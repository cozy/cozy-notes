!function(e){function t(t){for(var r,o,s=t[0],c=t[1],l=t[2],d=0,p=[];d<s.length;d++)o=s[d],Object.prototype.hasOwnProperty.call(i,o)&&i[o]&&p.push(i[o][0]),i[o]=0;for(r in c)Object.prototype.hasOwnProperty.call(c,r)&&(e[r]=c[r]);for(u&&u(t);p.length;)p.shift()();return a.push.apply(a,l||[]),n()}function n(){for(var e,t=0;t<a.length;t++){for(var n=a[t],r=!0,s=1;s<n.length;s++){var c=n[s];0!==i[c]&&(r=!1)}r&&(a.splice(t--,1),e=o(o.s=n[0]))}return e}var r={},i={4:0},a=[];function o(t){if(r[t])return r[t].exports;var n=r[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,o),n.l=!0,n.exports}o.e=function(e){var t=[],n=i[e];if(0!==n)if(n)t.push(n[2]);else{var r=new Promise((function(t,r){n=i[e]=[t,r]}));t.push(n[2]=r);var a,s=document.createElement("script");s.charset="utf-8",s.timeout=120,o.nc&&s.setAttribute("nonce",o.nc),s.src=function(e){return o.p+""+({1:"@atlaskit-internal_media-archive-viewer",2:"@atlaskit-internal_media-pdf-viewer",3:"@atlaskit-internal_media-viewer"}[e]||e)+"/notes."+{1:"01694905e77a5358823e",2:"17d8a127c2cb8e8e749d",3:"b0c61e3f9ea5dbf25f5c"}[e]+".js"}(e);var c=new Error;a=function(t){s.onerror=s.onload=null,clearTimeout(l);var n=i[e];if(0!==n){if(n){var r=t&&("load"===t.type?"missing":t.type),a=t&&t.target&&t.target.src;c.message="Loading chunk "+e+" failed.\n("+r+": "+a+")",c.name="ChunkLoadError",c.type=r,c.request=a,n[1](c)}i[e]=void 0}};var l=setTimeout((function(){a({type:"timeout",target:s})}),12e4);s.onerror=s.onload=a,document.head.appendChild(s)}return Promise.all(t)},o.m=e,o.c=r,o.d=function(e,t,n){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)o.d(n,r,function(t){return e[t]}.bind(null,r));return n},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="",o.oe=function(e){throw console.error(e),e};var s=window.webpackJsonp=window.webpackJsonp||[],c=s.push.bind(s);s.push=t,s=s.slice();for(var l=0;l<s.length;l++)t(s[l]);var u=c;a.push([1,0]),n()}({"/KVF":function(e,t,n){var r={"./atlassian_missing_french":"BwLP","./atlassian_missing_french.json":"BwLP","./en":"7dT6","./en.json":"7dT6","./fr":"9pOX","./fr.json":"9pOX"};function i(e){var t=a(e);return n(t)}function a(e){if(!n.o(r,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return r[e]}i.keys=function(){return Object.keys(r)},i.resolve=a,e.exports=i,i.id="/KVF"},0:function(e,t){},1:function(e,t,n){n("55Il"),n("7NIr"),e.exports=n("LiWt")},2:function(e,t){},3:function(e,t){},4:function(e,t){},"7dT6":function(e){e.exports=JSON.parse('{"Notes":{"Add":{"add_note":"Add a note"},"Delete":{"delete_note":"Delete","deleted":"The note has been moved to the trash of your Drive","failed":"The note could not be deleted, please try again"},"EditorView":{"main_placeholder":"Write anything…"},"Editor":{"title_placeholder":"Here is your title","exit_confirmation_message":"Automatic saving has not taken into account the latest changes in your doc. Please stay on your current note if you want to keep them.","exit_confirmation_title":"Abandon your changes?","exit_confirmation_leave":"Leave without saving","exit_confirmation_cancel":"Cancel","read_only":"This note is in read-only mode."},"Files":{"share":{"cta":"Share"}},"List":{"latest_notes":"Latest Notes","name":"Name","updated_at":"Updated at","location":"Location","sharings":"Sharings","at":"%{date} at %{time}"},"Empty":{"welcome":"Welcome on Cozy Notes","after_created":"Once your Note is created, you can find it in your "},"SavingIndicator":{"saved":{"default":"Up to date","just_now":"Up to date","secs_ago":"Up to date (saved %{time} sec. ago)","min_ago":"Up to date (saved %{time} min. ago)","mins_ago":"Up to date (saved %{time} min. ago)","hour_ago":"Up to date (saved %{time} hour ago)","hours_ago":"Up to date (saved %{time} hours ago)","day_ago":"Up to date (saved %{time} day ago)","days_ago":"Up to date (saved %{time} days ago)","month_ago":"Up to date (saved %{time} month ago)","monthes_ago":"Up to date (saved %{time} monthes ago)","year_ago":"Up to date (saved %{time} year ago)","years_ago":"Up to date (saved %{time} years ago)"},"saving":"Saving...","still_saving":"Saving......","out_of_sync":{"default":"Saved (off-line)","just_now":"Saved (off-line)","secs_ago":"Saved (off-line for %{time} sec)","min_ago":"Saved (off-line for %{time} min)","mins_ago":"Saved (off-line for %{time} min)","hour_ago":"Saved (off-line for %{time} hour)","hours_ago":"Saved (off-line for %{time} hours)","day_ago":"Saved (off-line for %{time} day)","days_ago":"Saved (off-line for %{time} days)","month_ago":"Saved (off-line for %{time} month)","monthes_ago":"Saved (off-line for %{time} monthes)","year_ago":"Saved (off-line for %{time} year)","years_ago":"Saved (off-line for %{time} years)"},"saving_impossible":{"default":"Changes unsaved (off-line)","just_now":"Changes unsaved (off-line)","secs_ago":"Changes unsaved (off-line for %{time} sec)","min_ago":"Changes unsaved (off-line for %{time} min)","mins_ago":"Changes unsaved (off-line for %{time} min)","hour_ago":"Changes unsaved (off-line for %{time} hour)","hours_ago":"Changes unsaved (off-line for %{time} hours)","day_ago":"Changes unsaved (off-line for %{time} day)","days_ago":"Changes unsaved (off-line for %{time} days)","month_ago":"Changes unsaved (off-line for %{time} month)","monthes_ago":"Changes unsaved (off-line for %{time} monthes)","year_ago":"Changes unsaved (off-line for %{time} year)","years_ago":"Changes unsaved (off-line for %{time} years)"}},"OfflineIndicator":{"message":"You\'re not connected to internet anymore. Your changes will be saved once you will be connected again."}},"Error":{"422":"Only images are accepted","unshared_title":"This share is no longer active","unshared_text":"The owner may have revoked this sharing. You can no longer edit a note at this address.","loading_error_title":"The note couldn\'t be loaded","loading_error_text_noReturnUrl":"The note may not exists anymore, or our servers may have a temporary glitch. Please try again later.","loading_error_text_returnUrl":"The note may not exists anymore, or our servers may have a temporary glitch. Please go <a href=\'%{url}\'>back</a> and try again later.","unknown_error":"An unexpected error occured","only_one_image":"You cannot drag and drop multiple pictures at the same time"},"manifest":{"short_description":"Cozy Notes is your personal and collaborative note-taking application.","long_description":"Notes is an online text editor that can already offer you to:\\n\\n* Create your own notes with the essential features (bold, underlined, links, tables...)\\n* Fill and find your notes with you other documents in files of your personal Drive\\n* Edit easily your notes from all your devices\\n* Access your notes offline\\n* For the fans, use shortcuts and input in markdown format ... and even write with contacts together on the same note (coming soon)!","screenshots":["screenshots/en/screenshot01.png","screenshots/en/screenshot02.png"]}}')},"84gJ":function(e,t,n){e.exports={"saving-indicator":"saving-indicator--rzoXB"}},"8AF3":function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var r={FLOATING_TOOLBAR_COMPONENT:"".concat("pm-alt-text","-alt-text-floating-toolbar")}},"9Hm3":function(e,t,n){"use strict";var r=n("lwsE"),i=n.n(r),a=n("W8MJ"),o=n.n(a),s=n("PJYZ"),c=n.n(s),l=n("7W2i"),u=n.n(l),d=n("a1gu"),p=n.n(d),f=n("Nsbk"),h=n.n(f),m=n("lSNA"),v=n.n(m),g=n("q1tI"),b=n.n(g),y=n("J+OG"),w=n("By3w"),O=n("9N10");function k(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=h()(e);if(t){var i=h()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return p()(this,n)}}var x=function(e){u()(n,e);var t=k(n);function n(e){var r;return i()(this,n),r=t.call(this,e),v()(c()(r),"handleRef",(function(e){r.setState({target:e||void 0})})),v()(c()(r),"updatePopupPlacement",(function(e){r.setState({popupPlacement:e})})),r.state={popupPlacement:["bottom","left"]},r}return o()(n,[{key:"renderDropdown",value:function(){var e=this.state.target,t=this.props,n=t.children,r=t.mountTo,i=t.boundariesElement,a=t.scrollableElement,o=t.onOpenChange,s=t.fitHeight,c=t.fitWidth,l=t.zIndex;return b.a.createElement(w.a,{target:e,mountTo:r,boundariesElement:i,scrollableElement:a,onPlacementChanged:this.updatePopupPlacement,fitHeight:s,fitWidth:c,zIndex:l},b.a.createElement("div",{style:{height:0,minWidth:c||0}},b.a.createElement(y.a,{disabled:!0,isOpen:!0,onOpenChange:o,appearance:"tall",position:"top left",shouldFlip:!1,shouldFitContainer:!0},n)))}},{key:"render",value:function(){var e=this.props,t=e.trigger,n=e.isOpen;return b.a.createElement(b.a.Fragment,null,b.a.createElement("div",{ref:this.handleRef},t),n?this.renderDropdown():null)}}]),n}(g.PureComponent),j=Object(O.a)(x);t.a=j},"9N10":function(e,t,n){"use strict";n.d(t,"a",(function(){return k}));var r=n("lwsE"),i=n.n(r),a=n("W8MJ"),o=n.n(a),s=n("PJYZ"),c=n.n(s),l=n("7W2i"),u=n.n(l),d=n("a1gu"),p=n.n(d),f=n("Nsbk"),h=n.n(f),m=n("lSNA"),v=n.n(m),g=n("q1tI"),b=n.n(g),y=n("i8i4"),w=n.n(y);function O(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=h()(e);if(t){var i=h()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return p()(this,n)}}function k(e){return function(t){u()(r,t);var n=O(r);function r(){var e;i()(this,r);for(var t=arguments.length,a=new Array(t),o=0;o<t;o++)a[o]=arguments[o];return e=n.call.apply(n,[this].concat(a)),v()(c()(e),"handleClick",(function(t){var n=w.a.findDOMNode(c()(e));(!n||t.target instanceof Node&&!n.contains(t.target))&&e.props.handleClickOutside&&e.props.handleClickOutside(t)})),v()(c()(e),"handleKeydown",(function(t){"Escape"===t.code&&e.props.handleEscapeKeydown?e.props.handleEscapeKeydown(t):"Enter"===t.code&&e.props.handleEnterKeydown&&e.props.handleEnterKeydown(t)})),e}return o()(r,[{key:"componentDidMount",value:function(){this.props.handleClickOutside&&document.addEventListener("click",this.handleClick,!1),this.props.handleEscapeKeydown&&document.addEventListener("keydown",this.handleKeydown,!1)}},{key:"componentWillUnmount",value:function(){this.props.handleClickOutside&&document.removeEventListener("click",this.handleClick,!1),this.props.handleEscapeKeydown&&document.removeEventListener("keydown",this.handleKeydown,!1)}},{key:"render",value:function(){return b.a.createElement(e,this.props)}}]),r}(g.PureComponent)}},"9pOX":function(e){e.exports=JSON.parse('{"Notes":{"Add":{"add_note":"Ajouter une note"},"Delete":{"delete_note":"Supprimer","deleted":"La note a été placée dans la corbeille de votre Drive","failed":"La note n\'a pas pu être supprimée, merci de re-essayer plus tard"},"EditorView":{"main_placeholder":"Écrivez ce que vous souhaitez…"},"Editor":{"title_placeholder":"Ici votre titre","exit_confirmation_message":"La sauvegarde automatique n\'a pas encore pris en compte vos dernières modifications. Merci de retourner sur votre note pour ne pas les perdre.","exit_confirmation_title":"Abandonner les modifications ?","exit_confirmation_leave":"Quitter sans sauvegarder","exit_confirmation_cancel":"Retour","read_only":"Cette note est en mode lecture-seule."},"Files":{"share":{"cta":"Partager"}},"List":{"latest_notes":"Notes récentes","name":"Nom","updated_at":"Mise à jour","location":"Emplacement","sharings":"Partage","at":"%{date} à %{time}"},"Empty":{"welcome":"Bienvenue sur Cozy Notes","after_created":"Une fois votre note créée, il vous est possible de la retrouver dans "},"SavingIndicator":{"saved":{"default":"À jour","just_now":"À jour","secs_ago":"À jour (enregistré il y a %{time} sec.)","min_ago":"À jour (enregistré il y a %{time} min.)","mins_ago":"À jour (enregistré il y a %{time} min.)","hour_ago":"À jour (enregistré il y a %{time} heure)","hours_ago":"À jour (enregistré il y a %{time} heures)","day_ago":"À jour (enregistré il y a %{time} jour)","days_ago":"À jour (enregistré il y a %{time} jours)","month_ago":"À jour (enregistré il y a %{time} mois)","monthes_ago":"À jour (enregistré il y a %{time} mois)","year_ago":"À jour (enregistré il y a %{time} an)","years_ago":"À jour (enregistré il y a %{time} ans)"},"saving":"Enregistrement en cours...","still_saving":"Enregistrement en cours......","out_of_sync":{"default":"Enregistré (hors ligne)","just_now":"Enregistré (hors ligne)","secs_ago":"Enregistré (hors ligne depuis %{time} sec)","min_ago":"Enregistré (hors ligne depuis %{time} min)","mins_ago":"Enregistré (hors ligne depuis %{time} min)","hour_ago":"Enregistré (hors ligne depuis %{time} h)","hours_ago":"Enregistré (hors ligne depuis %{time} h)","day_ago":"Enregistré (hors ligne depuis %{time} jour)","days_ago":"Enregistré (hors ligne depuis %{time} jours)","month_ago":"Enregistré (hors ligne depuis %{time} mois)","monthes_ago":"Enregistré (hors ligne depuis %{time} mois)","year_ago":"Enregistré (hors ligne depuis %{time} an)","years_ago":"Enregistré (hors ligne depuis %{time} ans)"},"saving_impossible":{"default":"Non enregistré (hors ligne)","just_now":"Non enregistré (hors ligne)","secs_ago":"Non enregistré (hors ligne depuis %{time} sec)","min_ago":"Non enregistré (hors ligne depuis %{time} min)","mins_ago":"Non enregistré (hors ligne depuis %{time} min)","hour_ago":"Non enregistré (hors ligne depuis %{time} h)","hours_ago":"Non enregistré (hors ligne depuis %{time} h)","day_ago":"Non enregistré (hors ligne depuis %{time} jour)","days_ago":"Non enregistré (hors ligne depuis %{time} jours)","month_ago":"Non enregistré (hors ligne depuis %{time} mois)","monthes_ago":"Non enregistré (hors ligne depuis %{time} mois)","year_ago":"Non enregistré (hors ligne depuis %{time} an)","years_ago":"Non enregistré (hors ligne depuis %{time} ans)"}},"OfflineIndicator":{"message":"Vous n’êtes plus connecté à internet. Vos modifications seront enregistrées quand vous serez connecté à nouveau."}},"Error":{"422":"Seules les images sont acceptées","unshared_title":"Le partage n\'est plus actif","unshared_text":"Le propriétaire a peut-être révoqué ce partage. Vous ne pouvez plus éditer de note à cette adresse.","loading_error_title":"La note n\'a pas pu être chargée","loading_error_text_noReturnUrl":"Cette note n\'existe peut-être plus, ou nos serveurs ont peut-être un moment d\'égarement. Merci de retenter plus tard.","loading_error_text_returnUrl":"Cette note n\'existe peut-être plus, ou nos serveurs ont peut-être un moment d\'égarement. Merci revenir <a href=\'%{url}\'>en arrière</a> et de retenter plus tard.","unknown_error":"Une erreur inattendue s\'est produite","only_one_image":"Vous ne pouvez pas glisser-déposer plusieurs images en même temps"},"manifest":{"short_description":"Cozy Notes est votre application de prise de notes personnelles et collaboratives.","long_description":"Notes est un éditeur de texte en ligne destiné à :\\n\\n* Créer vos propres notes avec les fonctionnalités essentielles (gras, souligné, liens, tableaux...)\\n* Classer et retrouver vos notes avec vos autres documents, dans les répertoires de votre Drive personnel\\n* Éditer facilement vos notes depuis tous vos appareils\\n* Accéder à vos notes, même sans internet, stockées sur votre PC\\n* Pour les aficionados, utiliser les raccourcis et la saisie au format markdown\\n*  ... et même écrire à plusieurs simultanément sur la même note (à venir) ! ","screenshots":["screenshots/fr/screenshot01.png","screenshots/fr/screenshot02.png"]}}')},AP7J:function(e,t,n){"use strict";n.d(t,"a",(function(){return d}));var r,i=n("VkAN"),a=n.n(i),o=n("vOnD"),s=n("5GI9"),c=n("uCUl"),l=n("73wN"),u=n("b2LO"),d=Object(o.css)(r||(r=a()(["\n  .ProseMirror {\n    "," & [layout='full-width'] .",",\n    & [layout='wide'] ."," {\n      margin-left: 50%;\n      transform: translateX(-50%);\n    }\n\n    & [layout^='wrap-'] + [layout^='wrap-'] {\n      clear: none;\n      & + p,\n      & + div[class^='fabric-editor-align'],\n      & + ul,\n      & + ol,\n      & + h1,\n      & + h2,\n      & + h3,\n      & + h4,\n      & + h5,\n      & + h6 {\n        clear: both !important;\n      }\n      & ."," {\n        margin-left: 0;\n        margin-right: 0;\n      }\n    }\n\n    .mediaSingleView-content-wrap[layout^='wrap-'] {\n      max-width: 100%;\n      // overwrite default Prosemirror setting making it clear: both\n      clear: inherit;\n    }\n\n    .mediaSingleView-content-wrap[layout='wrap-left'] {\n      float: left;\n    }\n\n    .mediaSingleView-content-wrap[layout='wrap-right'] {\n      float: right;\n    }\n\n    .mediaSingleView-content-wrap[layout='wrap-right']\n      + .mediaSingleView-content-wrap[layout='wrap-left'] {\n      clear: both;\n    }\n\n    /* Larger margins for resize handlers when at depth 0 of the document */\n    & > .mediaSingleView-content-wrap {\n      .richMedia-resize-handle-right {\n        margin-right: -","px;\n      }\n      .richMedia-resize-handle-left {\n        margin-left: -","px;\n      }\n    }\n  }\n\n  .richMedia-resize-handle-right,\n  .richMedia-resize-handle-left {\n    display: flex;\n    flex-direction: column;\n\n    /* vertical align */\n    justify-content: center;\n  }\n\n  .richMedia-resize-handle-right {\n    align-items: flex-end;\n    padding-right: 12px;\n    margin-right: -","px;\n  }\n\n  .richMedia-resize-handle-left {\n    align-items: flex-start;\n    padding-left: 12px;\n    margin-left: -","px;\n  }\n\n  .richMedia-resize-handle-right::after,\n  .richMedia-resize-handle-left::after {\n    content: ' ';\n    display: flex;\n    width: 3px;\n    height: 64px;\n\n    border-radius: 6px;\n  }\n\n  .",":hover .richMedia-resize-handle-left::after,\n  .",":hover .richMedia-resize-handle-right::after {\n    background: ",";\n  }\n\n  ."," .richMedia-resize-handle-right::after,\n  ."," .richMedia-resize-handle-left::after,\n  ."," .richMedia-resize-handle-right:hover::after,\n  ."," .richMedia-resize-handle-left:hover::after,\n  .",".is-resizing .richMedia-resize-handle-right::after,\n  .",".is-resizing .richMedia-resize-handle-left::after {\n    background: ",";\n  }\n\n  .__resizable_base__ {\n    left: unset !important;\n    width: auto !important;\n    height: auto !important;\n  }\n\n  /* Danger when top level node for smart cards / inline links */\n  .danger > div > div > .media-card-frame,\n  .danger > span > a {\n    background-color: ",";\n    box-shadow: 0px 0px 0px ","px\n      ",";\n    transition: background-color 0s;\n    transition: box-shadow 0s;\n  }\n\n  /* Danger when nested node or common */\n  .danger {\n    /* Media single */\n    ."," .","::after {\n      border: ","px solid ",";\n    }\n\n    .richMedia-selected .richMedia-resize-handle-right::after,\n    .richMedia-selected .richMedia-resize-handle-left::after {\n      background: ",";\n    }\n\n    /* Smart cards */\n    div div .media-card-frame,\n    .inlineCardView-content-wrap > span > a {\n      background-color: rgb(255, 189, 173, 0.5); /* R75 with 50% opactiy */\n      transition: background-color 0s;\n    }\n\n    div div .media-card-frame::after {\n      box-shadow: none;\n    }\n  }\n"])),s.a,s.b,s.b,s.b,c.v,c.v,c.u,c.u,s.b,s.b,l.N60,c.H,c.H,s.b,s.b,s.b,s.b,l.B200,c.h,c.D,c.j,s.b,u.b,c.D,c.j,c.j)},BwLP:function(e){e.exports=JSON.parse('{"fabric.editor.editMode.inviteToEditButton.title":"Inviter à éditer","fabric.editor.blockquote2":"Citation","fabric.editor.remove":"Supprimer","fabric.editor.linkPlaceholder":"Coller le lien","fabric.editor.linkAddress":"Adresse du lien","fabric.editor.layoutWide":"Élargir","fabric.editor.layoutFullWidth":"Pleine largeur","fabric.editor.layoutFixedWidth":"Retour au centre","fabric.editor.alignImageLeft":"Aligner l\'image à gauche","fabric.editor.alignImageCenter":"Centrer l\'image","fabric.editor.alignImageRight":"Aligner l\'image à droite","fabric.editor.numberedColumn":"Lignes numérotées"}')},"G0/2":function(e,t,n){var r={"./en.json":"6wRk","./fr.json":"wNxD"};function i(e){var t=a(e);return n(t)}function a(e){if(!n.o(r,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return r[e]}i.keys=function(){return Object.keys(r)},i.resolve=a,e.exports=i,i.id="G0/2"},G2JP:function(e,t,n){"use strict";var r=n("q1tI"),i=n.n(r).a.createContext(!1);t.a=i},KDJG:function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var r=function(e){return!!e&&(e.indexOf("image/")>-1||e.indexOf("video/")>-1)}},LiWt:function(e,t,n){"use strict";n.r(t),n.d(t,"initApp",(function(){return N}));var r=n("lSNA"),i=n.n(r),a=(n("llna"),n("/8/d"),n("3FT0"),n("VxdY"),n("q1tI")),o=n.n(a),s=n("i8i4"),c=n.n(s),l=n("JRPe"),u=n("44Ds"),d=n.n(u),p=n("PRV4"),f=n("o8Rm"),h=n("Kwg8"),m=n("nnJL"),v=n("xIbs"),g=n("SH7X"),b=n.n(g),y=n("oJ5p"),w=n("buk/"),O=n("goAg"),k=n("UmWK"),x=n("qvEe"),j=n("G2JP"),P=n("X3v2");function E(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function C(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?E(Object(n),!0).forEach((function(t){i()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):E(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var S=n("pZg0"),_=n("BwLP"),M={en:{react:n("PTt1"),atlaskit:h.a},fr:{react:n("Z6Ro"),atlaskit:C(C({},m.a),_)}},D=Object(p.a)({disableGlobal:!0}),N=function(){var e=Object(P.b)(),t=Object(P.a)(e.app.icon,n("ZAKO")),r=Object(P.a)(e.app.prefix||S.name_prefix,""),i=Object(P.a)(e.app.name,S.name),a=Object(P.a)(e.app.slug,S.slug),s=Object(P.a)(e.app.version,S.version);Object(l.d)(M.en.react),Object(l.d)(M.fr.react);var u=Object(P.a)(e.locale,"en"),d=["en","fr"].includes(u)?u:"en",p=window.location?window.location.protocol:"https:",f=Object(P.c)(),h=f||e.token,m=Boolean(f||!h||""==h),v=new b.a({uri:"".concat(p,"//").concat(e.domain),token:h,appMetadata:{slug:a,version:s}});return O.Document.cozyClient||O.Document.registerClient(v),v.registerPlugin(y.RealtimePlugin),m||(window.React=o.a,window.ReactDOM=c.a,cozy.bar.init({appName:i,appNamePrefix:r,iconPath:t,lang:d,replaceTitleOnMobile:!0,cozyClient:v,isPublic:m})),{appLocale:d,client:v,isPublic:m}},I=d()(N);document.addEventListener("DOMContentLoaded",(function(){var e=I();!function(e,t,r){var i=n("pL5B").default;Object(s.render)(o.a.createElement(x.WebviewIntentProvider,null,o.a.createElement(w.b,{lang:e,dictRequire:function(e){return n("/KVF")("./".concat(e))}},o.a.createElement(f.b,{generateClassName:D},o.a.createElement(l.c,{locale:e,messages:M[e].atlaskit},o.a.createElement(g.CozyProvider,{client:t},o.a.createElement(v.a,null,o.a.createElement(j.a.Provider,{value:r},!r&&o.a.createElement(k.a,{doctype:"io.cozy.files",documentType:"Notes",previewPath:"/preview/"},o.a.createElement(i,{isPublic:r})),r&&o.a.createElement(i,{isPublic:r})))))))),document.querySelector("[role=application]"))}(e.appLocale,e.client,e.isPublic)}))},Q2Eh:function(e,t,n){e.exports={"note-article":"note-article--2yQdC",banner:"banner--1nSEd",title:"title--2DQ8I",titleInput:"titleInput--2ERlh"}},"R3/7":function(e,t,n){e.exports={"sharing-button":"sharing-button--nzFli"}},RMII:function(e,t,n){e.exports={empty:"empty--FqnXy",appHeader:"appHeader--2ilS0",tableSpecialRow:"tableSpecialRow--4oekp",tableCellEmpty:"tableCellEmpty--21fZ1",tableCellName:"tableCellName--2Jak9",tableCell:"tableCell--3-jDP",tableRow:"tableRow--3SicR",notable:"notable--tK8uq",actionMenuItem:"actionMenuItem--17ajc"}},VxdY:function(e,t,n){},X3v2:function(e,t,n){"use strict";n.d(t,"b",(function(){return r})),n.d(t,"a",(function(){return i})),n.d(t,"c",(function(){return a}));n("dasq");var r=function(){var e=document.querySelector("[role=application]");return JSON.parse(e.dataset.cozy)},i=function(e,t){return/^\{\{\.[a-zA-Z]*\}\}$/.test(e)?t:e},a=function(){return new URLSearchParams(window.location.search).get("sharecode")}},YVgD:function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var r=new(n("UxO+").PluginKey)("mediaPlugin")},ZAKO:function(e,t){e.exports="/img/icon.ade48547fed1e1897b253182a9038251.svg"},byNj:function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var r=new(n("UxO+").PluginKey)("imageUploadPlugin")},ckle:function(e,t,n){"use strict";n.d(t,"f",(function(){return f})),n.d(t,"e",(function(){return h})),n.d(t,"d",(function(){return m})),n.d(t,"h",(function(){return v})),n.d(t,"c",(function(){return k})),n.d(t,"g",(function(){return j})),n.d(t,"i",(function(){return P})),n.d(t,"j",(function(){return E})),n.d(t,"a",(function(){return S})),n.d(t,"k",(function(){return _})),n.d(t,"l",(function(){return N})),n.d(t,"b",(function(){return I}));var r=n("ABBN"),i=(n("MEpN"),n("UxO+")),a=n("mG1W"),o=n("8Uts"),s=n("k9uR"),c=n("Q4kT"),l=n("Vlyn"),u=n("KDJG"),d=n("4Wbe"),p=n("W4PY"),f=(n("YDJT"),function(e){return j(e)||w(e)||v(e)||g(e)}),h=function(e){var t=e.selection.node;return t&&t.type!==e.schema.nodes.media&&t.isBlock},m=function(e){var t=e.selection.node;return t&&t.type===e.schema.nodes.mediaSingle},v=function(e){if(Object(d.a)(e))return O(e,e.selection.$from)},g=function(e){if(e.selection instanceof p.a){var t=e.selection.$from,n=e.schema.nodes.mediaGroup;return b(t,n)||y(t,n)}},b=function(e,t){if(e.nodeBefore&&e.nodeBefore.type===t)return e.pos-e.nodeBefore.nodeSize+1},y=function(e,t){if(e.nodeAfter&&e.nodeAfter.type===t)return e.pos+1},w=function(e){if(Object(d.c)(e))return x(e,e.selection.$to)},O=function(e,t){var n,r;if(h(e)?(n=t.pos,r=t.nodeBefore):(n=Object(d.f)(t)-1,r=e.doc.resolve(n).nodeBefore),r&&r.type===e.schema.nodes.mediaGroup)return n-r.nodeSize+1},k=function(e){return e.selection.$from.parent.type===e.schema.nodes.paragraph&&Object(d.a)(e)&&Object(d.c)(e)},x=function(e,t){var n,r,i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(h(e)?(n=t.pos,r=t.nodeAfter):(n=Object(d.e)(t),r=e.doc.nodeAt(n)),r&&r.type===e.schema.nodes.mediaGroup)return i?n+1:n+r.nodeSize-1},j=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=e.selection.$from;if((t=t||r).parent.type===e.schema.nodes.mediaGroup)return n?Object(d.f)(t):Object(d.e)(t)-1};var P=function(e,t,n){var r=t.attrs.id,o=e.state,c=o.tr,l=o.selection,u=o.doc,p=n();c.deleteRange(p,p+t.nodeSize),Object(s.r)(r)&&c.setMeta("addToHistory",!1);var f=u.resolve(p),h=f.nodeBefore,m=f.parent,v=f.index()===m.childCount-1;if(l.from===p&&!v&&!Object(d.b)(o)&&h&&"media"===h.type.name){var g=Object(a.findPositionOfNodeBefore)(c.selection);g&&c.setSelection(i.NodeSelection.create(c.doc,g))}e.dispatch(c)},E=function(e){var t=e.state.selection;return t instanceof i.NodeSelection&&t.node.type===e.state.schema.nodes.media&&(Object(r.e)(e.state,e.dispatch),t.$to.nodeAfter?(Object(r.g)(e.state,e.dispatch),Object(o.e)(!1)(e.state,e.dispatch)):Object(o.c)(e.state,e.dispatch),!0)},C=function(e){return e.length>1&&"_"===e[0]&&"_"===e[1]},S=function(e,t){Object.keys(t.attrs).filter(C).forEach((function(n){var r=n.substring(2),i=e[r];void 0!==i&&(t.attrs[n]=i)}))},_=function(e,t){var n=t.nodes,r=n.mediaGroup,i=n.mediaSingle,a=n.media;return Object(c.e)(e,(function(e,t){return t||e.type!==a?e:i&&(Object(u.a)(e.attrs.__fileMimeType)||"external"===e.attrs.type)?i.createChecked({},e):r.createChecked({},[e])}))},M=function(e){return"0"===e.style.opacity||"none"===e.style.display||"hidden"===e.style.visibility},D=["DIV","TD"];var N=function(e){var t=(new DOMParser).parseFromString(e,"text/html").body,n=t.querySelector('b[id^="docs-internal-guid-"]');n&&Object(l.g)(t,n);var r=t.querySelectorAll("img");return r.length?(r.forEach((function(e){var n=e.parentElement;if(n)if(M(n)||M(e))n.removeChild(e);else if(!(n instanceof HTMLDivElement)){var r=Object(l.h)(n,(function(e){return e.parentElement===t||function(e){return!!e&&-1!==D.indexOf(e.tagName)}(e.parentElement)}));r&&r.parentElement&&(r.parentElement.insertBefore(e,r.nextElementSibling||r),n.innerText=n.innerText.trim(),Object(l.f)(n))}})),t.lastElementChild&&"BR"===t.lastElementChild.tagName&&t.removeChild(t.lastElementChild),t.innerHTML):e},I=function(e){if(!m(e))return null;var t=e.tr,n=t.selection.from+1,r=t.doc.nodeAt(n);return r&&r.type===e.schema.nodes.media?r:null}},dojK:function(e,t,n){"use strict";var r,i,a,o,s,c,l;n.d(t,"d",(function(){return r})),n.d(t,"c",(function(){return i})),n.d(t,"f",(function(){return a})),n.d(t,"e",(function(){return o})),n.d(t,"g",(function(){return s})),n.d(t,"a",(function(){return c})),n.d(t,"i",(function(){return l})),n.d(t,"h",(function(){return d})),n.d(t,"b",(function(){return u})),function(e){e.NoFileFoundAfterInput="No File was detected during the upload procedure.",e.FileNotProcessable="Could not process the uploaded image.",e.CouldNotFindFileInCurrentNote="Could not find file in current note.",e.MissingCollabEdit="`CollabEditProvider` was `undefined` in `fetchCozyImage`. <Media> was unable to fetch the image source. The component might be unmounted.",e.CouldNotGetNoteImages="MediaNode failed to fetch included files in the current note"}(r||(r={})),function(e){e.Input="input"}(i||(i={})),function(e){e.File="file"}(a||(a={})),function(e){e.Click="click",e.Change="change",e.Drop="drop",e.Paste="paste"}(o||(o={})),function(e){e.Created="CREATED",e.Updated="UPDATED"}(s||(s={})),function(e){e.Files="io.cozy.files",e.NoteEvents="io.cozy.notes.events",e.Thumbnails="io.cozy.files.thumbnails"}(c||(c={})),function(e){e.Drive="drive",e.Home="home",e.Notes="notes"}(l||(l={}));var u,d="/preview/";!function(e){e.Files="Files",e.Notes="Notes"}(u||(u={}))},gROp:function(e,t,n){"use strict";n.d(t,"a",(function(){return L}));var r,i,a,o=n("lwsE"),s=n.n(o),c=n("W8MJ"),l=n.n(c),u=n("PJYZ"),d=n.n(u),p=n("7W2i"),f=n.n(p),h=n("a1gu"),m=n.n(h),v=n("Nsbk"),g=n.n(v),b=n("lSNA"),y=n.n(b),w=n("VkAN"),O=n.n(w),k=n("q1tI"),x=n.n(k),j=n("vOnD"),P=n("J+OG"),E=n("oNmO"),C=n("eoVD"),S=n("xVUm"),_=n("By3w"),M=n("uCUl"),D=n("9N10");function N(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=g()(e);if(t){var i=g()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return m()(this,n)}}var I=j.default.div(r||(r=O()(["\n  /* tooltip in ToolbarButton is display:block */\n  & > div > div {\n    display: flex;\n  }\n"]))),T=Object(D.a)(P.a),A=j.default.div(i||(i=O()(["\n  ",";\n"])),(function(e){return e.isSelected?"&& > span, && > span:hover { background: #6c798f; color: #fff; }":""})),R=j.default.span(a||(a=O()(["\n  ",";\n"])),(function(e){return e.hasElemBefore?"margin-left: 8px;":""})),L=function(e){f()(n,e);var t=N(n);function n(){var e;s()(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return e=t.call.apply(t,[this].concat(i)),y()(d()(e),"state",{popupPlacement:["bottom","left"]}),y()(d()(e),"handleRef",(function(t){e.setState({target:t||void 0})})),y()(d()(e),"updatePopupPlacement",(function(t){e.setState({popupPlacement:t})})),y()(d()(e),"handleClose",(function(){e.props.onOpenChange&&e.props.onOpenChange({isOpen:!1})})),e}return l()(n,[{key:"renderItem",value:function(e){var t=this.props,n=t.onItemActivated,r=t.onMouseEnter,i=t.onMouseLeave;if(!e.onClick&&!e.value&&!e.value.name)return x.a.createElement("span",{key:String(e.content)},e.content);var a=x.a.createElement(A,{key:e.key||e.content,isSelected:e.isActive},x.a.createElement(E.a,{elemBefore:e.elemBefore,elemAfter:e.elemAfter,isDisabled:e.isDisabled,onClick:function(){return n&&n({item:e})},onMouseEnter:function(){return r&&r({item:e})},onMouseLeave:function(){return i&&i({item:e})},className:e.className},x.a.createElement(R,{hasElemBefore:!!e.elemBefore},e.content)));return e.tooltipDescription?x.a.createElement(S.a,{key:e.key||e.content,content:e.tooltipDescription,position:e.tooltipPosition},a):a}},{key:"renderDropdownMenu",value:function(){var e=this,t=this.state,n=t.target,r=t.popupPlacement,i=this.props,a=i.items,o=i.mountTo,s=i.boundariesElement,c=i.scrollableElement,l=i.offset,u=i.fitHeight,d=i.fitWidth,p=i.isOpen,f=i.zIndex,h=a[0].items.some((function(e){return"Cell background"===e.content}))?r.join(" "):"top left";return x.a.createElement(_.a,{target:p?n:void 0,mountTo:o,boundariesElement:s,scrollableElement:c,onPlacementChanged:this.updatePopupPlacement,fitHeight:u,fitWidth:d,zIndex:f||M.n,offset:l},x.a.createElement(T,{isOpen:!0,appearance:"tall",position:h,shouldFlip:!1,shouldFitContainer:!0,isTriggerNotTabbable:!0,handleClickOutside:this.handleClose,handleEscapeKeydown:this.handleClose},x.a.createElement("div",{style:{height:0,minWidth:d||0}}),a.map((function(t,n){return x.a.createElement(C.a,{key:n},t.items.map((function(t){return e.renderItem(t)})))}))))}},{key:"render",value:function(){var e=this.props,t=e.children,n=e.isOpen;return x.a.createElement(I,null,x.a.createElement("div",{ref:this.handleRef},t),n?this.renderDropdownMenu():null)}}]),n}(k.PureComponent)},he1T:function(e,t,n){e.exports={"header-menu":"header-menu--HN4tE","app-icon":"app-icon--2S30F","home-link":"home-link--3zbZf","file-infos":"file-infos--1KJvL"}},kabT:function(e,t,n){"use strict";n.d(t,"d",(function(){return P})),n.d(t,"b",(function(){return E})),n.d(t,"c",(function(){return C})),n.d(t,"e",(function(){return _})),n.d(t,"a",(function(){return M}));var r=n("lSNA"),i=n.n(r),a=n("MEpN"),o=n("mG1W"),s=n("E6jh"),c=n("qXKI"),l=n("uCUl"),u=n("k9uR"),d=n("avnJ"),p=n("ckle"),f=n("Q4kT"),h=n("9J0+"),m=n("ctWQ"),v=n("oSw/"),g=n("3Pol"),b=n("KDJG"),y=n("4Wbe");function w(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function O(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?w(Object(n),!0).forEach((function(t){i()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):w(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var k=function(e,t){return{action:h.a.INSERTED,actionSubject:h.b.DOCUMENT,actionSubjectId:h.c.MEDIA,attributes:{inputMethod:e,fileExtension:t,type:h.c.MEDIA_SINGLE},eventType:h.d.TRACK}};function x(e){return Object(y.a)(e)&&!Object(u.d)(e.selection,e.doc,d.g)}function j(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return function(n,r){var i=n.tr,o=n.schema.nodes.paragraph,s=t.inputMethod,c=t.fileExtension,l=0;return x(n)&&(e.push(o.create()),l=1),i.replaceSelection(new a.Slice(a.Fragment.from(e),0,l)),s&&Object(m.a)(n,i,k(s,c)),r&&r(i),!0}}var P=function(e,t){return!!e.nodes.mediaSingle&&Object(b.a)(t)},E=function(e,t,n){var r=e.state,i=e.dispatch,a=r.schema.nodes,o=a.mediaSingle,s=a.media;return!!o&&(!(t.type!==s||!Object(b.a)(t.attrs.__fileMimeType)&&"external"!==t.attrs.type)&&j([o.create({},t)],{inputMethod:n,fileExtension:t.attrs.__fileMimeType})(r,i))},C=function(e,t,n,r,i){if(void 0===r)return!1;var s,c=e.state,l=e.dispatch,u=c.selection.$from.node(-1),d=S(c.schema,r,i)(t),p=u&&u.type.validContent(a.Fragment.from(d));if(t.fileName){var f=t.fileName.lastIndexOf(".");s=f>=0?t.fileName.substring(f+1):void 0}if(p)j([d],{fileExtension:s,inputMethod:n})(c,l);else{var h=null;if(Object(g.b)(e.state).newInsertionBehaviour&&(h=Object(v.b)(d,c.selection.from)(c.tr)),!h){var b=x(e.state)?a.Fragment.fromArray([d,c.schema.nodes.paragraph.create()]):d;h=Object(o.safeInsert)(b,void 0,!0)(c.tr)}n&&(h=Object(m.a)(c,h,k(n,s))),l(h)}return!0},S=function(e,t,n){return function(r){var i=r.id,a=r.dimensions,o=r.contextId,s=r.scaleFactor,c=void 0===s?1:s,l=a||{height:void 0,width:void 0},u=l.width,d=l.height,f=e.nodes,h=f.media,m=f.mediaSingle,v=h.create({id:i,type:"file",collection:t,contextId:o,width:u&&Math.round(u/c),height:d&&Math.round(d/c)}),g=n?{layout:"align-start"}:{};return Object(p.a)(r,v),m.createChecked(g,v)}};function _(e,t){var n=t.nodes,r=n.mediaSingle,i=n.layoutSection,a=n.table,s=n.bulletList,c=n.orderedList,l=n.media,u=n.expand;return function(t){var n=e;return Object(o.hasParentNodeOfType)([i,a,s,c,u])(t)&&(n=Object(f.e)(n,(function(e){return"mediaSingle"===e.type.name?r.createChecked({},e.content,e.marks):e}))),n=Object(f.e)(n,(function(e){return"media"===e.type.name&&"external"===e.attrs.type?l.createChecked(O(O({},e.attrs),{},{__external:!0}),e.content,e.marks):e}))}}var M=function(e){var t=e.origWidth,n=e.origHeight,r=e.layout,i=e.pctWidth,a=e.containerWidth,o=e.resizedPctWidth,c=a.width,u=a.lineLength,d=D(a,i,t,n),p=D(a,o,t,n);if("wide"===r){if(u){var f=Math.ceil(u*l.Z);return f>c?u:f}}else{if("full-width"===r)return c-l.d;if(d)return s.e.indexOf(r)>-1?p?o<50?p:d:Math.max(d,t):p||d;if("center"===r)return p||Math.min(t,u||c);if(r&&-1!==s.e.indexOf(r)){var h=Math.ceil((u||c)/2);return t<=h?t:h}}return t},D=function(e,t,n,r){return t&&n&&r&&Math.ceil(Object(c.d)(t/100,e.lineLength||e.width))}},nw0P:function(e,t,n){var r={"./_lib/build_formatting_tokens_reg_exp/index.js":"kOWh","./ar/build_distance_in_words_locale/index.js":"XxX6","./ar/build_format_locale/index.js":"alis","./ar/index.js":"EDRf","./be/build_distance_in_words_locale/index.js":"LQ09","./be/build_format_locale/index.js":"kj7F","./be/index.js":"YEhR","./bg/build_distance_in_words_locale/index.js":"7K3h","./bg/build_format_locale/index.js":"RrdL","./bg/index.js":"isx8","./ca/build_distance_in_words_locale/index.js":"wqqj","./ca/build_format_locale/index.js":"qcV0","./ca/index.js":"Vwa+","./cs/build_distance_in_words_locale/index.js":"ZKDM","./cs/build_format_locale/index.js":"ipyF","./cs/index.js":"dvhP","./da/build_distance_in_words_locale/index.js":"2Mgc","./da/build_format_locale/index.js":"Gned","./da/index.js":"7ur/","./de/build_distance_in_words_locale/index.js":"5IWf","./de/build_format_locale/index.js":"THCn","./de/index.js":"bgw5","./el/build_distance_in_words_locale/index.js":"o/GB","./el/build_format_locale/index.js":"8T9h","./el/index.js":"dH0v","./en/build_distance_in_words_locale/index.js":"LZbM","./en/build_format_locale/index.js":"6DAA","./en/index.js":"Us+F","./eo/build_distance_in_words_locale/index.js":"qrnn","./eo/build_format_locale/index.js":"Bl15","./eo/index.js":"UB7v","./es/build_distance_in_words_locale/index.js":"GEfZ","./es/build_format_locale/index.js":"O+zC","./es/index.js":"/S0t","./fi/build_distance_in_words_locale/index.js":"VHtQ","./fi/build_format_locale/index.js":"Oydx","./fi/index.js":"ndVD","./fil/build_distance_in_words_locale/index.js":"uq4p","./fil/build_format_locale/index.js":"d7hw","./fil/index.js":"pNfm","./fr/build_distance_in_words_locale/index.js":"IzMR","./fr/build_format_locale/index.js":"I3Zg","./fr/index.js":"LKA2","./hr/build_distance_in_words_locale/index.js":"DPvn","./hr/build_format_locale/index.js":"puw3","./hr/index.js":"L9Jq","./hu/build_distance_in_words_locale/index.js":"w2RQ","./hu/build_format_locale/index.js":"/0iD","./hu/index.js":"Nm+E","./id/build_distance_in_words_locale/index.js":"JbvB","./id/build_format_locale/index.js":"0wlw","./id/index.js":"A6C3","./is/build_distance_in_words_locale/index.js":"qzMC","./is/build_format_locale/index.js":"S3yD","./is/index.js":"N4bE","./it/build_distance_in_words_locale/index.js":"MDEp","./it/build_format_locale/index.js":"aUJd","./it/index.js":"hmb4","./ja/build_distance_in_words_locale/index.js":"nNvt","./ja/build_format_locale/index.js":"buui","./ja/index.js":"uAXs","./ko/build_distance_in_words_locale/index.js":"oEw+","./ko/build_format_locale/index.js":"9SQf","./ko/index.js":"iW8+","./mk/build_distance_in_words_locale/index.js":"nmwZ","./mk/build_format_locale/index.js":"htxJ","./mk/index.js":"GzBU","./nb/build_distance_in_words_locale/index.js":"SL1f","./nb/build_format_locale/index.js":"CJ5F","./nb/index.js":"73vv","./nl/build_distance_in_words_locale/index.js":"Uyu0","./nl/build_format_locale/index.js":"doCD","./nl/index.js":"hCQt","./pl/build_distance_in_words_locale/index.js":"FUBD","./pl/build_format_locale/index.js":"nOYf","./pl/index.js":"B6yL","./pt/build_distance_in_words_locale/index.js":"aTPA","./pt/build_format_locale/index.js":"TTT0","./pt/index.js":"gdks","./ro/build_distance_in_words_locale/index.js":"gI+A","./ro/build_format_locale/index.js":"njjO","./ro/index.js":"r2yp","./ru/build_distance_in_words_locale/index.js":"KmPx","./ru/build_format_locale/index.js":"UUBw","./ru/index.js":"nz/o","./sk/build_distance_in_words_locale/index.js":"q2Bs","./sk/build_format_locale/index.js":"9sxn","./sk/index.js":"Wqan","./sl/build_distance_in_words_locale/index.js":"mlv2","./sl/build_format_locale/index.js":"vHkZ","./sl/index.js":"KYSo","./sr/build_distance_in_words_locale/index.js":"LlkS","./sr/build_format_locale/index.js":"RhjJ","./sr/index.js":"7mU3","./sv/build_distance_in_words_locale/index.js":"UNBN","./sv/build_format_locale/index.js":"zTNB","./sv/index.js":"hxgj","./th/build_distance_in_words_locale/index.js":"XAGa","./th/build_format_locale/index.js":"We2s","./th/index.js":"Pk+z","./tr/build_distance_in_words_locale/index.js":"aFZF","./tr/build_format_locale/index.js":"jh7A","./tr/index.js":"3ZWG","./zh_cn/build_distance_in_words_locale/index.js":"KdB7","./zh_cn/build_format_locale/index.js":"l4EP","./zh_cn/index.js":"8tMq","./zh_tw/build_distance_in_words_locale/index.js":"vyyr","./zh_tw/build_format_locale/index.js":"uYH7","./zh_tw/index.js":"QPlQ"};function i(e){var t=a(e);return n(t)}function a(e){if(!n.o(r,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return r[e]}i.keys=function(){return Object.keys(r)},i.resolve=a,e.exports=i,i.id="nw0P"},obMR:function(e,t,n){"use strict";var r=n("yXPU"),i=n.n(r),a=n("lSNA"),o=n.n(a),s=n("o0o1"),c=n.n(s),l=n("UxO+"),u=n("B6LQ"),d=n("SZ+L"),p=n("y0Hk"),f=n("q3Kj"),h=n("byNj"),m=n("dojK");function v(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function g(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?v(Object(n),!0).forEach((function(t){o()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):v(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var b=function(e,t){return function(t,n){return!!e(n)&&(n.preventDefault(),n.stopPropagation(),n.type===m.e.Drop&&Object(p.d)(n,t),Object(f.b)(n)(t.state,t.dispatch),!0)}},y=function(e){var t,n=e.dispatch,r=e.providerFactory;return new l.Plugin({state:{init:function(e,t){return{active:!1,enabled:Object(p.a)(t),hidden:!t.schema.nodes.media||!t.schema.nodes.mediaSingle}},apply:function(e,t,r,i){var a=Object(p.c)(i),o=Object(p.a)(i),s=function(e,t){var n=e.getMeta(h.a);return n&&"START_UPLOAD"===n.name?{event:n.event}:t.activeUpload}(e,t);if(a!==t.active||o!==t.enabled||s!==t.activeUpload){var c=g(g({},t),{},{active:a,enabled:o,activeUpload:s});return n(h.a,c),c}return t}},key:h.a,view:function(){var e=function(){var e=i()(c.a.mark((function e(n,r){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("imageUploadProvider"===n&&r){e.next=2;break}return e.abrupt("return");case 2:return e.prev=2,e.next=5,r;case 5:t=e.sent,e.next=11;break;case 8:e.prev=8,e.t0=e.catch(2),t=void 0;case 11:case"end":return e.stop()}}),e,null,[[2,8]])})));return function(t,n){return e.apply(this,arguments)}}();return r.subscribe("imageUploadProvider",e),{update:function(e,n){var r=e.state,i=h.a.getState(r),a=h.a.getState(n);i.activeUpload!==a.activeUpload&&i.activeUpload&&t&&t(i.activeUpload.event,(function(t){return Object(f.a)(t)(e.state,e.dispatch)}))},destroy:function(){r.unsubscribe("imageUploadProvider",e)}}},props:{handleDOMEvents:{drop:b(d.a),paste:b(u.b)}}})},w=n("RRD0");var O=function(e){if(e.nodes.media&&e.nodes.mediaSingle){var t=Object(w.a)(/!\[(.*)\]\((\S+)\)$/,(function(e,t,n,r){var i=e.schema,a={src:t[2],alt:t[1]},o=Object(p.b)(a.src,i);return o?e.tr.replaceWith(n,r,o):null}));return Object(w.c)("image-upload",{rules:[t]})}};window.document.addEventListener("dragover",(function(e){return e.preventDefault(),!(null==e?void 0:e.target).closest(".ProseMirror")&&null!==e.dataTransfer&&(e.dataTransfer.dropEffect="none")}));t.a=function(){return{name:"imageUpload",pmPlugins:function(){return[{name:"imageUpload",plugin:y},{name:"imageUploadInputRule",plugin:function(e){var t=e.schema;return O(t)}}]}}}},pL5B:function(e,t,n){"use strict";n.r(t);var r,i=n("yXPU"),a=n.n(i),o=n("J4zp"),s=n.n(o),c=n("pVnL"),l=n.n(c),u=n("o0o1"),d=n.n(u),p=n("q1tI"),f=n.n(p),h=n("CodD"),m=n("QS0n"),v=n("67rm"),g=n("wvTK"),b=n("le8I"),y=n("xIbs"),w=n("V2U0"),O=n("1I/2"),k=n("47W4"),x=n.n(k),j=n("jDpt"),P=n("DA+R"),E=n("SH7X"),C=n("buk/");!function(e){e.Editor="n/:id",e.Root="/",e.ShareFromList="share"}(r||(r={}));var S=n("X+Uv"),_=n("yDJO"),M=n("KXWi"),D=n("780l"),N=n("lSNA"),I=n.n(N),T=n("mwIZ"),A=n.n(T),R=n("AHTZ"),L=n("X3v2"),U=n("MEpN"),z=[["date",{inline:!0,group:"inline",selectable:!0,attrs:{timestamp:{default:""}},parseDOM:[{tag:'span[data-node-type="date"]'}]}],["status",{inline:!0,group:"inline",selectable:!0,attrs:{text:{default:""},color:{default:""},localId:{default:"adf1f61a-da02-4a41-a6c3-183fdcac102d"},style:{default:""}},parseDOM:[{tag:'span[data-node-type="status"]'}]}],["doc",{content:"(block)+",marks:"alignment breakout indentation link unsupportedMark unsupportedNodeAttribute"}],["paragraph",{selectable:!1,content:"inline*",group:"block",marks:"strong code em link strike subsup textColor typeAheadQuery underline unsupportedMark unsupportedNodeAttribute",parseDOM:[{tag:"p"}]}],["text",{group:"inline"}],["bulletList",{group:"block",content:"listItem+",selectable:!1,parseDOM:[{tag:"ul"}],marks:"unsupportedMark unsupportedNodeAttribute"}],["orderedList",{group:"block",content:"listItem+",marks:"unsupportedMark unsupportedNodeAttribute",selectable:!1,parseDOM:[{tag:"ol"}]}],["listItem",{content:"(paragraph | mediaSingle | codeBlock) (paragraph | bulletList | orderedList | mediaSingle | codeBlock)*",marks:"link unsupportedMark unsupportedNodeAttribute",defining:!0,selectable:!1,parseDOM:[{tag:"li"}]}],["heading",{attrs:{level:{default:1}},content:"inline*",group:"block",defining:!0,selectable:!1,parseDOM:[{tag:"h1",attrs:{level:1}},{tag:"h2",attrs:{level:2}},{tag:"h3",attrs:{level:3}},{tag:"h4",attrs:{level:4}},{tag:"h5",attrs:{level:5}},{tag:"h6",attrs:{level:6}}]}],["blockquote",{content:"paragraph+",group:"block",defining:!0,selectable:!1,parseDOM:[{tag:"blockquote"}]}],["codeBlock",{attrs:{language:{default:null},uniqueId:{default:null}},content:"text*",marks:"unsupportedMark unsupportedNodeAttribute",group:"block",code:!0,defining:!0,parseDOM:[{tag:"pre",preserveWhitespace:"full"},{tag:"div[style]",preserveWhitespace:"full"},{tag:"table[style]",preserveWhitespace:"full"},{tag:"div.code-block",preserveWhitespace:"full"}]}],["rule",{group:"block",parseDOM:[{tag:"hr"}]}],["panel",{group:"block",content:"(paragraph | heading | bulletList | orderedList )+",marks:"unsupportedMark unsupportedNodeAttribute",attrs:{panelType:{default:"info"}},parseDOM:[{tag:"div[data-panel-type]"}]}],["confluenceUnsupportedBlock",{group:"block",attrs:{cxhtml:{default:null}},parseDOM:[{tag:'div[data-node-type="confluenceUnsupportedBlock"]'}]}],["confluenceUnsupportedInline",{group:"inline",inline:!0,atom:!0,attrs:{cxhtml:{default:null}},parseDOM:[{tag:'div[data-node-type="confluenceUnsupportedInline"]'}]}],["unsupportedBlock",{inline:!1,group:"block",atom:!0,selectable:!0,attrs:{originalValue:{default:{}}},parseDOM:[{tag:'[data-node-type="unsupportedBlock"]'}]}],["unsupportedInline",{inline:!0,group:"inline",selectable:!0,attrs:{originalValue:{default:{}}},parseDOM:[{tag:'[data-node-type="unsupportedInline"]'}]}],["hardBreak",{inline:!0,group:"inline",selectable:!1,parseDOM:[{tag:"br"}]}],["mediaSingle",{inline:!1,group:"block",selectable:!0,atom:!0,content:"media | media ( unsupportedBlock)",attrs:{width:{default:null},layout:{default:"center"}},marks:"unsupportedMark unsupportedNodeAttribute link",parseDOM:[{tag:'div[data-node-type="mediaSingle"]'}]}],["table",{content:"tableRow+",attrs:{isNumberColumnEnabled:{default:!1},layout:{default:"default"},__autoSize:{default:!1}},marks:"unsupportedMark unsupportedNodeAttribute",tableRole:"table",isolating:!0,selectable:!1,group:"block",parseDOM:[{tag:"table"}]}],["media",{selectable:!0,attrs:{id:{default:""},type:{default:"file"},collection:{default:""},occurrenceKey:{default:null},alt:{default:null},width:{default:null},height:{default:null},url:{default:null},__fileName:{default:null},__fileSize:{default:null},__fileMimeType:{default:null},__displayType:{default:null},__contextId:{default:null},__external:{default:!1}},parseDOM:[{tag:'div[data-node-type="media"]'},{tag:'img[src^="data:image"]',ignore:!0},{tag:"img:not(.smart-link-icon)"}]}],["tableHeader",{selectable:!1,content:"(paragraph | panel | blockquote | orderedList | bulletList | rule | heading | codeBlock | mediaSingle )+",attrs:{colspan:{default:1},rowspan:{default:1},colwidth:{default:null},background:{default:null}},tableRole:"header_cell",isolating:!0,marks:"link alignment unsupportedMark unsupportedNodeAttribute",parseDOM:[{tag:"th"}]}],["tableRow",{selectable:!1,content:"(tableCell | tableHeader)+",marks:"unsupportedMark unsupportedNodeAttribute",tableRole:"row",parseDOM:[{tag:"tr"}]}],["tableCell",{selectable:!1,content:"(paragraph | panel | blockquote | orderedList | bulletList | rule | heading | codeBlock | mediaSingle | unsupportedBlock)+",attrs:{colspan:{default:1},rowspan:{default:1},colwidth:{default:null},background:{default:null}},tableRole:"cell",marks:"link alignment unsupportedMark unsupportedNodeAttribute",isolating:!0,parseDOM:[{tag:".ak-renderer-table-number-column",ignore:!0},{tag:"td"}]}]],F=[["link",{excludes:"link color",group:"link",attrs:{href:{},__confluenceMetadata:{default:null}},inclusive:!1,parseDOM:[{tag:"[data-block-link]"},{tag:"a[href]",context:"paragraph/|heading/|mediaSingle/"},{tag:"a[href]"}]}],["em",{inclusive:!0,group:"fontStyle",parseDOM:[{tag:"i"},{tag:"em"},{style:"font-style=italic"}]}],["strong",{inclusive:!0,group:"fontStyle",parseDOM:[{tag:"strong"},{tag:"b"},{tag:"span"}]}],["textColor",{attrs:{color:{}},inclusive:!0,group:"color",parseDOM:[{style:"color"}]}],["strike",{inclusive:!0,group:"fontStyle",parseDOM:[{tag:"strike"},{tag:"s"},{tag:"del"},{style:"text-decoration"}]}],["subsup",{inclusive:!0,group:"fontStyle",attrs:{type:{default:"sub"}},parseDOM:[{tag:"sub",attrs:{type:"sub"}},{tag:"sup",attrs:{type:"sup"}},{tag:"span",style:"vertical-align=super"},{tag:"span",style:"vertical-align=sub"}]}],["underline",{inclusive:!0,group:"fontStyle",parseDOM:[{tag:"u"},{style:"text-decoration"}]}],["code",{excludes:"fontStyle link searchQuery color",inclusive:!0,parseDOM:[{tag:"span.code",preserveWhitespace:!0},{tag:"code",preserveWhitespace:!0},{tag:"tt",preserveWhitespace:!0},{tag:"span",preserveWhitespace:!0}]}],["typeAheadQuery",{inclusive:!0,group:"searchQuery",parseDOM:[{tag:"span[data-type-ahead-query]"}],attrs:{trigger:{default:""}}}],["alignment",{excludes:"alignment indentation",group:"alignment",attrs:{align:{}},parseDOM:[{tag:"div.fabric-editor-block-mark"}]}],["breakout",{spanning:!1,inclusive:!1,parseDOM:[{tag:"div.fabric-editor-breakout-mark"}],attrs:{mode:{default:"wide"}}}],["indentation",{excludes:"indentation alignment",group:"indentation",attrs:{level:{}},parseDOM:[{tag:"div.fabric-editor-indentation-mark"}]}],["unsupportedMark",{attrs:{originalValue:{}}}],["unsupportedNodeAttribute",{attrs:{type:{},unsupported:{}}}]];function B(e){return e.reduce((function(e,t){return e[t[0]]=t[1],e}),{})}var V={nodes:z,marks:F},W={nodes:B(z),marks:B(F)},q=(new U.Schema(W),n("pZg0")),K=n.n(q);function G(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function J(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?G(Object(n),!0).forEach((function(t){I()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):G(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function H(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return Q(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Q(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function Q(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function $(){var e,t=H(new URLSearchParams(window.location.search));try{for(t.s();!(e=t.n()).done;){var n=s()(e.value,2),r=n[0],i=n[1];if("returnUrl"===r)return i}}catch(a){t.e(a)}finally{t.f()}}function X(e,t){return Y.apply(this,arguments)}function Y(){return(Y=a()(d.a.mark((function e(t,n){var r,i,a;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=E.models.note.fetchURL(t,n),i=window.location.toString(),e.t0=URL,e.next=5,r;case 5:return e.t1=e.sent,(a=new e.t0(e.t1)).searchParams.set("returnUrl",i),e.abrupt("return",a.toString());case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Z(e){return ee.apply(this,arguments)}function ee(){return(ee=a()(d.a.mark((function e(t){var n,r,i;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.collection("io.cozy.permissions").fetchOwnPermissions();case 2:if(n=e.sent,r=A()(n,"data.attributes.permissions")){e.next=6;break}throw"can't get self permissions";case 6:return i=Object.values(r),e.abrupt("return",i.filter((function(e){return E.models.permission.isForType(e,"io.cozy.files")})));case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function te(e,t){return ne.apply(this,arguments)}function ne(){return(ne=a()(d.a.mark((function e(t,n){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",t.query(t.find("io.cozy.files").getById(n)).then((function(e){return e&&e.data})));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function re(e,t){return ie.apply(this,arguments)}function ie(){return(ie=a()(d.a.mark((function e(t,n){var r;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,te(t,n);case 2:return r=e.sent,e.abrupt("return",E.models.permission.isDocumentReadOnly({document:r,client:t,writability:["PATCH"]}));case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ae(e){return oe.apply(this,arguments)}function oe(){return(oe=a()(d.a.mark((function e(t){var n,r,i,a;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Z(t);case 2:if(!((n=e.sent.filter((function(e){return E.models.permission.isForType(e,"io.cozy.files")&&e.values&&e.values.length>0}))).length<1)){e.next=7;break}throw new Error("No individual io.cozy.files permissions in current context");case 7:(n.length>1||n[0].values.length>1)&&console.warn("There are more than one permission for a file in current context. Let's take the first one, but it may not be the one you expect");case 8:return r=n[0],i=r.values[0],a=E.models.permission.isReadOnly(r,{writability:["PATCH"]}),e.abrupt("return",{id:i,readOnly:a});case 12:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function se(e){return"/folder/".concat(e)}function ce(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=new URL(e.getStackClient().uri),r=e.getInstanceOptions(),i=r.subdomain,a="drive",o=null!==t?se(t):"",s=Object(R.b)({cozyUrl:n.origin,slug:a,subDomainType:i,nativePath:o});return s}function le(){var e=Object(L.b)(),t=Object(L.a)(e.app.prefix||K.a.name_prefix,""),n=Object(L.a)(e.app.name,K.a.name);return""!=t?"".concat(t," ").concat(n):n}function ue(e){return e.getStackClient().fetchJSON("POST","/notes",{data:{type:"io.cozy.notes.documents",attributes:{title:"",schema:J(J({},V),{},{version:3})}}})}var de=6e4,pe=60*de,fe=24*pe,he=31*fe,me=365*fe,ve=[[1e4,"just_now",1e3,1],[1*de,"secs_ago",1e3,10],[2*de,"min_ago",de,1],[5*de,"mins_ago",de,1],[20*de,"mins_ago",de,5],[1*pe,"mins_ago",de,10],[2*pe,"hour_ago",pe,1],[1*fe,"hours_ago",pe,1],[2*fe,"day_ago",fe,1],[1*he,"days_ago",fe,1],[2*he,"month_ago",he,1],[1*me,"monthes_ago",he,1],[2*me,"year_ago",me,1],[1/0,"years_ago",me,1]];function ge(e){var t=e.className,n=Object(C.f)().t,r=Object(E.useClient)(),i=Object(p.useState)(!1),o=s()(i,2),c=o[0],l=o[1],u=Object(p.useCallback)(a()(d.a.mark((function e(){var t,n;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return l(!0),e.next=3,ue(r);case 3:return t=e.sent,n=t.data,e.next=7,X(r,n);case 7:window.location.href=e.sent;case 8:case"end":return e.stop()}}),e)}))),[r]);return f.a.createElement(M.c,{onClick:u,type:"submit",busy:c,icon:"plus",label:n("Notes.Add.add_note"),extension:"narrow",className:t})}function be(e){var t=Object(E.useClient)()||e.client;return f.a.createElement(D.a,{onClick:a()(d.a.mark((function e(){var n,r;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ue(t);case 2:return n=e.sent,r=n.data,e.next=6,X(t,r);case 6:window.location.href=e.sent;case 7:case"end":return e.stop()}}),e)}))),icon:"plus",className:"u-c-pointer"})}var ye,we=n("kyGY"),Oe=n("ufaa"),ke=Object(Oe.a)()(Object(C.e)()((function(e){var t=e.t;return!e.breakpoints.isMobile&&f.a.createElement(we.a,null,t("Notes.List.latest_notes"))}))),xe=n("7YkG"),je=n("GoJ1"),Pe=n("4BeY"),Ee=n.n(Pe),Ce=n("IaFt"),Se=n.n(Ce),_e=new Ee.a({id:"icon_note_empty_77efa79dd615f19897a8ed6ec9097298",use:"icon_note_empty_77efa79dd615f19897a8ed6ec9097298-usage",viewBox:"0 0 171 168",content:'<symbol xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 171 168" id="icon_note_empty_77efa79dd615f19897a8ed6ec9097298">\n    <defs>\n        <path id="icon_note_empty_77efa79dd615f19897a8ed6ec9097298_a" d="M.02.12h36.532v20.674H.02z" />\n    </defs>\n    <g fill="none" fill-rule="evenodd">\n        <path fill="#0DCBCF" d="M48.367 47.28c3.795-4.135 9.702 2.27 5.938 6.374-8.105 8.832-11.21 22.848-5.617 33.864 6.83 13.453 25.138 8.377 36.387 4.37 5.26-1.871 7.054 6.655 1.834 8.515-15.343 5.464-37.282 8.714-45.942-8.858-7.276-14.767-3.455-32.433 7.4-44.265" />\n        <path fill="#D6FAFB" d="M59.57 16.922c.739-4.162 1.797-8.167 3.764-11.417C66.807-.21 73.009-.675 79.69.561c3.047.47 76.99 11.012 78.873 11.76 6.957 2.843 7.343 8.129 5.837 14.148-.141.971-20.067 84.443-21.43 88.854-1.852 5.978-4.906 11.375-10.609 11.973-5.714.623-75.27-18.403-78.5-19.534-3.954-1.39-5.72-3.632-6.159-6.323-.603-1.443-.376-3.088-.067-5.144.8-5.412 8.228-69.79 11.935-79.373" />\n        <path fill="#FFF" d="M65.047 19.073S64.561 3.301 79.004 5.122c14.443 1.819 89.593 13.951 89.593 13.951v9.972l-15.17 7.281-88.38-17.253z" />\n        <path fill="#ACF5F7" d="M53.622 31.458c.246-4.25.829-8.372 2.413-11.844 2.795-6.122 8.927-7.314 15.747-6.87 3.103.105 6.245.706 8.959 1.155 13.33 2.21 60.933 9.536 62.437 9.936.853.239 3.242 1.012 3.93 1.337 5.173 2.422 4.26 6.643 3.56 12.102-.023.988-10.066 86.694-10.903 91.263-1.155 6.187-3.561 11.933-9.185 13.21-5.636 1.297-77.342-9.496-80.695-10.235-4.111-.928-6.143-2.958-6.897-5.597-.781-1.368-.738-3.034-.675-5.12.157-5.506 8.735-79.333 11.309-89.337" />\n        <path fill="#79ECEE" d="M134.818 99.416c4.069-24.17 8.504-48.43 11.948-72.677.037-.293.209-1.305.35-1.515-.04-.744 2.317.264 4.506.067.068 0 .925-.114.992-.114.716-.138 1.42-.29 2.149-.552 3.554-1.285 4.98-4.27 4.938-7.584-.046-2.971-2.376-4.28-2.285-5.071.047-.427 2.619.902 2.915 1 .405.133 3.131 1.892 4.372 4.065 1.249 2.19.856 5.296.785 8.049-.244 9.277-8.008 66.518-9.51 78.49.026.153-.358 3.1-.546 4.417-.38 2.901-.772 5.807-1.182 8.707-.319 2.271-1.653 15.153-1.929 15.747-3.391 7.361-12.892 9.872-20.513 9.34-.434.025-.851-.016-1.524-.102-.844-.108-2.024.034-3.35-.235.145-2.458 5.937-30.472 7.884-42.032" />\n        <path fill="#FFF" d="M98.24 56.354c3.65-6.425 11.472-9.96 18.354-7.212a10.488 10.488 0 0 1 4.359 2.129c.117.074.22.173.33.253.099.086.2.171.29.253a10.141 10.141 0 0 1 3.012 3.703c.14.243.285.483.408.733.028.087.095.136.12.22.089.233.126.462.208.7.4 1.024.667 2.088.785 3.213.399 2.397.348 4.8-.468 7.371-1.431 4.512-6.871 6.769-11.066 7.466-3.062.503-6.549-.22-9.546-1.52-4.286-1.86-5.61-4.269-6.733-7.469-1.146-3.274-1.878-6.632-.054-9.84M57.875 49.863c1.7-3.323 4.417-5.416 7.697-6.62.072-.048.117-.104.197-.162 2.037-1.45 4.806-2 7.4-1.642 6.076.399 11.603 5.645 13.426 11.64.926 3.055.816 6.827-.747 9.66-2.345 4.249-6.24 6.338-10.86 7.305-7.715 1.625-16.183-3.686-18.103-11.22-.745-2.904-.38-6.293.99-8.961" />\n        <path fill="#FFF" d="M97.573 60.005c.542 1.111 2.285 1.832 3.325 1.161 1.116-.715 1.315-2.42.479-3.462-.451-.557-1.063-.82-1.666-.79a.296.296 0 0 0-.235-.062c-1.392.108-2.635 1.68-1.903 3.153M82.511 58.042c.543 1.11 2.287 1.83 3.325 1.159 1.12-.72 1.318-2.42.479-3.46-.453-.558-1.059-.82-1.668-.791a.295.295 0 0 0-.227-.065c-1.4.11-2.637 1.679-1.909 3.157" />\n        <path fill="#FFF" d="M83.12 55.648c.916-3.33 5.387-5.305 8.553-5.085 3.765.266 8.59 3.494 9.277 7.454.373 2.132-3.201 2.492-3.554.466-.782-4.47-8.893-6.614-10.702-2.003-.036.357-.226.713-.675 1.002-.022.023-.05.037-.07.05-1.412.921-3.292-.203-2.83-1.884" />\n        <path fill="#79ECEE" d="M130.887 48.194c1.972 3.09 7.333 4.648 10.183 2.337 3.064-2.497 3.1-7.587.281-10.373-1.511-1.495-3.399-2.072-5.16-1.798a1.058 1.058 0 0 0-.718-.108c-4.064.775-7.221 5.81-4.586 9.942M127.85 77.94c1.733 2.724 6.45 4.093 8.956 2.058 2.697-2.199 2.723-6.673.244-9.122-1.327-1.316-2.985-1.825-4.536-1.582a.938.938 0 0 0-.63-.094c-3.578.679-6.353 5.109-4.034 8.74M123.467 106.767c1.607 2.793 6.26 4.374 8.854 2.454 2.796-2.074 3.021-6.54.654-9.102-1.267-1.375-2.901-1.949-4.46-1.781a.948.948 0 0 0-.627-.127c-3.603.52-6.573 4.823-4.42 8.556" />\n        <path fill="#D6FAFB" d="M134.92 71.16l.384-.004c3.34-.056 4.832 2.564 4.435 4.87.819 3.035 6.732 4.083 9.188 4.55 3.327.638 6.204.138 7.935-1.695a5.354 5.354 0 0 0 .518-.67c.964-1.44 1.663-2.972 2.485-4.46.207-1.606.413-3.208.626-4.844 1.045.01 7.44.93 7.404 5.085-.061 7.397-4.113 11.963-9.873 13.901.007-.076.018-.156.03-.233a.106.106 0 0 0-.042.013l.012.22c-2.516.844-5.377 1.193-8.431 1.044-7.434-.364-19.518-4.398-19.253-13.56.07-2.467 2.191-4.176 4.582-4.217M155.979 103.575c.026.15-.358 3.097-.548 4.415-.379 2.903-.77 5.807-1.182 8.708-.04.298-.1.792-.173 1.41-.423.111-.846.232-1.267.325-9.933 2.216-23.748-2.264-26.83-12.978-1.387-4.823 5.737-6.845 8.28-3.535 3.25 3.006 6.375 4.279 10.726 4.987 2.315.378 9.589 1.174 10.133-1.001l.86-2.331z" />\n        <path fill="#D6FAFB" d="M155.43 107.99c.19-1.318.575-4.264.549-4.415.141-1.139.343-2.691.587-4.57 1.43-.943 3.35-1.181 4.91-.156 4.028 2.644 5.269 6.247 3.534 10.833-1.791 4.722-6.312 7.18-10.936 8.425.075-.617.134-1.11.175-1.409.412-2.901.803-5.805 1.182-8.708" />\n        <path fill="#0DCBCF" d="M97.295 86.818c.143-.42-.082-.821-.543-.907l-15.969-2.926c-.445-.086-.826.224-.826.667 0 0-.792 8.124 7.2 9.59 7.994 1.46 10.138-6.424 10.138-6.424M106.717 66.413a2.628 2.628 0 0 0 2.9-2.325c.148-1.137.803-3.051 3.438-2.757 2.873.313 2.836 2.714 2.758 3.44a2.632 2.632 0 0 0 2.32 2.906 2.635 2.635 0 0 0 2.902-2.328c.367-3.341-1.301-8.563-7.404-9.24-6.1-.67-8.868 4.061-9.233 7.399a2.623 2.623 0 0 0 2.319 2.905M65.97 60.55a2.618 2.618 0 0 0 2.898-2.323c.154-1.135.809-3.045 3.444-2.756 2.873.32 2.836 2.715 2.758 3.446a2.628 2.628 0 0 0 2.324 2.898 2.633 2.633 0 0 0 2.896-2.326c.369-3.336-1.295-8.561-7.399-9.232-6.107-.682-8.87 4.055-9.24 7.395a2.62 2.62 0 0 0 2.319 2.898M7.328 107.186s-4.037-2.086 6.805-8.374c10.108-5.864 7.278 10.253 7.278 10.253l-14.083-1.88z" />\n        <path fill="#DFFCFC" d="M77.122 128.065c-3.962-7.31-6.318-14.535-8.397-21.528-3.496-11.78-4.837-23.725-10.418-35.926-.384-.842-1.51-1.893-2.359-2.092a1247.17 1247.17 0 0 1-45.203-11.481C5.086 55.485.713 55.304.083 59.109c-.007.039-.016.076-.022.12-.14.995-.046 2.243.353 3.81.19.754.696 1.372 1.281 1.841C4.793 75.29 6.898 85.406 10.32 95.907c3.831 11.75 8.712 23.72 12.591 35.483.415 1.26 1.806 2.668 3.07 2.721.323.013.648.028.971.04 3.006 1.149 30.837 7.319 41.229 8.583 4.412.538 18.182 5.133 17.55-.856-.335-3.168-7.048-10.931-8.61-13.813" />\n        <path fill="#0DCBCF" d="M24.169 106.068c-4.748.862-9.072.078-13.23-2.376-3.782-2.232-6.633 3.978-2.878 6.194a24.375 24.375 0 0 0 16.752 2.983c4.29-.779 3.694-7.587-.644-6.801" />\n        <path fill="#0DCBCF" d="M26.43 113.925c-4.822.208-9-1.152-12.787-4.147-3.445-2.725-7.11 3.043-3.69 5.747a24.362 24.362 0 0 0 16.193 5.225c4.356-.19 4.689-7.017.284-6.825" />\n        <path fill="#0DCBCF" d="M27.7 121.497c-4.773-.725-8.608-2.867-11.746-6.535-2.856-3.338-7.566 1.615-4.73 4.929a24.372 24.372 0 0 0 14.88 8.249c4.313.653 5.952-5.982 1.595-6.643" />\n        <path fill="#D6FAFB" d="M56.82 163.387c2.634 1.707 9.394 3.19 14.841 3.785 14.866 1.625 35.651.773 44.451-2.186 8.875-2.98 9.27-7.505-13.293-9.77-19.21-1.926-41.628.772-46.423 4.818-1.286 1.083-1.211 2.293.423 3.353" />\n        <path fill="#FFF" d="M85.93 121.501l-8.872-2.495 5.144-7.99 53.966-19.197a4.453 4.453 0 0 1 5.686 2.7l.746 2.099a4.45 4.45 0 0 1-2.702 5.686L85.93 121.5z" />\n        <path fill="#0DCBCF" d="M154.388 66.712c-4.389-3.498-9.232 3.746-4.877 7.216 9.374 7.469 14.612 20.835 10.794 32.583-4.663 14.35-23.538 12.171-35.273 9.956-5.483-1.035-5.935 7.667-.492 8.695 16.003 3.021 38.184 2.835 44.015-15.867 4.9-15.715-1.61-32.577-14.167-42.583" />\n        <path fill="#0DCBCF" d="M117.57 120.966c-.858-.505-1.8-.82-2.724-.954.007-.692-.294-1.44-.896-2.045a5.36 5.36 0 0 0-1.042-.795c.604-.217 1.24-.4 1.767-.57 4.603-1.484-.888-7.006-5.49-5.523-4.248 1.372-8.193 3.504-7.248 7.418.244 1.01 1.247 2.234 2.773 2.788.09.031.177.056.268.09.235 1.784 2.018 3.698 4.6 4.72.32.126.656.225.99.326.556 1.45 2.692 2.89 4.895 2.99 5.026.234 8.746-1.607 9.6-4.766.4-1.491-1.568-3.332-3.883-3.906-1.418-.35-2.69-.218-3.61.227" />\n        <path fill="#0DCBCF" d="M116.74 108.083c-2.338-.522-12.208 2.855-5.111 5.063 1.627.505 1.248.814 2.754 1.558-.564.2-1.05.473-1.4.824-2.277.728-2.681 3.583-1.654 5.93 1.48 3.38 2.415 7.939 7.426 7.805 5.597-.148 12.373-6.007 12.023-9.417-.211-2.065-1.65-5.025-4.013-6.767-1.204-.887-7.684-4.475-10.024-4.996" />\n        <path fill="#0DCBCF" d="M118.038 108.505s-11.852-4.477-13.846-1.858c-1.799 2.363-5.817 10.49-3.131 10.95 2.683.463 10.129-2.62 10.129-2.62l6.848-6.472z" />\n        <g transform="translate(134.244 38.595)">\n            <mask id="icon_note_empty_77efa79dd615f19897a8ed6ec9097298_b" fill="#fff">\n                <use xlink:href="#icon_note_empty_77efa79dd615f19897a8ed6ec9097298_a" />\n            </mask>\n            <path fill="#D6FAFB" d="M9.325 7.036c.397 5.93 8.7 6.329 13.777 4.795.42-.158.845-.317 1.23-.505a9.225 9.225 0 0 0 1.389-.872c.082-.06.995-.824 1.133-.954 1.086-1.008 2.065-2.238 2.415-3.433.248-2.072.485-4.087.695-5.947a8.54 8.54 0 0 1 2.63 1.137C34 2.191 34.869 3.2 35.499 4.768c.088.213.125.438.17.665.332.608.553 1.271.557 1.963 1.55 5.622-2.602 9.814-8.58 11.908.032-.244.058-.477.09-.717-.01.004-.02.011-.029.015-.018.233-.03.458-.061.702C17.12 22.994.906 20.164.03 7.036c-.365-5.393 8.932-5.393 9.294 0" mask="url(#icon_note_empty_77efa79dd615f19897a8ed6ec9097298_b)" />\n        </g>\n        <path fill="#ACF5F7" d="M67.018 83.907a4.967 4.967 0 1 1-9.935 0 4.966 4.966 0 0 1 4.967-4.967 4.967 4.967 0 0 1 4.968 4.967M73.57 105.824a4.967 4.967 0 1 1-9.935 0 4.966 4.966 0 0 1 4.966-4.966 4.967 4.967 0 0 1 4.969 4.966M80.564 124.544a4.967 4.967 0 0 1-4.968 4.966 4.966 4.966 0 0 1-4.967-4.966 4.967 4.967 0 1 1 9.935 0" />\n    </g>\n</symbol>'}),Me=(Se.a.add(_e),_e),De=n("goAg"),Ne={_type:"io.cozy.apps",_id:"io.cozy.apps/notes"},Ie=function(e){var t=Object(p.useState)(ce(e)),n=s()(t,2),r=n[0],i=n[1];return Object(p.useEffect)((function(){(function(){var t=a()(d.a.mark((function t(){var n,r;return d.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,De.CozyFolder.getReferencedFolders(Ne);case 3:n=t.sent,r=ce(e,n[0]._id),i(r),t.next=11;break;case 8:t.prev=8,t.t0=t.catch(0),i(ce(e));case 11:case"end":return t.stop()}}),t,null,[[0,8]])})));return function(){return t.apply(this,arguments)}})()()}),[e]),{notesFolder:r}},Te=n("sCMN"),Ae=n("dojK"),Re=Object(C.e)()(Object(E.withClient)((function(e){var t=e.t,n=e.client,r=Ie(n).notesFolder;return f.a.createElement("div",{className:"empty"},f.a.createElement(je.a,{id:"empty",icon:Me,title:t("Notes.Empty.welcome"),text:f.a.createElement(Te.a,{href:r,app:{slug:Ae.i.Drive}},(function(e){var n=e.href,r=e.onClick;return f.a.createElement("span",{className:"u-mb-half"},t("Notes.Empty.after_created")," ",f.a.createElement("a",{href:n,onClick:r},"Cozy Drive"),".")}))},f.a.createElement(ge,{className:"u-mt-1"})))}))),Le=n("UxX4"),Ue=n("y6ex"),ze=n("lEaz"),Fe=n("lXO7"),Be=n("FFOw"),Ve=new Ee.a({id:"icon-note-32_0b87f187ce7a65cb93dbf28b37a73b8d",use:"icon-note-32_0b87f187ce7a65cb93dbf28b37a73b8d-usage",viewBox:"0 0 32 32",content:'<symbol xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 32 32" id="icon-note-32_0b87f187ce7a65cb93dbf28b37a73b8d">\n<style type="text/css">\n\t#icon-note-32_0b87f187ce7a65cb93dbf28b37a73b8d .st0{fill-rule:evenodd;clip-rule:evenodd;fill:#ACF5F7;}\n\t#icon-note-32_0b87f187ce7a65cb93dbf28b37a73b8d .st1{fill-rule:evenodd;clip-rule:evenodd;fill:#0DCBCF;}\n</style>\n<g transform="translate(2)">\n\t<path class="st0" d="M0,2c0-1.1,0.9-2,2-2h22c1.1,0,2,0.9,2,2v28c0,1.1-0.9,2-2,2H2c-1.1,0-2-0.9-2-2V2z" />\n\t<path class="st1" d="M6,8h14v2H6V8z M6,12h8v2H6V12z M6,16h14v2H6V16z M6,20h10v2H6V20z" />\n</g>\n<g transform="translate(0 4)">\n\t<path class="st1" d="M1.5,0h2C4.3,0,5,0.7,5,1.5l0,0C5,2.3,4.3,3,3.5,3h-2C0.7,3,0,2.3,0,1.5l0,0C0,0.7,0.7,0,1.5,0z" />\n\t<path class="st1" d="M1.5,7h2C4.3,7,5,7.7,5,8.5l0,0C5,9.3,4.3,10,3.5,10h-2C0.7,10,0,9.3,0,8.5l0,0C0,7.7,0.7,7,1.5,7z" />\n\t<path class="st1" d="M1.5,14h2C4.3,14,5,14.7,5,15.5l0,0C5,16.3,4.3,17,3.5,17h-2C0.7,17,0,16.3,0,15.5l0,0C0,14.7,0.7,14,1.5,14z" />\n\t<path class="st1" d="M1.5,21h2C4.3,21,5,21.7,5,22.5l0,0C5,23.3,4.3,24,3.5,24h-2C0.7,24,0,23.3,0,22.5l0,0C0,21.7,0.7,21,1.5,21z" />\n</g>\n<g>\n\t<path class="st1" d="M31.4,18.4l-2.8-2.8c0.8-0.8,2-0.8,2.8,0S32.2,17.6,31.4,18.4z" />\n\t<path class="st1" d="M30.7,19.1L20.8,29l-2.5,0.9c-0.5,0.2-1.1-0.1-1.3-0.6c-0.1-0.2-0.1-0.5,0-0.7l0.9-2.5l9.9-9.9L30.7,19.1z" />\n</g>\n</symbol>'}),We=(Se.a.add(Ve),Ve),qe=n("RMII"),Ke=n.n(qe);!function(e){e.ExtraLarge="isExtraLarge",e.Large="isLarge",e.Medium="isMedium",e.Small="isSmall",e.Tiny="isTiny",e.Desktop="isDesktop",e.Tablet="isTablet",e.Mobile="isMobile"}(ye||(ye={}));var Ge=n("UP3J"),Je=function(e){return null!==e&&"string"!=typeof e&&e},He=function(e){var t=e.drivePath,n=e.path,r=e.target;return f.a.createElement(Te.a,{href:t,app:{slug:Ae.i.Drive}},(function(e){var t=e.href,i=e.onClick;return f.a.createElement(Ge.a,l()({href:t,onClick:i},function(e){return"string"!=typeof e?{}:"_blank"===e?{target:"_blank",rel:"noreferrer noopener"}:{target:e}}(r)),function(e){var t;return(null===(t=/(.+)(\/.+)$/.exec(e))||void 0===t?void 0:t[1])||e}(n))}))},Qe=function(e){var t=e.hideOn,n=e.showOn,r=e.children,i=Object(O.b)(),a=t&&i[t],o=n&&i[n],s=f.a.createElement(f.a.Fragment,null,r);return t?a?null:s:n?o?s:null:s};function $e(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Xe(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?$e(Object(n),!0).forEach((function(t){I()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):$e(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Ye=Object(C.e)()(Object(E.withClient)((function(e){var t=e.note,n=e.f,i=e.t,o=e.client,c=Object(h.e)(),l=De.CozyFile.splitFilename(t),u=l.filename,g=l.extension,b=Object(p.useState)(!1),y=s()(b,2),w=y[0],O=y[1],k=Object(p.useCallback)((function(e){O(!0),e.stopPropagation()}),[O]),x=Object(p.useCallback)((function(){return O(!1)}),[O]),j=Object(p.useCallback)(a()(d.a.mark((function e(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,o.destroy(t);case 3:O(!1),v.a.info(i("Notes.Delete.deleted")),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),v.a.error(i("Notes.Delete.failed"));case 10:case"end":return e.stop()}}),e,null,[[0,7]])}))),[o,t,i,O]),P=Object(p.useMemo)((function(){return ce(o,t.dir_id)}),[o,t]),E=f.a.createRef(),C=function(){var e=a()(d.a.mark((function e(){var n;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,X(o,t);case 3:n=e.sent,window.location.href=n,e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),v.a.error(i("Error.loading_error_title"));case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(){return e.apply(this,arguments)}}();return f.a.createElement(f.a.Fragment,null,f.a.createElement(xe.f,{className:"u-c-pointer ".concat(Ke.a.tableRow),role:"button",tabIndex:"0",onKeyDown:function(e){"Enter"===e.key&&C()},onClick:C},f.a.createElement(xe.c,{className:"".concat(Ke.a.tableCellName," u-flex u-flex-items-center u-fz-medium")},f.a.createElement(Ue.a,{icon:We,size:32,className:"u-mr-1 u-flex-shrink-0"}),f.a.createElement("div",{className:"u-flex-grow-1"},f.a.createElement("span",{className:"u-charcoalGrey u-ellipsis"},u),f.a.createElement(Qe,{hideOn:ye.Mobile},f.a.createElement("span",{className:"u-ellipsis"},g)),f.a.createElement(Qe,{showOn:ye.Mobile},f.a.createElement(He,{drivePath:P,path:t.path,target:"_blank"})))),f.a.createElement(Qe,{hideOn:ye.Mobile},f.a.createElement(xe.c,{className:Ke.a.tableCell},i("Notes.List.at",{date:n(t.updated_at,"DD MMMM"),time:n(t.updated_at,"HH:mm")})),f.a.createElement(xe.c,{className:"".concat(Ke.a.tableCell," u-flex-shrink-0")},f.a.createElement(He,{drivePath:P,path:t.path,target:"_blank"})),f.a.createElement(xe.c,{className:Ke.a.tableCell},f.a.createElement(Be.a,{docId:t._id,size:24}))),f.a.createElement(xe.c,{className:Ke.a.tableCell},f.a.createElement("span",{ref:E},f.a.createElement(ze.a,{onClick:k},f.a.createElement(Ue.a,{icon:"dots"}))))),w&&f.a.createElement(Le.b,{onClose:x,anchorElRef:E,popperOptions:{strategy:"fixed"}},f.a.createElement(m.b,{className:Ke.a.actionMenuItem,onClick:x,to:r.ShareFromList,state:{backgroundLocation:c,shareModalProps:{document:Xe(Xe({},t),{},{name:t.attributes.name}),documentType:Ae.b.Notes,sharingDesc:t.attributes.name}}},f.a.createElement(Le.a,{left:f.a.createElement(Ue.a,{icon:Fe.a}),autoclose:!0,right:f.a.createElement(Qe,{showOn:ye.Mobile},f.a.createElement(Be.a,{docId:t.id,size:"small"}))},i("Notes.Files.share.cta"))),f.a.createElement(Le.a,{onClick:j,left:f.a.createElement(Ue.a,{icon:"trash"})},i("Notes.Delete.delete_note"))))}))),Ze=function(){return f.a.createElement(xe.f,{className:Ke.a.tableSpecialRow},f.a.createElement(xe.c,{className:Ke.a.tableCellEmpty},f.a.createElement(Re,null)))},et=function(){return f.a.createElement(xe.f,{className:Ke.a.tableSpecialRow},f.a.createElement(xe.c,{className:"".concat(Ke.a.tableCellEmpty," u-ta-center")},f.a.createElement(w.b,{size:"xxlarge"})))},tt=Object(C.e)()((function(e){var t=e.t,n=e.notes,r=e.fetchStatus;return f.a.createElement(xe.a,{className:"".concat(Ke.a.table," ").concat(0===n.length&&Ke.a.notable)},n.length>0&&f.a.createElement(xe.d,null,f.a.createElement(xe.f,null,f.a.createElement(xe.e,{className:Ke.a.tableCellName},t("Notes.List.name")),f.a.createElement(Qe,{hideOn:ye.Mobile},f.a.createElement(xe.e,{className:Ke.a.tableCell},t("Notes.List.updated_at")),f.a.createElement(xe.e,{className:"".concat(Ke.a.tableCell," u-flex-shrink-0")},t("Notes.List.location")),f.a.createElement(xe.e,{className:Ke.a.tableCell},t("Notes.List.sharings"))),f.a.createElement(xe.e,{className:Ke.a.tableCell}))),f.a.createElement(xe.b,null,"loading"===r?f.a.createElement(et,null):0===n.length?f.a.createElement(Ze,null):n.map((function(e){return f.a.createElement(Ye,{note:e,key:e._id})}))))})),nt=function(e,t){return"loaded"===e&&t.length>0},rt=function(){var e=cozy.bar.BarRight,t=Object(C.f)(),n=Object(E.useClient)();return f.a.createElement(E.Query,{query:function(){return Object(E.Q)("io.cozy.notes")}},(function(r){var i=r.data,a=r.fetchStatus;return f.a.createElement(f.a.Fragment,null,f.a.createElement(S.a,null,f.a.createElement(Qe,{hideOn:ye.Mobile},f.a.createElement("div",{className:i.length>0?"".concat(Ke.a.appHeader," u-flex u-flex-justify-between u-flex-items-center u-mt-1"):""},i.length>0&&f.a.createElement(ke,null),nt(a,i)&&f.a.createElement(ge,null))),f.a.createElement(tt,{notes:i,fetchStatus:a})),nt(a,i)&&f.a.createElement(Qe,{showOn:ye.Mobile},f.a.createElement(e,null,f.a.createElement(_.a,l()({store:n.store,client:n},t),f.a.createElement(be,null)))))}))},it=n("17x9"),at=n.n(it),ot=n("95Bo"),st=n("59M3"),ct=n("t9Ym"),lt=n("jWvl"),ut=n("KXVJ"),dt=n("B9Y0"),pt={allowBreakout:!0,allowTextColor:!0,allowTextAlignment:!0,allowIndentation:!0,allowTables:{allowColumnSorting:!0,allowColumnResizing:!0,allowMergeCells:!0,allowNumberColumn:!0,allowBackgroundColor:!0,allowHeaderRow:!0,allowHeaderColumn:!0,permittedLayouts:"all",stickToolbarToBottom:!0},allowPanel:!0,allowStatus:!0,allowRule:!0,allowDate:!0},ft=n("Q2Eh"),ht=n.n(ft);var mt=function(e,t){switch(null==e?void 0:e.type){case Ae.e.Drop:return gt(e,t);case Ae.e.Paste:return bt(e,t);default:return vt(t)}},vt=function(e){var t=document.createElement(Ae.c.Input);t.setAttribute("accept","image/*"),t.type=Ae.f.File,t.dispatchEvent(new MouseEvent(Ae.e.Click)),t.addEventListener(Ae.e.Change,(function(){var n;return e(null===(n=t.files)||void 0===n?void 0:n[0])}))},gt=function(e,t){var n,r,i=e.dataTransfer;return(1===(null==(r=null==i?void 0:i.files)?void 0:r.length)||(v.a.error("Error.only_one_image"),!1))&&t(null==i||null===(n=i.files)||void 0===n?void 0:n[0])},bt=function(e,t){var n,r=e.clipboardData;return t(null==r||null===(n=r.files)||void 0===n?void 0:n[0])},yt=function(e,t,n){var r=new window.FileReader;if(!n)throw Error(Ae.d.NoFileFoundAfterInput);r.readAsArrayBuffer(n),r.onloadend=a()(d.a.mark((function i(){var a,o,s;return d.a.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:if(a=Je(r.result)){i.next=3;break}throw Error(Ae.d.FileNotProcessable);case 3:return i.prev=3,e.setUploading(!0),i.next=7,e.collabProvider.serviceClient.postImage(n.name,e.collabProvider.config.noteId,a,n.type);case 7:o=i.sent,s=o.data.id,t({src:s}),i.next=15;break;case 12:i.prev=12,i.t0=i.catch(3),v.a.error(e.t(void 0!==i.t0.status?"Error.".concat(i.t0.status):"Error.unknown_error"),{duration:4e3});case 15:return i.prev=15,e.setUploading(!1),i.finish(15);case 18:case"end":return i.stop()}}),i,null,[[3,12,15,18]])})))};var wt=function(){};var Ot=function(e){var t=e.defaultValue,n=e.onTitleChange,r=e.onTitleBlur,i=e.defaultTitle,a=e.title,o=e.collabProvider,c=e.onContentChange,u=e.readOnly,d=e.bannerRef,h=e.headerMenu,m=Object(C.f)().t,v=Object(p.useRef)(null),g=Object(p.useCallback)((function(e){n&&n(e)}),[n]);Object(p.useMemo)((function(){return o&&o.setReadOnly(!!u)}),[u,o]);var b=Object(p.useMemo)((function(){return o&&{useNativePlugin:!0,provider:Promise.resolve(o),inviteToEditHandler:function(){},isInviteToEditButtonSelected:!1,userId:o.serviceClient.getSessionId()}}),[o]);Object(p.useEffect)((function(){var e;(e=v.current)&&(e.style.height="".concat(e.scrollHeight,"px"))}),[a]),Object(ut.a)(v.current,"blur",r);var y,O=Object(p.useState)(!1),k=s()(O,2),x=k[0],j=k[1];return f.a.createElement("article",{className:ht.a["note-article"]},x&&f.a.createElement(dt.a,null,f.a.createElement(w.b,{size:"xxlarge",middle:!0})),f.a.createElement("style",null,"#coz-bar ","{ display: none }"),h,f.a.createElement("section",{className:"note-editor-container"},f.a.createElement(st.a,l()({},pt,{disabled:!o&&u,collabEdit:b,onChange:c||wt,defaultValue:t,appearance:"full-page",placeholder:m("Notes.EditorView.main_placeholder"),shouldFocus:!u,legacyImageUploadProvider:(y={collabProvider:o,t:m,setUploading:j},Promise.resolve((function(e,t){return mt(e,(function(e){return yt(y,t,e)}))}))),contentComponents:f.a.createElement(ct.a,{render:function(){return f.a.createElement(f.a.Fragment,null,f.a.createElement("aside",{ref:d,className:ht.a.banner}),f.a.createElement(we.a,{tag:"h1",className:ht.a.title},f.a.createElement(lt.a,{ref:v,rows:"1",readOnly:!!u,fullwidth:!0,value:a,onChange:u?wt:g,placeholder:i,className:ht.a.titleInput})))}})}))))},kt=n("SOfb"),xt=n("9jN0");var jt=function(e){var t=e.cozyClient,n=e.file,r=Object(p.useState)(void 0),i=s()(r,2),o=i[0],c=i[1];return Object(p.useEffect)((function(){function e(){return(e=a()(d.a.mark((function e(n){var r,i;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=E.models.file.normalize(n),e.prev=1,e.next=4,t.query(t.get("io.cozy.files",r.attributes.dir_id));case 4:i=e.sent,c(E.models.file.ensureFilePath(r,i.data)),e.next=12;break;case 8:e.prev=8,e.t0=e.catch(1),console.warn("Request failed when try to fetch the parent ".concat(r.attributes.dir_id," of io.cozy.files ").concat(r.id)),c(null);case 12:case"end":return e.stop()}}),e,null,[[1,8]])})))).apply(this,arguments)}!function(t){e.apply(this,arguments)}(n)}),[t,n,n.attributes.dir_id]),o&&o.id==n.id?o:void 0},Pt=n("R3/7"),Et=n.n(Pt);function Ct(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function St(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ct(Object(n),!0).forEach((function(t){I()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ct(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function _t(e){var t=Object(E.useClient)(),n=jt({cozyClient:t,file:e.file}),r=Object(p.useState)(!1),i=s()(r,2),a=i[0],o=i[1],c=Object(p.useCallback)((function(){return o(!a)}),[a]),l=Object(p.useCallback)((function(){return o(!1)}),[]);if(!n)return null;var u=n.id;return f.a.createElement(f.a.Fragment,null,f.a.createElement(xt.a,{theme:"primary",docId:u,onClick:c,extension:"narrow",className:Et.a["sharing-button"]}),a&&f.a.createElement(P.a,{document:St(St({},n),{},{name:e.title?e.title:n.attributes.name}),documentType:Ae.b.Notes,onClose:l,sharingDesc:e.title}))}var Mt=f.a.forwardRef((function(e,t){return f.a.createElement("div",{ref:t},f.a.createElement(Ue.a,e))})),Dt=function(e){var t=e.doc,n=e.isPublic,r=e.isReadOnly,i=e.title,a=Object(C.f)().t;return n?r?f.a.createElement(kt.a,{title:a("Notes.Editor.read_only")},f.a.createElement(Mt,{icon:"lock",color:"var(--primaryTextColor)"})):null:f.a.createElement(_t,{file:t.file,title:i})};Dt.propTypes={doc:at.a.object.isRequired,isPublic:at.a.bool.isRequired,isReadOnly:at.a.bool.isRequired};var Nt=Dt;var It=function(){return f.a.createElement("div",{className:"u-mv-3"},f.a.createElement(w.b,{size:"xxlarge",middle:!0}))};var Tt=Object(C.e)()((function(e){var t=e.t,n=e.returnUrl;return f.a.createElement(je.a,{icon:"cross-small",title:t("Error.loading_error_title"),text:f.a.createElement("p",{className:"u-mb-half",dangerouslySetInnerHTML:{__html:n?t("Error.loading_error_text_returnUrl",{url:n}):t("Error.loading_error_text_noReturnUrl")}})})})),At=n("h+bj"),Rt=n("Jl/m"),Lt=n("84gJ"),Ut=n.n(Lt),zt=n("i8i4"),Ft=n.n(zt),Bt=n("tRbT"),Vt=n("tNlo"),Wt=n("H2TA"),qt=n("yWSb"),Kt=n.n(qt),Gt=Object(Wt.a)({tooltipPlacementBottom:{margin:"12px 24px"},tooltipPlacementTop:{margin:"12px 24px"}},{name:"MuiTooltip"})(kt.a);function Jt(e){return f.a.createElement(Gt,{title:e.content,open:e.open||void 0,key:e.open?"open":"auto"},e.children)}function Ht(e){var t=e.bannerRef&&e.bannerRef.current;return t?Ft.a.createPortal(f.a.createElement("div",{className:Kt.a.banner},e.content),t):null}function Qt(e){var t=Object(C.f)().t,n=Object(O.b)().isMobile,r=f.a.createElement(Bt.a,{direction:"row",container:!0,wrap:"nowrap",spacing:1,className:Kt.a.grid},f.a.createElement(Bt.a,{item:!0},f.a.createElement(Vt.a.Round,{className:Kt.a.chip},f.a.createElement(Ue.a,{icon:"offline",color:"var(--black)"}))),f.a.createElement(Bt.a,{item:!0},t("Notes.OfflineIndicator.message"))),i=n?Ht:Jt;return f.a.createElement(i,{open:e.open,content:r,bannerRef:e.bannerRef},e.children)}var $t=n("DzJC"),Xt=n.n($t);var Yt=function(e){var t=Object(C.f)().t,n=Object(O.b)().isMobile,r=new Date,i=e.collabProvider,a=r-(i.getLastSaveOrSync()||r),o=i.isDirty(),c=r-i.getDirtySince();!function(e){var t=Object(p.useState)(null),n=s()(t,2)[1],r=Object(p.useCallback)(Xt()((function(){return n(new Date)}),200),[n]);Object(p.useEffect)((function(){return e.on("collab-state-change",r),function(){return e.off("collab-state-change",r)}}),[e,r])}(i);var l,u=function(e){var t=e.isOutOfSync,n=new Date,r=Object(Rt.a)()||t,i=Object(p.useMemo)((function(){return new Date}),[r]);return{isDisconnected:r,disconnectedAge:r?n-i:0}}({isOutOfSync:function(e){var t=e.isDirty,n=e.dirtyAge;return t&&n&&n>3e4}({isDirty:o,dirtyAge:c})}),d=u.isDisconnected,h=u.disconnectedAge,m=function(e){var t=e.disconnectedAge,n=e.isDisconnected&&t<5e3,r=5e3-t;return Object(At.a)(n&&r),n}({isDisconnected:d,disconnectedAge:h}),v=function(e,t){var n=(t||ve).find((function(t){return e<t[0]})),r=s()(n,4),i=r[1],a=r[2],o=r[3];return{key:i,unit:a,coef:o,time:Math.floor(e/a/o)*o,interval:a*o}}(d?h:o?c:a),g=v.key,b=v.time,y=v.interval;Object(At.a)(y),l=o?d?"saving_impossible.".concat(g):c>5e3?"still_saving":"saving":d?"out_of_sync.".concat(g):"saved.default";var w=t("Notes.SavingIndicator.".concat(l),{time:b}),k=f.a.createElement(we.b,{className:Ut.a["saving-indicator"]},w);return d?f.a.createElement(Qt,{open:m,bannerRef:e.bannerRef},k):n?null:k},Zt=n("lwsE"),en=n.n(Zt),tn=n("W8MJ"),nn=n.n(tn),rn=n("G2JP"),an=function(){function e(){en()(this,e)}return nn()(e,[{key:"preventDefault",value:function(){this.prevented=!0}}]),e}();function on(e,t,n){var r=function(){var e=new an;n&&n(e),e.prevented||(document.location=t)};return function(t){t.preventDefault(),e(r)}}function sn(e){var t=e.returnUrl,n=e.file,r=e.requestToLeave,i=Object(p.useContext)(rn.a);if(t){var a=se(E.models.file.getParentFolderId(n));return f.a.createElement(Te.a,{app:{slug:Ae.i.Drive},href:t,nativePath:a},(function(e){var t=e.onClick,n=e.href;return f.a.createElement(M.b,{icon:"previous",onClick:on(r,n,t),href:n,className:"sto-app-back",subtle:!0})}))}if(i)return null;return f.a.createElement(M.a,{icon:"previous",href:"#/",onClick:on(r,"#/"),className:"sto-app-back",subtle:!0})}var cn=function(e){var t=e.serviceClient,n=e.noteId,r=e.readOnly,i=Object(p.useState)(n),o=s()(i,2),c=o[0],l=o[1],u=Object(p.useState)(!0),f=s()(u,2),h=f[0],m=f[1],v=Object(p.useState)(void 0),g=s()(v,2),b=g[0],y=g[1],w=Object(p.useState)(void 0),O=s()(w,2),k=O[0],x=O[1];return Object(p.useEffect)((function(){function e(){return(e=a()(d.a.mark((function e(){var n;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,h||m(!0),e.next=4,t.getDoc(c);case 4:if(n=e.sent,r||3===n.schemaVersion){e.next=9;break}return e.next=8,t.updateSchema(c,V);case 8:n=e.sent;case 9:x(n.title||""),y(n),e.next=18;break;case 13:e.prev=13,e.t0=e.catch(0),x(!1),y(!1),console.warn("Could not load note ".concat(c));case 18:m(!1);case 19:case"end":return e.stop()}}),e,null,[[0,13]])})))).apply(this,arguments)}c!==n?(m(!0),x(void 0),y(void 0),l(n)):t&&(b&&b.file.id===c||function(){e.apply(this,arguments)}())}),[n,c,l,m,t,y,x]),c===n?{loading:h,title:k,doc:b,setTitle:x}:{loading:!0,title:void 0,doc:void 0,setTitle:x}};function ln(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function un(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ln(Object(n),!0).forEach((function(t){I()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ln(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var dn=function(){function e(t){var n=this;en()(this,e),I()(this,"postImage",function(){var e=a()(d.a.mark((function e(t,r,i,a){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",n.stackClient.fetchJSON("POST",n.path(r,"images?Name=".concat(t)),i,{headers:{"Content-Type":a}}));case 1:case"end":return e.stop()}}),e)})));return function(t,n,r,i){return e.apply(this,arguments)}}());var r=t.userId,i=t.cozyClient,o=t.schema,s=t.realtime,c=new Date,l=c.getTime()+"."+c.getMilliseconds()+"."+Math.random();this.sessionId=r+":"+l,this.userId=this.getUserId(r),this.cozyClient=i,this.stackClient=i.getStackClient(),this.schema=o,this.schemaVersion=3,this.onRealtimeEvent=this.onRealtimeEvent.bind(this),this.realtime=s||i.plugins.realtime,this.resetCallbacks()}var t,n,r,i,o,s,c,l,u,p,f,h,m;return nn()(e,[{key:"resetCallbacks",value:function(){this.callbacks={}}},{key:"setCallback",value:function(e,t,n){this.callbacks[e]=this.callbacks[e]||{},this.callbacks[e][t]=n}},{key:"getUserId",value:function(e){return e?e.match(/[^:]+/)[0]:this.userId}},{key:"getSessionId",value:function(){return this.sessionId}},{key:"close",value:function(){this.realtime.unsubscribeAll(),this.resetCallbacks()}},{key:"defaultTitle",value:function(){return(new Date).toISOString()}},{key:"path",value:function(e,t){return e?t?"/notes/".concat(e,"/").concat(t):"/notes/".concat(e):"/notes"}},{key:"client2server",value:function(e){return un({sessionID:e.sessionId||this.sessionId},e)}},{key:"server2client",value:function(e){return un({sessionId:e.sessionID,userId:this.getUserId(e.sessionID)},e)}},{key:"create",value:(m=a()(d.a.mark((function e(t,n){var r;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r={data:{type:"io.cozy.notes.documents",attributes:{title:t||this.defaultTitle(),schema:n||this.schema||V}}},e.abrupt("return",this.stackClient.fetchJSON("POST",this.path(),r));case 2:case"end":return e.stop()}}),e,this)}))),function(e,t){return m.apply(this,arguments)})},{key:"updateSchema",value:(h=a()(d.a.mark((function e(t,n){var r,i;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.stackClient.fetchJSON("PUT",this.path(t,"schema"),{data:{type:"io.cozy.notes.documents",attributes:{schema:un(un({},n),{},{version:3})}}});case 2:return r=e.sent,i=this.formatDoc(r),this.schemaVersion=i.schemaVersion,e.abrupt("return",i);case 6:case"end":return e.stop()}}),e,this)}))),function(e,t){return h.apply(this,arguments)})},{key:"sync",value:(f=a()(d.a.mark((function e(t){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.stackClient.fetchJSON("POST",this.path(t,"sync"));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return f.apply(this,arguments)})},{key:"setTitle",value:(p=a()(d.a.mark((function e(t,n){var r;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r={data:{type:"io.cozy.notes.documents",id:t,attributes:this.client2server({title:n})}},e.next=3,this.stackClient.fetchJSON("PUT",this.path(t,"title"),r);case 3:case"end":return e.stop()}}),e,this)}))),function(e,t){return p.apply(this,arguments)})},{key:"onRealtimeEvent",value:function(e){var t=e.id||e._id,n=e.doctype||e.type;if("file"===n&&(n="io.cozy.files"),this.callbacks[n]&&this.callbacks[n][t])return this.callbacks[n][t](e);console.warn("Event not managed",n,t,this.callbacks)}},{key:"join",value:(u=a()(d.a.mark((function e(t){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all([this.realtime.subscribe(null,"io.cozy.notes.events",t,this.onRealtimeEvent)]);case 2:this.realtime.subscribe("UPDATED","io.cozy.files",t,this.onRealtimeEvent);case 3:case"end":return e.stop()}}),e,this)}))),function(e){return u.apply(this,arguments)})},{key:"onStepsCreated",value:(l=a()(d.a.mark((function e(t,n){var r=this;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.setCallback("io.cozy.notes.steps",t,(function(e){return n(r.server2client(e))}));case 1:case"end":return e.stop()}}),e,this)}))),function(e,t){return l.apply(this,arguments)})},{key:"onTelepointerUpdated",value:(c=a()(d.a.mark((function e(t,n){var r=this;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.setCallback("io.cozy.notes.telepointers",t,(function(e){return n(r.server2client(e))}));case 1:case"end":return e.stop()}}),e,this)}))),function(e,t){return c.apply(this,arguments)})},{key:"onSchemaUpdated",value:(s=a()(d.a.mark((function e(t,n){var r=this;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.setCallback("io.cozy.files",t,(function(e){if(e.metadata.schema.version!==r.schemaVersion)return n(e)}));case 1:case"end":return e.stop()}}),e,this)}))),function(e,t){return s.apply(this,arguments)})},{key:"onTitleUpdated",value:(o=a()(d.a.mark((function e(t,n){var r=this;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.setCallback("io.cozy.notes.documents",t,(function(e){return e.sessionID&&e.sessionID==r.sessionId?null:n(e.title)}));case 1:case"end":return e.stop()}}),e,this)}))),function(e,t){return o.apply(this,arguments)})},{key:"getDoc",value:(i=a()(d.a.mark((function e(t){var n,r;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.stackClient.fetchJSON("GET",this.path(t));case 2:return n=e.sent,r=this.formatDoc(n),this.schemaVersion=r.schemaVersion,e.abrupt("return",r);case 6:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"formatDoc",value:function(e){return{doc:e.data.attributes.metadata.content,version:e.data.attributes.metadata.version,title:e.data.attributes.metadata.title,updatedAt:new Date(e.data.attributes.updated_at),file:e.data,schemaVersion:e.data.attributes.metadata.schema.version}}},{key:"pushSteps",value:(r=a()(d.a.mark((function e(t,n,r){var i,a,o=this;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i={headers:{"if-match":n}},a={data:r.map((function(e){return{type:"io.cozy.notes.steps",attributes:o.client2server(e.toJSON())}}))},e.next=4,this.stackClient.fetchJSON("PATCH",this.path(t),a,i);case 4:return e.abrupt("return",null);case 5:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return r.apply(this,arguments)})},{key:"getSteps",value:(n=a()(d.a.mark((function e(t,n){var r,i,a,o,s,c,l,u,p,f,h=this;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.stackClient.fetchJSON("GET","".concat(this.path(t,"steps"),"?Version=").concat(n));case 3:if(0!=(r=e.sent).data.length){e.next=8;break}return e.abrupt("return",{steps:[],version:n});case 8:return i=r.data.map((function(e){return h.server2client(e.attributes)})),a=r.data[r.data.length-1].attributes.version,e.abrupt("return",{version:a,steps:i});case 11:e.next=28;break;case 13:if(e.prev=13,e.t0=e.catch(0),o=e.t0.response,s=e.t0.reason&&e.t0.reason.data,c=s&&s.attributes&&s.attributes.metadata,l=c&&c.content,u=c&&c.version,412!=o.status||!l||!u){e.next=27;break}return f={_id:t,_type:"io.cozy.notes.events",doctype:p="io.cozy.notes.documents",title:c.title},this.callbacks[p]&&this.callbacks[p][t]&&this.callbacks[p][t](f),e.abrupt("return",{doc:l,version:u});case 27:throw e.t0;case 28:case"end":return e.stop()}}),e,this,[[0,13]])}))),function(e,t){return n.apply(this,arguments)})},{key:"pushTelepointer",value:(t=a()(d.a.mark((function e(t,n){var r;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r={data:{type:"io.cozy.notes.telepointers",id:t,attributes:this.client2server(n)}},e.abrupt("return",this.stackClient.fetchJSON("PUT",this.path(t,"telepointer"),r));case 2:case"end":return e.stop()}}),e,this)}))),function(e,n){return t.apply(this,arguments)})}]),e}();var pn=function(e){var t=e.userId,n=e.userName,r=e.cozyClient;return Object(p.useMemo)((function(){return new dn({userId:t,userName:n,cozyClient:r})}),[r,t,n])},fn=n("RIqP"),hn=n.n(fn),mn=n("cjKa"),vn=n("RsOk"),gn=n("bfWj"),bn=n("mgfL"),yn=n.n(bn),wn=n("BCfO"),On=n.n(wn),kn=n("oON/"),xn=n.n(kn),jn=n("D1y2"),Pn=n.n(jn);function En(e,t){var n=On()("debug.".concat(e));Object(p.useEffect)((function(){n&&Cn(e,t)}),[n,e,t])}function Cn(e,t){Pn()(window,"cozy.debug.".concat(e),t)}Pn()(window,"cozy.debug.showSwitcher",(function(){return yn()("switcher",!0)})),Pn()(window,"cozy.debug.notes.debugCollab",function(){var e=a()(d.a.mark((function e(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return yn()("debug.client",!0),yn()("debug.notes.service",!0),yn()("debug.notes.collabProvider",!0),yn()("debug.notes.channel",!0),yn()("debug.notes.noteId",!0),yn()("debug.notes.doc",!0),yn()("debug.notes.file",!0),yn()("debug.notes.returnUrl",!0),yn()("debug.notes.dirtyRef",!0),yn()("debug.notes.lastPatchError",!0),e.next=12,new Promise((function(e){window.setTimeout(a()(d.a.mark((function t(){var n,r,i,o,s,c,l,u,p,f,h,m,v,g,b,y,w,O,k,x,j,P,E,C,S,_;return d.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=A()(window,"cozy.debug.notes.collabProvider"),r=A()(window,"cozy.debug.notes.channel"),(i={date:(new Date).toISOString()}).noteId=A()(window,"cozy.debug.notes.noteId"),i.initialVersion=A()(window,"cozy.debug.notes.initialVersion"),i.returnUrl=A()(window,"cozy.debug.notes.returnUrl"),o=n&&n.getState(),s=n&&o&&Object(vn.b)(o),c=o&&Object(vn.d)(o)||{steps:[]},l=c.steps,i.state={version:s,steps:l,length:l&&l.length},u=r&&r.backoff,p=r&&r.failures,f=r&&r.isDirty(),h=r&&r.isSending,m=r&&r.hasQueuedSteps(),v=r&&r.queuedStep,g=v&&v.state,b=g&&Object(vn.b)(g),y=v&&v.localSteps&&v.localSteps.steps,i.queue={backoff:u,failures:p,isDirty:f,isSending:h,hasQueue:m,version:b,steps:y,length:y&&y.length},w=n.isDirty(),O=n.getLastRemoteSync(),k=n.getLastLocalSave(),i.collabState={dirtySince:w,lastRemoteSync:O,lastLocalSave:k},x=n&&n.serviceClient,j=x&&x.realtime,P=j&&j.websocket,E=j&&j.retryManager,i.realtime={hasRealtime:!!j,started:j&&j.isStarted,hasWebsocket:j&&j.hasWebSocket(),isOpen:j&&j.isWebSocketOpen(),readyState:P&&P.readyState,bufferedAmount:P&&P.bufferedAmount,url:P&&P.url,retries:E&&E.retries,wait:E&&E.wait},C=A()(window,"cozy.debug.client"),i.client={token:C.stackClient.token,credentials:C.stackClient.getCredentials(),authorization:C.stackClient.getAuthorizationHeader(),uri:C.uri},(S=A()(window,"cozy.debug.notes.lastPatchError"))||!f){t.next=43;break}case 33:if(!r.isSending){t.next=38;break}return t.next=36,new Promise((function(e){return window.setTimeout(e,50)}));case 36:t.next=33;break;case 38:return r.resetBackoff(),r.processQueue(),t.next=42,Promise.race([new Promise((function(e){return window.setTimeout(e,2e3)})),new Promise((function(e){(function(){var t=a()(d.a.mark((function t(){var n;return d.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n=A()(window,"cozy.debug.notes.lastPatchError");case 1:if(n){t.next=7;break}return t.next=4,new Promise((function(e){return window.setTimeout(e,50)}));case 4:n=A()(window,"cozy.debug.notes.lastPatchError"),t.next=1;break;case 7:S=n,e();case 9:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}})()()}))]);case 42:r.isDirty()&&(r.backoff=u,r.failures=p);case 43:_=S&&S.message;try{_=JSON.parse(S.message)}catch(M){}i.lastPatchError={name:S&&S.name,status:S&&S.status,message:_},e(i);case 47:case"end":return t.stop()}}),t)}))),250)}));case 12:return e.abrupt("return",e.sent);case 13:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}());var Sn=function(){function e(t,n){en()(this,e),this.config=t,this.service=n,this.eventEmitter=new mn.EventEmitter2,this.resetBackoff(),this.initializeStepsQueue(),this.isSending=!1}var t,n,r,i,o,s;return nn()(e,[{key:"resetBackoff",value:function(){this.backoff=0,this.failures=0}},{key:"increaseBackoff",value:function(){this.failures=this.failures+1,this.failures%4==0&&this.emit("needcatchup",{failures:this.failures}),this.backoff=Math.max(Math.min(2*this.backoff,3e5),128)}},{key:"afterBackoff",value:function(){var e=this;return new Promise((function(t){e.backoff<128?t():window.setTimeout(t,e.backoff)}))}},{key:"initializeStepsQueue",value:function(){this.queuedStep=void 0}},{key:"isDirty",value:function(){return this.hasQueuedSteps()||this.isSending}},{key:"ensureEmptyQueue",value:(s=a()(d.a.mark((function e(){var t=this;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e){t.isDirty()?t.on("emptyQueue",(function t(){this.off("emptyQueue",t),e()})):e()})));case 1:case"end":return e.stop()}}),e)}))),function(){return s.apply(this,arguments)})},{key:"enqueueSteps",value:function(e){var t=e.getState,n=e.state,r=e.localSteps;this.queuedStep={getState:t,state:n,localSteps:r}}},{key:"dequeueSteps",value:function(){var e=this.queuedStep,t=e.getState,n=e.state||t(),r=e.localSteps||Object(vn.d)(n)||{steps:[]};return this.queuedStep=void 0,{getState:t,state:n,localSteps:r}}},{key:"hasQueuedSteps",value:function(){return!!this.queuedStep}},{key:"rebaseStepsInQueue",value:function(){this.queuedStep&&(this.queuedStep={getState:this.queuedStep.getState})}},{key:"sendSteps",value:(o=a()(d.a.mark((function e(t,n,r){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.emit("enqueueSteps"),this.enqueueSteps({getState:t,state:n,localSteps:r}),e.next=4,this.processQueue();case 4:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return o.apply(this,arguments)})},{key:"processQueue",value:(i=a()(d.a.mark((function e(){var t,n,r,i,a,o,s;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isSending){e.next=2;break}return e.abrupt("return");case 2:if(this.hasQueuedSteps()){e.next=5;break}return this.emit("emptyQueue"),e.abrupt("return");case 5:return this.isSending=!0,e.next=8,this.afterBackoff();case 8:if(t=this.dequeueSteps(),n=t.getState,r=t.state,i=t.localSteps.steps,void 0!==(a=Object(vn.b)(r))){e.next=12;break}return e.abrupt("return");case 12:if(0!==i.length){e.next=14;break}return e.abrupt("return");case 14:return e.prev=14,o=this.config.noteId,e.next=18,this.service.pushSteps(o,a,i);case 18:s=e.sent,this.rebaseStepsInQueue(),this.resetBackoff(),this.emit("successfulPatch"),this.isSending=!1,s&&s.steps&&s.steps.length>0&&this.emit("data",s),e.next=32;break;case 26:e.prev=26,e.t0=e.catch(14),yn()("notes.lastPatchError")&&Cn("notes.lastPatchError",e.t0),this.hasQueuedSteps()?this.rebaseStepsInQueue():this.enqueueSteps({getState:n}),this.increaseBackoff(),this.isSending=!1;case 32:return e.next=34,this.processQueue();case 34:case"end":return e.stop()}}),e,this,[[14,26]])}))),function(){return i.apply(this,arguments)})},{key:"connect",value:(r=a()(d.a.mark((function e(t){var n,r,i,a,o=this;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=t.version,r=t.doc,i=t.updatedAt,a=this.config.noteId,this.service.join(a),this.service.onStepsCreated(a,(function(e){o.emit("data",{version:e.version,steps:[e]})})),this.service.onTelepointerUpdated(a,(function(e){o.emit("telepointer",e)})),this.service.onSchemaUpdated(a,(function(){o.emit("schemaupdated")})),this.emit("connected",{version:n,doc:r,updatedAt:i});case 7:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"getSteps",value:(n=a()(d.a.mark((function e(t){var n;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.config.noteId,e.next=3,this.service.getSteps(n,t);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"sendTelepointer",value:(t=a()(d.a.mark((function e(t){var n;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.config.noteId,e.next=3,this.service.pushTelepointer(n,t);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"on",value:function(e,t){return this.eventEmitter.on(e,t),this}},{key:"off",value:function(e,t){return this.eventEmitter.off(e,t),this}},{key:"emit",value:function(e,t){return this.eventEmitter.emit(e,t),this}}]),e}(),_n=n("sEfC"),Mn=n.n(_n);function Dn(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Nn(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Dn(Object(n),!0).forEach((function(t){I()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Dn(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var In=new gn.a,Tn=In.encode.bind(In);In.encode=function(e){var t=Tn(e);return 0===t.content.length&&0!=e.content.length?{content:[{type:"paragraph",content:[]}],type:"doc"}:t};var An=function(){function e(t,n){var r=this;en()(this,e),I()(this,"processRemoteData",(function(e){var t=e.version,n=e.steps;if(n&&n.length){var i=n.map((function(e){return e.sessionId||r.serviceClient.getUserId(e.sessionId)}));r.emit("data",{json:n,version:t,userIds:i})}else console.warn("Collab.Provider: processRemoteData no steps ? ",n,e)})),I()(this,"onReceiveData",(function(e){r.queueData(e),r.processQueue()})),I()(this,"onReceiveTelepointer",(function(e){var t=e.sessionId,n=r.serviceClient.getUserId(t);if(n!==r.config.userId){var i=r.participants.get(n);i&&i.lastActive>e.timestamp||(r.updateParticipant(t,e.timestamp),r.emit("telepointer",e))}})),I()(this,"onReceiveSchemaUpdated",(function(){window.location.reload(!0)})),this.config=Nn({},t),this.config.sessionId=n.getSessionId(),this.config.userId=n.getUserId(),this.cancelLocalChanges=Mn()(this.cancelLocalChanges.bind(this),100),this.setReadOnly(!!this.config.readOnly),this.serviceClient=n,this.channel=t.channel||new Sn(this.config,n),this.eventEmitter=new mn.EventEmitter2,this.queue=[],this.getState=function(){},this.participants=new Map,this.pauseQueue=!1,this.initialVersion=t.version,this.initialDate=t.updatedAt||new Date,this.pauseQueue=!1}var t;return nn()(e,[{key:"initialize",value:function(e){var t=this;this.getState=e,this.channel.on("connected",(function(e){var n=e.doc,r=e.version,i=e.updatedAt,a=t.config.sessionId;t.emit("init",{sid:a,doc:n,version:r}),t.emit("connected",{sid:a}),t.listenStateEvents({lastRemoteSync:i})})),this.channel.on("data",this.onReceiveData),this.channel.on("telepointer",this.onReceiveTelepointer),this.channel.on("schemaupdated",this.onReceiveSchemaUpdated),this.channel.on("needcatchup",(function(){return t.catchup()}));var n=e(),r=In.encode(n.doc),i=void 0!==this.initialVersion?this.initialVersion:r.version,a=Nn(Nn({},r),{},{version:i});return this.channel.connect({version:i,doc:a,updatedAt:this.initialDate}),this}},{key:"send",value:function(e,t,n){e.steps&&e.steps.length&&(this.isReadOnly()?this.cancelLocalChanges():this.channel.sendSteps(this.getState,n))}},{key:"sendMessage",value:function(e){if(e&&!this.isReadOnly())switch(e.type){case"telepointer":this.channel.sendTelepointer(Nn(Nn({},e),{},{timestamp:(new Date).getTime()}))}}},{key:"queueData",value:function(e){var t=[].concat(hn()(this.queue),[e]).sort((function(e,t){var n=e.version-e.steps.length,r=t.version-t.steps.length;return n>r?1:n<r||e.version>t.version?-1:e.version<t.version?1:0}));this.queue=t}},{key:"catchup",value:(t=a()(d.a.mark((function e(){var t,n,r,i,a,o,s,c,l;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.pauseQueue=!0,t=Object(vn.b)(this.getState()),e.prev=2,e.next=5,this.channel.getSteps(t);case 5:n=e.sent,r=n.doc,i=n.version,a=n.steps,r?(o=this.config.sessionId,s=Object(vn.d)(this.getState())||{},c=s.steps,l=void 0===c?[]:c,this.emit("init",{sid:o,doc:r,version:i}),l.length&&!this.isReadOnly()&&this.emit("local-steps",{steps:l})):a.length>0&&this.onReceiveData({steps:a,version:i},!0),this.queueTimeout=void 0,this.pauseQueue=!1,this.processQueue(),e.next=19;break;case 15:e.prev=15,e.t0=e.catch(2),this.pauseQueue=!1,this.programCatchup();case 19:case"end":return e.stop()}}),e,this,[[2,15]])}))),function(){return t.apply(this,arguments)})},{key:"programCatchup",value:function(){var e=this;this.queueTimeout||(this.queueTimeout=window.setTimeout((function(){e.catchup()}),1e3))}},{key:"cancelCatchup",value:function(){this.queueTimeout&&(window.clearTimeout(this.queueTimeout),this.queueTimeout=void 0)}},{key:"processQueue",value:function(){if(this.queue.length>0&&!this.pauseQueue)for(var e=Object(vn.b)(this.getState());this.queue.length>0;){var t=this.queue[0],n=t.version,r=t.steps.length+e;if(n==r)this.cancelCatchup(),this.queue.shift(),this.processRemoteData(t),e=n;else if(n<=r&&this.queue.shift(),n>r){this.programCatchup();break}}}},{key:"updateParticipant",value:function(e,t){var n=this,r=this.serviceClient.getUserId(e),i=function(e){var t=e.userId,n=e.sessionId;return{userId:n,sessionId:n||t,name:t,avatar:null,email:null}}({userId:r,sessionId:e});this.participants.set(r,Nn(Nn({name:"",email:"",avatar:"",sessionId:e,userId:r},i),{},{lastActive:t}));var a=[this.participants.get(r)],o=(new Date).getTime(),s=Array.from(this.participants.values()).filter((function(e){return(o-e.lastActive)/1e3>300}));s.forEach((function(e){return n.participants.delete(e.userId)})),this.emit("presence",{joined:a,left:s})}},{key:"emit",value:function(e,t){return this.eventEmitter.emit(e,t),this}},{key:"on",value:function(e,t){return this.eventEmitter.on(e,t),this}},{key:"off",value:function(e,t){return this.eventEmitter.off(e,t),this}},{key:"unsubscribeAll",value:function(e){this.eventEmitter.removeAllListeners(e)}},{key:"isDirty",value:function(){return!!this.dirtySince}},{key:"getDirtySince",value:function(){return this.dirtySince}},{key:"getLastLocalSave",value:function(){return this.lastLocalSave}},{key:"getLastRemoteSync",value:function(){return this.lastRemoteSync}},{key:"getLastSaveOrSync",value:function(){return this.lastLocalSave>this.lastRemoteSync?this.lastLocalSave:this.lastRemoteSync}},{key:"onLocalSave",value:function(){this.lastLocalSave=new Date,this.emit("collab-state-change")}},{key:"onRemoteSync",value:function(){this.lastRemoteSync=new Date,this.emit("collab-state-change")}},{key:"onChannelEmptyQueue",value:function(){this.dirtySince=void 0,this.emit("collab-state-change")}},{key:"onChannelEnqueue",value:function(){this.dirtySince||(this.dirtySince=new Date,this.emit("collab-state-change"))}},{key:"listenStateEvents",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.lastRemoteSync;this.channel.on("emptyQueue",this.onChannelEmptyQueue.bind(this)),this.channel.on("enqueueSteps",this.onChannelEnqueue.bind(this)),this.channel.on("successfulPatch",this.onLocalSave.bind(this)),this.on("data",this.onRemoteSync.bind(this)),this.on("init",this.onRemoteSync.bind(this)),t&&(this.lastRemoteSync=t)}},{key:"isReadOnly",value:function(){return this.readOnly}},{key:"setReadOnly",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.readOnly=!!e,this.readOnly&&this.cancelLocalChanges()}},{key:"cancelLocalChanges",value:function(){var e=this.getState&&this.getState();if(e){var t=A()(e,"collab$.unconfirmed[0].origin.docs[0]"),n=A()(e,"collab$.version"),r=this.config.sessionId;if(t&&n&&r){var i=t.toJSON();this.emit("init",{doc:i,version:n,sid:r})}}}}]),e}();var Rn=function(e){var t=e.doc,n=e.noteId,r=e.serviceClient;return Object(p.useMemo)((function(){var e=t&&t.version,i=t&&t.updatedAt;if(r&&void 0!==t)return new An({version:e,noteId:n,updatedAt:i},r)}),[n,t,r])};var Ln=function(e){var t=e.noteId,n=e.title,r=e.setTitle,i=e.serviceClient,a=Object(p.useCallback)(i?function(e){var a;if("insertLineBreak"===(null===(a=e.nativeEvent)||void 0===a?void 0:a.inputType))return window.document.querySelector(".ProseMirror").focus();var o=e.target.value.replace(/[\r\t\n\xa0]+/g," ");n!=o&&(r(o),i.setTitle(t,o))}:function(){},[t,n,r,i]);Object(p.useEffect)((function(){i&&i.onTitleUpdated(t,(function(e){n!=e&&r(e)}))}),[n,r,i,t]);var o=Object(p.useMemo)(le,[]);return Object(p.useEffect)((function(){document.title=n&&""!=n?"".concat(n," - ").concat(o):o}),[o,n]),{onLocalTitleChange:a}};var Un=function(e){var t=e.doc,n=e.collabProvider,r=t&&t.file.id,i=n&&n.serviceClient,o=n&&n.channel;return{forceSync:Object(p.useCallback)(function(){var e=a()(d.a.mark((function e(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t&&o&&i)){e.next=5;break}return e.next=3,o.ensureEmptyQueue();case 3:return e.next=5,i.sync(r);case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),[t,o,i,r]),emergencySync:Object(p.useCallback)((function(){r&&i&&i.sync(r)}),[r,i])}};var zn=function(e){var t=e.returnUrl,n=e.cozyClient,r=e.doc,i=Object(p.useContext)(rn.a);return Object(p.useMemo)((function(){return void 0!==t?t:r?(e=n,a=r.file,ce(e,E.models.file.getParentFolderId(a))):i?void 0:"/";var e,a}),[t,r,i,n])};var Fn=function(e){var t=e.userName,n=e.cozyClient,r=Object(p.useContext)(rn.a),i=Object(p.useMemo)((function(){return t||((e=new URLSearchParams(window.location.search)).has("username")?e.get("username"):null)||(r?"?":new URL(n.getStackClient().uri).hostname+Math.floor(100*Math.random()));var e}),[n,t,r]);return{userId:i,userName:i}},Bn=n("5ViJ"),Vn=n("rvOC"),Wn=n("MSWZ"),qn=n("UyMz"),Kn=n("c8ah"),Gn=n("he1T"),Jn=n.n(Gn),Hn=function(e){var t=e.file,n=Object(E.useClient)(),r=jt({cozyClient:n,file:t}),i=Object(p.useMemo)((function(){return ce(n,t.attributes.dirId)}),[n,t.attributes.dirId]);return f.a.createElement(Qe,{hideOn:ye.Mobile},r?f.a.createElement(He,{drivePath:i,path:r.path,target:"_blank"}):null)},Qn=function(e){var t,n=e.homeHref,r=e.leftComponent,i=e.rightComponent,a=e.isPublic,o=e.file,s=e.primaryToolBarComponents,c=(t=Object(E.useClient)(),{fetchHomeIcon:function(){return"".concat(t.options.uri,"/assets/images/icon-cozy-home.svg")},fetchNoteIcon:function(){return"/public/".concat(t.instanceOptions.app.icon)}}),u=c.fetchHomeIcon,d=c.fetchNoteIcon,p=E.models.file.splitFilename(o.attributes).filename;return f.a.createElement("header",{className:Jn.a["header-menu"]},f.a.createElement(Qe,{hideOn:ye.Mobile},f.a.createElement(Te.a,{app:{slug:Ae.i.Home},href:n},(function(e){var t=e.href;return f.a.createElement(qn.a,l()({},!a&&{href:t},{className:Jn.a["home-link"]}),f.a.createElement(Vn.a,{app:Ae.i.Home,alt:Ae.i.Home,fetchIcon:u}))})),f.a.createElement(Wn.a,{orientation:"vertical",className:"u-mh-1"})),r,f.a.createElement("div",{className:Jn.a["file-infos"]},f.a.createElement(Qe,{hideOn:ye.Mobile},f.a.createElement(Vn.a,{app:o.attributes.cozyMetadata.createdByApp,className:Jn.a["app-icon"],fetchIcon:d})),f.a.createElement("div",null,f.a.createElement(Kn.a,null,f.a.createElement("strong",null,p)),!a&&f.a.createElement(Hn,{file:o}))),f.a.createElement(Qe,{hideOn:ye.Mobile},f.a.createElement(Be.a,{docId:o.id,size:32})),i,s)};function $n(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Xn(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?$n(Object(n),!0).forEach((function(t){I()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):$n(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Yn(e){var t=Object(E.useClient)(),n=e.noteId,r=e.readOnly,i=Object(C.f)().t,a=Object(p.useRef)(),o=Object(p.useContext)(rn.a),c=Fn({userName:e.userName,cozyClient:t}),l=c.userName,u=c.userId,d=pn({userId:u,userName:l,cozyClient:t}),h=cn({serviceClient:d,noteId:n,readOnly:r}),m=h.loading,v=h.title,g=h.doc,b=h.setTitle,y=zn({returnUrl:e.returnUrl,cozyClient:t,doc:g}),w=Rn({noteId:n,serviceClient:d,doc:g}),O=Ln({noteId:n,title:v,setTitle:b,serviceClient:d}).onLocalTitleChange,k=Un({doc:g,collabProvider:w}),x=k.forceSync,j=k.emergencySync;Object(p.useEffect)((function(){return x}),[n,g,x]);var P,S,_,M,D,N=Object(p.useCallback)((function(){return w.isDirty()}),[w]),I=Object(Bn.a)({activate:N,onLeave:j,title:i("Notes.Editor.exit_confirmation_title"),message:i("Notes.Editor.exit_confirmation_message"),leaveLabel:i("Notes.Editor.exit_confirmation_leave"),cancelLabel:i("Notes.Editor.exit_confirmation_cancel")}),T=I.exitConfirmationModal,A=I.requestToLeave,R=(P=window.location.pathname,S=Object(p.useState)(!1),_=s()(S,2),M=_[0],D=_[1],Object(p.useEffect)((function(){D(Ae.h===P&&!!Object(L.c)())}),[P]),M);return En("client",t),En("notes.service",d),En("notes.collabProvider",w),En("notes.channel",w&&w.channel),En("notes.noteId",n),En("notes.doc",g&&Xn(Xn({},g.doc),{},{version:g.version})),En("notes.file",g&&g.file),En("notes.returnUrl",y),m?f.a.createElement(It,null):g?f.a.createElement(f.a.Fragment,null,f.a.createElement(Ot,{bannerRef:a,readOnly:r,onTitleChange:O,onTitleBlur:j,collabProvider:w,defaultTitle:i("Notes.Editor.title_placeholder"),defaultValue:Xn(Xn({},g.doc),{},{version:g.version}),title:v&&v.length>0?v:void 0,headerMenu:f.a.createElement(Qn,{leftComponent:f.a.createElement("div",{className:"u-mr-1"},f.a.createElement(sn,{returnUrl:y,file:g.file,requestToLeave:A})),rightComponent:f.a.createElement(Nt,{doc:g,isPublic:o,isReadOnly:r,title:v}),homeHref:w.serviceClient.cozyClient.getStackClient().uri,isPublic:o,file:g.file,primaryToolbarComponents:R?f.a.createElement(ot.a,null):null})}),f.a.createElement(Yt,{collabProvider:w,bannerRef:a}),T):f.a.createElement(Tt,{returnUrl:y})}Yn.propTypes={noteId:at.a.string.isRequired,readOnly:at.a.bool.isRequired,userName:at.a.string,returnUrl:at.a.oneOfType([at.a.string,at.a.bool]).isRequired};var Zn=Object(C.e)()((function(e){var t=e.t;return f.a.createElement(je.a,{icon:"unlink",title:t("Error.unshared_title"),text:t("Error.unshared_text")})})),er=n("pZg0"),tr=function(){var e=Object(h.g)().id,t=$();return f.a.createElement(Yn,{noteId:e,returnUrl:t,readOnly:!1})},nr=function(){var e=Object(h.e)(),t=Object(h.f)(),n=e.state;return f.a.createElement(f.a.Fragment,null,f.a.createElement(h.c,{location:(null==n?void 0:n.backgroundLocation)||e},f.a.createElement(h.a,{path:r.Root,element:f.a.createElement(rt,null)}),f.a.createElement(h.a,{path:r.Editor,element:f.a.createElement(tr,null)})),(null==n?void 0:n.backgroundLocation)&&(null==n?void 0:n.shareModalProps)&&f.a.createElement(h.c,null,f.a.createElement(h.a,{path:r.ShareFromList,element:f.a.createElement(P.a,l()({onClose:function(){return t(-1)}},n.shareModalProps))})))},rr=function(){var e=Object(E.useClient)(),t=Object(p.useState)(null),n=s()(t,2),r=n[0],i=n[1],o=Object(p.useState)(!1),c=s()(o,2),l=c[0],u=c[1],h=Object(p.useMemo)((function(){return $()}),[]);return Object(p.useEffect)((function(){(function(){var t=a()(d.a.mark((function t(){var n,r,a,o,s,c;return d.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,!(n=new URLSearchParams(window.location.search)).has("id")){t.next=11;break}return r=n.get("id"),t.next=6,re(e,r);case 6:a=t.sent,u(a),i(r),t.next=18;break;case 11:return t.next=13,ae(e);case 13:o=t.sent,s=o.id,c=o.readOnly,u(c),i(s);case 18:t.next=23;break;case 20:t.prev=20,t.t0=t.catch(0),i(!1);case 23:case"end":return t.stop()}}),t,null,[[0,20]])})));return function(){return t.apply(this,arguments)}})()()}),[e]),r?f.a.createElement(Yn,{readOnly:l,noteId:r,returnUrl:h||!1}):null!==r?f.a.createElement(Zn,null):f.a.createElement(w.b,{size:"xxlarge",middle:!0})},ir=function(e){var t=e.isPublic,n=Object(E.useClient)(),r=Object(O.b)().isMobile,i=x()().ClientErrors,a=Object(C.f)().t,o=r?Object(L.a)(n.getInstanceOptions().app.name,er.name):"",s=cozy.bar.BarCenter,c=(On()("switcher"),xn.a);return f.a.createElement(f.a.Fragment,null,f.a.createElement(m.a,null,f.a.createElement(j.b,{monoColumn:!0},!t&&r&&f.a.createElement(s,null,f.a.createElement(y.a,null,f.a.createElement(g.a,null,o))),f.a.createElement(j.c,null,f.a.createElement(j.a,null,t?f.a.createElement(rr,null):f.a.createElement(nr,null))),f.a.createElement(b.a,null),f.a.createElement(v.a,{t:a}),f.a.createElement(c,null))),f.a.createElement(i,null))};t.default=function(e){return f.a.createElement(O.a,null,f.a.createElement(ir,e))}},pZg0:function(e,t){e.exports={name:"Notes",name_prefix:"Cozy",slug:"notes",icon:"icon.svg",categories:["cozy"],version:"1.21.0",licence:"AGPL-3.0",editor:"Cozy",source:"https://github.com/cozy/cozy-notes.git@build",developer:{name:"Cozy Cloud",url:"https://cozy.io"},screenshots:["screenshots/fr/screenshot01.png","screenshots/fr/screenshot02.png"],langs:["en","fr"],routes:{"/":{folder:"/",index:"index.html",public:!1},"/public":{folder:"/",index:"index.html",public:!0},"/preview":{folder:"/",index:"index.html",public:!0}},permissions:{apps:{description:"Required by the cozy-bar to display the icons of the apps",type:"io.cozy.apps",verbs:["GET"]},files:{description:"Notes as files",type:"io.cozy.files"},settings:{description:"Required by the cozy-bar to display Claudy and know which applications are coming soon",type:"io.cozy.settings",verbs:["GET"]},sharings:{description:"Required to have access to the sharings in realtime",type:"io.cozy.sharings",verbs:["GET"]},contacts:{type:"io.cozy.contacts",verbs:["GET","POST"]},groups:{type:"io.cozy.contacts.groups",verbs:["GET"]}}}},q3Kj:function(e,t,n){"use strict";n.d(t,"a",(function(){return s})),n.d(t,"b",(function(){return c}));var r=n("mG1W"),i=n("y0Hk"),a=n("byNj"),o=function(e){return function(t){return function(e,t){return e.setMeta(a.a,t)}(t,{name:"START_UPLOAD",event:e})}},s=function(e){return function(t,n){if(!a.a.getState(t).enabled||!e.src)return!1;var o=Object(i.b)(e.src,t.schema);return!!o&&(n&&n(Object(r.safeInsert)(o,t.selection.$to.pos)(t.tr).scrollIntoView()),!0)}},c=function(e){return function(t,n){return!!a.a.getState(t).enabled&&(n&&n(o(e)(t.tr)),!0)}}},"u/g/":function(e,t,n){"use strict";var r,i,a,o=n("lSNA"),s=n.n(o),c=n("q1tI"),l=n.n(c),u=n("VPdw"),d=n("qo2B"),p=n("ymI0"),f=n("yXPU"),h=n.n(f),m=n("lwsE"),v=n.n(m),g=n("W8MJ"),b=n.n(g),y=n("o0o1"),w=n.n(y),O=n("i8i4"),k=n.n(O),x=n("UxO+"),j=n("CsC6"),P=n("V2qZ"),E=n("NGmG"),C=n("9lTW"),S=n.n(C),_=n("mG1W"),M=n("kabT"),D=n("VkAN"),N=n.n(D),I=n("vOnD"),T=n("gxo2"),A=n("73wN"),R=n("dtZH"),L=n.n(R),U=n("5CwK"),z=n("PJYZ"),F=n.n(z),B=n("7W2i"),V=n.n(B),W=n("a1gu"),q=n.n(W),K=n("Nsbk"),G=n.n(K),J=n("Y5+h"),H=n("4cwp"),Q=n("b0xO"),$=n("SdAV"),X=n("JeIq"),Y=n("YVgD"),Z=I.default.figure(r||(r=N()(["\n  margin: 0;\n"])));Z.displayName="FigureWrapper";var ee=I.default.div(i||(i=N()(["\n  position: absolute;\n  width: 100%;\n  height: 100%;\n"]))),te=I.default.div(a||(a=N()(["\n  width: 100%;\n  position: relative;\n  padding-bottom: ","%;\n"])),(function(e){return e.dimensions.height/e.dimensions.width*100})),ne=function(e){var t=e.dimensions,n=e.children,r=e.onContextMenu;return l.a.createElement(te,{dimensions:t,onContextMenuCapture:r},l.a.createElement(ee,null,n))},re=n("dojK"),ie=n("SH7X");function ae(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=G()(e);if(t){var i=G()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return q()(this,n)}}var oe,se,ce=function(e){V()(r,e);var t,n=ae(r);function r(e){var t;v()(this,r),t=n.call(this,e),s()(F()(t),"mediaPluginState",void 0),s()(F()(t),"state",{imageUrl:"",imageError:"",imageLoading:!0}),s()(F()(t),"realtimeSubscription",void 0),s()(F()(t),"setViewMediaClientConfig",h()(w.a.mark((function e(){var n,r;return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.props.mediaProvider;case 2:(n=e.sent)&&(r=n.viewMediaClientConfig,t.setState({viewMediaClientConfig:r}));case 4:case"end":return e.stop()}}),e)})))),s()(F()(t),"selectMediaSingleFromCard",(function(e){var n=e.event;t.selectMediaSingle(n)})),s()(F()(t),"selectMediaSingle",(function(e){e.stopPropagation();var n=t.props.getPos(),r=t.props.view.state;if(e.shiftKey){if(r.selection instanceof $.a)return;Object(X.g)(t.props.view,r.selection.from<n?r.selection.from:n-1,r.selection.to>n?r.selection.to:n+2)}else Object(X.f)(t.props.view,n-1)})),s()(F()(t),"fetchCozyImage",h()(w.a.mark((function e(){var n,r,i,a,o;return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.setState({imageError:""}),t.state.collabEditProvider){e.next=3;break}throw Error(re.d.MissingCollabEdit);case 3:return n=t.state.collabEditProvider,r=n.serviceClient,i=n.config.noteId,e.prev=4,e.next=7,r.cozyClient.query(Object(ie.Q)(re.a.Files).getById(i));case 7:if(a=e.sent){e.next=10;break}throw Error(re.d.CouldNotGetNoteImages);case 10:if(o=a.included.find((function(e){return e.id===t.props.node.attrs.url}))){e.next=13;break}throw Error(re.d.CouldNotFindFileInCurrentNote);case 13:!o.attributes.willBeResized&&t.setState({imageUrl:"".concat(r.stackClient.uri).concat(o.links.self),imageLoading:!1}),e.next=19;break;case 16:e.prev=16,e.t0=e.catch(4),t.setState({imageError:e.t0.message});case 19:case"end":return e.stop()}}),e,null,[[4,16]])})))),s()(F()(t),"subscribeToImageUpdate",(function(){var e;return null===(e=t.state.collabEditProvider)||void 0===e?void 0:e.serviceClient.realtime.subscribe(re.g.Updated,re.a.NoteEvents,t.state.collabEditProvider.config.noteId,(function(e){var n=e.image_id;t.props.node.attrs.url.includes(n)&&t.setState({imageLoading:!0},t.fetchCozyImage)}))})),s()(F()(t),"handleNewNode",(function(e){var n=e.node;t.mediaPluginState.handleMediaNodeMount(n,(function(){return t.props.getPos()}))}));var i=t.props.view;return t.mediaPluginState=Y.a.getState(i.state),t}return b()(r,[{key:"shouldComponentUpdate",value:function(e,t){var n=!this.state.viewMediaClientConfig&&t.viewMediaClientConfig;return!(this.state.imageUrl===t.imageUrl&&this.state.imageError===t.imageError&&this.props.selected===e.selected&&this.props.uploadComplete===e.uploadComplete&&this.props.node.attrs.id===e.node.attrs.id&&this.props.node.attrs.collection===e.node.attrs.collection&&this.props.maxDimensions.height===e.maxDimensions.height&&this.props.maxDimensions.width===e.maxDimensions.width&&this.props.contextIdentifierProvider===e.contextIdentifierProvider&&this.props.isLoading===e.isLoading&&this.props.mediaProvider===e.mediaProvider&&!n)}},{key:"componentDidMount",value:(t=h()(w.a.mark((function e(){var t,n,r;return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.handleNewNode(this.props),t=this.props,n=t.contextIdentifierProvider,r=t.collabEditProvider,e.t0=this,e.next=5,n;case 5:return e.t1=e.sent,e.next=8,r;case 8:return e.t2=e.sent,e.t3={contextIdentifierProvider:e.t1,collabEditProvider:e.t2},e.t0.setState.call(e.t0,e.t3),this.realtimeSubscription=this.subscribeToImageUpdate(),e.next=14,this.fetchCozyImage();case 14:return e.next=16,this.setViewMediaClientConfig();case 16:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"componentWillUnmount",value:function(){var e,t=this.props.node;null===(e=this.realtimeSubscription)||void 0===e||e.unsubscribe(),this.mediaPluginState.handleMediaNodeUnmount(t)}},{key:"componentDidUpdate",value:function(e){e.node.attrs.id!==this.props.node.attrs.id&&(this.mediaPluginState.handleMediaNodeUnmount(e.node),this.handleNewNode(this.props)),this.mediaPluginState.updateElement(),this.setViewMediaClientConfig()}},{key:"render",value:function(){var e=this.props,t=e.node,n=e.selected,r=e.uploadComplete,i=e.originalDimensions,a=e.isLoading,o=e.maxDimensions,s=e.mediaOptions,c=this.state,u=c.viewMediaClientConfig,d=c.contextIdentifierProvider,p=t.attrs,f=p.id,h=p.type,m=p.collection,v=p.url,g=p.alt;if(this.state.imageLoading||!this.state.imageUrl||this.state.imageError||a||"external"!==h&&(!u||"boolean"==typeof r&&!r))return l.a.createElement(ne,{dimensions:i},l.a.createElement(H.a,null));var b=d&&d.objectId,y="external"===h?{dataURI:this.state.imageUrl,name:v,mediaItemType:"external-image"}:{id:f,mediaItemType:"file",collectionName:m},w=u||{authProvider:function(){return{}}};return l.a.createElement(ne,{dimensions:i,onContextMenu:this.selectMediaSingle},l.a.createElement(Q.a,{mediaClientConfig:w,resizeMode:"stretchy-fit",dimensions:o,originalDimensions:i,identifier:y,selectable:!0,selected:n,disableOverlay:!0,onClick:this.selectMediaSingleFromCard,useInlinePlayer:s&&s.allowLazyLoading,isLazy:s&&s.allowLazyLoading,featureFlags:s&&s.featureFlags,contextId:b,alt:g}))}}]),r}(c.Component),le=Object(J.a)(ce),ue=I.default.div(oe||(oe=N()(["\n  color: ",";\n  background: ",";\n  border-radius: ","px;\n  margin: 5px 3px 25px;\n  width: ","px;\n  min-height: ","px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n"])),Object(U.J)(A.B400,.4)||A.B400,Object(U.J)(A.B300,.6)||A.B300,Object(T.c)(),156,125),de=I.default.div(se||(se=N()(["\n  background: ",";\n  border-radius: ","px;\n  margin: 2px 0;\n  width: 100%;\n  height: 2px;\n"])),A.B200,Object(T.c)()),pe=function(e){var t=e.type;return"single"===(void 0===t?"group":t)?l.a.createElement(de,null):l.a.createElement(ue,null,l.a.createElement(L.a,{label:"Document",size:"medium"}))},fe=n("MEpN"),he=n("k9uR"),me=n("avnJ"),ve=n("ckle"),ge=n("4Wbe"),be=n("JLRh"),ye=n("9J0+"),we=n("ctWQ"),Oe=function(e,t){var n="";return 1===e.length?n=e[0].fileMimeType||"unknown":e.length>1&&(n="multiple"),{action:ye.a.INSERTED,actionSubject:ye.b.DOCUMENT,actionSubjectId:ye.c.MEDIA,attributes:{type:ye.c.MEDIA_GROUP,inputMethod:t,fileExtension:n},eventType:ye.d.TRACK}};var ke=function(e,t,n,r){var i=e.state,a=e.dispatch,o=i.tr,s=i.schema,c=s.nodes,l=c.media,u=c.paragraph;if(l&&t.length){var d=xe(t,n,l),p=Pe(i),f=o.doc.resolve(p).parent,h=o.doc.nodeAt(p),m=!function(e){var t=e.schema,n=e.selection.$anchor.node();return n&&n.type===t.nodes.mediaGroup}(i)&&Object(be.e)(i,fe.Fragment.from(i.schema.nodes.mediaGroup.createChecked({},d))),v=function(e,t){var n=e.schema.nodes.media,r=t&&t.type===n;return(Object(he.j)(e)||Object(he.n)(e)||Object(he.m)(e)||Object(ge.d)(e)&&(!Object(ve.h)(e)||Object(ve.e)(e)))&&!r}(i,h),g=f.type===s.nodes.mediaGroup?d:[s.nodes.mediaGroup.createChecked({},d)];if(m){g=v?g.concat(u.create()):g;var b=Ee(i);return b?p<=b.start?o.deleteRange(b.start,b.end).insert(p,g):o.insert(p,g).deleteRange(b.start,b.end):o.insert(p,g),Object(we.a)(i,o,Oe(t,r)),a(o),void Se(e)}v&&f.type!==s.nodes.mediaGroup&&g.push(u.create()),Object(we.a)(i,o,Oe(t,r)),a(Object(_.safeInsert)(fe.Fragment.fromArray(g),p)(o))}},xe=function(e,t,n){return e.map((function(e){var r=e.id,i=n.create({id:r,type:"file",collection:t});return Object(ve.a)(e,i),i}))},je=function(e){var t=e.schema.nodes,n=t.mediaGroup,r=t.listItem;if(Object(_.hasParentNode)((function(e){return e.type===r}))(e.selection)){var i=function(e){var t=e.schema.nodes,n=t.bulletList,r=t.orderedList;return Object(me.b)((function(e){return e.type===n||e.type===r}))(e.selection.$from)}(e);if(i){var a=i.pos+i.node.nodeSize,o=e.doc.nodeAt(a);return o&&o.type===n?a+1:a}}},Pe=function(e){var t=e.selection,n=t.$from,r=t.$to,i=je(e);if(i)return i;var a=Object(ve.f)(e);return a&&(!Object(ve.e)(e)||n.pos<a&&r.pos<a)?a:Object(ve.e)(e)?r.pos:Object(ge.c)(e)?r.pos+1:Object(ge.a)(e)?n.pos-1:r.pos},Ee=function(e){var t=e.selection,n=t.$from,r=t.$to;if(!Object(ve.g)(e))return!Object(ve.c)(e)||Object(ve.f)(e)?Ce(n.pos,r.pos):Ce(Object(ge.f)(n)-1,Object(ge.e)(r))},Ce=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e;return{start:e,end:t}},Se=function(e){var t=e.state,n=t.doc,r=Object(ve.f)(t);if(r){var i=n.resolve(r),a=Object(ge.e)(i);a+1>=n.nodeSize-1?Object(X.f)(e,r):Object(X.g)(e,a+1)}},_e=n("00zI");function Me(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}var De=function(e,t){return e.mediaNodes.reduce((function(e,n){return e||(n.node.attrs.id===t?n:e)}),null)},Ne=function(e,t,n){return n?De(e,t):e.mediaGroupNodes[t]},Ie=function(e,t){return e.mediaOptions&&e.mediaOptions.allowMarkingUploadsAsIncomplete&&"boolean"==typeof e.mobileUploadComplete[t]?e.mobileUploadComplete[t]:void 0},Te=function(e,t,n){return function(r,i){var a,o=Y.a.getState(r);if(n)a=function(e,t){return e.mediaNodes.filter((function(e){return e.node.attrs.id===t}))}(o,e);else{var s=Ne(o,e,n);a=s?[s]:[]}var c=r.schema.nodes.media;if(0===(a=a.filter((function(e){var t;try{t=r.doc.nodeAt(e.getPos())}catch(n){return!1}return t&&t.type===c}))).length)return!1;if(i){var l=r.tr;a.forEach((function(e){var n=e.getPos;return l.step(new _e.a(n(),t))})),l.setMeta("addToHistory",!1),i(l)}return!0}},Ae=function(e,t,n){return function(r,i){var a=Y.a.getState(r),o=Ne(a,e,n);return!!o&&(i&&i(r.tr.step(new _e.a(o.getPos(),t)).setMeta("addToHistory",!1)),!0)}},Re=function(e,t){return function(n,r){return!!r&&(r(n.tr.step(new _e.a(e,function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Me(Object(n),!0).forEach((function(t){s()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Me(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({type:"file",url:null},t))).setMeta("addToHistory",!1)),!0)}},Le=n("0q37"),Ue=function(){function e(t,n,r){var i=this,a=(arguments.length>3&&void 0!==arguments[3]||Le.d,arguments.length>4?arguments[4]:void 0);v()(this,e),s()(this,"picker",void 0),s()(this,"onDragListeners",[]),s()(this,"errorReporter",void 0),s()(this,"pickerType",void 0),s()(this,"onStartListeners",[]),s()(this,"eventListeners",{}),s()(this,"analyticsName",void 0),s()(this,"erroredFiles",void 0),s()(this,"handleUploadPreviewUpdate",(function(e){var t=e.file,n=e.preview,r=i.erroredFiles.has(t.id),a=Object(Le.e)(n)?n:{dimensions:void 0,scaleFactor:void 0},o=a.dimensions,s=a.scaleFactor,c={id:t.id,fileName:t.name,fileSize:t.size,fileMimeType:t.type,dimensions:o,scaleFactor:s,status:r?"error":void 0};i.eventListeners[t.id]=[],i.onStartListeners.forEach((function(e){return e(c,(function(e){return i.subscribeStateChanged(t,e)}),i.analyticsName||i.pickerType)}))})),s()(this,"subscribeStateChanged",(function(e,t){var n=i.eventListeners[e.id];n&&n.push(t)})),s()(this,"handleUploadError",(function(e){var t=e.error,n=e.fileId,r=i.eventListeners[n];i.erroredFiles.add(n),r&&(r.forEach((function(e){return e({id:n,status:"error",error:t&&{description:t.description,name:t.name}})})),delete i.eventListeners[n])})),s()(this,"handleMobileUploadEnd",(function(e){var t=e.file,n=i.eventListeners[t.id];n&&n.forEach((function(e){return e({id:t.id,status:"mobile-upload-end",fileMimeType:t.type,collection:t.collectionName,publicId:t.publicId})}))})),s()(this,"handleReady",(function(e){var t=e.file,n=i.eventListeners[t.id];n&&(n.forEach((function(e){return e({id:t.id,status:"ready"})})),delete i.eventListeners[t.id])})),this.pickerType=t,this.errorReporter=n.errorReporter,this.analyticsName=a,this.erroredFiles=new Set}var t;return b()(e,[{key:"init",value:(t=h()(w.a.mark((function e(){var t;return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("customMediaPicker"!==this.pickerType){e.next=4;break}t=this.picker=this.pickerConfig,e.next=8;break;case 4:if("popup"!==this.pickerType){e.next=8;break}return e.next=7,this.mediaPickerFactoryClass(this.config.mediaClientConfig,this.pickerConfig);case 7:t=this.picker=e.sent;case 8:if(t){e.next=10;break}return e.abrupt("return",this);case 10:return t.on("upload-preview-update",this.handleUploadPreviewUpdate),t.on("upload-end",this.handleReady),t.on("upload-error",this.handleUploadError),t.on("mobile-upload-end",this.handleMobileUploadEnd),e.abrupt("return",this);case 15:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"type",get:function(){return this.pickerType}},{key:"mediaPicker",get:function(){return this.picker}},{key:"destroy",value:function(){var e=this.picker;if(e){e.removeAllListeners("upload-preview-update"),e.removeAllListeners("upload-end"),e.removeAllListeners("upload-error"),this.onStartListeners=[],this.onDragListeners=[];try{"popup"===this.pickerType&&e.teardown()}catch(t){this.errorReporter.captureException(t)}}}},{key:"setUploadParams",value:function(e){this.picker&&this.picker.setUploadParams(e)}},{key:"onClose",value:function(e){var t=this.picker;if("popup"===this.pickerType){var n=t;return n.on("closed",e),function(){return n.off("closed",e)}}return function(){}}},{key:"show",value:function(){if("popup"===this.pickerType)try{this.picker.show()}catch(e){this.errorReporter.captureException(e)}}},{key:"hide",value:function(){"popup"===this.pickerType&&this.picker.hide()}},{key:"onNewMedia",value:function(e){this.onStartListeners.push(e)}},{key:"onDrag",value:function(e){this.onDragListeners.push(e)}}]),e}(),ze=n("KDJG");function Fe(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Be(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Fe(Object(n),!0).forEach((function(t){s()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Fe(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Ve=["ready","error","cancelled"],We=function(){function e(t,n,r,i,a){var o=this;v()(this,e),s()(this,"allowsUploads",!1),s()(this,"mediaClientConfig",void 0),s()(this,"uploadMediaClientConfig",void 0),s()(this,"ignoreLinks",!1),s()(this,"waitForMediaUpload",!0),s()(this,"allUploadsFinished",!0),s()(this,"showDropzone",!1),s()(this,"element",void 0),s()(this,"layout","center"),s()(this,"mediaNodes",[]),s()(this,"mediaGroupNodes",{}),s()(this,"mobileUploadComplete",{}),s()(this,"options",void 0),s()(this,"mediaProvider",void 0),s()(this,"pendingTask",Promise.resolve(null)),s()(this,"view",void 0),s()(this,"destroyed",!1),s()(this,"contextIdentifierProvider",void 0),s()(this,"errorReporter",void 0),s()(this,"popupPicker",void 0),s()(this,"customPicker",void 0),s()(this,"removeOnCloseListener",(function(){})),s()(this,"openMediaPickerBrowser",void 0),s()(this,"onPopupToogleCallback",(function(){})),s()(this,"reactContext",void 0),s()(this,"pickers",[]),s()(this,"pickerPromises",[]),s()(this,"editingMediaSinglePos",void 0),s()(this,"showEditingDialog",void 0),s()(this,"mediaOptions",void 0),s()(this,"dispatch",void 0),s()(this,"onContextIdentifierProvider",function(){var e=h()(w.a.mark((function e(t,n){return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!n){e.next=4;break}return e.next=3,n;case 3:o.contextIdentifierProvider=e.sent;case 4:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()),s()(this,"setMediaProvider",function(){var e=h()(w.a.mark((function e(t){var n,r,i,a;return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=5;break}return o.destroyPickers(),o.allowsUploads=!1,o.destroyed||o.view.dispatch(o.view.state.tr.setMeta(Y.a,{allowsUploads:o.allowsUploads})),e.abrupt("return");case 5:return e.prev=5,e.next=8,t;case 8:o.mediaProvider=e.sent,o.mediaProvider.viewMediaClientConfig||(n=o.mediaProvider.viewMediaClientConfig)&&(o.mediaProvider.viewMediaClientConfig=n),S()(o.mediaProvider.viewMediaClientConfig,"MediaProvider promise did not resolve to a valid instance of MediaProvider - ".concat(o.mediaProvider)),e.next=21;break;case 13:return e.prev=13,e.t0=e.catch(5),r=new Error("Media functionality disabled due to rejected provider: ".concat(e.t0.message)),o.errorReporter.captureException(r),o.destroyPickers(),o.allowsUploads=!1,o.destroyed||o.view.dispatch(o.view.state.tr.setMeta(Y.a,{allowsUploads:o.allowsUploads})),e.abrupt("return");case 21:if(o.mediaClientConfig=o.mediaProvider.viewMediaClientConfig,o.allowsUploads=!!o.mediaProvider.uploadMediaClientConfig,i=o.view,a=o.allowsUploads,!o.destroyed&&i.dom.parentNode&&i.dispatch(i.state.tr.setMeta(Y.a,{allowsUploads:a})),!o.allowsUploads){e.next=35;break}if(o.uploadMediaClientConfig=o.mediaProvider.uploadMediaClientConfig,!o.mediaProvider.uploadParams||!o.uploadMediaClientConfig){e.next=32;break}return e.next=30,o.initPickers(o.mediaProvider.uploadParams,Ue,o.reactContext);case 30:e.next=33;break;case 32:o.destroyPickers();case 33:e.next=36;break;case 35:o.destroyPickers();case 36:case"end":return e.stop()}}),e,null,[[5,13]])})));return function(t){return e.apply(this,arguments)}}()),s()(this,"getMediaOptions",(function(){return o.options})),s()(this,"hasUserAuthProvider",(function(){return!!o.uploadMediaClientConfig&&!!o.uploadMediaClientConfig.userAuthProvider})),s()(this,"insertFile",(function(e,t,n){var r=Be(Be({},e),{},{contextId:o.contextIdentifierProvider?o.contextIdentifierProvider.objectId:void 0}),i=o.collectionFromProvider();if(void 0!==i){o.mediaOptions&&o.mediaOptions.allowMarkingUploadsAsIncomplete&&(o.mobileUploadComplete[r.id]=!1),"error"!==e.status&&o.updateAndDispatch({allUploadsFinished:!1}),Object(M.d)(o.view.state.schema,r.fileMimeType)?Object(M.c)(o.view,r,o.getInputMethod(n),i,o.mediaOptions&&o.mediaOptions.alignLeftOnInsert):ke(o.view,[r],i,o.getInputMethod(n)),t(o.handleMediaState);var a=function(e){return e.status&&-1!==Ve.indexOf(e.status)};a(r)||(o.addPendingTask(new Promise((function(e){t((function(t){a(t)&&e(t)}))}))),o.pendingTask.then((function(){o.updateAndDispatch({allUploadsFinished:!0})})));var s=o.view;s.hasFocus()||s.focus()}})),s()(this,"addPendingTask",(function(e){var t=o.pendingTask,n=function(){return t};o.pendingTask=e.then(n,n)})),s()(this,"splitMediaGroup",(function(){return Object(ve.j)(o.view)})),s()(this,"onPopupPickerClose",(function(){o.onPopupToogleCallback(!1)})),s()(this,"shouldUseMediaPickerPopup",(function(){return!o.mediaOptions||o.mediaOptions&&void 0===o.mediaOptions.useMediaPickerPopup?o.hasUserAuthProvider():!!o.mediaOptions.useMediaPickerPopup})),s()(this,"showMediaPicker",(function(){if(o.openMediaPickerBrowser&&!o.shouldUseMediaPickerPopup())return o.openMediaPickerBrowser();o.popupPicker&&(o.popupPicker.show(),o.onPopupToogleCallback(!0))})),s()(this,"setBrowseFn",(function(e){o.openMediaPickerBrowser=e})),s()(this,"onPopupToggle",(function(e){o.onPopupToogleCallback=e})),s()(this,"waitForPendingTasks",(function(e,t){if(t&&o.pendingTask===t)return t;var n,r=o.pendingTask.then((function(){return o.waitForPendingTasks(void 0,o.pendingTask)}));if(!e)return r;var i=new Promise((function(t,r){n=window.setTimeout((function(){return r(new Error("Media operations did not finish in ".concat(e," ms")))}),e)}));return Promise.race([i,r.then((function(e){return clearTimeout(n),e}))])})),s()(this,"handleMediaNodeRemoval",(function(e,t){var n=e;n||(n=o.view.state.doc.nodeAt(t())),Object(ve.i)(o.view,n,t)})),s()(this,"handleMediaNodeMount",(function(e,t){o.mediaNodes.unshift({node:e,getPos:t})})),s()(this,"handleMediaNodeUnmount",(function(e){o.mediaNodes=o.mediaNodes.filter((function(t){var n=t.node;return e!==n}))})),s()(this,"findMediaNode",(function(e){return De(o,e)})),s()(this,"destroyAllPickers",(function(e){e.forEach((function(e){return e.destroy()})),o.pickers.splice(0,o.pickers.length)})),s()(this,"destroyPickers",(function(){var e=o.pickers,t=o.pickerPromises;t.length===e.length?o.destroyAllPickers(o.pickers):Promise.all(t).then((function(e){return o.destroyAllPickers(e)})),o.popupPicker=void 0,o.customPicker=void 0})),s()(this,"getInputMethod",(function(e){switch(e){case"popup":return ye.e.PICKER_CLOUD;case"clipboard":return ye.e.CLIPBOARD;case"dropzone":return ye.e.DRAG_AND_DROP}})),s()(this,"updateMediaNodeAttrs",(function(e,t,n){var r=o.view;if(r)return Ae(e,t,n)(r.state,r.dispatch)})),s()(this,"handleMediaState",(function(e){switch(e.status){case"error":var t=o.options.uploadErrorHandler;t&&t(e);break;case"mobile-upload-end":var n={id:e.publicId||e.id};"string"==typeof e.collection&&(n.collection=e.collection),o.updateMediaNodeAttrs(e.id,n,Object(M.d)(o.view.state.schema,e.fileMimeType)),o.mobileUploadComplete[n.id]=!0,delete o.mediaGroupNodes[e.id]}})),s()(this,"isMobileUploadCompleted",(function(e){return Ie(o,e)})),s()(this,"removeNodeById",(function(e){var t=e.id,n=Ne(o,t,Object(ze.a)(e.fileMimeType));n&&Object(ve.i)(o.view,n.node,n.getPos)})),s()(this,"removeSelectedMediaContainer",(function(){var e=o.view,t=o.selectedMediaContainerNode();if(!t)return!1;var n=e.state.selection.from;return Object(ve.i)(e,t.firstChild,(function(){return n+1})),!0})),s()(this,"selectedMediaContainerNode",(function(){var e=o.view.state,t=e.selection,n=e.schema;if(t instanceof x.NodeSelection&&(t.node.type===n.nodes.mediaSingle||t.node.type===n.nodes.mediaGroup))return t.node})),s()(this,"handleDrag",(function(e){var t="enter"===e;if(o.showDropzone!==t){o.showDropzone=t;var n=o.view;(0,n.dispatch)(n.state.tr)}})),this.reactContext=r,this.options=n,this.mediaOptions=i,this.dispatch=a,this.waitForMediaUpload=void 0===n.waitForMediaUpload||n.waitForMediaUpload;var c=t.schema.nodes;S()(c.media&&(c.mediaGroup||c.mediaSingle),"Editor: unable to init media plugin - media or mediaGroup/mediaSingle node absent in schema"),n.providerFactory.subscribe("mediaProvider",(function(e,t){return o.setMediaProvider(t)})),n.providerFactory.subscribe("contextIdentifierProvider",this.onContextIdentifierProvider),this.errorReporter=n.errorReporter||new E.a}var t;return b()(e,[{key:"updateElement",value:function(){var e,t=this.selectedMediaContainerNode(),n=this.view.state.schema.nodes.mediaSingle;t&&t.type===n&&(e=this.getDomElement(this.view.domAtPos.bind(this.view))),this.element!==e&&(this.element=e)}},{key:"getDomElement",value:function(e){var t=this.view.state,n=t.selection,r=t.schema;if(n instanceof x.NodeSelection&&n.node.type===r.nodes.mediaSingle){var i=Object(_.findDomRefAtPos)(n.from,e);if(i)return i.childNodes.length?i.querySelector(".wrapper")||i:i.parentNode}}},{key:"setView",value:function(e){this.view=e}},{key:"destroy",value:function(){if(!this.destroyed){this.destroyed=!0;var e=this.mediaNodes;e.splice(0,e.length),this.removeOnCloseListener(),this.destroyPickers()}}},{key:"initPickers",value:(t=h()(w.a.mark((function e(t,n,r){var i,a,o,s,c,l,u,d=this;return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.destroyed&&this.uploadMediaClientConfig){e.next=2;break}return e.abrupt("return");case 2:if(i=this.errorReporter,a=this.pickers,o=this.pickerPromises,a.length){e.next=26;break}if(s={mediaClientConfig:this.uploadMediaClientConfig,errorReporter:i},c={uploadParams:t,proxyReactContext:r(),useForgePlugins:this.mediaOptions&&this.mediaOptions.useForgePlugins||!1,featureFlags:this.mediaOptions&&this.mediaOptions.featureFlags},!this.options.customMediaPicker){e.next=16;break}return l=new n("customMediaPicker",s,this.options.customMediaPicker).init(),o.push(l),e.t0=a,e.next=12,l;case 12:e.t1=this.customPicker=e.sent,e.t0.push.call(e.t0,e.t1),e.next=25;break;case 16:if(!this.shouldUseMediaPickerPopup()){e.next=25;break}return u=new n("popup",s,c).init(),o.push(u),e.t2=a,e.next=22,u;case 22:e.t3=this.popupPicker=e.sent,e.t2.push.call(e.t2,e.t3),this.removeOnCloseListener=this.popupPicker.onClose(this.onPopupPickerClose);case 25:a.forEach((function(e){e.onNewMedia(d.insertFile)}));case 26:a.forEach((function(e){return e.setUploadParams(t)}));case 27:case"end":return e.stop()}}),e,this)}))),function(e,n,r){return t.apply(this,arguments)})},{key:"collectionFromProvider",value:function(){return this.mediaProvider&&this.mediaProvider.uploadParams&&this.mediaProvider.uploadParams.collection}},{key:"updateAndDispatch",value:function(e){var t=this;Object.keys(e).forEach((function(n){var r=n,i=e[r];void 0!==i&&(t[r]=i)})),this.dispatch&&this.dispatch(Y.a,Be({},this))}}]),e}(),qe=function(e){return Y.a.getState(e)},Ke=function(e,t,n,r,i){var a=function(e){var t=document.createElement("div");return e?k.a.render(l.a.createElement(pe,{type:"single"}),t):k.a.render(l.a.createElement(pe),t),t}(i&&i.allowDropzoneDropLine);return new x.Plugin({state:{init:function(e,a){return new We(a,t,n,i,r)},apply:function(e,t){"number"==typeof t.editingMediaSinglePos&&(t.editingMediaSinglePos=e.mapping.map(t.editingMediaSinglePos));var n=e.getMeta(Y.a);if(n){var r=n.allowsUploads;t.updateAndDispatch({allowsUploads:void 0===r?t.allowsUploads:r})}return t}},filterTransaction:function(e,t){return!(e.selectionSet&&Object(_.isNodeSelection)(e.selection)&&e.selection.node.type===t.schema.nodes.media&&e.selection.$anchor.parent.type===t.schema.nodes.mediaSingle)},key:Y.a,view:function(e){var t=qe(e.state);return t.setView(e),t.updateElement(),{update:function(){t.updateElement()}}},props:{decorations:function(e){if(qe(e).showDropzone){var t=e.schema,n=e.selection.$anchor;if(e.selection instanceof x.NodeSelection){if(e.selection.node.type===t.nodes.mediaSingle){var r=P.a.node(e.selection.from,e.selection.to,{class:"richMedia-selected"});return P.b.create(e.doc,[r])}}else{var i=n.pos;if(n.parent.type!==t.nodes.paragraph&&n.parent.type!==t.nodes.codeBlock&&(i=Object(j.h)(e.doc,i,t.nodes.mediaGroup)),null!=i){var o=[P.a.widget(i,a,{key:"drop-placeholder"})];return P.b.create(e.doc,o)}}}},nodeViews:t.nodeViews,handleTextInput:function(e){return qe(e.state).splitMediaGroup(),!1}}})},Ge=n("g09J");function Je(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function He(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Je(Object(n),!0).forEach((function(t){s()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Je(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Qe=new x.PluginKey("mediaEditorPlugin"),$e=Object(Ge.a)(Qe,(function(e,t){switch(t.type){case"open":return He(He({},e),{},{editor:{identifier:t.identifier,pos:t.pos}});case"close":case"upload":return He(He({},e),{},{editor:void 0});case"setMediaClientConfig":return He(He({},e),{},{mediaClientConfig:t.mediaClientConfig});default:return e}}),{mapping:function(e,t){return t.editor?He(He({},t),{},{editor:He(He({},t.editor),{},{pos:e.mapping.map(t.editor.pos)})}):t}}),Xe=$e.createPluginState,Ye=$e.createCommand,Ze=$e.getPluginState;function et(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function tt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?et(Object(n),!0).forEach((function(t){s()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):et(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var nt=function(){return Ye({type:"close"})},rt=function(e,t){return Ye({type:"upload",newIdentifier:e},(function(n,r){var i=Ze(r).editor;if(!i)return n;var a=n.mapping.map(i.pos),o=n.doc.nodeAt(a),s=r.schema.nodes.media;if(!o||o.type!==s)return n;var c=tt(tt({},o.attrs),{},{id:e.id,collection:e.collectionName||o.attrs.collection,occurrenceKey:e.occurrenceKey,width:t.width,height:t.height});return n.setNodeMarkup(a,void 0,c)}))},it=function(e){return function(t){var n=function(){var e=h()(w.a.mark((function e(n,r){var i,a,o,s;return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("mediaProvider"===n){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,r;case 4:if(i=e.sent){e.next=7;break}return e.abrupt("return");case 7:return e.next=9,i.uploadMediaClientConfig;case 9:if(e.t0=e.sent,e.t0){e.next=14;break}return e.next=13,i.viewMediaClientConfig;case 13:e.t0=e.sent;case 14:a=e.t0,o=t.dispatch,s=t.state,Ye({type:"setMediaClientConfig",mediaClientConfig:a})(s,o,t);case 17:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}();return e.subscribe("mediaProvider",n),{destroy:function(){e.unsubscribe("mediaProvider",n)}}}},at=function(e){var t=e.dispatch,n=e.providerFactory;return new x.Plugin({state:Xe(t,{}),key:Qe,view:it(n)})};function ot(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function st(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ot(Object(n),!0).forEach((function(t){s()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ot(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var ct=n("f5LB"),lt=new x.PluginKey("mediaAltTextPlugin"),ut=Object(Ge.a)(lt,(function(e,t){switch(t.type){case"updateAltText":return st({},e);case"openMediaAltTextMenu":return st(st({},e),{},{isAltTextEditorOpen:!0});case"closeMediaAltTextMenu":return st(st({},e),{},{isAltTextEditorOpen:!1});default:return e}}),{onSelectionChanged:function(e,t){return e.getMeta(ct.a)?t:{isAltTextEditorOpen:!1}}}),dt=ut.createPluginState,pt=ut.createCommand,ft=ut.getPluginState,ht=function(e){var t=e.dispatch;e.providerFactory;return new x.Plugin({state:dt(t,{isAltTextEditorOpen:!1}),key:lt,view:function(){return{update:function(e,t){var n=ft(e.state),r=ft(t);n&&r&&r.isAltTextEditorOpen&&!n.isAltTextEditorOpen&&!e.hasFocus()&&e.focus()}}}})},mt=n("fwbU"),vt=n("jWH/");function gt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function bt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?gt(Object(n),!0).forEach((function(t){s()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):gt(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var yt,wt,Ot,kt=pt((function(e){return!!Object(ve.d)(e)&&{type:"closeMediaAltTextMenu"}})),xt=(yt=ye.a.OPENED,wt=function(e){return!!Object(ve.d)(e)&&{type:"openMediaAltTextMenu"}},Ot=function(e){return e.setMeta("scrollIntoView",!1)},Object(we.d)({action:yt,actionSubject:ye.b.MEDIA,actionSubjectId:ye.c.ALT_TEXT,eventType:ye.d.TRACK})(pt(wt,Ot)));var jt=n("ABBN");function Pt(e,t){var n=e.$from,r=n.index(n.depth-1),i=n.node(n.depth-1);return i?i.maybeChild(r+t):null}function Et(e){return function(t,n){var r=t.selection.$from,i=t.schema.nodes.paragraph,a=Pt(t.selection,-2);if(!a)return!1;var o=Pt(t.selection,-1),s=r.pos-o.nodeSize-a.nodeSize,c=t.tr;if(function(t){var n=!1;try{n=e(t)}catch(r){}return n}(a))c=c.replace(s-1,s+a.nodeSize);else if(Object(he.q)(t.selection)?c.replace(r.pos,r.pos+r.parent.nodeSize-1):c.replace(r.pos-1,r.pos+r.parent.nodeSize-1),a.type===i){var l=s+a.nodeSize-2;Object(_.safeInsert)(r.parent.content,l)(c)}else{var u=s+a.nodeSize-1;Object(_.safeInsert)(r.parent.copy(r.parent.content),u)(c)}return n&&n(c),!0}}var Ct,St=function(e){var t=Object(he.l)(e);return function(e,n){var r=e.selection,i=e.schema,a=r.$from;if(!function(e){return!!e.empty&&e.$from.parentOffset<=0}(e.selection))return!1;if(!function(e,t){return e.$from.parent.type===t}(e.selection,i.nodes.paragraph))return!1;return!!function(e,t,n){var r=Pt(e,n);return!!r&&r.type===t}(e.selection,i.nodes.mediaSingle,-1)&&("wrap-right"===Pt(e.selection,-1).attrs.layout?Et(t)(e,n):(n&&Object(jt.f)(e,(function(r){t(a.parent)&&!Object(ge.d)(e)&&r.replace(a.pos-1,a.pos+a.parent.nodeSize-1),n(r)})),!0))}};function _t(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Mt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?_t(Object(n),!0).forEach((function(t){s()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):_t(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}!function(e){e.showToolbar="MEDIA_SHOW_TOOLBAR",e.hideToolbar="MEDIA_HIDE_TOOLBAR",e.setUrl="MEDIA_SET_LINK_TO",e.unlink="MEDIA_LINKING_UNLINK"}(Ct||(Ct={}));function Dt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Nt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Dt(Object(n),!0).forEach((function(t){s()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Dt(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var It=new x.PluginKey("mediaLinking"),Tt={visible:!1,editable:!1,mediaPos:null,link:""};var At=Object(Ge.a)(It,(function(e,t){switch(t.type){case Ct.showToolbar:return Mt(Mt({},e),{},{visible:!0});case Ct.setUrl:return Mt(Mt({},e),{},{editable:!0,link:t.payload});case Ct.hideToolbar:return Mt(Mt({},e),{},{visible:!1});case Ct.unlink:return Mt(Mt({},e),{},{link:"",visible:!1,editable:!1})}return e}),{mapping:function(e,t){return t&&null!==t.mediaPos?Nt(Nt({},t),{},{mediaPos:e.mapping.map(t.mediaPos)}):t},onSelectionChanged:function(e){if(!(e.selection instanceof x.NodeSelection))return Tt;var t=e.selection.$from.pos+1,n=e.doc.nodeAt(t);if(!n||"media"!==n.type.name)return Tt;var r=n.marks.find((function(e){return"link"===e.type.name}));return Nt(Nt({},Tt),{},r?{mediaPos:t,editable:!0,link:r.attrs.href}:{mediaPos:t})}}),Rt=At.createCommand,Lt=At.getPluginState,Ut=n("SH5O"),zt=n("8Uts"),Ft=function(e){var t=e.doc,n=e.selection,r=e.schema;if(t&&n&&n instanceof x.NodeSelection&&n.node.type===r.nodes.mediaSingle){var i=t.nodeAt(n.$anchor.pos+1);if(i&&i.type===r.nodes.media)return i}},Bt=n("OnqS"),Vt=function(){var e=h()(w.a.mark((function e(t,n){var r;return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("external"!==t.attrs.type){e.next=2;break}return e.abrupt("return","external");case 2:if(t.attrs.id){e.next=4;break}return e.abrupt("return");case 4:return e.prev=4,e.next=7,Object(Bt.a)(n).file.getCurrentState(t.attrs.id,{collectionName:t.attrs.collection});case 7:if(!(r=e.sent)||"error"===r.status){e.next=10;break}return e.abrupt("return",r.mediaType);case 10:e.next=14;break;case 12:e.prev=12,e.t0=e.catch(4);case 14:case"end":return e.stop()}}),e,null,[[4,12]])})));return function(t,n){return e.apply(this,arguments)}}();function Wt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function qt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Wt(Object(n),!0).forEach((function(t){s()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Wt(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Kt=Rt((function(e){var t=Lt(e);if(t&&null!==t.mediaPos&&e.doc.nodeAt(t.mediaPos))return{type:Ct.showToolbar};return!1})),Gt=function(e,t,n){if(t&&n){var r=Ft(e);if(!r)return!1;var i=qe(e).mediaClientConfig;if(!i)return!1;Vt(r,i).then((function(e){"external"!==e&&"image"!==e||Ft(n.state)!==r||t(n.state.tr.setMeta(It,{type:Ct.showToolbar}))}))}return!0},Jt=Rt({type:Ct.hideToolbar}),Ht=function(e,t,n){Jt(e,t,n),n&&n.focus()};function Qt(e,t,n){var r=n.forceRemove,i=void 0!==r&&r,a=n.url,o=Lt(t);if(!o||null===o.mediaPos)return e;var s=t.doc.resolve(o.mediaPos),c=t.doc.nodeAt(s.pos);if(!c)return e;var l=t.schema.marks.link,u=t.schema.nodes.media;return Object(zt.f)(l,(function(e,t){if(t&&t.type===u){if(i)return!1;var n=Object(Ut.g)(a);if(!e||e.href!==n)return""!==n.trim()&&qt(qt({},e),{},{href:n})}}),[u])(s.pos,s.pos+c.nodeSize,e,t),e}var $t=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:void 0;return Object(we.a)(t,e,{action:n,eventType:ye.d.TRACK,actionSubject:ye.b.MEDIA,actionSubjectId:ye.c.LINK,attributes:r})},Xt=Rt({type:Ct.unlink},(function(e,t){var n=Qt(e,t,{forceRemove:!0});return $t(n,t,ye.a.DELETED)})),Yt=function(e,t){var n=function(e){var t=e.schema.marks.link,n=Lt(e);if(n&&null!==n.mediaPos){var r=e.doc.resolve(n.mediaPos),i=e.doc.nodeAt(r.pos);if(i)if(t.isInSet(i.marks))return i.marks.find((function(e){return e.type===t})).attrs.href}}(t);return n?e!==n?ye.a.EDITED:void 0:ye.a.ADDED},Zt=function(e,t){return Rt({type:Ct.setUrl,payload:Object(Ut.g)(e)},(function(n,r){var i=Yt(e,r);if(!i)return n;try{var a=Qt(n,r,{url:e});return $t(n,r,i,i===ye.a.ADDED?{inputMethod:t}:void 0),a}catch(o){throw $t(n,r,ye.a.ERRORED,{action:i}),o}}))};var en=function(e){return Y.a.getState(e).ignoreLinks=!0,!1},tn=function(e){return Y.a.getState(e).splitMediaGroup()},nn=function(){var e={};return vt.bindKeymapWithCommand(vt.undo.common,en,e),vt.bindKeymapWithCommand(vt.enter.common,tn,e),vt.bindKeymapWithCommand(vt.insertNewLine.common,tn,e),Object(mt.b)(e)},rn=n("8R/O"),an=n.n(rn),on=n("eo7v"),sn=n("Zzit"),cn=function(e){var t=e.editorView,n=e.eventDispatcher,r=e.pluginKey,i=e.isDisabled,a=e.isReducedSpacing;return l.a.createElement(sn.a,{editorView:t,eventDispatcher:n,plugins:{mediaPlugin:r},render:function(e){var t,n=e.mediaPlugin;return n.allowsUploads?l.a.createElement(on.a,{onClick:(t=n,function(){return t.showMediaPicker(),!0}),disabled:i,title:"Files & images",spacing:a?"none":"default",iconBefore:l.a.createElement(an.a,{label:"Files & images"})}):null}})},ln=n("Oqvs"),un=n("8m3F"),dn=n.n(un),pn=n("8mfK"),fn=n("idzD"),hn=n("gEh3"),mn=n("Fu+u"),vn=n("xk4V"),gn=n.n(vn),bn=n("E6jh"),yn=n("YDJT"),wn=function(){function e(t){var n=this;v()(this,e),s()(this,"props",void 0),s()(this,"updateContextId",h()(w.a.mark((function e(){var t,r,i;return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((t=n.getAttrs())&&"file"===t.type){e.next=3;break}return e.abrupt("return");case 3:return r=t.id,e.next=6,n.getObjectId();case 6:i=e.sent,Te(r,{__contextId:i},n.props.isMediaSingle)(n.props.view.state,n.props.view.dispatch);case 8:case"end":return e.stop()}}),e)})))),s()(this,"hasFileAttributesDefined",(function(){var e=n.getAttrs();return e&&"file"===e.type&&e.__fileName&&e.__fileMimeType&&e.__fileSize&&e.__contextId})),s()(this,"updateFileAttrs",h()(w.a.mark((function e(){var t,r,i,a,o,s,c,l,u,d,p,f,h,m=arguments;return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=!(m.length>0&&void 0!==m[0])||m[0],r=n.getAttrs(),e.next=4,n.props.mediaProvider;case 4:if((i=e.sent)&&i.uploadParams&&r&&"file"===r.type&&!n.hasFileAttributesDefined()){e.next=7;break}return e.abrupt("return");case 7:return a=i.viewMediaClientConfig,o=Object(Bt.a)(a),s={collectionName:r.collection},e.prev=10,e.next=13,o.file.getCurrentState(r.id,s);case 13:if("error"!==(c=e.sent).status){e.next=16;break}return e.abrupt("return");case 16:e.next=21;break;case 18:return e.prev=18,e.t0=e.catch(10),e.abrupt("return");case 21:if(e.t1=n.getNodeContextId(),e.t1){e.next=26;break}return e.next=25,n.getObjectId();case 25:e.t1=e.sent;case 26:l=e.t1,d=(u=c).name,p=u.mimeType,f=u.size,On(r,h={__fileName:d,__fileMimeType:p,__fileSize:f,__contextId:l})&&Te(r.id,h,t)(n.props.view.state,n.props.view.dispatch);case 31:case"end":return e.stop()}}),e,null,[[10,18]])})))),s()(this,"getAttrs",(function(){var e=n.props.node.attrs;if(e)return e})),s()(this,"getObjectId",h()(w.a.mark((function e(){var t;return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.props.contextIdentifierProvider;case 2:return t=e.sent,e.abrupt("return",t&&t.objectId);case 4:case"end":return e.stop()}}),e)})))),s()(this,"uploadExternalMedia",function(){var e=h()(w.a.mark((function e(t){var r,i,a,o,s,c,l,u;return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.props.node,e.next=3,n.props.mediaProvider;case 3:if(i=e.sent,!r||!i){e.next=21;break}if((a=i.uploadMediaClientConfig)&&r.attrs.url){e.next=8;break}return e.abrupt("return");case 8:return o=Object(Bt.a)(a),s=i.uploadParams&&i.uploadParams.collection,e.prev=10,e.next=13,o.file.uploadExternal(r.attrs.url,s);case 13:c=e.sent,l=c.uploadableFileUpfrontIds,u=c.dimensions,Re(t()+1,{id:l.id,collection:s,height:u.height,width:u.width,occurrenceKey:l.occurrenceKey})(n.props.view.state,n.props.view.dispatch),e.next=21;break;case 18:e.prev=18,e.t0=e.catch(10),n.props.dispatchAnalyticsEvent&&n.props.dispatchAnalyticsEvent({action:ye.a.UPLOAD_EXTERNAL_FAIL,actionSubject:ye.b.EDITOR,eventType:ye.d.OPERATIONAL});case 21:case"end":return e.stop()}}),e,null,[[10,18]])})));return function(t){return e.apply(this,arguments)}}()),s()(this,"getNodeContextId",(function(){var e=n.getAttrs();if(e&&"file"===e.type)return e.__contextId})),s()(this,"updateDimensions",(function(e){Te(e.id,{height:e.height,width:e.width},!0)(n.props.view.state,n.props.view.dispatch)})),s()(this,"hasDifferentContextId",h()(w.a.mark((function e(){var t,r;return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.getNodeContextId(),e.next=3,n.getObjectId();case 3:if(r=e.sent,!t||!r||t===r){e.next=6;break}return e.abrupt("return",!0);case 6:return e.abrupt("return",!1);case 7:case"end":return e.stop()}}),e)})))),s()(this,"isNodeFromDifferentCollection",h()(w.a.mark((function e(){var t,r,i,a,o;return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.props.mediaProvider;case 2:if((t=e.sent)&&t.uploadParams){e.next=5;break}return e.abrupt("return",!1);case 5:if(r=t.uploadParams.collection,(i=n.getAttrs())&&"file"===i.type){e.next=9;break}return e.abrupt("return",!1);case 9:if(a=i.collection,o=i.__contextId,e.t0=o,e.t0){e.next=15;break}return e.next=14,n.getObjectId();case 14:e.t0=e.sent;case 15:if(!e.t0||r===a){e.next=18;break}return e.abrupt("return",!0);case 18:return e.abrupt("return",!1);case 19:case"end":return e.stop()}}),e)})))),s()(this,"copyNodeFromBlobUrl",function(){var e=h()(w.a.mark((function e(t){var r,i,a,o,s,c,l,u,d,p,f,h,m,v,g,b,y,O,k;return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((r=n.getAttrs())&&"external"===r.type){e.next=3;break}return e.abrupt("return");case 3:if(i=r.url,a=Object(yn.b)(i)){e.next=7;break}return e.abrupt("return");case 7:return e.next=9,n.props.mediaProvider;case 9:if((o=e.sent)&&o.uploadParams){e.next=12;break}return e.abrupt("return");case 12:if(s=o.uploadParams.collection,c=a.contextId,l=a.id,u=a.collection,d=a.height,p=a.width,f=a.mimeType,h=a.name,m=a.size,(v=o.uploadMediaClientConfig)&&v.getAuthFromContext){e.next=17;break}return e.abrupt("return");case 17:return g=Object(Bt.a)(v),e.next=20,v.getAuthFromContext(c);case 20:return b=e.sent,y={id:l,collection:u,authProvider:function(){return Promise.resolve(b)}},O={collection:s,authProvider:v.authProvider,occurrenceKey:gn()()},e.next=25,g.file.copyFile(y,O);case 25:k=e.sent,Re(t()+1,{id:k.id,collection:s,height:d,width:p,__fileName:h,__fileMimeType:f,__fileSize:m})(n.props.view.state,n.props.view.dispatch);case 27:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),s()(this,"copyNode",h()(w.a.mark((function e(){var t,r,i,a,o,s,c,l,u,d,p,f,h,m,v,g;return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.props.mediaProvider;case 2:if(t=e.sent,r=n.props,i=r.isMediaSingle,a=r.view,o=n.getAttrs(),t&&t.uploadParams&&o&&"file"===o.type){e.next=7;break}return e.abrupt("return");case 7:if(s=n.getNodeContextId(),!((c=t.uploadMediaClientConfig)&&c.getAuthFromContext&&s)){e.next=25;break}return l=Object(Bt.a)(c),e.next=13,c.getAuthFromContext(s);case 13:return u=e.sent,e.next=16,n.getObjectId();case 16:return d=e.sent,p=o.id,f=o.collection,h={id:p,collection:f,authProvider:function(){return Promise.resolve(u)}},m=t.uploadParams.collection,v={collection:m,authProvider:c.authProvider,occurrenceKey:gn()()},e.next=23,l.file.copyFile(h,v);case 23:g=e.sent,Ae(h.id,{id:g.id,collection:m,__contextId:d},i)(a.state,a.dispatch);case 25:case"end":return e.stop()}}),e)})))),this.props=t}var t,n;return b()(e,[{key:"isMediaBlobUrl",value:function(){var e=this.getAttrs();return!(!e||"external"!==e.type||!Object(yn.c)(e.url))}},{key:"getRemoteDimensions",value:(n=h()(w.a.mark((function e(){var t,n,r,i,a,o,s,c,l,u;return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.props.mediaProvider;case 2:if(t=e.sent,n=this.props.mediaOptions,r=this.getAttrs(),t&&r){e.next=7;break}return e.abrupt("return",!1);case 7:if(i=r.height,a=r.width,"external"!==r.type&&r.id){e.next=10;break}return e.abrupt("return",!1);case 10:if(o=r.id,s=r.collection,!i||!a){e.next=13;break}return e.abrupt("return",!1);case 13:if(!n||n.allowRemoteDimensionsFetch){e.next=15;break}return e.abrupt("return",{id:o,height:bn.a,width:bn.b});case 15:return c=t.viewMediaClientConfig,l=Object(Bt.a)(c),e.next=19,l.getImageMetadata(o,{collection:s});case 19:if((u=e.sent)&&u.original){e.next=22;break}return e.abrupt("return",!1);case 22:return e.abrupt("return",{id:o,height:u.original.height||bn.a,width:u.original.width||bn.b});case 23:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"handleExternalMedia",value:(t=h()(w.a.mark((function e(t){return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isMediaBlobUrl()){e.next=12;break}return e.prev=1,e.next=4,this.copyNodeFromBlobUrl(t);case 4:e.next=10;break;case 6:return e.prev=6,e.t0=e.catch(1),e.next=10,this.uploadExternalMedia(t);case 10:e.next=14;break;case 12:return e.next=14,this.uploadExternalMedia(t);case 14:case"end":return e.stop()}}),e,this,[[1,6]])}))),function(e){return t.apply(this,arguments)})}]),e}(),On=function(e,t){return e.__fileName!==t.__fileName||e.__fileMimeType!==t.__fileMimeType||e.__fileSize!==t.__fileSize||e.__contextId!==t.__contextId};function kn(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=G()(e);if(t){var i=G()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return q()(this,n)}}var xn=function(e){return Object(be.c)(e.anchorPos,e.headPos,e.getPos(),e.node.nodeSize)},jn=function(e){V()(n,e);var t=kn(n);function n(e){var r;return v()(this,n),r=t.call(this,e),s()(F()(r),"mediaPluginState",void 0),s()(F()(r),"mediaNodes",void 0),s()(F()(r),"state",{viewMediaClientConfig:void 0}),s()(F()(r),"updateNodeAttrs",(function(e){var t=e.view,n=e.mediaProvider,i=e.contextIdentifierProvider;r.mediaNodes.forEach((function(e){new wn({view:t,mediaProvider:n,contextIdentifierProvider:i,node:e,isMediaSingle:!1}).updateFileAttrs(!1)}))})),s()(F()(r),"setMediaItems",(function(e){var t=e.node;r.mediaNodes=[],t.forEach((function(t,n){r.mediaPluginState.mediaGroupNodes[t.attrs.id]={node:t,getPos:function(){return e.getPos()+n+1}},r.mediaNodes.push(t)}))})),s()(F()(r),"getIdentifier",(function(e){return"external"===e.attrs.type?{mediaItemType:"external-image",dataURI:e.attrs.url}:{id:e.attrs.id,mediaItemType:"file",collectionName:e.attrs.collection}})),s()(F()(r),"isNodeSelected",(function(e){var t=xn(r.props);return t===be.a.selectedInRange||t===be.a.selectedInside&&r.props.anchorPos===e})),s()(F()(r),"renderChildNodes",(function(){var e=r.state.viewMediaClientConfig,t=r.props,n=t.getPos,i=t.allowLazyLoading,a=t.disabled,o=t.mediaOptions,s=r.mediaNodes.map((function(e,t){var o=function(){return n()+t+1};return{identifier:r.getIdentifier(e),isLazy:i,selected:r.isNodeSelected(o()),onClick:function(){Object(X.f)(r.props.view,o())},actions:[{handler:a?function(){}:r.mediaPluginState.handleMediaNodeRemoval.bind(null,void 0,o),icon:l.a.createElement(dn.a,{label:"delete"})}]}}));return l.a.createElement(pn.a,{items:s,mediaClientConfig:e,featureFlags:o.featureFlags})})),r.mediaNodes=[],r.mediaPluginState=Y.a.getState(e.view.state),r.setMediaItems(e),r.state={viewMediaClientConfig:void 0},r}return b()(n,[{key:"componentDidMount",value:function(){var e=this;this.updateMediaClientConfig(),this.mediaNodes.forEach(function(){var t=h()(w.a.mark((function t(n){var r,i,a,o,s;return w.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if("external"!==n.attrs.type){t.next=2;break}return t.abrupt("return");case 2:if(r=e.props,i=r.view,a=r.mediaProvider,o=r.contextIdentifierProvider,s=new wn({view:i,mediaProvider:a,contextIdentifierProvider:o,node:n,isMediaSingle:!1}),s.getNodeContextId()){t.next=8;break}return t.next=8,s.updateContextId();case 8:return t.next=10,s.hasDifferentContextId();case 10:if(!t.sent){t.next=14;break}return t.next=14,s.copyNode();case 14:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())}},{key:"UNSAFE_componentWillReceiveProps",value:function(e){this.updateMediaClientConfig(),this.setMediaItems(e),!1!==e.isCopyPasteEnabled&&this.updateNodeAttrs(e)}},{key:"shouldComponentUpdate",value:function(e){return t=this.props,n=e,xn(t)!==xn(n)||xn(n)===be.a.selectedInside&&t.anchorPos!==n.anchorPos||this.props.node!==e.node||this.state.viewMediaClientConfig!==this.mediaPluginState.mediaClientConfig;var t,n}},{key:"updateMediaClientConfig",value:function(){var e=this.state.viewMediaClientConfig,t=this.mediaPluginState.mediaClientConfig;!e&&t&&this.setState({viewMediaClientConfig:t})}},{key:"render",value:function(){return this.renderChildNodes()}}]),n}(l.a.Component);s()(jn,"displayName","MediaGroup");var Pn,En=function(e){V()(n,e);var t=kn(n);function n(){return v()(this,n),t.apply(this,arguments)}return b()(n,[{key:"render",value:function(e,t){var n=this,r=e.providerFactory,i=e.mediaOptions,a=this.getPos;return l.a.createElement(ln.a,{providers:["mediaProvider","contextIdentifierProvider"],providerFactory:r,renderNode:function(e){var r=e.mediaProvider,o=e.contextIdentifierProvider;return l.a.createElement(sn.a,{editorView:n.view,plugins:{reactNodeViewState:hn.b,editorDisabledPlugin:mn.b},render:function(e){var s=e.editorDisabledPlugin;return r?l.a.createElement(jn,{node:n.node,getPos:a,view:n.view,forwardRef:t,disabled:(s||{}).editorDisabled,allowLazyLoading:i.allowLazyLoading,mediaProvider:r,contextIdentifierProvider:o,isCopyPasteEnabled:i.isCopyPasteEnabled,anchorPos:n.view.state.selection.$anchor.pos,headPos:n.view.state.selection.$head.pos,mediaOptions:i}):null}})}})}}]),n}(fn.a),Cn=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return function(i,a,o){return new En(i,a,o,e,t,{providerFactory:n,mediaOptions:r}).init()}},Sn=n("iWIM"),_n=n.n(Sn),Mn=n("pVnL"),Dn=n.n(Mn),Nn=n("YPIr"),In=n("TwjQ"),Tn=n("qXKI"),An=n("uCUl"),Rn=n("S9L0"),Ln=I.default.div(Pn||(Pn=N()(["\n  img {\n    width: 100%;\n  }\n\n  & > div {\n    ",";\n    position: relative;\n    clear: both;\n  }\n"])),Rn.a);Ln.displayName="ResizerWrapper";var Un=n("N/j8"),zn=n("27vU"),Fn=n("vExi"),Bn=[250,384,576,768];function Vn(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=G()(e);if(t){var i=G()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return q()(this,n)}}var Wn=function(e){V()(i,e);var t,n,r=Vn(i);function i(){var e;v()(this,i);for(var t=arguments.length,n=new Array(t),a=0;a<t;a++)n[a]=arguments[a];return e=r.call.apply(r,[this].concat(n)),s()(F()(e),"state",{offsetLeft:qn(e.insideInlineLike,e.insideLayout,e.props.view.dom,void 0),isVideoFile:!0}),s()(F()(e),"calcNewSize",(function(t,n){var r=e.props,i=r.layout,a=r.view.state,o=100*Object(Tn.b)(t,e.props.lineLength);e.setState({resizedPctWidth:o});var s=Object(_.hasParentNodeOfType)(a.schema.nodes.table)(a.selection)?i:e.calcUnwrappedLayout(o,t);return o<=100?(!e.wrappedLayout||n&&100===o||(s=i),{width:o,layout:s}):{width:e.props.pctWidth||null,layout:s}})),s()(F()(e),"calcUnwrappedLayout",(function(e,t){return e<=100?"center":t<=An.V?"wide":"full-width"})),s()(F()(e),"calcColumnLeftOffset",(function(){var t=e.state.offsetLeft;return e.insideInlineLike?Object(Tn.a)(t,e.props.lineLength,e.props.gridSize):0})),s()(F()(e),"wrapper",void 0),s()(F()(e),"calcPxWidth",(function(t){var n=e.props,r=n.width,i=n.height,a=n.layout,o=n.pctWidth,s=n.lineLength,c=n.containerWidth,l=n.fullWidthMode,u=n.getPos,d=n.view.state,p=e.state.resizedPctWidth,f="function"==typeof u?u():void 0;return Object(M.a)({origWidth:r,origHeight:i,pctWidth:o,state:d,containerWidth:{width:c,lineLength:s},isFullWidthModeEnabled:l,layout:t||a,pos:f,resizedPctWidth:p})})),s()(F()(e),"highlights",(function(t,n){var r=Object(zn.c)(t,n),i=e.props.view.state.schema.nodes,a=i.layoutColumn,o=i.table,s=i.expand,c=i.nestedExpand;if(e.$pos&&Object(_.findParentNodeOfTypeClosestToPos)(e.$pos,[a,o,s,c].filter(Boolean)))return[];if(r>An.V)return["full-width"];var l=e.props,u=l.layout,d=l.lineLength,p=l.gridSize,f=Object(Tn.a)(r,d,p),h=Math.round(f),m=[];return"wrap-left"===u||"align-start"===u?m.push(0,h):"wrap-right"===u||"align-end"===u?m.push(p,p-h):e.insideInlineLike?m.push(Math.round(f+e.calcColumnLeftOffset())):m.push(Math.floor((p-h)/2),Math.ceil((p+h)/2)),m})),s()(F()(e),"saveWrapper",(function(t){return e.wrapper=t})),e}return b()(i,[{key:"componentDidUpdate",value:function(){var e=qn(this.insideInlineLike,this.insideLayout,this.props.view.dom,this.wrapper);return e!==this.state.offsetLeft&&e>=0&&this.setState({offsetLeft:e}),!0}},{key:"wrappedLayout",get:function(){return bn.e.indexOf(this.props.layout)>-1}},{key:"componentDidMount",value:(n=h()(w.a.mark((function e(){var t;return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t=this.props.viewMediaClientConfig)){e.next=4;break}return e.next=4,this.checkVideoFile(t);case 4:this.props.pctWidth&&this.setState({resizedPctWidth:this.props.pctWidth});case 5:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"UNSAFE_componentWillReceiveProps",value:function(e){this.props.viewMediaClientConfig!==e.viewMediaClientConfig&&this.checkVideoFile(e.viewMediaClientConfig),this.props.layout!==e.layout&&this.checkLayout(this.props.layout,e.layout)}},{key:"checkVideoFile",value:(t=h()(w.a.mark((function e(t){var n,r,i,a;return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((n=this.$pos)&&t){e.next=3;break}return e.abrupt("return");case 3:if((r=this.props.view.state.doc.nodeAt(n.pos+1))&&r.attrs.id){e.next=6;break}return e.abrupt("return");case 6:return i=Object(Bt.a)(t),e.prev=7,e.next=10,i.file.getCurrentState(r.attrs.id,{collectionName:r.attrs.collection});case 10:(a=e.sent)&&"error"!==a.status&&"image"===a.mediaType&&this.setState({isVideoFile:!1}),e.next=17;break;case 14:e.prev=14,e.t0=e.catch(7),this.setState({isVideoFile:!1});case 17:case"end":return e.stop()}}),e,this,[[7,14]])}))),function(e){return t.apply(this,arguments)})},{key:"checkLayout",value:function(e,t){var n=this.state.resizedPctWidth;if(bn.e.indexOf(e)>-1&&"center"===t&&n){var r=this.calcUnwrappedLayout(n,this.calcPxWidth(t));this.props.updateSize(n,r)}}},{key:"$pos",get:function(){if("function"!=typeof this.props.getPos)return null;var e=this.props.getPos();return Number.isNaN(e)||"number"!=typeof e?null:this.props.view.state.doc.resolve(e)}},{key:"gridWidth",get:function(){var e=this.props.gridSize;return this.wrappedLayout||this.insideInlineLike?e:e/2}},{key:"insideInlineLike",get:function(){var e=this.$pos;if(!e)return!1;var t=this.props.view.state.schema.nodes.listItem;return!!Object(_.findParentNodeOfTypeClosestToPos)(e,[t])}},{key:"insideLayout",get:function(){var e=this.$pos;if(!e)return!1;var t=this.props.view.state.schema.nodes.layoutColumn;return!!Object(_.findParentNodeOfTypeClosestToPos)(e,[t])}},{key:"render",value:function(){var e=this,t=this.props,n=t.width,r=t.height,i=t.layout,a=t.pctWidth,o=t.containerWidth,s=t.fullWidthMode,c=t.selected,u=t.view.state,d=t.children,p=this.calcPxWidth(),f=r/n*p,h=p,m={};zn.a.forEach((function(t){var n="left"===t?"right":"left";m[t]=["full-width","wide","center"].concat("wrap-".concat(n)).concat("align-".concat(zn.b[n])).indexOf(i)>-1,"left"===t&&e.insideInlineLike&&(m[t]=!1)}));this.$pos,An.V,this.props.allowBreakoutSnapPoints,this.props.containerWidth,this.props.gridSize,this.gridWidth,this.insideInlineLike,this.insideLayout,this.state.isVideoFile,this.props.lineLength,this.state.offsetLeft,this.wrappedLayout;return l.a.createElement(Ln,{ratio:(f/h*100).toFixed(3),layout:i,isResized:!!a,containerWidth:o||n,innerRef:this.saveWrapper,fullWidthMode:s},l.a.createElement(Un.a,Dn()({},this.props,{width:h,height:f,selected:c,enable:m,calcNewSize:this.calcNewSize,snapPoints:Bn,scaleFactor:this.wrappedLayout||this.insideInlineLike?1:2,highlights:this.highlights,handleResizeStart:function(){var e=Object(Fn.c)(u);return!e||!e.dragging},nodeType:"media",dispatchAnalyticsEvent:this.props.dispatchAnalyticsEvent}),d))}}]),i}(l.a.Component);function qn(e,t,n,r){var i=0;r&&e&&!t&&(i=r.getBoundingClientRect().left-n.getBoundingClientRect().left);return i}var Kn=n("jUYI"),Gn=n("5LYD"),Jn=function(){return document.querySelectorAll(".ProseMirror > p").forEach((function(e){return e.setAttribute("contenteditable","false")}))},Hn=function(){return document.querySelectorAll(".ProseMirror > p").forEach((function(e){return e.setAttribute("contenteditable","")}))},Qn=function(){return document.querySelector(".ua-firefox")};function $n(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Xn(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?$n(Object(n),!0).forEach((function(t){s()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):$n(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Yn(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=G()(e);if(t){var i=G()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return q()(this,n)}}var Zn=function(e){V()(r,e);var t,n=Yn(r);function r(){var e;v()(this,r);for(var t=arguments.length,i=new Array(t),a=0;a<t;a++)i[a]=arguments[a];return e=n.call.apply(n,[this].concat(i)),s()(F()(e),"state",{width:void 0,height:void 0,viewMediaClientConfig:void 0,isCopying:!1}),s()(F()(e),"createMediaNodeUpdater",(function(t){var n=e.props.node.firstChild;return new wn(Xn(Xn({},t),{},{isMediaSingle:!0,node:n||e.props.node,dispatchAnalyticsEvent:e.props.dispatchAnalyticsEvent}))})),s()(F()(e),"setViewMediaClientConfig",function(){var t=h()(w.a.mark((function t(n){var r,i;return w.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,n.mediaProvider;case 2:(r=t.sent)&&(i=r.viewMediaClientConfig,e.setState({viewMediaClientConfig:i}));case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),s()(F()(e),"updateMediaNodeAttributes",function(){var t=h()(w.a.mark((function t(n){var r,i,a,o,s,c;return w.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=e.createMediaNodeUpdater(n),i=e.props.mediaPluginState.addPendingTask,a=e.props.node.firstChild){t.next=5;break}return t.abrupt("return");case 5:return t.next=7,r.getRemoteDimensions();case 7:if((o=t.sent)&&r.updateDimensions(o),"external"!==a.attrs.type||!a.attrs.__external){t.next=15;break}return s=r.handleExternalMedia(e.props.getPos),i(s),t.next=14,s;case 14:return t.abrupt("return");case 15:if(r.getNodeContextId()){t.next=19;break}return t.next=19,r.updateContextId();case 19:return t.next=21,r.hasDifferentContextId();case 21:if(!t.sent){t.next=34;break}return e.setState({isCopying:!0}),t.prev=24,c=r.copyNode(),i(c),t.next=29,c;case 29:t.next=34;break;case 31:t.prev=31,t.t0=t.catch(24),e.setState({isCopying:!1});case 34:case"end":return t.stop()}}),t,null,[[24,31]])})));return function(e){return t.apply(this,arguments)}}()),s()(F()(e),"selectMediaSingle",(function(t){var n=t.event;n.stopPropagation();var r=e.props.getPos(),i=e.props.view.state;if(n.shiftKey){if(i.selection instanceof $.a)return;Object(X.g)(e.props.view,i.selection.from<r?i.selection.from:r,i.selection.to>r?i.selection.to:r+3)}else Object(X.f)(e.props.view,r)})),s()(F()(e),"updateSize",(function(t,n){var r=e.props.view,i=r.state,a=r.dispatch,o=e.props.getPos();if(void 0!==o){var s=i.tr.setNodeMarkup(o,void 0,Xn(Xn({},e.props.node.attrs),{},{layout:n,width:t}));return s.setMeta("scrollIntoView",!1),a(s)}})),s()(F()(e),"forwardInnerRef",(function(t){e.props.forwardRef(t)})),s()(F()(e),"getLineLength",(function(e,t){if(Object(Gn.c)(e,t)){var n=e.state.doc.resolve(t),r=e.nodeDOM(n.pos);if(n.nodeAfter&&Gn.b.indexOf(n.nodeAfter.attrs.layout)>-1&&r&&r.parentElement)return r.parentElement.offsetWidth;if(r instanceof HTMLElement)return r.offsetWidth}return null})),e}return b()(r,[{key:"UNSAFE_componentWillReceiveProps",value:function(e){e.mediaProvider!==this.props.mediaProvider&&this.setViewMediaClientConfig(e),!1!==e.isCopyPasteEnabled&&this.createMediaNodeUpdater(e).updateFileAttrs()}},{key:"componentDidMount",value:(t=h()(w.a.mark((function e(){var t;return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.props.contextIdentifierProvider,e.next=3,Promise.all([this.setViewMediaClientConfig(this.props),this.updateMediaNodeAttributes(this.props)]);case 3:return e.t0=this,e.next=6,t;case 6:e.t1=e.sent,e.t2={contextIdentifierProvider:e.t1},e.t0.setState.call(e.t0,e.t2),null!=(n=Qn())&&n.addEventListener("dragstart",Jn),null==n||n.addEventListener("dragend",Hn);case 10:case"end":return e.stop()}var n}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"componentWillUnmount",value:function(){var e;null!=(e=Qn())&&e.removeEventListener("dragstart",Jn),null==e||e.removeEventListener("dragend",Hn)}},{key:"render",value:function(){var e=this.props,t=e.selected,n=e.getPos,r=e.node,i=e.mediaOptions,a=e.fullWidthMode,o=e.view.state,s=e.view,c=r.attrs,u=c.layout,d=c.width,p=r.firstChild.attrs,f=p.width,h=p.height;f&&h||(f=250,h=187.5);var m={layout:u,width:f,height:h,containerWidth:this.props.width,lineLength:this.props.lineLength||768,pctWidth:d||250/768*100,fullWidthMode:a},v=l.a.createElement(Z,{innerRef:this.forwardInnerRef}),g=!!this.props.mediaOptions.allowResizing;if(!this.props.mediaOptions.allowResizingInTables){var b=n();if(b){var y=o.doc.resolve(b),w=o.schema.nodes.table,O=!!Object(_.findParentNodeOfTypeClosestToPos)(y,[w]);g=g&&!O}}var k=this.getLineLength(s,n())||m.lineLength;return g?l.a.createElement(Wn,Dn()({},m,{lineLength:k,view:this.props.view,getPos:n,updateSize:this.updateSize,displayGrid:Object(Kn.a)(this.props.eventDispatcher),gridSize:12,viewMediaClientConfig:this.state.viewMediaClientConfig,allowBreakoutSnapPoints:i&&i.allowBreakoutSnapPoints,selected:t(),dispatchAnalyticsEvent:this.props.dispatchAnalyticsEvent}),v):l.a.createElement(bn.c,m,v)}}]),r}(c.Component);s()(Zn,"defaultProps",{mediaOptions:{}}),s()(Zn,"displayName","MediaSingleNode");var er=function(e){V()(n,e);var t=Yn(n);function n(){var e;v()(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return e=t.call.apply(t,[this].concat(i)),s()(F()(e),"lastOffsetLeft",0),s()(F()(e),"forceViewUpdate",!1),s()(F()(e),"selectionType",null),s()(F()(e),"checkAndUpdateSelectionType",(function(){var t=e.getPos,n=e.view.state.selection,r=Object(be.c)(n.$anchor.pos,n.$head.pos,t(),e.node.nodeSize);return e.selectionType=r,r})),s()(F()(e),"isNodeSelected",(function(){return e.checkAndUpdateSelectionType(),null!==e.selectionType})),e}return b()(n,[{key:"createDomRef",value:function(){var e=document.createElement("div");return Nn.a.chrome&&this.reactComponentProps.mediaOptions&&this.reactComponentProps.mediaOptions.allowMediaSingleEditable&&(e.contentEditable="true"),e}},{key:"getContentDOM",value:function(){return{dom:document.createElement("div")}}},{key:"viewShouldUpdate",value:function(e){return this.forceViewUpdate?(this.forceViewUpdate=!1,!0):this.node.attrs!==e.attrs||(this.selectionType!==this.checkAndUpdateSelectionType()||_n()(G()(n.prototype),"viewShouldUpdate",this).call(this,e))}},{key:"getNodeMediaId",value:function(e){if(e.firstChild)return e.firstChild.attrs.id}},{key:"update",value:function(e,t,r){var i=this;return r||(r=function(e,t){return i.getNodeMediaId(e)===i.getNodeMediaId(t)}),_n()(G()(n.prototype),"update",this).call(this,e,t,r)}},{key:"render",value:function(e,t){var n=this,r=this.reactComponentProps,i=r.eventDispatcher,a=r.fullWidthMode,o=r.providerFactory,s=r.mediaOptions,c=r.dispatchAnalyticsEvent,u=this.getPos;return l.a.createElement(ln.a,{providers:["mediaProvider","contextIdentifierProvider"],providerFactory:o,renderNode:function(e){var r=e.mediaProvider,o=e.contextIdentifierProvider;return l.a.createElement(sn.a,{editorView:n.view,plugins:{width:In.b,mediaPluginState:Y.a},render:function(e){var d=e.width,p=e.mediaPluginState;return l.a.createElement(Zn,{width:d.width,lineLength:d.lineLength,node:n.node,getPos:u,mediaProvider:r,contextIdentifierProvider:o,mediaOptions:s,view:n.view,fullWidthMode:a,selected:n.isNodeSelected,eventDispatcher:i,mediaPluginState:p,dispatchAnalyticsEvent:c,forwardRef:t})}})}})}},{key:"ignoreMutation",value:function(){if(this.dom){var e=this.dom.offsetLeft;e!==this.lastOffsetLeft&&(this.lastOffsetLeft=e,this.forceViewUpdate=!0,this.update(this.node,[],(function(){return!0})))}return!0}}]),n}(fn.a),tr=function(e,t,n,r){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};return function(a,o,s){return new er(a,o,s,e,t,{eventDispatcher:t,fullWidthMode:i.fullWidthEnabled,providerFactory:n,mediaOptions:i,dispatchAnalyticsEvent:r,isCopyPasteEnabled:i.isCopyPasteEnabled}).init()}},nr=n("RIqP"),rr=n.n(nr),ir=n("Fn6O"),ar=n.n(ir),or=n("f9tS"),sr=n("j964"),cr=n("lTRq"),lr=n.n(cr),ur=n("6FpG"),dr=n("E9jt"),pr=n("JRPe"),fr=Object(pr.e)({annotate:{id:"fabric.editor.annotate",defaultMessage:"Annotate",description:"Annotate an image by drawing arrows, adding text, or scribbles."}});function hr(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=G()(e);if(t){var i=G()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return q()(this,n)}}var mr,vr,gr=function(e,t){var n=Y.a.getState(e);if(!n)return!1;var r=e.schema.nodes.mediaSingle,i=n.selectedMediaContainerNode();if(!i||i.type!==r)return!1;var a,o=i.firstChild.attrs,s=o.id,c=o.collection,l=o.occurrenceKey;return Object(we.d)({action:ye.a.CLICKED,actionSubject:ye.b.MEDIA,actionSubjectId:ye.c.ANNOTATE_BUTTON,eventType:ye.d.UI})((a=e.selection.from+1,Ye({type:"open",identifier:{id:s,collectionName:c,mediaItemType:"file",occurrenceKey:l},pos:a})))(e,t)},br=function(e){V()(i,e);var t,n,r=hr(i);function i(){var e;v()(this,i);for(var t=arguments.length,n=new Array(t),a=0;a<t;a++)n[a]=arguments[a];return e=r.call.apply(r,[this].concat(n)),s()(F()(e),"state",{isImage:!1}),s()(F()(e),"onClickAnnotation",(function(){var t=e.props.view;t&&gr(t.state,t.dispatch)})),e}return b()(i,[{key:"componentDidMount",value:(n=h()(w.a.mark((function e(){return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.checkIsImage();case 2:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"checkIsImage",value:(t=h()(w.a.mark((function e(){var t,n;return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=Object(Bt.a)(this.props.viewMediaClientConfig),this.props.id){e.next=3;break}return e.abrupt("return");case 3:return e.prev=3,e.next=6,t.file.getCurrentState(this.props.id,{collectionName:this.props.collection});case 6:(n=e.sent)&&"error"!==n.status&&"image"===n.mediaType&&this.setState({isImage:!0}),e.next=12;break;case 10:e.prev=10,e.t0=e.catch(3);case 12:case"end":return e.stop()}}),e,this,[[3,10]])}))),function(){return t.apply(this,arguments)})},{key:"componentDidUpdate",value:function(e){var t=this;e.id!==this.props.id&&this.setState({isImage:!1},(function(){t.checkIsImage()}))}},{key:"render",value:function(){if(!this.state.isImage)return null;var e=this.props.intl.formatMessage(fr.annotate);return l.a.createElement(l.a.Fragment,null,l.a.createElement(dr.a,null),l.a.createElement(ur.a,{title:e,icon:l.a.createElement(lr.a,{label:e}),onClick:this.onClickAnnotation}))}}]),i}(l.a.Component),yr=function(e,t){return function(n,r){var i=e.selectedMediaContainerNode();return i&&e.mediaClientConfig?l.a.createElement(br,{key:r,viewMediaClientConfig:e.mediaClientConfig,id:i.firstChild.attrs.id,collection:i.firstChild.attrs.collection,view:n,intl:t}):null}},wr=n("oMky"),Or=n.n(wr),kr=n("VAOK"),xr=n.n(kr),jr=n("GwG2"),Pr=n("q86w"),Er=n("YVJ+"),Cr=n("WRQz");function Sr(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=G()(e);if(t){var i=G()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return q()(this,n)}}var _r=Object(pr.e)({backLink:{id:"fabric.editor.backLink",defaultMessage:"Go back",description:"Go back from media linking toolbar to main toolbar"}}),Mr=I.default.section(mr||(mr=N()(["\n  display: flex;\n  line-height: 0;\n  padding: 12px 24px 12px 0;\n  margin: 0 4px 0 32px;\n  border-top: 1px solid ",";\n  align-items: start;\n  display: flex;\n  flex-direction: column;\n"])),A.R400),Dr=I.default.span(vr||(vr=N()(["\n  padding: 4px 8px 4px 0px;\n"]))),Nr=function(e){V()(n,e);var t=Sr(n);function n(){var e;v()(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return e=t.call.apply(t,[this].concat(i)),s()(F()(e),"state",{validationErrors:[]}),s()(F()(e),"handleSubmit",(function(t){var n=t.url,r=t.inputMethod;e.props.onSubmit(n,{inputMethod:r})})),s()(F()(e),"handleOnBack",(function(t){var n=t.url,r=t.inputMethod,i=e.props.onBack;i&&i(n,{inputMethod:r})})),s()(F()(e),"handleCancel",(function(){var t=e.props.onCancel;t&&t()})),s()(F()(e),"handleUnlink",(function(){var t=e.props.onUnlink;t&&t()})),s()(F()(e),"handleOnBlur",(function(t){e.props.onBlur(t.url)})),s()(F()(e),"renderContainer",(function(t){var n,r=t.activityProvider,i=t.inputProps,a=i.onChange,o=i.onKeyDown,s=i.onSubmit,c=i.value,u=t.currentInputMethod,d=t.renderRecentList,p=e.props,f=p.intl.formatMessage,h=p.displayUrl,m=f(_r.backLink),v=f(or.b.unlink),g=e.state.validationErrors.map((function(e,t){return l.a.createElement(Cr.a,{key:t},e)}));return l.a.createElement("div",{className:"recent-list"},l.a.createElement(Pr.a,{provider:!!r},l.a.createElement(Pr.e,null,l.a.createElement(Dr,null,l.a.createElement(ur.a,{title:m,icon:l.a.createElement(Or.a,{label:m}),onClick:function(){return e.handleOnBack({url:c,inputMethod:u})}})),l.a.createElement(jr.a,{testId:"media-link-input",placeholder:(n=!!r,f(n?or.b.placeholder:or.b.linkPlaceholder)),autoFocus:!0,onCancel:e.handleCancel,defaultValue:c,onSubmit:function(t){var n=e.getValidationErrors(t,u);e.setState({validationErrors:n}),n.length||s()},onChange:function(t){e.setState({validationErrors:[]}),a(t)},onKeyDown:o}),Object(Ut.g)(h)&&l.a.createElement(l.a.Fragment,null,l.a.createElement(dr.a,null),l.a.createElement(ur.a,{title:v,icon:l.a.createElement(xr.a,{label:v}),onClick:e.handleUnlink}))),!!g.length&&l.a.createElement(Mr,null,g),d()))})),e}return b()(n,[{key:"getValidationErrors",value:function(e,t){var n=this.props.intl.formatMessage;return t===ye.e.TYPEAHEAD?[]:e?Object(Ut.g)(e)?[]:[n(or.b.invalidLink)]:[n(or.b.emptyLink)]}},{key:"render",value:function(){var e=this.props,t=e.providerFactory,n=e.displayUrl;return l.a.createElement(Er.a,{defaultUrl:Object(Ut.g)(n),providerFactory:t,onSubmit:this.handleSubmit,onBlur:this.handleOnBlur,render:this.renderContainer})}}]),n}(l.a.PureComponent);function Ir(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Tr(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ir(Object(n),!0).forEach((function(t){s()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ir(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Ar(e){var t=Lt(e);if(!t||null===t.mediaPos)return!1;var n=e.schema,r=n.nodes.media,i=n.marks.link,a=e.doc.nodeAt(t.mediaPos);if(!a||a.type!==r)return!1;var o=e.doc.resolve(t.mediaPos).parent;return o&&o.type.allowsMarkType(i)}var Rr,Lr,Ur,zr,Fr,Br,Vr=function(e,t,n,r,i){var a=t.link,o=t.visible,s=t.editable,c=t.mediaPos;if(o&&null!==c&&n.doc.nodeAt(c))return Tr(Tr({},e),{},{height:Pr.c,width:Pr.d,forcePlacement:!0,items:[{type:"custom",render:function(e,t){return e&&i?l.a.createElement(Nr,{key:t,displayUrl:a,providerFactory:i,intl:r,editing:s,onUnlink:function(){return Xt(e.state,e.dispatch,e)},onBack:function(t,n){t.trim()&&n.inputMethod&&Zt(t,n.inputMethod)(e.state,e.dispatch,e),Ht(e.state,e.dispatch,e)},onCancel:function(){return Ht(e.state,e.dispatch,e)},onSubmit:function(t,n){Zt(t,n.inputMethod)(e.state,e.dispatch,e),Ht(e.state,e.dispatch,e)},onBlur:function(){Ht(e.state,e.dispatch,e)}}):null}}]})},Wr=n("zQFu"),qr=Object(pr.e)({altText:{id:"fabric.editor.addAltText",defaultMessage:"Alt text",description:"Add an alt text for this image"},editAltText:{id:"fabric.editor.editAltText",defaultMessage:"Edit alt text",description:"Edit an alt text for this image"},back:{id:"fabric.editor.closeAltTextEdit",defaultMessage:"Back",description:"Back to toolbar"},clear:{id:"fabric.editor.clearAltTextEdit",defaultMessage:"Clear alt text",description:"Clear alt text"},placeholder:{id:"fabric.editor.placeholderAltText",defaultMessage:"Describe this image with alt text",description:"Describe this image with alt text"},supportText:{id:"fabric.editor.supportAltText",defaultMessage:"Alt text is useful for people using screen readers because of visual limitations.",description:"Alt text is useful for people using screen readers because of visual limitations."},validationMessage:{id:"fabric.editor.alttext.validation",defaultMessage:"Please remove any special characters in alt text.",description:"Please remove any special characters in alt text. "}}),Kr=n("SEpd"),Gr=n.n(Kr),Jr=n("DbPK"),Hr=n("qo7T");function Qr(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=G()(e);if(t){var i=G()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return q()(this,n)}}var $r=Pr.d,Xr=I.default.p(Rr||(Rr=N()(["\n  color: ",";\n  font-size: 12px;\n  padding: 12px 40px;\n  line-height: 20px;\n  border-top: 1px solid ",";\n  margin: 0;\n"])),A.N100,A.N30),Yr=I.default.div(Lr||(Lr=N()(["\n  width: ","px;\n  display: flex;\n  flex-direction: column;\n  overflow: auto;\n  line-height: 2;\n"])),$r),Zr=I.default.section(Ur||(Ur=N()(["\n  display: flex;\n  line-height: 0;\n  padding: 5px 0;\n  align-items: center;\n"]))),ei=I.default.section(zr||(zr=N()(["\n  display: flex;\n  line-height: 0;\n  padding: 12px 24px 12px 0;\n  margin: 0 12px 0 40px;\n  border-top: 1px solid ",";\n  align-items: start;\n  display: flex;\n  flex-direction: column;\n"])),A.R400),ti=I.default.div(Fr||(Fr=N()(["\n  display: flex;\n  padding: 4px 8px;\n"]))),ni=I.default.span(Br||(Br=N()(["\n  color: ",";\n"])),A.N80),ri=function(e){V()(n,e);var t=Qr(n);function n(e){var r;v()(this,n),r=t.call(this,e),s()(F()(r),"fireCustomAnalytics",void 0),s()(F()(r),"state",{showClearTextButton:Boolean(r.props.value),validationErrors:r.props.value?r.getValidationErrors(r.props.value):[],lastValue:r.props.value}),s()(F()(r),"prevValue",void 0),s()(F()(r),"closeMediaAltTextMenu",(function(){var e=r.props.view;kt(e.state,e.dispatch)})),s()(F()(r),"dispatchCancelEvent",(function(e){var t=r.props.view;t.someProp("handleKeyDown",(function(n){return n(t,e)}))})),s()(F()(r),"updateAltText",(function(e){var t=r.props.view;!function(e){return pt((function(e){return!!Object(ve.d)(e)&&{type:"updateAltText"}}),(function(t,n){var r=Object(ve.b)(n),i=t.selection.from+1;return r&&(t.setMeta("scrollIntoView",!1),t.setNodeMarkup(i,void 0,bt(bt({},r.attrs),{},{alt:e}))),t}))}(0===e.length?null:e)(t.state,t.dispatch)})),s()(F()(r),"handleOnChange",(function(e){var t=r.getValidationErrors(e);r.setState({showClearTextButton:Boolean(e),validationErrors:t,lastValue:e},(function(){t&&t.length||r.updateAltText(e)}))})),s()(F()(r),"handleOnBlur",(function(){var e=r.props.value,t=(r.state.lastValue||e||"").trim();r.handleOnChange(t)})),s()(F()(r),"handleClearText",(function(){r.handleOnChange("")}));var i=e.createAnalyticsEvent;return r.fireCustomAnalytics=Object(Hr.a)(i),r}return b()(n,[{key:"componentDidMount",value:function(){this.prevValue=this.props.value}},{key:"componentWillUnmount",value:function(){this.fireAnalytics(ye.a.CLOSED),!this.prevValue&&this.props.value&&this.fireAnalytics(ye.a.ADDED),this.prevValue&&!this.props.value&&this.fireAnalytics(ye.a.CLEARED),this.prevValue&&this.prevValue!==this.props.value&&this.fireAnalytics(ye.a.EDITED)}},{key:"getValidationErrors",value:function(e){var t=this.props.altTextValidator;return e&&"function"==typeof t&&t(e)||[]}},{key:"render",value:function(){var e=this.props.intl.formatMessage,t=this.state.showClearTextButton,n=e(qr.back),r=l.a.createElement(vt.ToolTipContent,{description:n,keymap:vt.escape,shortcutOverride:"Esc"}),i=(this.state.validationErrors||[]).map((function(e,t){return l.a.createElement(Cr.a,{key:t},e)}));return l.a.createElement(Yr,null,l.a.createElement(Zr,null,l.a.createElement(ti,null,l.a.createElement(ur.a,{title:e(qr.back),icon:l.a.createElement(Or.a,{label:e(qr.back)}),tooltipContent:r,onClick:this.closeMediaAltTextMenu})),l.a.createElement(jr.a,{testId:"alt-text-input",placeholder:e(qr.placeholder),defaultValue:this.state.lastValue,onCancel:this.dispatchCancelEvent,onChange:this.handleOnChange,onBlur:this.handleOnBlur,onSubmit:this.closeMediaAltTextMenu,maxLength:510,autoFocus:!0}),t&&l.a.createElement(ti,null,l.a.createElement(ur.a,{testId:"alt-text-clear-button",title:e(qr.clear),icon:l.a.createElement(ni,null,l.a.createElement(Gr.a,{label:e(qr.clear)})),tooltipContent:e(qr.clear),onClick:this.handleClearText}))),!!i.length&&l.a.createElement(ei,null,i),l.a.createElement(Xr,null,e(qr.supportText)))}},{key:"fireAnalytics",value:function(e){this.props.createAnalyticsEvent&&this.fireCustomAnalytics&&this.fireCustomAnalytics({payload:{action:e,actionSubject:ye.b.MEDIA,actionSubjectId:ye.c.ALT_TEXT,eventType:ye.d.TRACK}})}}]),n}(l.a.Component),ii=Object(Jr.a)()(Object(pr.f)(ri)),ai=n("8AF3");function oi(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function si(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?oi(Object(n),!0).forEach((function(t){s()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):oi(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var ci,li=function(e,t){var n=Object(ve.b)(t),r=n&&n.attrs.alt?qr.editAltText:qr.altText,i=e.formatMessage(r);return{title:i,type:"button",onClick:xt,showTitle:!0,testId:"alt-text-edit-button",tooltipContent:l.a.createElement(vt.ToolTipContent,{description:i,keymap:vt.addAltText})}},ui=function(e){return{type:"custom",render:function(t,n){if(!t)return null;var r=Object(ve.b)(t.state);return r?l.a.createElement(ii,{view:t,key:n,value:r.attrs.alt,altTextValidator:e&&e.altTextValidator}):null}}},di=function(e,t){return si(si({},e),{},{width:$r,className:ai.a.FLOATING_TOOLBAR_COMPONENT,items:[ui(t)]})},pi=n("J4zp"),fi=n.n(pi),hi=n("01nc"),mi=n.n(hi),vi=n("WhJf"),gi=n.n(vi),bi=n("K3FS"),yi=n("fR7n"),wi=I.default.div(ci||(ci=N()(["\n  display: flex;\n  align-items: center;\n  margin-right: 4px;\n"]))),Oi=function(e){var t=e.editorState,n=e.mediaLinkingState,r=e.intl,i=e.showSeparatorLeft,a=e.onAddLink,o=e.onEditLink,s=e.onOpenLink,u=Object(c.useState)(!1),d=fi()(u,2),p=d[0],f=d[1];if(Object(c.useEffect)((function(){var e;f(!1);var n=Ft(t);if(n){var r=null===(e=Y.a.getState(t))||void 0===e?void 0:e.mediaClientConfig;r&&Vt(n,r).then((function(e){"external"!==e&&"image"!==e||f(!0)}))}}),[t]),!p)return null;if(n&&n.editable){var h=Object(bi.a)(n.link),m=r.formatMessage(or.b.editLink),v=r.formatMessage(h?yi.a.openLink:or.b.unableToOpenLink);return l.a.createElement(l.a.Fragment,null,i&&l.a.createElement(wi,null,l.a.createElement(dr.a,null)),l.a.createElement(wi,null,l.a.createElement(ur.a,{onClick:o,title:m,tooltipContent:l.a.createElement(vt.ToolTipContent,{description:m,keymap:vt.addLink})},m)),l.a.createElement(wi,null,l.a.createElement(dr.a,null)),l.a.createElement(ur.a,{target:"_blank",href:h?n.link:void 0,disabled:!h,onClick:s,title:v,icon:l.a.createElement(gi.a,{label:v}),className:"hyperlink-open-link"}))}var g=r.formatMessage(or.b.addLink);return l.a.createElement(l.a.Fragment,null,i&&l.a.createElement(wi,null,l.a.createElement(dr.a,null)),l.a.createElement(ur.a,{testId:"add-link-button",onClick:a,title:g,tooltipContent:l.a.createElement(vt.ToolTipContent,{description:g,keymap:vt.addLink}),icon:l.a.createElement(mi.a,{label:g})}))};function ki(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function xi(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ki(Object(n),!0).forEach((function(t){s()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ki(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var ji=function(e,t){return t&&t(Object(_.removeSelectedNode)(e.tr)),!0},Pi=n("DCMf"),Ei=n("cFgX");function Ci(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=G()(e);if(t){var i=G()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return q()(this,n)}}var Si=function(e){V()(n,e);var t=Ci(n);function n(){var e;v()(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return e=t.call.apply(t,[this].concat(i)),s()(F()(e),"onUploadStart",(function(t,n){var r=e.props.view,i=r.state,a=r.dispatch;rt(t,n)(i,a)})),s()(F()(e),"onClose",(function(){var t=e.props.view,n=t.state,r=t.dispatch;nt()(n,r)})),e}return b()(n,[{key:"render",value:function(){var e=this.props.mediaEditorState,t=e.editor,n=e.mediaClientConfig;if(!t||!n)return null;var r=t.identifier;return l.a.createElement(Ei.a,{identifier:r,mediaClientConfig:n,onUploadStart:this.onUploadStart,onClose:this.onClose})}}]),n}(l.a.PureComponent);function _i(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=G()(e);if(t){var i=G()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return q()(this,n)}}s()(Si,"displayName","MediaEditor");var Mi={on:function(){},removeAllListeners:function(){},emit:function(){},destroy:function(){},setUploadParams:function(){}},Di=function(e){V()(n,e);var t=_i(n);function n(){var e;v()(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return e=t.call.apply(t,[this].concat(i)),s()(F()(e),"state",{}),s()(F()(e),"handleMediaProvider",function(){var t=h()(w.a.mark((function t(n,r){var i,a,o,s,c,l,u,d;return w.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i=e.props,a=i.mediaState,o=i.analyticsName,t.next=3,r;case 3:if((s=t.sent)&&s.uploadParams){t.next=6;break}return t.abrupt("return");case 6:return t.next=8,s.uploadMediaClientConfig;case 8:if(t.t0=t.sent,t.t0){t.next=13;break}return t.next=12,s.viewMediaClientConfig;case 12:t.t0=t.sent;case 13:if(c=t.t0){t.next=16;break}return t.abrupt("return");case 16:return l={mediaClientConfig:c,errorReporter:a.options.errorReporter||new E.a,featureFlags:a.mediaOptions&&a.mediaOptions.featureFlags},t.next=19,new Ue("customMediaPicker",l,Mi,Le.d,o).init();case 19:(u=t.sent).onNewMedia(a.insertFile),u.setUploadParams(s.uploadParams),d={uploadParams:s.uploadParams},e.setState({pickerFacadeInstance:u,config:d,mediaClientConfig:c});case 24:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}()),e}return b()(n,[{key:"componentDidMount",value:function(){this.props.mediaState.options.providerFactory.subscribe("mediaProvider",this.handleMediaProvider)}},{key:"componentWillUnmount",value:function(){this.props.mediaState.options.providerFactory.unsubscribe("mediaProvider",this.handleMediaProvider)}},{key:"render",value:function(){var e=this.state,t=e.mediaClientConfig,n=e.config,r=e.pickerFacadeInstance;return t&&n&&r?this.props.children({mediaClientConfig:t,config:n,pickerFacadeInstance:r}):null}}]),n}(l.a.Component),Ni=function(e){var t=e.mediaState,n=e.featureFlags;return l.a.createElement(Di,{mediaState:t,analyticsName:"clipboard"},(function(e){var t=e.mediaClientConfig,r=e.config,i=e.pickerFacadeInstance;return l.a.createElement(Le.b,{mediaClientConfig:t,config:r,onError:i.handleUploadError,onPreviewUpdate:i.handleUploadPreviewUpdate,onEnd:i.handleReady,featureFlags:n})}))};function Ii(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Ti(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ii(Object(n),!0).forEach((function(t){s()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ii(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Ai=function(e){var t=e.mediaState,n=e.isActive,r=e.featureFlags;return l.a.createElement(Di,{mediaState:t,analyticsName:"dropzone"},(function(e){var i=e.mediaClientConfig,a=e.config,o=e.pickerFacadeInstance,s=t.options.customDropzoneContainer,c=t.handleDrag,u=Ti(Ti({},a),{},{container:s});return n?l.a.createElement(Le.c,{mediaClientConfig:i,config:u,onError:o.handleUploadError,onPreviewUpdate:o.handleUploadPreviewUpdate,onEnd:o.handleReady,onDragEnter:function(){return c("enter")},onDragLeave:function(){return c("leave")},featureFlags:r}):null}))},Ri=function(e){var t=e.mediaState,n=e.isOpen,r=e.onBrowseFn,i=e.featureFlags;return l.a.createElement(Di,{mediaState:t,analyticsName:"browser"},(function(e){var t=e.mediaClientConfig,a=e.config,o=e.pickerFacadeInstance;return l.a.createElement(Le.a,{onBrowseFn:r,isOpen:n,config:a,mediaClientConfig:t,onEnd:o.handleReady,onError:o.handleUploadError,onPreviewUpdate:o.handleUploadPreviewUpdate,featureFlags:i})}))};function Li(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=G()(e);if(t){var i=G()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return q()(this,n)}}var Ui=function(e){V()(n,e);var t=Li(n);function n(){var e;v()(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return e=t.call.apply(t,[this].concat(i)),s()(F()(e),"state",{isPopupOpened:!1}),s()(F()(e),"onBrowseFn",(function(t){var n=e.props.mediaState;n&&n.setBrowseFn(t)})),e}return b()(n,[{key:"componentDidMount",value:function(){var e=this;this.props.mediaState.onPopupToggle((function(t){e.setState({isPopupOpened:t})}))}},{key:"render",value:function(){var e=this.props.mediaState,t=this.state.isPopupOpened,n=e.mediaOptions&&e.mediaOptions.featureFlags;return l.a.createElement(l.a.Fragment,null,l.a.createElement(Ni,{mediaState:e,featureFlags:n}),l.a.createElement(Ai,{mediaState:e,isActive:!t,featureFlags:n}),!e.shouldUseMediaPickerPopup()&&l.a.createElement(Ri,{onBrowseFn:this.onBrowseFn,mediaState:e,featureFlags:n}))}}]),n}(l.a.Component);s()(Ui,"displayName","MediaPickerComponents");var zi=n("jPV8");function Fi(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=G()(e);if(t){var i=G()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return q()(this,n)}}var Bi=function(e){V()(n,e);var t=Fi(n);function n(){var e;v()(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return e=t.call.apply(t,[this].concat(i)),s()(F()(e),"renderMediaNodeWithState",(function(t,n,r){return function(i){var a=i.width,o=e.getPos,s=e.reactComponentProps.mediaOptions,c=e.view.state.selection,u=e.getAttrs(),d=u.width,p=u.height;d=d||bn.b,p=p||bn.a;var f={width:"".concat(a.width,"px"),height:"".concat(p/d*a.width,"px")},h={width:d,height:p};return l.a.createElement(le,{view:e.view,node:e.node,getPos:o,selected:e.isNodeInsideSelection(c.from,c.to)||c instanceof x.NodeSelection&&c.from===o(),originalDimensions:h,maxDimensions:f,mediaProvider:t,contextIdentifierProvider:n,uploadComplete:e.uploadComplete(),mediaOptions:s,collabEditProvider:r})}})),s()(F()(e),"renderMediaNodeWithProviders",(function(t){var n=t.mediaProvider,r=t.contextIdentifierProvider,i=t.collabEditProvider;return l.a.createElement(sn.a,{editorView:e.view,plugins:{width:In.b},render:e.renderMediaNodeWithState(n,r,i)})})),e}return b()(n,[{key:"createDomRef",value:function(){var e=document.createElement("div");return Nn.a.chrome&&this.reactComponentProps.mediaOptions&&this.reactComponentProps.mediaOptions.allowMediaSingleEditable&&(e.contentEditable="true"),e}},{key:"viewShouldUpdate",value:function(e){return this.node.attrs!==e.attrs||_n()(G()(n.prototype),"viewShouldUpdate",this).call(this,e)}},{key:"stopEvent",value:function(e){if(-1!==["mousedown","contextmenu"].indexOf(e.type)&&2===e.button)return!0;return!1}},{key:"getAttrs",value:function(){return this.node.attrs}},{key:"uploadComplete",value:function(){return Ie(Y.a.getState(this.view.state),this.node.attrs.id)}},{key:"render",value:function(){var e=this.reactComponentProps.providerFactory;return l.a.createElement(ln.a,{providers:["mediaProvider","contextIdentifierProvider","collabEditProvider"],providerFactory:e,renderNode:this.renderMediaNodeWithProviders})}}]),n}(n("LVu0").a),Vi=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return function(i,a,o){return new Bi(i,a,o,e,t,{eventDispatcher:t,providerFactory:n,mediaOptions:r}).init()}},Wi={allowResizing:!0,allowAdvancedToolBarOptions:!0,allowResizingInTables:!1,allowAnnotation:!0,UNSAFE_allowImageCaptions:!0};function qi(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Ki(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?qi(Object(n),!0).forEach((function(t){s()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):qi(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Gi=function(e){return{name:"media",nodes:function(){var t=e||{},n=t.allowMediaGroup,r=void 0===n||n,i=t.allowMediaSingle,a=void 0!==i&&i,o=t.UNSAFE_allowImageCaptions,s=void 0!==o&&o?u.b:u.a;return[{name:"mediaGroup",node:d.a},{name:"mediaSingle",node:s},{name:"media",node:p.b}].filter((function(e){return"mediaGroup"===e.name?r:"mediaSingle"!==e.name||a}))},pmPlugins:function(){var t=[{name:"media",plugin:function(t){t.schema;var n=t.dispatch,r=t.eventDispatcher,i=t.providerFactory,a=t.errorReporter,o=t.portalProviderAPI,s=t.reactContext,c=t.dispatchAnalyticsEvent;return Ke(0,{providerFactory:i,nodeViews:{mediaGroup:Cn(o,r,i,e),mediaSingle:tr(o,r,i,c,e),media:Vi(o,r,i,e)},errorReporter:a,uploadErrorHandler:e&&e.uploadErrorHandler,waitForMediaUpload:e&&e.waitForMediaUpload,customDropzoneContainer:e&&e.customDropzoneContainer,customMediaPicker:e&&e.customMediaPicker,allowResizing:!(!e||!e.allowResizing)},s,n,e)}},{name:"mediaKeymap",plugin:function(){return nn()}}];return e&&e.allowMediaSingle&&t.push({name:"mediaSingleKeymap",plugin:function(e){return function(e){var t={},n=St(e);return vt.bindKeymapWithCommand(vt.backspace.common,n,t),Object(mt.b)(t)}(e.schema)}}),e&&e.allowAnnotation&&t.push({name:"mediaEditor",plugin:at}),e&&e.allowAltTextOnImages&&(t.push({name:"mediaAltText",plugin:ht}),t.push({name:"mediaAltTextKeymap",plugin:function(e){var t;e.schema;return t={},vt.bindKeymapWithCommand(vt.addAltText.common,xt,t),vt.bindKeymapWithCommand(vt.escape.common,kt,t),Object(mt.b)(t)}})),e&&e.allowLinking&&(t.push({name:"mediaLinking",plugin:function(e){return function(e){return new x.Plugin({key:It,state:At.createPluginState(e,Tt)})}(e.dispatch)}}),t.push({name:"mediaLinkingKeymap",plugin:function(e){var t;e.schema;return t={},vt.bindKeymapWithCommand(vt.addLink.common,Gt,t),Object(mt.b)(t)}})),t},contentComponent:function(t){var n=t.editorView,r=t.eventDispatcher,i=e&&e.allowAnnotation?l.a.createElement(sn.a,{editorView:n,plugins:{mediaEditorState:Qe},eventDispatcher:r,render:function(e){var t=e.mediaEditorState;return l.a.createElement(Si,{mediaEditorState:t,view:n})}}):null;return l.a.createElement(l.a.Fragment,null,l.a.createElement(sn.a,{editorView:n,plugins:{mediaState:Y.a},render:function(e){var t=e.mediaState;return l.a.createElement(Ui,{mediaState:t})}}),i)},secondaryToolbarComponent:function(e){var t=e.editorView,n=e.eventDispatcher,r=e.disabled;return l.a.createElement(cn,{editorView:t,eventDispatcher:n,pluginKey:Y.a,isDisabled:r,isReducedSpacing:!0})},pluginsOptions:{quickInsert:function(e){var t=e.formatMessage;return[{id:"media",title:t(zi.a.filesAndImages),description:t(zi.a.filesAndImagesDescription),priority:400,keywords:["attachment","gif","media","picture"],icon:function(){return l.a.createElement(Pi.j,{label:t(zi.a.filesAndImages)})},action:function(e,t){Y.a.getState(t).showMediaPicker();var n=e("");return Object(we.a)(t,n,{action:ye.a.OPENED,actionSubject:ye.b.PICKER,actionSubjectId:ye.c.PICKER_CLOUD,attributes:{inputMethod:ye.e.QUICK_INSERT},eventType:ye.d.UI})}}]},floatingToolbar:function(t,n,r){return function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=n.providerFactory,i=n.allowResizing,a=n.allowAnnotation,o=n.allowLinking,s=n.allowAdvancedToolBarOptions,c=n.allowResizingInTables,u=n.allowAltTextOnImages,d=n.altTextValidator,p=e.schema.nodes.mediaSingle,f=Y.a.getState(e),h=Lt(e);if(p&&f){var m={title:"Media floating controls",nodeType:p,getDomRef:function(){return f.element}};if(o&&h&&h.visible&&Ar(e)){var v=Vr(m,h,e,t,r);if(v)return v}var g=[];if(s){if((g=Object(Wr.a)(e,t,e.schema.nodes.mediaSingle,i,c)).length&&a&&g.push({type:"custom",render:yr(f,t)}),o&&Ar(e)){var b=g.length>0;g.push({type:"custom",render:function(e,n){if(null!=e&&e.state){var r=function(){if(e){var t=e.state,n=e.dispatch;Kt(t,n)}};return l.a.createElement(Oi,{key:n,editorState:e.state,intl:t,mediaLinkingState:h,onAddLink:r,onEditLink:r,onOpenLink:function(){if(e){var t=e.state;return(0,e.dispatch)(Object(we.a)(t,t.tr,{eventType:ye.d.TRACK,action:ye.a.VISITED,actionSubject:ye.b.MEDIA,actionSubjectId:ye.c.LINK})),!0}},showSeparatorLeft:b})}return null}})}g.length&&g.push({type:"separator"})}if(u){var y=ft(e);if(y.isAltTextEditorOpen)return di(m,{altTextValidator:d});g.push(li(t,e),{type:"separator"})}var w=[].concat(rr()(g),[{type:"button",appearance:"danger",icon:ar.a,onMouseEnter:Object(sr.b)(p,!0),onMouseLeave:Object(sr.b)(p,!1),title:t.formatMessage(or.a.remove),onClick:ji,testId:"media-toolbar-remove-button"}]);return xi(xi({},m),{},{items:w})}}(t,n,{providerFactory:r,allowResizing:e&&e.allowResizing,allowResizingInTables:e&&e.allowResizingInTables,allowAnnotation:e&&e.allowAnnotation,allowLinking:e&&e.allowLinking,allowAdvancedToolBarOptions:e&&e.allowAdvancedToolBarOptions,allowAltTextOnImages:e&&e.allowAltTextOnImages,altTextValidator:e&&e.altTextValidator})}}}};t.a=function(e){return Gi(Ki(Ki({},e),Wi))}},y0Hk:function(e,t,n){"use strict";n.d(t,"c",(function(){return i})),n.d(t,"a",(function(){return a})),n.d(t,"b",(function(){return o})),n.d(t,"d",(function(){return s}));var r=n("UxO+"),i=function(e){var t=e.schema.nodes.media;return e.selection instanceof r.NodeSelection&&e.selection.node.type===t},a=function(e){var t=e.schema.nodes.mediaSingle,n=e.selection.$to;if(t)for(var r=n.depth;r>=0;r--){var i=n.index(r);if(n.node(r).canReplaceWith(i,i,t))return!0}return!1},o=function(e,t){var n=t.nodes,r=n.media,i=n.mediaSingle;if(!r||!i)return null;var a=r.createChecked({type:"external",url:e});return i.createChecked({},a)},s=function(e,t){var n,i=e.clientX,a=e.clientY;return t.dispatch(t.state.tr.setSelection(r.TextSelection.create(t.state.doc,(null===(n=t.posAtCoords({left:i,top:a}))||void 0===n?void 0:n.pos)||0)))}},yWSb:function(e,t,n){e.exports={banner:"banner--MWCHK",grid:"grid--1HNmF",chip:"chip--3hU4-"}}});