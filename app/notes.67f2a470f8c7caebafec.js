!function(e){function t(t){for(var r,o,s=t[0],c=t[1],l=t[2],d=0,p=[];d<s.length;d++)o=s[d],Object.prototype.hasOwnProperty.call(a,o)&&a[o]&&p.push(a[o][0]),a[o]=0;for(r in c)Object.prototype.hasOwnProperty.call(c,r)&&(e[r]=c[r]);for(u&&u(t);p.length;)p.shift()();return i.push.apply(i,l||[]),n()}function n(){for(var e,t=0;t<i.length;t++){for(var n=i[t],r=!0,s=1;s<n.length;s++){var c=n[s];0!==a[c]&&(r=!1)}r&&(i.splice(t--,1),e=o(o.s=n[0]))}return e}var r={},a={4:0},i=[];function o(t){if(r[t])return r[t].exports;var n=r[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,o),n.l=!0,n.exports}o.e=function(e){var t=[],n=a[e];if(0!==n)if(n)t.push(n[2]);else{var r=new Promise((function(t,r){n=a[e]=[t,r]}));t.push(n[2]=r);var i,s=document.createElement("script");s.charset="utf-8",s.timeout=120,o.nc&&s.setAttribute("nonce",o.nc),s.src=function(e){return o.p+"vendors/"+({2:"@atlaskit-internal-editor-core-config-panel",3:"@atlaskit-internal_media-card"}[e]||e)+"."+{2:"bcd61036dc4dca7d337a",3:"848ba7058fc0419c657a"}[e]+".js"}(e);var c=new Error;i=function(t){s.onerror=s.onload=null,clearTimeout(l);var n=a[e];if(0!==n){if(n){var r=t&&("load"===t.type?"missing":t.type),i=t&&t.target&&t.target.src;c.message="Loading chunk "+e+" failed.\n("+r+": "+i+")",c.name="ChunkLoadError",c.type=r,c.request=i,n[1](c)}a[e]=void 0}};var l=setTimeout((function(){i({type:"timeout",target:s})}),12e4);s.onerror=s.onload=i,document.head.appendChild(s)}return Promise.all(t)},o.m=e,o.c=r,o.d=function(e,t,n){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)o.d(n,r,function(t){return e[t]}.bind(null,r));return n},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="",o.oe=function(e){throw console.error(e),e};var s=window.webpackJsonp=window.webpackJsonp||[],c=s.push.bind(s);s.push=t,s=s.slice();for(var l=0;l<s.length;l++)t(s[l]);var u=c;i.push([6,0,1]),n()}({0:function(e,t){},1:function(e,t){},2:function(e,t){},"2maa":function(e){e.exports=JSON.parse('{"Notes":{"Add":{"add_note":"Add a note"},"Delete":{"delete_note":"Delete","deleted":"The note has been moved to the trash of your Drive","failed":"The note could not be deleted, please try again"},"EditorView":{"main_placeholder":"Write anything…"},"Editor":{"title_placeholder":"Write your title","exit_confirmation_message":"Automatic saving has not taken into account the latest changes in your doc. Please stay on your current note if you want to keep them.","exit_confirmation_title":"Abandon your changes?","exit_confirmation_leave":"Leave without saving","exit_confirmation_cancel":"Cancel","read_only":"This note is in read-only mode."},"Files":{"share":{"cta":"Share"}},"List":{"latest_notes":"Latest Notes","name":"Name","updated_at":"Updated at","location":"Location","sharings":"Sharings","at":"%{date} at %{time}"},"Empty":{"welcome":"Welcome on Twake Notes","after_created":"Once your Note is created, you can find it in your "},"SavingIndicator":{"saved":{"default":"Up to date","just_now":"Up to date","secs_ago":"Up to date (saved %{time} sec. ago)","min_ago":"Up to date (saved %{time} min. ago)","mins_ago":"Up to date (saved %{time} min. ago)","hour_ago":"Up to date (saved %{time} hour ago)","hours_ago":"Up to date (saved %{time} hours ago)","day_ago":"Up to date (saved %{time} day ago)","days_ago":"Up to date (saved %{time} days ago)","month_ago":"Up to date (saved %{time} month ago)","monthes_ago":"Up to date (saved %{time} monthes ago)","year_ago":"Up to date (saved %{time} year ago)","years_ago":"Up to date (saved %{time} years ago)"},"saving":"Saving...","still_saving":"Saving......","out_of_sync":{"default":"Saved (off-line)","just_now":"Saved (off-line)","secs_ago":"Saved (off-line for %{time} sec)","min_ago":"Saved (off-line for %{time} min)","mins_ago":"Saved (off-line for %{time} min)","hour_ago":"Saved (off-line for %{time} hour)","hours_ago":"Saved (off-line for %{time} hours)","day_ago":"Saved (off-line for %{time} day)","days_ago":"Saved (off-line for %{time} days)","month_ago":"Saved (off-line for %{time} month)","monthes_ago":"Saved (off-line for %{time} monthes)","year_ago":"Saved (off-line for %{time} year)","years_ago":"Saved (off-line for %{time} years)"},"saving_impossible":{"default":"Changes unsaved (off-line)","just_now":"Changes unsaved (off-line)","secs_ago":"Changes unsaved (off-line for %{time} sec)","min_ago":"Changes unsaved (off-line for %{time} min)","mins_ago":"Changes unsaved (off-line for %{time} min)","hour_ago":"Changes unsaved (off-line for %{time} hour)","hours_ago":"Changes unsaved (off-line for %{time} hours)","day_ago":"Changes unsaved (off-line for %{time} day)","days_ago":"Changes unsaved (off-line for %{time} days)","month_ago":"Changes unsaved (off-line for %{time} month)","monthes_ago":"Changes unsaved (off-line for %{time} monthes)","year_ago":"Changes unsaved (off-line for %{time} year)","years_ago":"Changes unsaved (off-line for %{time} years)"}},"OfflineIndicator":{"message":"You\'re not connected to internet anymore. Your changes will be saved once you will be connected again."}},"Error":{"422":"Only images are accepted","unshared_title":"This share is no longer active","unshared_text":"The owner may have revoked this sharing. You can no longer edit a note at this address.","loading_error_title":"The note couldn\'t be loaded","loading_error_text_noReturnUrl":"The note may not exists anymore, or our servers may have a temporary glitch. Please try again later.","back":"back","unknown_error":"An unexpected error occured","only_one_image":"You cannot drag and drop multiple pictures at the same time"},"manifest":{"short_description":"Twake Notes is your personal and collaborative note-taking application.","long_description":"Notes is an online text editor that can already offer you to:\\n\\n* Create your own notes with the essential features (bold, underlined, links, tables...)\\n* Fill and find your notes with you other documents in files of your personal Drive\\n* Edit easily your notes from all your devices\\n* Access your notes offline\\n* For the fans, use shortcuts and input in markdown format ... and even write with contacts together on the same note (coming soon)!","screenshots":["screenshots/en/screenshot01.png","screenshots/en/screenshot02.png"]},"Intents":{"save":"Save"},"TrashedBanner":{"text":"The item has been trashed","redirect":"Open the trash","restore":"Restore","restoreSuccess":"The item has been restored","restoreError":"An error has occurred, please try again.","destroy":"Delete permanently"},"DestroyConfirm":{"title":"Permanently delete?","forbidden":"You won\'t be able to access this file anymore.","restore":"You won\'t be able to restore this file if you didn\'t make a backup.","cancel":"Cancel","delete":"Delete permanently","deleteError":"An error has occurred, please try again."},"MoreButton":{"more":"More"}}')},3:function(e,t){},"3xVv":function(e,t,n){"use strict";n.d(t,"d",(function(){return j})),n.d(t,"b",(function(){return x})),n.d(t,"c",(function(){return C})),n.d(t,"e",(function(){return M})),n.d(t,"a",(function(){return _}));var r=n("J58c"),a=n.n(r),i=n("iO45"),o=n("9Jaj"),s=n("laKe"),c=n("bHTr"),l=n("WISH"),u=n("3mYb"),d=n("PuAp"),p=n("CDNI"),f=n("I/PM"),h=n("AV8T"),m=n("3sCF"),v=n("Eh77"),g=n("OZn/"),b=n("ct2w"),y=n("3Su3");function O(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function w(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?O(Object(n),!0).forEach((function(t){a()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):O(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var k=function(e,t){return{action:h.a.INSERTED,actionSubject:h.b.DOCUMENT,actionSubjectId:h.c.MEDIA,attributes:{inputMethod:e,fileExtension:t,type:h.c.MEDIA_SINGLE},eventType:h.d.TRACK}};function E(e){return Object(y.a)(e)&&!Object(u.d)(e.selection,e.doc,d.g)}function P(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return function(n,r){var a=n.tr,o=n.schema.nodes.paragraph,s=t.inputMethod,c=t.fileExtension,l=0;return E(n)&&(e.push(o.create()),l=1),a.replaceSelection(new i.Slice(i.Fragment.from(e),0,l)),s&&Object(m.a)(n,a,k(s,c)),r&&r(a),!0}}var j=function(e,t){return!!e.nodes.mediaSingle&&Object(b.a)(t)},x=function(e,t,n){var r=e.state,a=e.dispatch,i=r.schema.nodes,o=i.mediaSingle,s=i.media;return!!o&&(!(t.type!==s||!Object(b.a)(t.attrs.__fileMimeType)&&"external"!==t.attrs.type)&&P([o.create({},t)],{inputMethod:n,fileExtension:t.attrs.__fileMimeType})(r,a))},C=function(e,t,n,r,a){if(void 0===r)return!1;var s,c=e.state,l=e.dispatch,u=c.selection.$from.node(-1),d=S(c.schema,r,a)(t),p=u&&u.type.validContent(i.Fragment.from(d));if(t.fileName){var f=t.fileName.lastIndexOf(".");s=f>=0?t.fileName.substring(f+1):void 0}if(p)P([d],{fileExtension:s,inputMethod:n})(c,l);else{var h=null;if(Object(g.b)(e.state).newInsertionBehaviour&&(h=Object(v.b)(d,c.selection.from)(c.tr)),!h){var b=E(e.state)?i.Fragment.fromArray([d,c.schema.nodes.paragraph.create()]):d;h=Object(o.safeInsert)(b,void 0,!0)(c.tr)}n&&(h=Object(m.a)(c,h,k(n,s))),l(h)}return!0},S=function(e,t,n){return function(r){var a=r.id,i=r.dimensions,o=r.contextId,s=r.scaleFactor,c=void 0===s?1:s,l=i||{height:void 0,width:void 0},u=l.width,d=l.height,f=e.nodes,h=f.media,m=f.mediaSingle,v=h.create({id:a,type:"file",collection:t,contextId:o,width:u&&Math.round(u/c),height:d&&Math.round(d/c)}),g=n?{layout:"align-start"}:{};return Object(p.a)(r,v),m.createChecked(g,v)}};function M(e,t){var n=t.nodes,r=n.mediaSingle,a=n.layoutSection,i=n.table,s=n.bulletList,c=n.orderedList,l=n.media,u=n.expand;return function(t){var n=e;return Object(o.hasParentNodeOfType)([a,i,s,c,u])(t)&&(n=Object(f.e)(n,(function(e){return"mediaSingle"===e.type.name?r.createChecked({},e.content,e.marks):e}))),n=Object(f.e)(n,(function(e){return"media"===e.type.name&&"external"===e.attrs.type?l.createChecked(w(w({},e.attrs),{},{__external:!0}),e.content,e.marks):e}))}}var _=function(e){var t=e.origWidth,n=e.origHeight,r=e.layout,a=e.pctWidth,i=e.containerWidth,o=e.resizedPctWidth,c=i.width,u=i.lineLength,d=D(i,a,t,n),p=D(i,o,t,n);if("wide"===r){if(u){var f=Math.ceil(u*l.Z);return f>c?u:f}}else{if("full-width"===r)return c-l.d;if(d)return s.e.indexOf(r)>-1?p?o<50?p:d:Math.max(d,t):p||d;if("center"===r)return p||Math.min(t,u||c);if(r&&-1!==s.e.indexOf(r)){var h=Math.ceil((u||c)/2);return t<=h?t:h}}return t},D=function(e,t,n,r){return t&&n&&r&&Math.ceil(Object(c.d)(t/100,e.lineLength||e.width))}},4:function(e,t){},"4vUV":function(e,t,n){"use strict";var r,a,i,o,s,c,l;n.d(t,"d",(function(){return r})),n.d(t,"c",(function(){return a})),n.d(t,"f",(function(){return i})),n.d(t,"e",(function(){return o})),n.d(t,"g",(function(){return s})),n.d(t,"a",(function(){return c})),n.d(t,"i",(function(){return l})),n.d(t,"h",(function(){return d})),n.d(t,"b",(function(){return u})),function(e){e.NoFileFoundAfterInput="No File was detected during the upload procedure.",e.FileNotProcessable="Could not process the uploaded image.",e.CouldNotFindFileInCurrentNote="Could not find file in current note.",e.MissingCollabEdit="`CollabEditProvider` was `undefined` in `fetchCozyImage`. <Media> was unable to fetch the image source. The component might be unmounted.",e.CouldNotGetNoteImages="MediaNode failed to fetch included files in the current note",e.CouldNotCopyImage="Could not copy image from another note"}(r||(r={})),function(e){e.Input="input"}(a||(a={})),function(e){e.File="file"}(i||(i={})),function(e){e.Click="click",e.Change="change",e.Drop="drop",e.Paste="paste"}(o||(o={})),function(e){e.Created="CREATED",e.Updated="UPDATED"}(s||(s={})),function(e){e.Files="io.cozy.files",e.NoteEvents="io.cozy.notes.events",e.Thumbnails="io.cozy.files.thumbnails"}(c||(c={})),function(e){e.Drive="drive",e.Home="home",e.Notes="notes"}(l||(l={}));var u,d="/preview/";!function(e){e.Files="Files",e.Notes="Notes"}(u||(u={}))},"5tuL":function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var r={FLOATING_TOOLBAR_COMPONENT:"".concat("pm-alt-text","-alt-text-floating-toolbar")}},"5z4W":function(e,t){e.exports={name:"Notes",name_prefix:"Twake",slug:"notes",icon:"icon.svg",categories:["cozy"],version:"1.43.0",licence:"AGPL-3.0",editor:"Cozy",source:"https://github.com/cozy/cozy-notes.git@build",developer:{name:"Twake Workplace",url:"https://twake.app"},screenshots:["screenshots/fr/screenshot01.png","screenshots/fr/screenshot02.png"],langs:["en","fr"],routes:{"/":{folder:"/",index:"index.html",public:!1},"/public":{folder:"/",index:"index.html",public:!0},"/preview":{folder:"/",index:"index.html",public:!0},"/intents":{folder:"/intents",index:"index.html",public:!1}},intents:[{action:"OPEN",type:["io.cozy.notes.documents"],href:"/intents"}],permissions:{apps:{description:"Required by the cozy-bar to display the icons of the apps",type:"io.cozy.apps",verbs:["GET"]},files:{description:"Notes as files",type:"io.cozy.files"},settings:{description:"Required by the cozy-bar to display Claudy and know which applications are coming soon",type:"io.cozy.settings",verbs:["GET"]},sharings:{description:"Required to have access to the sharings in realtime",type:"io.cozy.sharings",verbs:["GET"]},contacts:{type:"io.cozy.contacts",verbs:["GET","POST"]},groups:{type:"io.cozy.contacts.groups",verbs:["GET"]},intents:{type:"io.cozy.notes.documents",verbs:["GET"]}}}},6:function(e,t,n){n("jI5P"),e.exports=n("nXPL")},"6mlU":function(e,t,n){"use strict";n.d(t,"c",(function(){return a})),n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return l}));var r=n("iO45"),a=4,i=function(){return a},o=[["date",{inline:!0,group:"inline",selectable:!0,attrs:{timestamp:{default:""}},parseDOM:[{tag:'span[data-node-type="date"]'}]}],["status",{inline:!0,group:"inline",selectable:!0,attrs:{text:{default:""},color:{default:""},localId:{default:"dfab1003-a025-425f-869b-4592431ae618"},style:{default:""}},parseDOM:[{tag:'span[data-node-type="status"]'}]}],["doc",{content:"(block)+",marks:"alignment breakout indentation link unsupportedMark unsupportedNodeAttribute"}],["paragraph",{selectable:!1,content:"inline*",group:"block",marks:"strong code em link strike subsup textColor typeAheadQuery underline unsupportedMark unsupportedNodeAttribute",parseDOM:[{tag:"p"}]}],["text",{group:"inline"}],["bulletList",{group:"block",content:"listItem+",selectable:!1,parseDOM:[{tag:"ul"}],marks:"unsupportedMark unsupportedNodeAttribute"}],["orderedList",{group:"block",content:"listItem+",marks:"unsupportedMark unsupportedNodeAttribute",selectable:!1,parseDOM:[{tag:"ol"}]}],["listItem",{content:"(paragraph | mediaSingle | codeBlock) (paragraph | bulletList | orderedList | mediaSingle | codeBlock)*",marks:"link unsupportedMark unsupportedNodeAttribute",defining:!0,selectable:!1,parseDOM:[{tag:"li"}]}],["heading",{attrs:{level:{default:1}},content:"inline*",group:"block",defining:!0,selectable:!1,parseDOM:[{tag:"h1",attrs:{level:1}},{tag:"h2",attrs:{level:2}},{tag:"h3",attrs:{level:3}},{tag:"h4",attrs:{level:4}},{tag:"h5",attrs:{level:5}},{tag:"h6",attrs:{level:6}}]}],["blockquote",{content:"paragraph+",group:"block",defining:!0,selectable:!1,parseDOM:[{tag:"blockquote"}]}],["codeBlock",{attrs:{language:{default:null},uniqueId:{default:null}},content:"text*",marks:"unsupportedMark unsupportedNodeAttribute",group:"block",code:!0,defining:!0,parseDOM:[{tag:"pre",preserveWhitespace:"full"},{tag:"div[style]",preserveWhitespace:"full"},{tag:"table[style]",preserveWhitespace:"full"},{tag:"div.code-block",preserveWhitespace:"full"}]}],["rule",{group:"block",parseDOM:[{tag:"hr"}]}],["panel",{group:"block",content:"(paragraph | heading | bulletList | orderedList )+",marks:"unsupportedMark unsupportedNodeAttribute",attrs:{panelType:{default:"info"}},parseDOM:[{tag:"div[data-panel-type]"}]}],["confluenceUnsupportedBlock",{group:"block",attrs:{cxhtml:{default:null}},parseDOM:[{tag:'div[data-node-type="confluenceUnsupportedBlock"]'}]}],["confluenceUnsupportedInline",{group:"inline",inline:!0,atom:!0,attrs:{cxhtml:{default:null}},parseDOM:[{tag:'div[data-node-type="confluenceUnsupportedInline"]'}]}],["unsupportedBlock",{inline:!1,group:"block",atom:!0,selectable:!0,attrs:{originalValue:{default:{}}},parseDOM:[{tag:'[data-node-type="unsupportedBlock"]'}]}],["unsupportedInline",{inline:!0,group:"inline",selectable:!0,attrs:{originalValue:{default:{}}},parseDOM:[{tag:'[data-node-type="unsupportedInline"]'}]}],["hardBreak",{inline:!0,group:"inline",selectable:!1,parseDOM:[{tag:"br"}]}],["mediaSingle",{inline:!1,group:"block",selectable:!0,atom:!0,content:"media | media ( unsupportedBlock)",attrs:{width:{default:null},layout:{default:"center"}},marks:"unsupportedMark unsupportedNodeAttribute link",parseDOM:[{tag:'div[data-node-type="mediaSingle"]'}]}],["table",{content:"tableRow+",attrs:{isNumberColumnEnabled:{default:!1},layout:{default:"default"},__autoSize:{default:!1}},marks:"unsupportedMark unsupportedNodeAttribute",tableRole:"table",isolating:!0,selectable:!1,group:"block",parseDOM:[{tag:"table"}]}],["media",{selectable:!0,attrs:{id:{default:""},type:{default:"file"},collection:{default:""},occurrenceKey:{default:null},alt:{default:null},width:{default:null},height:{default:null},url:{default:null},__fileName:{default:null},__fileSize:{default:null},__fileMimeType:{default:null},__displayType:{default:null},__contextId:{default:null},__external:{default:!1}},parseDOM:[{tag:'div[data-node-type="media"]'},{tag:'img[src^="data:image"]',ignore:!0},{tag:"img:not(.smart-link-icon)"}]}],["tableHeader",{selectable:!1,content:"(paragraph | panel | blockquote | orderedList | bulletList | rule | heading | codeBlock | mediaSingle | decisionList | taskList )+",attrs:{colspan:{default:1},rowspan:{default:1},colwidth:{default:null},background:{default:null}},tableRole:"header_cell",isolating:!0,marks:"link alignment unsupportedMark unsupportedNodeAttribute",parseDOM:[{tag:"th"}]}],["decisionList",{group:"block",defining:!0,content:"decisionItem+",marks:"unsupportedMark unsupportedNodeAttribute",selectable:!1,attrs:{localId:{default:""}},parseDOM:[{tag:'ol[data-node-type="decisionList"]',priority:100}]}],["tableRow",{selectable:!1,content:"(tableCell | tableHeader)+",marks:"unsupportedMark unsupportedNodeAttribute",tableRole:"row",parseDOM:[{tag:"tr"}]}],["decisionItem",{content:"inline*",defining:!0,marks:"_",attrs:{localId:{default:""},state:{default:"DECIDED"}},parseDOM:[{tag:"li[data-decision-local-id]",priority:100}]}],["tableCell",{selectable:!1,content:"(paragraph | panel | blockquote | orderedList | bulletList | rule | heading | codeBlock | mediaSingle | decisionList | taskList | unsupportedBlock)+",attrs:{colspan:{default:1},rowspan:{default:1},colwidth:{default:null},background:{default:null}},tableRole:"cell",marks:"link alignment unsupportedMark unsupportedNodeAttribute",isolating:!0,parseDOM:[{tag:".ak-renderer-table-number-column",ignore:!0},{tag:"td"}]}],["taskList",{group:"block",defining:!0,selectable:!1,content:"taskItem+ (taskItem|taskList)*",marks:"unsupportedMark unsupportedNodeAttribute",attrs:{localId:{default:""}},parseDOM:[{tag:'div[data-node-type="actionList"]',priority:100}]}],["taskItem",{content:"inline*",defining:!0,selectable:!1,marks:"_",attrs:{localId:{default:""},state:{default:"TODO"}},parseDOM:[{tag:"div[data-task-local-id]",priority:100}]}]],s=[["link",{excludes:"link color",group:"link",attrs:{href:{},__confluenceMetadata:{default:null}},inclusive:!1,parseDOM:[{tag:"[data-block-link]"},{tag:"a[href]",context:"paragraph/|heading/|mediaSingle/|taskItem/|decisionItem/"},{tag:"a[href]"}]}],["em",{inclusive:!0,group:"fontStyle",parseDOM:[{tag:"i"},{tag:"em"},{style:"font-style=italic"}]}],["strong",{inclusive:!0,group:"fontStyle",parseDOM:[{tag:"strong"},{tag:"b"},{tag:"span"}]}],["textColor",{attrs:{color:{}},inclusive:!0,group:"color",parseDOM:[{style:"color"}]}],["strike",{inclusive:!0,group:"fontStyle",parseDOM:[{tag:"strike"},{tag:"s"},{tag:"del"},{style:"text-decoration"}]}],["subsup",{inclusive:!0,group:"fontStyle",attrs:{type:{default:"sub"}},parseDOM:[{tag:"sub",attrs:{type:"sub"}},{tag:"sup",attrs:{type:"sup"}},{tag:"span",style:"vertical-align=super"},{tag:"span",style:"vertical-align=sub"}]}],["underline",{inclusive:!0,group:"fontStyle",parseDOM:[{tag:"u"},{style:"text-decoration"}]}],["code",{excludes:"fontStyle link searchQuery color",inclusive:!0,parseDOM:[{tag:"span.code",preserveWhitespace:!0},{tag:"code",preserveWhitespace:!0},{tag:"tt",preserveWhitespace:!0},{tag:"span",preserveWhitespace:!0}]}],["typeAheadQuery",{inclusive:!0,group:"searchQuery",parseDOM:[{tag:"span[data-type-ahead-query]"}],attrs:{trigger:{default:""}}}],["alignment",{excludes:"alignment indentation",group:"alignment",attrs:{align:{}},parseDOM:[{tag:"div.fabric-editor-block-mark"}]}],["breakout",{spanning:!1,inclusive:!1,parseDOM:[{tag:"div.fabric-editor-breakout-mark"}],attrs:{mode:{default:"wide"}}}],["indentation",{excludes:"indentation alignment",group:"indentation",attrs:{level:{}},parseDOM:[{tag:"div.fabric-editor-indentation-mark"}]}],["unsupportedMark",{attrs:{originalValue:{}}}],["unsupportedNodeAttribute",{attrs:{type:{},unsupported:{}}}]];function c(e){return e.reduce((function(e,t){return e[t[0]]=t[1],e}),{})}var l={nodes:o,marks:s,version:a},u={nodes:c(o),marks:c(s)};new r.Schema(u)},7:function(e,t){},8:function(e,t){},"8BHA":function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var r=new(n("4z1N").PluginKey)("imageUploadPlugin")},"8Zd7":function(e,t,n){"use strict";var r=n("HZZ/"),a=n.n(r),i=n("GeFe"),o=n.n(i),s=n("Zvb3"),c=n.n(s),l=n("J58c"),u=n.n(l),d=n("hJxD"),p=n.n(d),f=[{type:"paragraph"}],h=n("6mlU");function m(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function v(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?m(Object(n),!0).forEach((function(t){u()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):m(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var g=function(){function e(t){var n=this;o()(this,e),u()(this,"postImage",function(){var e=a()(p.a.mark((function e(t,r,a,i){return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",n.stackClient.fetchJSON("POST",n.path(r,"images?Name=".concat(t)),a,{headers:{"Content-Type":i}}));case 1:case"end":return e.stop()}}),e)})));return function(t,n,r,a){return e.apply(this,arguments)}}());var r=t.userId,i=t.cozyClient,s=t.schema,c=t.realtime,l=new Date,d=l.getTime()+"."+l.getMilliseconds()+"."+Math.random();this.sessionId=r+":"+d,this.userId=this.getUserId(r),this.cozyClient=i,this.stackClient=i.getStackClient(),this.schema=s,this.schemaVersion=h.c,this.onRealtimeEvent=this.onRealtimeEvent.bind(this),this.realtime=c||i.plugins.realtime,this.resetCallbacks()}var t,n,r,i,s,l,d,m,g,b,y,O,w;return c()(e,[{key:"resetCallbacks",value:function(){this.callbacks={}}},{key:"setCallback",value:function(e,t,n){this.callbacks[e]=this.callbacks[e]||{},this.callbacks[e][t]=n}},{key:"getUserId",value:function(e){return e?e.match(/[^:]+/)[0]:this.userId}},{key:"getSessionId",value:function(){return this.sessionId}},{key:"close",value:function(){this.realtime.unsubscribeAll(),this.resetCallbacks()}},{key:"defaultTitle",value:function(){return(new Date).toISOString()}},{key:"path",value:function(e,t){return e?t?"/notes/".concat(e,"/").concat(t):"/notes/".concat(e):"/notes"}},{key:"client2server",value:function(e){return v({sessionID:e.sessionId||this.sessionId},e)}},{key:"server2client",value:function(e){return v({sessionId:e.sessionID,userId:this.getUserId(e.sessionID)},e)}},{key:"create",value:(w=a()(p.a.mark((function e(t,n,r){var a,i;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i={data:{type:"io.cozy.notes.documents",attributes:{title:t||this.defaultTitle(),schema:n||this.schema||h.b,content:r?(null===(a=r.content)||void 0===a?void 0:a.length)>0?r:v(v({},r),{},{content:f}):void 0}}},e.abrupt("return",this.stackClient.fetchJSON("POST",this.path(),i));case 2:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return w.apply(this,arguments)})},{key:"updateSchema",value:(O=a()(p.a.mark((function e(t,n){var r,a;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.stackClient.fetchJSON("PUT",this.path(t,"schema"),{data:{type:"io.cozy.notes.documents",attributes:{schema:v(v({},n),{},{version:h.c})}}});case 2:return r=e.sent,a=this.formatDoc(r.data),this.schemaVersion=a.schemaVersion,e.abrupt("return",a);case 6:case"end":return e.stop()}}),e,this)}))),function(e,t){return O.apply(this,arguments)})},{key:"sync",value:(y=a()(p.a.mark((function e(t){return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.stackClient.fetchJSON("POST",this.path(t,"sync"));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return y.apply(this,arguments)})},{key:"setTitle",value:(b=a()(p.a.mark((function e(t,n){var r;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r={data:{type:"io.cozy.notes.documents",id:t,attributes:this.client2server({title:n})}},e.next=3,this.stackClient.fetchJSON("PUT",this.path(t,"title"),r);case 3:case"end":return e.stop()}}),e,this)}))),function(e,t){return b.apply(this,arguments)})},{key:"onRealtimeEvent",value:function(e){var t=e.id||e._id,n=e.doctype||e.type;if("file"===n&&(n="io.cozy.files"),this.callbacks[n]&&this.callbacks[n][t])return this.callbacks[n][t](e);console.warn("Event not managed",n,t,this.callbacks)}},{key:"join",value:(g=a()(p.a.mark((function e(t){return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all([this.realtime.subscribe(null,"io.cozy.notes.events",t,this.onRealtimeEvent)]);case 2:this.realtime.subscribe("UPDATED","io.cozy.files",t,this.onRealtimeEvent);case 3:case"end":return e.stop()}}),e,this)}))),function(e){return g.apply(this,arguments)})},{key:"onStepsCreated",value:(m=a()(p.a.mark((function e(t,n){var r=this;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.setCallback("io.cozy.notes.steps",t,(function(e){return n(r.server2client(e))}));case 1:case"end":return e.stop()}}),e,this)}))),function(e,t){return m.apply(this,arguments)})},{key:"onTelepointerUpdated",value:(d=a()(p.a.mark((function e(t,n){var r=this;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.setCallback("io.cozy.notes.telepointers",t,(function(e){return n(r.server2client(e))}));case 1:case"end":return e.stop()}}),e,this)}))),function(e,t){return d.apply(this,arguments)})},{key:"onSchemaUpdated",value:(l=a()(p.a.mark((function e(t,n){var r=this;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.setCallback("io.cozy.files",t,(function(e){if(e.metadata.schema.version!==r.schemaVersion)return n(e)}));case 1:case"end":return e.stop()}}),e,this)}))),function(e,t){return l.apply(this,arguments)})},{key:"onTitleUpdated",value:(s=a()(p.a.mark((function e(t,n){var r=this;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.setCallback("io.cozy.notes.documents",t,(function(e){return e.sessionID&&e.sessionID==r.sessionId?null:n(e.title)}));case 1:case"end":return e.stop()}}),e,this)}))),function(e,t){return s.apply(this,arguments)})},{key:"getDoc",value:(i=a()(p.a.mark((function e(t){var n,r;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.stackClient.fetchJSON("GET",this.path(t));case 2:return n=e.sent,r=this.formatDoc(n.data),this.schemaVersion=r.schemaVersion,e.abrupt("return",r);case 6:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"getFormatedDoc",value:function(e){var t=this.formatDoc(e);return this.schemaVersion=t.schemaVersion,t}},{key:"formatDoc",value:function(e){return{doc:e.attributes.metadata.content,version:e.attributes.metadata.version,title:e.attributes.metadata.title,updatedAt:new Date(e.attributes.updated_at),file:e,schemaVersion:e.attributes.metadata.schema.version}}},{key:"pushSteps",value:(r=a()(p.a.mark((function e(t,n,r){var a,i,o=this;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a={headers:{"if-match":n}},i={data:r.map((function(e){return{type:"io.cozy.notes.steps",attributes:o.client2server(e.toJSON())}}))},e.next=4,this.stackClient.fetchJSON("PATCH",this.path(t),i,a);case 4:return e.abrupt("return",null);case 5:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return r.apply(this,arguments)})},{key:"getSteps",value:(n=a()(p.a.mark((function e(t,n){var r,a,i,o,s,c,l,u,d,f,h=this;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.stackClient.fetchJSON("GET","".concat(this.path(t,"steps"),"?Version=").concat(n));case 3:if(0!=(r=e.sent).data.length){e.next=8;break}return e.abrupt("return",{steps:[],version:n});case 8:return a=r.data.map((function(e){return h.server2client(e.attributes)})),i=r.data[r.data.length-1].attributes.version,e.abrupt("return",{version:i,steps:a});case 11:e.next=28;break;case 13:if(e.prev=13,e.t0=e.catch(0),o=e.t0.response,s=e.t0.reason&&e.t0.reason.data,c=s&&s.attributes&&s.attributes.metadata,l=c&&c.content,u=c&&c.version,412!=o.status||!l||!u){e.next=27;break}return f={_id:t,_type:"io.cozy.notes.events",doctype:d="io.cozy.notes.documents",title:c.title},this.callbacks[d]&&this.callbacks[d][t]&&this.callbacks[d][t](f),e.abrupt("return",{doc:l,version:u});case 27:throw e.t0;case 28:case"end":return e.stop()}}),e,this,[[0,13]])}))),function(e,t){return n.apply(this,arguments)})},{key:"pushTelepointer",value:(t=a()(p.a.mark((function e(t,n){var r;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r={data:{type:"io.cozy.notes.telepointers",id:t,attributes:this.client2server(n)}},e.abrupt("return",this.stackClient.fetchJSON("PUT",this.path(t,"telepointer"),r));case 2:case"end":return e.stop()}}),e,this)}))),function(e,n){return t.apply(this,arguments)})}]),e}(),b=n("ivGQ");t.a=function(e){var t=e.userId,n=e.userName,r=e.cozyClient;return Object(b.useMemo)((function(){return new g({userId:t,userName:n,cozyClient:r})}),[r,t,n])}},AdhS:function(e,t,n){},AvBw:function(e,t,n){"use strict";n.d(t,"a",(function(){return s})),n.d(t,"b",(function(){return c}));var r=n("9Jaj"),a=n("JdMa"),i=n("8BHA"),o=function(e){return function(t){return function(e,t){return e.setMeta(i.a,t)}(t,{name:"START_UPLOAD",event:e})}},s=function(e){return function(t,n){if(!i.a.getState(t).enabled||!e.src)return!1;var o=Object(a.b)(e.src,t.schema);return!!o&&(n&&n(Object(r.safeInsert)(o,t.selection.$to.pos)(t.tr).scrollIntoView()),!0)}},c=function(e){return function(t,n){return!!i.a.getState(t).enabled&&(n&&n(o(e)(t.tr)),!0)}}},CDNI:function(e,t,n){"use strict";n.d(t,"f",(function(){return f})),n.d(t,"e",(function(){return h})),n.d(t,"d",(function(){return m})),n.d(t,"h",(function(){return v})),n.d(t,"c",(function(){return k})),n.d(t,"g",(function(){return P})),n.d(t,"i",(function(){return j})),n.d(t,"j",(function(){return x})),n.d(t,"a",(function(){return S})),n.d(t,"k",(function(){return M})),n.d(t,"l",(function(){return N})),n.d(t,"b",(function(){return I}));var r=n("XZ5u"),a=(n("iO45"),n("4z1N")),i=n("9Jaj"),o=n("eXjd"),s=n("3mYb"),c=n("I/PM"),l=n("odni"),u=n("ct2w"),d=n("3Su3"),p=n("a+IN"),f=(n("KgC3"),function(e){return P(e)||O(e)||v(e)||g(e)}),h=function(e){var t=e.selection.node;return t&&t.type!==e.schema.nodes.media&&t.isBlock},m=function(e){var t=e.selection.node;return t&&t.type===e.schema.nodes.mediaSingle},v=function(e){if(Object(d.a)(e))return w(e,e.selection.$from)},g=function(e){if(e.selection instanceof p.a){var t=e.selection.$from,n=e.schema.nodes.mediaGroup;return b(t,n)||y(t,n)}},b=function(e,t){if(e.nodeBefore&&e.nodeBefore.type===t)return e.pos-e.nodeBefore.nodeSize+1},y=function(e,t){if(e.nodeAfter&&e.nodeAfter.type===t)return e.pos+1},O=function(e){if(Object(d.c)(e))return E(e,e.selection.$to)},w=function(e,t){var n,r;if(h(e)?(n=t.pos,r=t.nodeBefore):(n=Object(d.f)(t)-1,r=e.doc.resolve(n).nodeBefore),r&&r.type===e.schema.nodes.mediaGroup)return n-r.nodeSize+1},k=function(e){return e.selection.$from.parent.type===e.schema.nodes.paragraph&&Object(d.a)(e)&&Object(d.c)(e)},E=function(e,t){var n,r,a=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(h(e)?(n=t.pos,r=t.nodeAfter):(n=Object(d.e)(t),r=e.doc.nodeAt(n)),r&&r.type===e.schema.nodes.mediaGroup)return a?n+1:n+r.nodeSize-1},P=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=e.selection.$from;if((t=t||r).parent.type===e.schema.nodes.mediaGroup)return n?Object(d.f)(t):Object(d.e)(t)-1};var j=function(e,t,n){var r=t.attrs.id,o=e.state,c=o.tr,l=o.selection,u=o.doc,p=n();c.deleteRange(p,p+t.nodeSize),Object(s.r)(r)&&c.setMeta("addToHistory",!1);var f=u.resolve(p),h=f.nodeBefore,m=f.parent,v=f.index()===m.childCount-1;if(l.from===p&&!v&&!Object(d.b)(o)&&h&&"media"===h.type.name){var g=Object(i.findPositionOfNodeBefore)(c.selection);g&&c.setSelection(a.NodeSelection.create(c.doc,g))}e.dispatch(c)},x=function(e){var t=e.state.selection;return t instanceof a.NodeSelection&&t.node.type===e.state.schema.nodes.media&&(Object(r.e)(e.state,e.dispatch),t.$to.nodeAfter?(Object(r.g)(e.state,e.dispatch),Object(o.e)(!1)(e.state,e.dispatch)):Object(o.c)(e.state,e.dispatch),!0)},C=function(e){return e.length>1&&"_"===e[0]&&"_"===e[1]},S=function(e,t){Object.keys(t.attrs).filter(C).forEach((function(n){var r=n.substring(2),a=e[r];void 0!==a&&(t.attrs[n]=a)}))},M=function(e,t){var n=t.nodes,r=n.mediaGroup,a=n.mediaSingle,i=n.media;return Object(c.e)(e,(function(e,t){return t||e.type!==i?e:a&&(Object(u.a)(e.attrs.__fileMimeType)||"external"===e.attrs.type)?a.createChecked({},e):r.createChecked({},[e])}))},_=function(e){return"0"===e.style.opacity||"none"===e.style.display||"hidden"===e.style.visibility},D=["DIV","TD"];var N=function(e){var t=(new DOMParser).parseFromString(e,"text/html").body,n=t.querySelector('b[id^="docs-internal-guid-"]');n&&Object(l.g)(t,n);var r=t.querySelectorAll("img");return r.length?(r.forEach((function(e){var n=e.parentElement;if(n)if(_(n)||_(e))n.removeChild(e);else if(!(n instanceof HTMLDivElement)){var r=Object(l.h)(n,(function(e){return e.parentElement===t||function(e){return!!e&&-1!==D.indexOf(e.tagName)}(e.parentElement)}));r&&r.parentElement&&(r.parentElement.insertBefore(e,r.nextElementSibling||r),n.innerText=n.innerText.trim(),Object(l.f)(n))}})),t.lastElementChild&&"BR"===t.lastElementChild.tagName&&t.removeChild(t.lastElementChild),t.innerHTML):e},I=function(e){if(!m(e))return null;var t=e.tr,n=t.selection.from+1,r=t.doc.nodeAt(n);return r&&r.type===e.schema.nodes.media?r:null}},G09D:function(e,t,n){"use strict";n.d(t,"a",(function(){return k}));var r=n("GeFe"),a=n.n(r),i=n("Zvb3"),o=n.n(i),s=n("J/YY"),c=n.n(s),l=n("a1Fv"),u=n.n(l),d=n("g3eI"),p=n.n(d),f=n("wDGE"),h=n.n(f),m=n("J58c"),v=n.n(m),g=n("ivGQ"),b=n.n(g),y=n("Y/FK"),O=n.n(y);function w(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=h()(e);if(t){var a=h()(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return p()(this,n)}}function k(e){return function(t){u()(r,t);var n=w(r);function r(){var e;a()(this,r);for(var t=arguments.length,i=new Array(t),o=0;o<t;o++)i[o]=arguments[o];return e=n.call.apply(n,[this].concat(i)),v()(c()(e),"handleClick",(function(t){var n=O.a.findDOMNode(c()(e));(!n||t.target instanceof Node&&!n.contains(t.target))&&e.props.handleClickOutside&&e.props.handleClickOutside(t)})),v()(c()(e),"handleKeydown",(function(t){"Escape"===t.code&&e.props.handleEscapeKeydown?e.props.handleEscapeKeydown(t):"Enter"===t.code&&e.props.handleEnterKeydown&&e.props.handleEnterKeydown(t)})),e}return o()(r,[{key:"componentDidMount",value:function(){this.props.handleClickOutside&&document.addEventListener("click",this.handleClick,!1),this.props.handleEscapeKeydown&&document.addEventListener("keydown",this.handleKeydown,!1)}},{key:"componentWillUnmount",value:function(){this.props.handleClickOutside&&document.removeEventListener("click",this.handleClick,!1),this.props.handleEscapeKeydown&&document.removeEventListener("keydown",this.handleKeydown,!1)}},{key:"render",value:function(){return b.a.createElement(e,this.props)}}]),r}(g.PureComponent)}},Gfcl:function(e,t,n){"use strict";var r=n("HZZ/"),a=n.n(r),i=n("J58c"),o=n.n(i),s=n("hJxD"),c=n.n(s),l=n("4z1N"),u=n("fiXu"),d=n("X5HD"),p=n("JdMa"),f=n("AvBw"),h=n("8BHA"),m=n("4vUV");function v(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function g(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?v(Object(n),!0).forEach((function(t){o()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):v(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var b=function(e,t){return function(t,n){return!!e(n)&&(n.preventDefault(),n.stopPropagation(),n.type===m.e.Drop&&Object(p.d)(n,t),Object(f.b)(n)(t.state,t.dispatch),!0)}},y=function(e){var t,n=e.dispatch,r=e.providerFactory;return new l.Plugin({state:{init:function(e,t){return{active:!1,enabled:Object(p.a)(t),hidden:!t.schema.nodes.media||!t.schema.nodes.mediaSingle}},apply:function(e,t,r,a){var i=Object(p.c)(a),o=Object(p.a)(a),s=function(e,t){var n=e.getMeta(h.a);return n&&"START_UPLOAD"===n.name?{event:n.event}:t.activeUpload}(e,t);if(i!==t.active||o!==t.enabled||s!==t.activeUpload){var c=g(g({},t),{},{active:i,enabled:o,activeUpload:s});return n(h.a,c),c}return t}},key:h.a,view:function(){var e=function(){var e=a()(c.a.mark((function e(n,r){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("imageUploadProvider"===n&&r){e.next=2;break}return e.abrupt("return");case 2:return e.prev=2,e.next=5,r;case 5:t=e.sent,e.next=11;break;case 8:e.prev=8,e.t0=e.catch(2),t=void 0;case 11:case"end":return e.stop()}}),e,null,[[2,8]])})));return function(t,n){return e.apply(this,arguments)}}();return r.subscribe("imageUploadProvider",e),{update:function(e,n){var r=e.state,a=h.a.getState(r),i=h.a.getState(n);a.activeUpload!==i.activeUpload&&a.activeUpload&&t&&t(a.activeUpload.event,(function(t){return Object(f.a)(t)(e.state,e.dispatch)}))},destroy:function(){r.unsubscribe("imageUploadProvider",e)}}},props:{handleDOMEvents:{drop:b(d.a),paste:b(u.b)}}})},O=n("cwpE");var w=function(e){if(e.nodes.media&&e.nodes.mediaSingle){var t=Object(O.a)(/!\[(.*)\]\((\S+)\)$/,(function(e,t,n,r){var a=e.schema,i={src:t[2],alt:t[1]},o=Object(p.b)(i.src,a);return o?e.tr.replaceWith(n,r,o):null}));return Object(O.c)("image-upload",{rules:[t]})}};window.document.addEventListener("dragover",(function(e){return e.preventDefault(),!(null==e?void 0:e.target).closest(".ProseMirror")&&null!==e.dataTransfer&&(e.dataTransfer.dropEffect="none")}));t.a=function(){return{name:"imageUpload",pmPlugins:function(){return[{name:"imageUpload",plugin:y},{name:"imageUploadInputRule",plugin:function(e){var t=e.schema;return w(t)}}]}}}},GwML:function(e){e.exports=JSON.parse('{"Notes":{"Add":{"add_note":"Thêm ghi chú"},"Delete":{"delete_note":"Xóa","deleted":"Ghi chú đã được chuyển vào thùng rác trong Drive của bạn","failed":"Không thể xóa ghi chú, vui lòng thử lại"},"EditorView":{"main_placeholder":"Viết bất cứ điều gì…"},"Editor":{"title_placeholder":"Viết tiêu đề của bạn","exit_confirmation_message":"Tính năng lưu tự động chưa lưu những thay đổi mới nhất trong tài liệu của bạn. Vui lòng ở lại ghi chú hiện tại nếu bạn muốn giữ lại chúng.","exit_confirmation_title":"Bỏ qua các thay đổi của bạn?","exit_confirmation_leave":"Rời đi mà không lưu","exit_confirmation_cancel":"Hủy","read_only":"Ghi chú này đang ở chế độ chỉ đọc."},"Files":{"share":{"cta":"Chia sẻ"}},"List":{"latest_notes":"Ghi chú mới nhất","name":"Tên","updated_at":"Cập nhật lúc","location":"Vị trí","sharings":"Chia sẻ","at":"%{date} lúc %{time}"},"Empty":{"welcome":"Chào mừng đến với Twake Notes","after_created":"Sau khi ghi chú được tạo, bạn có thể tìm thấy nó trong "},"SavingIndicator":{"saved":{"default":"Đã cập nhật","just_now":"Đã cập nhật","secs_ago":"Đã cập nhật (đã lưu %{time} giây trước)","min_ago":"Đã cập nhật (đã lưu %{time} phút trước)","mins_ago":"Đã cập nhật (đã lưu %{time} phút trước)","hour_ago":"Đã cập nhật (đã lưu %{time} giờ trước)","hours_ago":"Đã cập nhật (đã lưu %{time} giờ trước)","day_ago":"Đã cập nhật (đã lưu %{time} ngày trước)","days_ago":"Đã cập nhật (đã lưu %{time} ngày trước)","month_ago":"Đã cập nhật (đã lưu %{time} tháng trước)","monthes_ago":"Đã cập nhật (đã lưu %{time} tháng trước)","year_ago":"Đã cập nhật (đã lưu %{time} năm trước)","years_ago":"Đã cập nhật (đã lưu %{time} năm trước)"},"saving":"Đang lưu...","still_saving":"Đang lưu......","out_of_sync":{"default":"Đã lưu (ngoại tuyến)","just_now":"Đã lưu (ngoại tuyến)","secs_ago":"Đã lưu (ngoại tuyến %{time} giây)","min_ago":"Đã lưu (ngoại tuyến %{time} phút)","mins_ago":"Đã lưu (ngoại tuyến %{time} phút)","hour_ago":"Đã lưu (ngoại tuyến %{time} giờ)","hours_ago":"Đã lưu (ngoại tuyến %{time} giờ)","day_ago":"Đã lưu (ngoại tuyến %{time} ngày)","days_ago":"Đã lưu (ngoại tuyến %{time} ngày)","month_ago":"Đã lưu (ngoại tuyến %{time} tháng)","monthes_ago":"Đã lưu (ngoại tuyến %{time} tháng)","year_ago":"Đã lưu (ngoại tuyến %{time} năm)","years_ago":"Đã lưu (ngoại tuyến %{time} năm)"},"saving_impossible":{"default":"Thay đổi chưa được lưu (ngoại tuyến)","just_now":"Thay đổi chưa được lưu (ngoại tuyến)","secs_ago":"Thay đổi chưa được lưu (ngoại tuyến %{time} giây)","min_ago":"Thay đổi chưa được lưu (ngoại tuyến %{time} phút)","mins_ago":"Thay đổi chưa được lưu (ngoại tuyến %{time} phút)","hour_ago":"Thay đổi chưa được lưu (ngoại tuyến %{time} giờ)","hours_ago":"Thay đổi chưa được lưu (ngoại tuyến %{time} giờ)","day_ago":"Thay đổi chưa được lưu (ngoại tuyến %{time} ngày)","days_ago":"Thay đổi chưa được lưu (ngoại tuyến %{time} ngày)","month_ago":"Thay đổi chưa được lưu (ngoại tuyến %{time} tháng)","monthes_ago":"Thay đổi chưa được lưu (ngoại tuyến %{time} tháng)","year_ago":"Thay đổi chưa được lưu (ngoại tuyến %{time} năm)","years_ago":"Thay đổi chưa được lưu (ngoại tuyến %{time} năm)"}},"OfflineIndicator":{"message":"Bạn không còn kết nối internet. Các thay đổi của bạn sẽ được lưu khi bạn kết nối trở lại."}},"Error":{"422":"Chỉ chấp nhận hình ảnh","unshared_title":"Chia sẻ này không còn hoạt động","unshared_text":"Chủ sở hữu có thể đã thu hồi chia sẻ này. Bạn không thể chỉnh sửa ghi chú tại địa chỉ này nữa.","loading_error_title":"Không thể tải ghi chú","loading_error_text_noReturnUrl":"Ghi chú có thể không còn tồn tại, hoặc máy chủ của chúng tôi có thể gặp sự cố tạm thời. Vui lòng thử lại sau.","back":"quay lại","unknown_error":"Đã xảy ra lỗi không mong đợi","only_one_image":"Bạn không thể kéo và thả nhiều hình ảnh cùng một lúc"},"manifest":{"short_description":"Twake Notes là ứng dụng ghi chú cá nhân và cộng tác của bạn.","long_description":"Notes là trình soạn thảo văn bản trực tuyến có thể cung cấp cho bạn:\\n\\n* Tạo ghi chú của riêng bạn với các tính năng thiết yếu (in đậm, gạch chân, liên kết, bảng...)\\n* Điền và tìm ghi chú của bạn với các tài liệu khác trong các tệp của Drive cá nhân\\n* Chỉnh sửa ghi chú dễ dàng từ tất cả các thiết bị của bạn\\n* Truy cập ghi chú khi ngoại tuyến\\n* Dành cho người hâm mộ, sử dụng phím tắt và nhập theo định dạng markdown ... và thậm chí viết cùng với người khác trên cùng một ghi chú (sắp ra mắt)!","screenshots":["screenshots/en/screenshot01.png","screenshots/en/screenshot02.png"]},"Intents":{"save":"Lưu"},"TrashedBanner":{"text":"Mục này đã được chuyển vào thùng rác","redirect":"Mở thùng rác","restore":"Khôi phục","restoreSuccess":"Mục đã được khôi phục","restoreError":"Đã xảy ra lỗi, vui lòng thử lại.","destroy":"Xóa vĩnh viễn"},"DestroyConfirm":{"title":"Xóa vĩnh viễn?","forbidden":"Bạn sẽ không thể truy cập tệp này nữa.","restore":"Bạn sẽ không thể khôi phục tệp này nếu bạn chưa tạo bản sao lưu.","cancel":"Hủy","delete":"Xóa vĩnh viễn","deleteError":"Đã xảy ra lỗi, vui lòng thử lại."},"MoreButton":{"more":"Thêm"}}')},Hsuv:function(e){e.exports=JSON.parse('{"Notes":{"Add":{"add_note":"Ajouter une note"},"Delete":{"delete_note":"Supprimer","deleted":"La note a été placée dans la corbeille de votre Drive","failed":"La note n\'a pas pu être supprimée, merci de re-essayer plus tard"},"EditorView":{"main_placeholder":"Écrivez ce que vous souhaitez…"},"Editor":{"title_placeholder":"Écrivez votre titre","exit_confirmation_message":"La sauvegarde automatique n\'a pas encore pris en compte vos dernières modifications. Merci de retourner sur votre note pour ne pas les perdre.","exit_confirmation_title":"Abandonner les modifications ?","exit_confirmation_leave":"Quitter sans sauvegarder","exit_confirmation_cancel":"Retour","read_only":"Cette note est en mode lecture-seule."},"Files":{"share":{"cta":"Partager"}},"List":{"latest_notes":"Notes récentes","name":"Nom","updated_at":"Mise à jour","location":"Emplacement","sharings":"Partage","at":"%{date} à %{time}"},"Empty":{"welcome":"Bienvenue sur Twake Notes","after_created":"Une fois votre note créée, il vous est possible de la retrouver dans "},"SavingIndicator":{"saved":{"default":"À jour","just_now":"À jour","secs_ago":"À jour (enregistré il y a %{time} sec.)","min_ago":"À jour (enregistré il y a %{time} min.)","mins_ago":"À jour (enregistré il y a %{time} min.)","hour_ago":"À jour (enregistré il y a %{time} heure)","hours_ago":"À jour (enregistré il y a %{time} heures)","day_ago":"À jour (enregistré il y a %{time} jour)","days_ago":"À jour (enregistré il y a %{time} jours)","month_ago":"À jour (enregistré il y a %{time} mois)","monthes_ago":"À jour (enregistré il y a %{time} mois)","year_ago":"À jour (enregistré il y a %{time} an)","years_ago":"À jour (enregistré il y a %{time} ans)"},"saving":"Enregistrement en cours...","still_saving":"Enregistrement en cours......","out_of_sync":{"default":"Enregistré (hors ligne)","just_now":"Enregistré (hors ligne)","secs_ago":"Enregistré (hors ligne depuis %{time} sec)","min_ago":"Enregistré (hors ligne depuis %{time} min)","mins_ago":"Enregistré (hors ligne depuis %{time} min)","hour_ago":"Enregistré (hors ligne depuis %{time} h)","hours_ago":"Enregistré (hors ligne depuis %{time} h)","day_ago":"Enregistré (hors ligne depuis %{time} jour)","days_ago":"Enregistré (hors ligne depuis %{time} jours)","month_ago":"Enregistré (hors ligne depuis %{time} mois)","monthes_ago":"Enregistré (hors ligne depuis %{time} mois)","year_ago":"Enregistré (hors ligne depuis %{time} an)","years_ago":"Enregistré (hors ligne depuis %{time} ans)"},"saving_impossible":{"default":"Non enregistré (hors ligne)","just_now":"Non enregistré (hors ligne)","secs_ago":"Non enregistré (hors ligne depuis %{time} sec)","min_ago":"Non enregistré (hors ligne depuis %{time} min)","mins_ago":"Non enregistré (hors ligne depuis %{time} min)","hour_ago":"Non enregistré (hors ligne depuis %{time} h)","hours_ago":"Non enregistré (hors ligne depuis %{time} h)","day_ago":"Non enregistré (hors ligne depuis %{time} jour)","days_ago":"Non enregistré (hors ligne depuis %{time} jours)","month_ago":"Non enregistré (hors ligne depuis %{time} mois)","monthes_ago":"Non enregistré (hors ligne depuis %{time} mois)","year_ago":"Non enregistré (hors ligne depuis %{time} an)","years_ago":"Non enregistré (hors ligne depuis %{time} ans)"}},"OfflineIndicator":{"message":"Vous n’êtes plus connecté à internet. Vos modifications seront enregistrées quand vous serez connecté à nouveau."}},"Error":{"422":"Seules les images sont acceptées","unshared_title":"Le partage n\'est plus actif","unshared_text":"Le propriétaire a peut-être révoqué ce partage. Vous ne pouvez plus éditer de note à cette adresse.","loading_error_title":"La note n\'a pas pu être chargée","loading_error_text_noReturnUrl":"Cette note n\'existe peut-être plus, ou nos serveurs ont peut-être un moment d\'égarement. Merci de retenter plus tard.","back":"Retour","unknown_error":"Une erreur inattendue s\'est produite","only_one_image":"Vous ne pouvez pas glisser-déposer plusieurs images en même temps"},"manifest":{"short_description":"Twake Notes est votre application de prise de notes personnelles et collaboratives.","long_description":"Notes est un éditeur de texte en ligne destiné à :\\n\\n* Créer vos propres notes avec les fonctionnalités essentielles (gras, souligné, liens, tableaux...)\\n* Classer et retrouver vos notes avec vos autres documents, dans les répertoires de votre Drive personnel\\n* Éditer facilement vos notes depuis tous vos appareils\\n* Accéder à vos notes, même sans internet, stockées sur votre PC\\n* Pour les aficionados, utiliser les raccourcis et la saisie au format markdown\\n*  ... et même écrire à plusieurs simultanément sur la même note (à venir) ! ","screenshots":["screenshots/fr/screenshot01.png","screenshots/fr/screenshot02.png"]},"Intents":{"save":"Enregistrer"},"TrashedBanner":{"text":"Cet élément est dans la corbeille","redirect":"Ouvrir la corbeille","restore":"Restaurer","restoreSuccess":"Cet élément a été restauré avec succès","restoreError":"Une erreur s\'est produite, veuillez réessayer","destroy":"Supprimer définitivement"},"DestroyConfirm":{"title":"Supprimer définitivement ?","forbidden":"Vous ne pourrez plus accéder à ce fichier.","restore":"Vous ne pourrez pas restaurer ce fichier.","cancel":"Annuler","delete":"Supprimer définitivement","deleteError":"Une erreur s\'est produite, veuillez réessayer"},"MoreButton":{"more":"Plus"}}')},IDw7:function(e,t,n){e.exports={header:"header--2CTEE","header-menu":"header-menu--HN4tE","app-icon":"app-icon--2S30F","home-link":"home-link--3zbZf","file-infos":"file-infos--1KJvL"}},JdMa:function(e,t,n){"use strict";n.d(t,"c",(function(){return a})),n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return o})),n.d(t,"d",(function(){return s}));var r=n("4z1N"),a=function(e){var t=e.schema.nodes.media;return e.selection instanceof r.NodeSelection&&e.selection.node.type===t},i=function(e){var t=e.schema.nodes.mediaSingle,n=e.selection.$to;if(t)for(var r=n.depth;r>=0;r--){var a=n.index(r);if(n.node(r).canReplaceWith(a,a,t))return!0}return!1},o=function(e,t){var n=t.nodes,r=n.media,a=n.mediaSingle;if(!r||!a)return null;var i=r.createChecked({type:"external",url:e});return a.createChecked({},i)},s=function(e,t){var n,a=e.clientX,i=e.clientY;return t.dispatch(t.state.tr.setSelection(r.TextSelection.create(t.state.doc,(null===(n=t.posAtCoords({left:a,top:i}))||void 0===n?void 0:n.pos)||0)))}},MjaT:function(e,t,n){"use strict";n.d(t,"a",(function(){return d}));var r,a=n("yCbO"),i=n.n(a),o=n("Czyx"),s=n("QdRn"),c=n("WISH"),l=n("2KGD"),u=n("K4GK"),d=Object(o.css)(r||(r=i()(["\n  .ProseMirror {\n    "," & [layout='full-width'] .",",\n    & [layout='wide'] ."," {\n      margin-left: 50%;\n      transform: translateX(-50%);\n    }\n\n    & [layout^='wrap-'] + [layout^='wrap-'] {\n      clear: none;\n      & + p,\n      & + div[class^='fabric-editor-align'],\n      & + ul,\n      & + ol,\n      & + h1,\n      & + h2,\n      & + h3,\n      & + h4,\n      & + h5,\n      & + h6 {\n        clear: both !important;\n      }\n      & ."," {\n        margin-left: 0;\n        margin-right: 0;\n      }\n    }\n\n    .mediaSingleView-content-wrap[layout^='wrap-'] {\n      max-width: 100%;\n      // overwrite default Prosemirror setting making it clear: both\n      clear: inherit;\n    }\n\n    .mediaSingleView-content-wrap[layout='wrap-left'] {\n      float: left;\n    }\n\n    .mediaSingleView-content-wrap[layout='wrap-right'] {\n      float: right;\n    }\n\n    .mediaSingleView-content-wrap[layout='wrap-right']\n      + .mediaSingleView-content-wrap[layout='wrap-left'] {\n      clear: both;\n    }\n\n    /* Larger margins for resize handlers when at depth 0 of the document */\n    & > .mediaSingleView-content-wrap {\n      .richMedia-resize-handle-right {\n        margin-right: -","px;\n      }\n      .richMedia-resize-handle-left {\n        margin-left: -","px;\n      }\n    }\n  }\n\n  .richMedia-resize-handle-right,\n  .richMedia-resize-handle-left {\n    display: flex;\n    flex-direction: column;\n\n    /* vertical align */\n    justify-content: center;\n  }\n\n  .richMedia-resize-handle-right {\n    align-items: flex-end;\n    padding-right: 12px;\n    margin-right: -","px;\n  }\n\n  .richMedia-resize-handle-left {\n    align-items: flex-start;\n    padding-left: 12px;\n    margin-left: -","px;\n  }\n\n  .richMedia-resize-handle-right::after,\n  .richMedia-resize-handle-left::after {\n    content: ' ';\n    display: flex;\n    width: 3px;\n    height: 64px;\n\n    border-radius: 6px;\n  }\n\n  .",":hover .richMedia-resize-handle-left::after,\n  .",":hover .richMedia-resize-handle-right::after {\n    background: ",";\n  }\n\n  ."," .richMedia-resize-handle-right::after,\n  ."," .richMedia-resize-handle-left::after,\n  ."," .richMedia-resize-handle-right:hover::after,\n  ."," .richMedia-resize-handle-left:hover::after,\n  .",".is-resizing .richMedia-resize-handle-right::after,\n  .",".is-resizing .richMedia-resize-handle-left::after {\n    background: ",";\n  }\n\n  .__resizable_base__ {\n    left: unset !important;\n    width: auto !important;\n    height: auto !important;\n  }\n\n  /* Danger when top level node for smart cards / inline links */\n  .danger > div > div > .media-card-frame,\n  .danger > span > a {\n    background-color: ",";\n    box-shadow: 0px 0px 0px ","px\n      ",";\n    transition: background-color 0s;\n    transition: box-shadow 0s;\n  }\n\n  /* Danger when nested node or common */\n  .danger {\n    /* Media single */\n    ."," .","::after {\n      border: ","px solid ",";\n    }\n\n    .richMedia-selected .richMedia-resize-handle-right::after,\n    .richMedia-selected .richMedia-resize-handle-left::after {\n      background: ",";\n    }\n\n    /* Smart cards */\n    div div .media-card-frame,\n    .inlineCardView-content-wrap > span > a {\n      background-color: rgb(255, 189, 173, 0.5); /* R75 with 50% opactiy */\n      transition: background-color 0s;\n    }\n\n    div div .media-card-frame::after {\n      box-shadow: none;\n    }\n  }\n"])),s.a,s.b,s.b,s.b,c.v,c.v,c.u,c.u,s.b,s.b,l.N60,c.H,c.H,s.b,s.b,s.b,s.b,l.B200,c.h,c.D,c.j,s.b,u.b,c.D,c.j,c.j)},NZnG:function(e,t,n){"use strict";n.d(t,"a",(function(){return R}));var r,a,i,o=n("GeFe"),s=n.n(o),c=n("Zvb3"),l=n.n(c),u=n("J/YY"),d=n.n(u),p=n("a1Fv"),f=n.n(p),h=n("g3eI"),m=n.n(h),v=n("wDGE"),g=n.n(v),b=n("J58c"),y=n.n(b),O=n("yCbO"),w=n.n(O),k=n("ivGQ"),E=n.n(k),P=n("Czyx"),j=n("dKM3"),x=n("DzbU"),C=n("x3sL"),S=n("kSuG"),M=n("zy2m"),_=n("WISH"),D=n("G09D");function N(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=g()(e);if(t){var a=g()(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return m()(this,n)}}var I=P.default.div(r||(r=w()(["\n  /* tooltip in ToolbarButton is display:block */\n  & > div > div {\n    display: flex;\n  }\n"]))),T=Object(D.a)(j.a),A=P.default.div(a||(a=w()(["\n  ",";\n"])),(function(e){return e.isSelected?"&& > span, && > span:hover { background: #6c798f; color: #fff; }":""})),L=P.default.span(i||(i=w()(["\n  ",";\n"])),(function(e){return e.hasElemBefore?"margin-left: 8px;":""})),R=function(e){f()(n,e);var t=N(n);function n(){var e;s()(this,n);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return e=t.call.apply(t,[this].concat(a)),y()(d()(e),"state",{popupPlacement:["bottom","left"]}),y()(d()(e),"handleRef",(function(t){e.setState({target:t||void 0})})),y()(d()(e),"updatePopupPlacement",(function(t){e.setState({popupPlacement:t})})),y()(d()(e),"handleClose",(function(){e.props.onOpenChange&&e.props.onOpenChange({isOpen:!1})})),e}return l()(n,[{key:"renderItem",value:function(e){var t=this.props,n=t.onItemActivated,r=t.onMouseEnter,a=t.onMouseLeave;if(!e.onClick&&!e.value&&!e.value.name)return E.a.createElement("span",{key:String(e.content)},e.content);var i=E.a.createElement(A,{key:e.key||e.content,isSelected:e.isActive},E.a.createElement(x.a,{elemBefore:e.elemBefore,elemAfter:e.elemAfter,isDisabled:e.isDisabled,onClick:function(){return n&&n({item:e})},onMouseEnter:function(){return r&&r({item:e})},onMouseLeave:function(){return a&&a({item:e})},className:e.className},E.a.createElement(L,{hasElemBefore:!!e.elemBefore},e.content)));return e.tooltipDescription?E.a.createElement(S.a,{key:e.key||e.content,content:e.tooltipDescription,position:e.tooltipPosition},i):i}},{key:"renderDropdownMenu",value:function(){var e=this,t=this.state,n=t.target,r=t.popupPlacement,a=this.props,i=a.items,o=a.mountTo,s=a.boundariesElement,c=a.scrollableElement,l=a.offset,u=a.fitHeight,d=a.fitWidth,p=a.isOpen,f=a.zIndex;return E.a.createElement(M.a,{target:p?n:void 0,mountTo:o,boundariesElement:s,scrollableElement:c,onPlacementChanged:this.updatePopupPlacement,fitHeight:u,fitWidth:d,zIndex:f||_.n,offset:l},E.a.createElement(T,{isOpen:!0,appearance:"tall",position:r.join(" "),shouldFlip:!0,shouldFitContainer:!0,isTriggerNotTabbable:!0,handleClickOutside:this.handleClose,handleEscapeKeydown:this.handleClose},E.a.createElement("div",{style:{height:0,minWidth:d||0}}),i.map((function(t,n){return E.a.createElement(C.a,{key:n},t.items.map((function(t){return e.renderItem(t)})))}))))}},{key:"render",value:function(){var e=this.props,t=e.children,n=e.isOpen;return E.a.createElement(I,null,E.a.createElement("div",{ref:this.handleRef},t),n?this.renderDropdownMenu():null)}}]),n}(k.PureComponent)},Q6Vf:function(e,t,n){"use strict";n.r(t);var r,a=n("HZZ/"),i=n.n(a),o=n("XkwL"),s=n.n(o),c=n("LGLP"),l=n.n(c),u=n("hJxD"),d=n.n(u);!function(e){e.New="new",e.Editor="n/:id",e.Root="/",e.ShareFromEditor="n/:id/share",e.ShareFromList="share"}(r||(r={}));var p=n("4vUV"),f=n("QJcL"),h=n("ivGQ"),m=n.n(h),v=n("RLdO"),g=n("9Ub/"),b=n("AjpU"),y=Object(v.a)()(Object(b.a)()((function(e){var t=e.t;return!e.breakpoints.isMobile&&m.a.createElement(g.default,{variant:"h3",component:"h1"},t("Notes.List.latest_notes"))}))),O=n("bOB9"),w=n("xEu0"),k=n("SOA1"),E=n("/s+K"),P=n("AHiN"),j=n("Aaol");function x(e){var t=e.className,n=Object(j.useI18n)().t,r=Object(w.useClient)(),a=Object(h.useState)(!1),o=s()(a,2),c=o[0],l=o[1],u=Object(h.useCallback)(i()(d.a.mark((function e(){var t,n;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return l(!0),e.next=3,Object(O.a)(r);case 3:return t=e.sent,n=t.data,e.next=7,Object(O.c)(r,n);case 7:window.location.href=e.sent;case 8:case"end":return e.stop()}}),e)}))),[r]);return m.a.createElement(E.default,{onClick:u,type:"submit",busy:c,startIcon:m.a.createElement(P.default,{icon:"plus"}),label:n("Notes.Add.add_note"),className:t})}function C(e){var t=Object(w.useClient)()||e.client;return m.a.createElement(k.a,{onClick:i()(d.a.mark((function e(){var n,r;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(O.a)(t);case 2:return n=e.sent,r=n.data,e.next=6,Object(O.c)(t,r);case 6:window.location.href=e.sent;case 7:case"end":return e.stop()}}),e)}))),icon:"plus",className:"u-c-pointer"})}var S,M=n("xzHV"),_={_type:"io.cozy.apps",_id:"io.cozy.apps/notes"},D=function(e){var t=Object(h.useState)(Object(O.e)(e)),n=s()(t,2),r=n[0],a=n[1];return Object(h.useEffect)((function(){(function(){var t=i()(d.a.mark((function t(){var n,r;return d.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,M.CozyFolder.getReferencedFolders(_);case 3:n=t.sent,r=Object(O.e)(e,n[0]._id),a(r),t.next=11;break;case 8:t.prev=8,t.t0=t.catch(0),a(Object(O.e)(e));case 11:case"end":return t.stop()}}),t,null,[[0,8]])})));return function(){return t.apply(this,arguments)}})()()}),[e]),{notesFolder:r}},N=n("CE71"),I=n("/5Aj"),T=n("SjB4"),A=Object(b.a)()(Object(w.withClient)((function(e){var t=e.t,n=e.client,r=D(n).notesFolder;return m.a.createElement("div",{className:"empty"},m.a.createElement(I.a,{id:"empty",icon:T.a,title:t("Notes.Empty.welcome"),text:m.a.createElement(N.default,{href:r,app:{slug:p.i.Drive}},(function(e){var n=e.href,r=e.onClick;return m.a.createElement("span",{className:"u-mb-half"},t("Notes.Empty.after_created")," ",m.a.createElement("a",{href:n,onClick:r},"Twake Drive"),".")}))},m.a.createElement(x,{className:"u-mt-1"})))}))),L=n("J58c"),R=n.n(L),U=n("bcvt"),z=n.n(U),F=n("P0ff"),B=n("Iyno");!function(e){e.ExtraLarge="isExtraLarge",e.Large="isLarge",e.Medium="isMedium",e.Small="isSmall",e.Tiny="isTiny",e.Desktop="isDesktop",e.Tablet="isTablet",e.Mobile="isMobile"}(S||(S={}));var V=n("9sfc"),W=n("3zOg"),q=n("Wz2g"),G=n("zLZg"),K=n("ZpM7"),H=n("HCvV"),Q=n("wwZE"),J=n("mU0V"),X=n("vTbG"),$=n("Rx+m"),Z=n("uU7o"),Y=n("hX+F"),ee=n("2GvR"),te=function(e){var t=e.drivePath,n=e.path,r=e.target;return e.noLink?m.a.createElement(Y.a,null,Object(Z.b)(n)):m.a.createElement(N.default,{href:t,app:{slug:p.i.Drive}},(function(e){var t=e.href,a=e.onClick;return m.a.createElement(ee.a,l()({href:t,onClick:a},function(e){return"string"!=typeof e?{}:"_blank"===e?{target:"_blank",rel:"noreferrer noopener"}:{target:e}}(r)),Object(Z.b)(n))}))},ne=function(e){var t=e.hideOn,n=e.showOn,r=e.children,a=Object($.default)(),i=t&&a[t],o=n&&a[n],s=m.a.createElement(m.a.Fragment,null,r);return t?i?null:s:n?o?s:null:s},re=n("INxB"),ae=n("ORhN"),ie=n("i5f2"),oe=n("dUf/"),se=function(e,t){var n=Object(h.forwardRef)((function(n,r){return m.a.createElement(re.a,l()({},n,{ref:r}),m.a.createElement(ie.default,null,m.a.createElement(P.default,{icon:t})),m.a.createElement(oe.default,{primary:e}))}));return n.displayName="DeleteNote",n},ce=function(e){var t=e.t,n=e.onDeleteNote,r=t("Notes.Delete.delete_note"),a=ae.default;return{name:"deleteNote",label:r,icon:a,action:function(e){n(e[0])},Component:se(r,a)}},le=n("83GJ"),ue=n("MzjA"),de=function(e,t){var n=Object(h.forwardRef)((function(n,r){return m.a.createElement(re.a,l()({},n,{ref:r}),m.a.createElement(ie.default,null,m.a.createElement(P.default,{icon:t})),m.a.createElement(oe.default,{primary:e}),m.a.createElement(ne,{showOn:S.Mobile},m.a.createElement(ue.default,null,m.a.createElement(H.default,null,m.a.createElement(q.a,{docId:n.docs[0]._id,size:"small"})))))}));return n.displayName="ShareNote",n},pe=function(e){var t=e.t,n=e.onShareNote,r=t("Notes.Files.share.cta"),a=le.a;return{name:"shareNote",label:r,icon:a,action:function(e){n(e[0])},Component:de(r,a)}};function fe(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function he(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?fe(Object(n),!0).forEach((function(t){R()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):fe(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var me=Object(b.a)()(Object(w.withClient)((function(e){var t=e.note,n=e.f,a=e.t,o=e.client,c=Object($.default)().isMobile,l=Object(F.A)(),u=Object(F.D)(),f=M.CozyFile.splitFilename(t),v=f.filename,b=f.extension,y=Object(h.useState)(!1),w=s()(y,2),k=w[0],E=w[1],j=Object(X.b)().showAlert,x=Object(V.b)(),C=x.isNativeFileSharingAvailable,_=x.shareFilesNative,D=Object(h.useCallback)((function(e){E(!0),e.stopPropagation()}),[E]),N=Object(h.useCallback)((function(){return E(!1)}),[E]),I=Object(h.useCallback)(i()(d.a.mark((function e(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,o.destroy(t);case 3:E(!1),j({message:a("Notes.Delete.deleted"),severity:"success"}),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),j({message:a("Notes.Delete.failed"),severity:"error"});case 10:case"end":return e.stop()}}),e,null,[[0,7]])}))),[o,t,a,E,j]),T=Object(K.c)([pe,W.a,ce],{onDeleteNote:I,isNativeFileSharingAvailable:C,shareFilesNative:_,onShareNote:function(){u(r.ShareFromList,{state:{backgroundLocation:l,shareModalProps:{document:he(he({},t),{},{name:t.attributes.name}),documentType:p.b.Notes,sharingDesc:t.attributes.name}}})},t:a}),A=Object(h.useMemo)((function(){return Object(O.e)(o,t.dir_id)}),[o,t]),L=m.a.useRef(),R=function(){var e=i()(d.a.mark((function e(){var n;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Object(O.c)(o,t);case 3:n=e.sent,window.location.href=n,e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),j({message:a("Error.loading_error_title"),severity:"error"});case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(){return e.apply(this,arguments)}}();return m.a.createElement(m.a.Fragment,null,m.a.createElement(J.f,{className:"u-c-pointer ".concat(z.a.tableRow),role:"button",tabIndex:"0",onKeyDown:function(e){"Enter"===e.key&&R()},onClick:R},m.a.createElement(J.c,{className:"".concat(z.a.tableCellName," u-flex u-flex-items-center u-fz-medium")},m.a.createElement(P.default,{icon:Q.default,size:32,className:"u-mr-1 u-flex-shrink-0"}),c?m.a.createElement("div",{className:"u-flex u-flex-column u-flex-grow-1",style:{minWidth:0}},m.a.createElement(g.default,{display:"inline",noWrap:!0},v),m.a.createElement(te,{drivePath:A,path:t.path,noLink:!0})):m.a.createElement("div",{className:"u-flex-grow-1"},m.a.createElement(g.default,{display:"inline",noWrap:!0},v),m.a.createElement("span",{className:"u-ellipsis"},b))),m.a.createElement(ne,{hideOn:S.Mobile},m.a.createElement(J.c,{className:z.a.tableCell},a("Notes.List.at",{date:n(t.updated_at,"dd LLLL"),time:n(t.updated_at,"HH:mm")})),m.a.createElement(J.c,{className:"".concat(z.a.tableCell," u-flex-shrink-0"),onClick:function(e){return e.stopPropagation()}},m.a.createElement(te,{drivePath:A,path:t.path})),m.a.createElement(J.c,{className:z.a.tableCell},m.a.createElement(B.Link,{onClick:function(e){return e.stopPropagation()},to:r.ShareFromList,state:{backgroundLocation:l,shareModalProps:{document:he(he({},t),{},{name:t.attributes.name}),documentType:p.b.Notes,sharingDesc:t.attributes.name}}},m.a.createElement(q.a,{docId:t._id,size:24})))),m.a.createElement(J.c,{className:z.a.tableCell,onClick:c?D:void 0},m.a.createElement("span",{ref:L},m.a.createElement(H.default,{onClick:c?void 0:D},m.a.createElement(P.default,{icon:"dots"}))))),k&&m.a.createElement(G.a,{open:!0,ref:L,onClose:N,actions:T,docs:[t],autoClose:!0}))}))),ve=n("bQqJ"),ge=function(){return m.a.createElement(J.f,{className:z.a.tableSpecialRow},m.a.createElement(J.c,{className:z.a.tableCellEmpty},m.a.createElement(A,null)))},be=function(){return m.a.createElement(J.f,{className:z.a.tableSpecialRow},m.a.createElement(J.c,{className:"".concat(z.a.tableCellEmpty," u-ta-center")},m.a.createElement(ve.b,{size:"xxlarge"})))},ye=Object(b.a)()((function(e){var t=e.t,n=e.notes,r=e.fetchStatus;return m.a.createElement(J.a,{className:"".concat(z.a.table," ").concat(0===n.length&&z.a.notable)},n.length>0&&m.a.createElement(J.d,null,m.a.createElement(J.f,null,m.a.createElement(J.e,{className:z.a.tableCellName},t("Notes.List.name")),m.a.createElement(ne,{hideOn:S.Mobile},m.a.createElement(J.e,{className:z.a.tableCell},t("Notes.List.updated_at")),m.a.createElement(J.e,{className:"".concat(z.a.tableCell," u-flex-shrink-0")},t("Notes.List.location")),m.a.createElement(J.e,{className:z.a.tableCell},t("Notes.List.sharings"))),m.a.createElement(J.e,{className:z.a.tableCell}))),m.a.createElement(J.b,null,"loading"===r?m.a.createElement(be,null):0===n.length?m.a.createElement(ge,null):n.map((function(e){return m.a.createElement(me,{note:e,key:e._id})}))))})),Oe=n("p/pw"),we=n("pX20"),ke=function(e,t){return"loaded"===e&&t.length>0},Ee=function(){return m.a.createElement(w.Query,{query:function(){return Object(w.Q)("io.cozy.notes")}},(function(e){var t=e.data,n=e.fetchStatus;return m.a.createElement(m.a.Fragment,null,m.a.createElement(we.a,null,m.a.createElement(ne,{hideOn:S.Mobile},m.a.createElement("div",{className:t.length>0?"".concat(z.a.appHeader," u-flex u-flex-justify-between u-flex-items-center u-mt-1"):""},t.length>0&&m.a.createElement(y,null),ke(n,t)&&m.a.createElement(x,null))),m.a.createElement(ye,{notes:t,fetchStatus:n})),ke(n,t)&&m.a.createElement(ne,{showOn:S.Mobile},m.a.createElement(Oe.BarRight,null,m.a.createElement(C,null))))}))},Pe=n("q5Wy"),je=n("ii0b"),xe=n.n(je),Ce=n("eCKa"),Se=n("xr2j"),Me=n("gMSI"),_e=w.fetchPolicies.olderThan(3e5),De=function(e){return{definition:Object(w.Q)("io.cozy.files").getById(e),options:{as:"io.cozy.files/".concat(e),fetchPolicy:_e,singleDocData:!0}}},Ne=n("0nAg");function Ie(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Te(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ie(Object(n),!0).forEach((function(t){R()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ie(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Ae=function(e){var t=e.file,n=Object(w.useClient)(),r=De(t.dir_id),a=Object(w.useQuery)(r.definition,Te(Te({},r.options),{},{enabled:!!t.dir_id})),i=Object(h.useMemo)((function(){return a.data?Object(Ne.ensureFilePath)(t,a.data):void 0}),[t,a.data]),o=Object(h.useMemo)((function(){return Object(O.e)(n,t.dir_id)}),[n,t.dir_id]);return i?m.a.createElement(ne,{hideOn:S.Mobile},m.a.createElement(te,{drivePath:o,path:i.path,target:"_blank"})):null},Le=n("IDw7"),Re=n.n(Le),Ue=function(e){var t,n=e.homeHref,r=e.leftComponent,a=e.rightComponent,i=e.isPublic,o=e.file,s=e.bannerComponent,c=(t=Object(w.useClient)(),{fetchHomeIcon:function(){return"".concat(t.options.uri,"/assets/images/icon-cozy-home.svg")},fetchNoteIcon:function(){return"/public/".concat(t.instanceOptions.app.icon)}}),u=c.fetchHomeIcon,d=c.fetchNoteIcon,f=w.models.file.splitFilename(o.attributes).filename;return m.a.createElement("header",{className:Re.a.header},m.a.createElement("div",{className:Re.a["header-menu"]},m.a.createElement(ne,{hideOn:S.Mobile},m.a.createElement(N.default,{app:{slug:p.i.Home},href:n},(function(e){var t=e.href;return m.a.createElement(Me.default,l()({},!i&&{href:t},{className:Re.a["home-link"]}),m.a.createElement(Ce.default,{app:p.i.Home,alt:p.i.Home,fetchIcon:u}))})),m.a.createElement(Se.default,{orientation:"vertical",className:"u-ml-1",flexItem:!0})),r,m.a.createElement("div",{className:Re.a["file-infos"]},m.a.createElement(ne,{hideOn:S.Mobile},m.a.createElement(Ce.default,{app:o.attributes.cozyMetadata.createdByApp,className:Re.a["app-icon"],fetchIcon:d})),m.a.createElement("div",null,m.a.createElement(g.default,null,m.a.createElement("strong",null,f)),!i&&m.a.createElement(Ae,{file:o}))),a),s)};Ue.propTypes={homeHref:xe.a.string,leftComponent:xe.a.node,rightComponent:xe.a.node,isPublic:xe.a.bool,file:xe.a.object.isRequired,bannerComponent:xe.a.node};var ze=Ue,Fe=n("UdSB"),Be=n.n(Fe),Ve=n("uRLs"),We=n.n(Ve),qe=n("vc9t"),Ge=["disabled","onClick"],Ke=Object(h.forwardRef)((function(e,t){var n=e.disabled,r=e.onClick,a=Be()(e,Ge),i=Object(j.useI18n)().t,o=Object($.default)().isMobile;return m.a.createElement(E.default,l()({className:We()("u-miw-auto",{"u-ml-half":!o}),variant:"secondary",disabled:n,onClick:r,label:m.a.createElement(P.default,{icon:qe.a}),"aria-label":i("MoreButton.more"),ref:t},a))}));Ke.displayName="MoreButton",Ke.propTypes={disabled:xe.a.bool,onClick:xe.a.func.isRequired};var He=function(e){var t=e.files,n=e.actions,r=Object(h.useRef)(),a=Object(h.useState)(!1),i=s()(a,2),o=i[0],c=i[1],l=Object(h.useCallback)((function(){return c(!0)}),[c]),u=Object(h.useCallback)((function(){return c(!1)}),[c]),d=Object(h.useCallback)((function(){if(o)return u();l()}),[u,l,o]);return 0===n.length?null:m.a.createElement(m.a.Fragment,null,m.a.createElement(Ke,{onClick:d,ref:r}),o&&m.a.createElement(G.a,{open:!0,onClose:u,ref:r,docs:t,actions:n}))};He.propTypes={files:xe.a.arrayOf(xe.a.object).isRequired,actions:xe.a.arrayOf(xe.a.object)};var Qe=He,Je=n("hhV5"),Xe=n.n(Je),$e=n("nyYD");function Ze(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Ye(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ze(Object(n),!0).forEach((function(t){R()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ze(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var et=function(e){var t=e.file,n=e.title,a=Object(h.useCallback)((function(){}),[]),i=Object(F.A)();if(t){var o,s=t.id;return m.a.createElement(B.Link,{to:r.ShareFromList,state:{backgroundLocation:i,shareModalProps:{document:Ye(Ye({},t),{},{name:n||(null==t||null===(o=t.attributes)||void 0===o?void 0:o.name)}),documentType:p.b.Notes,sharingDesc:n}},style:{textDecoration:"none"}},m.a.createElement($e.a,{theme:"primary",docId:s,onClick:a,extension:"narrow",className:Xe.a["sharing-button"]}))}return null},tt=n("v2Ur"),nt=function(e){var t=Object(h.useState)(!1),n=s()(t,2),r=n[0],a=n[1];return Object(h.useEffect)((function(){a(p.h===e&&!!Object(tt.c)())}),[e]),r},rt=n("f6Pd"),at=n("BYzh"),it=n("cvJ7"),ot=n("Npbv"),st=n("aoYa"),ct=m.a.forwardRef((function(e,t){return m.a.createElement("div",{ref:t},m.a.createElement(P.default,e))})),lt=function(e){var t=e.isPublic,n=e.isReadOnly,r=e.title,a=e.file,i=Object(j.useI18n)().t,o=Object($.default)().isMobile,s=Object(rt.a)(p.h),c=s.addSharingLink,l=s.isSharingShortcutCreated,u=s.loading,d=nt(window.location.pathname),f=Object(K.c)([at.a,it.a],{isSharingShortcutCreated:l,addSharingLink:c});if(!t)return m.a.createElement(et,{file:a,title:r});var h=!o&&d&&!u&&!l;return m.a.createElement(m.a.Fragment,null,h&&m.a.createElement(ot.a,{link:c,isSharingShortcutCreated:l}),d&&m.a.createElement(Qe,{files:[a],actions:f}),n&&m.a.createElement(st.a,{title:i("Notes.Editor.read_only"),className:"u-ml-half"},m.a.createElement(ct,{icon:"lock",color:"var(--primaryTextColor)"})))};lt.propTypes={isPublic:xe.a.bool.isRequired,isReadOnly:xe.a.bool.isRequired,title:xe.a.string.isRequired,file:xe.a.object.isRequired};var ut=lt,dt=n("8Zd7"),pt=n("v/Qj"),ft=n("6mlU"),ht=Object(h.createContext)(),mt=function(e){var t,n=e.children,r=e.noteId,a=e.readOnly,o=void 0!==a&&a,c=Object(w.useClient)(),l=Object(h.useRef)(r),u=Object(h.useState)("pending"),p=s()(u,2),f=p[0],v=p[1],g=Object(h.useState)(),b=s()(g,2),y=b[0],O=b[1],k=Object(h.useState)(),E=s()(k,2),P=E[0],j=E[1],x=Object(pt.a)(),C=x.userName,S=x.userId,M=Object(dt.a)({userId:S,userName:C,cozyClient:c}),_=(t=r,{definition:Object(w.Q)("io.cozy.notes").getById(t),options:{as:"io.cozy.notes/".concat(t),fetchPolicy:_e,singleDocData:!0}}),D=Object(w.useQuery)(_.definition,_.options);return Object(h.useEffect)((function(){var e=function(){var e=i()(d.a.mark((function e(){var t;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(v("loading"),e.prev=1,t=M.getFormatedDoc(null==D?void 0:D.data),o||t.schemaVersion===Object(ft.a)()){e.next=8;break}if("failed"===f){e.next=8;break}return e.next=7,M.updateSchema(r,ft.b);case 7:t=e.sent;case 8:O(t.title||""),j(t),v("loaded"),e.next=16;break;case 13:e.prev=13,e.t0=e.catch(1),v("failed");case 16:case"end":return e.stop()}}),e,null,[[1,13]])})));return function(){return e.apply(this,arguments)}}();"loaded"===D.fetchStatus&&M&&"loading"!==f&&void 0===P&&e()}),[P,r,D,o,M,f]),Object(h.useEffect)((function(){r!==l.current&&(v("pending"),O(void 0),j(void 0)),l.current=r}),[r]),m.a.createElement(ht.Provider,{value:{doc:P,serviceClient:M,status:f,title:y,setTitle:O}},n)},vt=n("pSj2"),gt=n("jMeN"),bt=n("P/GF"),yt=n("OEPu"),Ot=n("4jS1"),wt=function(e){var t=e.noteId,n=e.onCancel,r=e.onConfirm,a=Object(j.useI18n)().t,o=Object(w.useClient)(),c=Object(h.useState)(!1),l=s()(c,2),u=l[0],p=l[1],f=Object(X.b)().showAlert,v=function(){var e=i()(d.a.mark((function e(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,p(!0),e.next=4,o.collection("io.cozy.files").deleteFilePermanently(t);case 4:r(),e.next=12;break;case 7:e.prev=7,e.t0=e.catch(0),f({message:a("TrashedBanner.deleteError"),severity:"error"}),n(),p(!1);case 12:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(){return e.apply(this,arguments)}}();return m.a.createElement(vt.a,{open:!0,onClose:n,title:a("DestroyConfirm.title"),content:m.a.createElement(yt.default,null,m.a.createElement(Ot.default,{gutters:"disabled",size:"small"},m.a.createElement(ie.default,null,m.a.createElement(P.default,{icon:gt.a})),m.a.createElement(oe.default,{primary:a("DestroyConfirm.forbidden")})),m.a.createElement(Ot.default,{gutters:"disabled",size:"small"},m.a.createElement(ie.default,null,m.a.createElement(P.default,{icon:bt.a})),m.a.createElement(oe.default,{primary:a("DestroyConfirm.restore")}))),actions:m.a.createElement(m.a.Fragment,null,m.a.createElement(E.default,{variant:"secondary",onClick:n,label:a("DestroyConfirm.cancel"),disabled:u}),m.a.createElement(E.default,{color:"error",onClick:v,label:a("DestroyConfirm.delete"),busy:u}))})},kt=n("whoR"),Et=n("3uoH"),Pt=function(e){var t=e.noteId,n=e.isPublic,r=e.returnUrl,a=Object(j.useI18n)().t,o=Object(w.useClient)(),c=Object(X.b)().showAlert,l=Object($.default)().isMobile,u=Object(h.useState)(!1),p=s()(u,2),f=p[0],v=p[1],g=Object(h.useState)(!1),b=s()(g,2),y=b[0],O=b[1],k=function(){var e=i()(d.a.mark((function e(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,o.collection("io.cozy.files").restore(t);case 3:c({message:a("TrashedBanner.restoreSuccess"),severity:"secondary"}),e.next=9;break;case 6:e.prev=6,e.t0=e.catch(0),c({message:a("TrashedBanner.restoreError"),severity:"error"});case 9:return e.prev=9,O(!1),e.finish(9);case 12:case"end":return e.stop()}}),e,null,[[0,6,9,12]])})));return function(){return e.apply(this,arguments)}}(),x=function(){var e=i()(d.a.mark((function e(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:v(!0);case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return m.a.createElement(m.a.Fragment,null,m.a.createElement(kt.a,{square:!0,severity:"secondary",icon:m.a.createElement(P.default,{icon:Et.a,size:32}),block:l,action:n?null:m.a.createElement(m.a.Fragment,null,m.a.createElement(E.default,{size:"small",variant:"text",label:a("TrashedBanner.restore"),onClick:k,busy:y}),m.a.createElement(E.default,{size:"small",variant:"text",label:a("TrashedBanner.destroy"),onClick:x,disabled:y}))},a("TrashedBanner.text")),f?m.a.createElement(wt,{noteId:t,onCancel:function(){v(!1)},onConfirm:function(){window.location=r}}):null)},jt=n("GeFe"),xt=n.n(jt),Ct=n("Zvb3"),St=n.n(Ct),Mt=n("ebeN"),_t=function(){function e(){xt()(this,e)}return St()(e,[{key:"preventDefault",value:function(){this.prevented=!0}}]),e}();function Dt(e,t,n){var r=function(){var e=new _t;n&&n(e),e.prevented||(document.location=t)};return function(t){t.preventDefault(),e(r)}}function Nt(e){var t=e.returnUrl,n=e.file,r=e.requestToLeave,a=Object(h.useContext)(Pe.a),i=Object(w.useClient)();if(a)return null;if(t){var o=w.models.file.getParentFolderId(n),s=Object(O.f)(o),c=function(e,t){try{var n=e.getInstanceOptions().subdomain;return Object(w.deconstructCozyWebLinkWithSlug)(t,n).slug}catch(r){return p.i.Notes}}(i,t);return m.a.createElement(N.default,{app:{slug:c},href:t,nativePath:s},(function(e){var t=e.onClick,n=e.href;return m.a.createElement(H.default,{component:"a",href:n,onClick:Dt(r,n,t)},m.a.createElement(P.default,{icon:Mt.a}))}))}return m.a.createElement(H.default,{component:"a",href:"#/",onClick:Dt(r,"#/")},m.a.createElement(P.default,{icon:Mt.a}))}Nt.propTypes={returnUrl:xe.a.string,file:xe.a.object.isRequired,requestToLeave:xe.a.func};var It=function(){return m.a.createElement("div",{className:"u-mv-3"},m.a.createElement(ve.b,{size:"xxlarge",middle:!0}))};var Tt=function(e){var t=e.returnUrl,n=Object(j.useI18n)().t;return m.a.createElement(I.a,{icon:"cross-small",title:n("Error.loading_error_title"),text:m.a.createElement(m.a.Fragment,null,m.a.createElement("p",{className:"u-mb-half"},n("Error.loading_error_text_noReturnUrl")),t&&m.a.createElement(E.default,{variant:"text",label:n("Error.back"),href:t}))})},At=n("bfH1"),Lt=n("o9PO"),Rt=n.n(Lt),Ut=n("Y/FK"),zt=n.n(Ut),Ft=n("eCKM"),Bt=n("/5sY"),Vt=n("OY/u"),Wt=Object(Vt.a)({tooltipPlacementBottom:{margin:"12px 24px"},tooltipPlacementTop:{margin:"12px 24px"}},{name:"MuiTooltip"})(st.a);function qt(e){return m.a.createElement(Wt,{title:e.content,open:e.open||void 0,key:e.open?"open":"auto"},e.children)}function Gt(e){var t=e.bannerRef&&e.bannerRef.current;return t?zt.a.createPortal(m.a.createElement("div",{className:Rt.a.banner},e.content),t):null}function Kt(e){var t=Object(j.useI18n)().t,n=Object($.default)().isMobile,r=m.a.createElement(Ft.default,{direction:"row",container:!0,wrap:"nowrap",spacing:1,className:Rt.a.grid},m.a.createElement(Ft.default,{item:!0},m.a.createElement(Bt.a.Round,{className:Rt.a.chip},m.a.createElement(P.default,{icon:"offline",color:"var(--iconTextColor)"}))),m.a.createElement(Ft.default,{item:!0},t("Notes.OfflineIndicator.message"))),a=n?Gt:qt;return m.a.createElement(a,{open:e.open,content:r,bannerRef:e.bannerRef},e.children)}var Ht=n("YDHN"),Qt=n.n(Ht),Jt=n("y0wq"),Xt=n.n(Jt);var $t=n("JlEO"),Zt=n("MoN4");var Yt=function(e){var t=Object(j.useI18n)().t,n=Object($.default)().isMobile,r=new Date,a=e.collabProvider,i=r-(a.getLastSaveOrSync()||r),o=a.isDirty(),c=r-a.getDirtySince();!function(e){var t=Object(h.useState)(null),n=s()(t,2)[1],r=Object(h.useCallback)(Xt()((function(){return n(new Date)}),200),[n]);Object(h.useEffect)((function(){return e.on("collab-state-change",r),function(){return e.off("collab-state-change",r)}}),[e,r])}(a);var l,u=function(e){var t=e.isOutOfSync,n=new Date,r=Object($t.a)()||t,a=Object(h.useMemo)((function(){return new Date}),[r]);return{isDisconnected:r,disconnectedAge:r?n-a:0}}({isOutOfSync:function(e){var t=e.isDirty,n=e.dirtyAge;return t&&n&&n>3e4}({isDirty:o,dirtyAge:c})}),d=u.isDisconnected,p=u.disconnectedAge,f=function(e){var t=e.disconnectedAge,n=e.isDisconnected&&t<5e3,r=5e3-t;return Object(Zt.a)(n&&r),n}({isDisconnected:d,disconnectedAge:p}),v=d?p:o?c:i,b=Object(O.l)(v),y=b.key,w=b.time,k=b.interval;Object(Zt.a)(k),l=o?d?"saving_impossible.".concat(y):c>5e3?"still_saving":"saving":d?"out_of_sync.".concat(y):"saved.default";var E=t("Notes.SavingIndicator.".concat(l),{time:w}),P=m.a.createElement(g.default,{className:Qt.a["saving-indicator"],variant:"body1"},E);return d?m.a.createElement(Kt,{open:f,bannerRef:e.bannerRef},P):n?null:P},en=n("QGb3"),tn=n.n(en),nn=n("gTK3"),rn=n("HrPx"),an=n("Mx+G"),on=n.n(an),sn=n("/yh+"),cn=n.n(sn),ln=n("RDSZ"),un=n("8ZpT"),dn=n.n(un),pn=n("XA6X"),fn=n.n(pn),hn=n("mXbR"),mn=n.n(hn);function vn(e,t){var n=mn()("debug.".concat(e));Object(h.useEffect)((function(){n&&gn(e,t)}),[n,e,t])}function gn(e,t){fn()(window,"cozy.debug.".concat(e),t)}fn()(window,"cozy.debug.notes.debugCollab",function(){var e=i()(d.a.mark((function e(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return dn()("debug.client",!0),dn()("debug.notes.service",!0),dn()("debug.notes.collabProvider",!0),dn()("debug.notes.channel",!0),dn()("debug.notes.noteId",!0),dn()("debug.notes.doc",!0),dn()("debug.notes.file",!0),dn()("debug.notes.returnUrl",!0),dn()("debug.notes.dirtyRef",!0),dn()("debug.notes.lastPatchError",!0),e.next=12,new Promise((function(e){window.setTimeout(i()(d.a.mark((function t(){var n,r,a,o,s,c,l,u,p,f,h,m,v,g,b,y,O,w,k,E,P,j,x,C,S,M;return d.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=cn()(window,"cozy.debug.notes.collabProvider"),r=cn()(window,"cozy.debug.notes.channel"),(a={date:(new Date).toISOString()}).noteId=cn()(window,"cozy.debug.notes.noteId"),a.initialVersion=cn()(window,"cozy.debug.notes.initialVersion"),a.returnUrl=cn()(window,"cozy.debug.notes.returnUrl"),o=n&&n.getState(),s=n&&o&&Object(ln.b)(o),c=o&&Object(ln.d)(o)||{steps:[]},l=c.steps,a.state={version:s,steps:l,length:l&&l.length},u=r&&r.backoff,p=r&&r.failures,f=r&&r.isDirty(),h=r&&r.isSending,m=r&&r.hasQueuedSteps(),v=r&&r.queuedStep,g=v&&v.state,b=g&&Object(ln.b)(g),y=v&&v.localSteps&&v.localSteps.steps,a.queue={backoff:u,failures:p,isDirty:f,isSending:h,hasQueue:m,version:b,steps:y,length:y&&y.length},O=n.isDirty(),w=n.getLastRemoteSync(),k=n.getLastLocalSave(),a.collabState={dirtySince:O,lastRemoteSync:w,lastLocalSave:k},E=n&&n.serviceClient,P=E&&E.realtime,j=P&&P.websocket,x=P&&P.retryManager,a.realtime={hasRealtime:!!P,started:P&&P.isStarted,hasWebsocket:P&&P.hasWebSocket(),isOpen:P&&P.isWebSocketOpen(),readyState:j&&j.readyState,bufferedAmount:j&&j.bufferedAmount,url:j&&j.url,retries:x&&x.retries,wait:x&&x.wait},C=cn()(window,"cozy.debug.client"),a.client={token:C.stackClient.token,credentials:C.stackClient.getCredentials(),authorization:C.stackClient.getAuthorizationHeader(),uri:C.uri},(S=cn()(window,"cozy.debug.notes.lastPatchError"))||!f){t.next=43;break}case 33:if(!r.isSending){t.next=38;break}return t.next=36,new Promise((function(e){return window.setTimeout(e,50)}));case 36:t.next=33;break;case 38:return r.resetBackoff(),r.processQueue(),t.next=42,Promise.race([new Promise((function(e){return window.setTimeout(e,2e3)})),new Promise((function(e){(function(){var t=i()(d.a.mark((function t(){var n;return d.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n=cn()(window,"cozy.debug.notes.lastPatchError");case 1:if(n){t.next=7;break}return t.next=4,new Promise((function(e){return window.setTimeout(e,50)}));case 4:n=cn()(window,"cozy.debug.notes.lastPatchError"),t.next=1;break;case 7:S=n,e();case 9:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}})()()}))]);case 42:r.isDirty()&&(r.backoff=u,r.failures=p);case 43:M=S&&S.message;try{M=JSON.parse(S.message)}catch(_){}a.lastPatchError={name:S&&S.name,status:S&&S.status,message:M},e(a);case 47:case"end":return t.stop()}}),t)}))),250)}));case 12:return e.abrupt("return",e.sent);case 13:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}());var bn=function(){function e(t,n){xt()(this,e),this.config=t,this.service=n,this.eventEmitter=new rn.EventEmitter2,this.resetBackoff(),this.initializeStepsQueue(),this.isSending=!1}var t,n,r,a,o,s;return St()(e,[{key:"resetBackoff",value:function(){this.backoff=0,this.failures=0}},{key:"increaseBackoff",value:function(){this.failures=this.failures+1,this.failures%4==0&&this.emit("needcatchup",{failures:this.failures}),this.backoff=Math.max(Math.min(2*this.backoff,3e5),128)}},{key:"afterBackoff",value:function(){var e=this;return new Promise((function(t){e.backoff<128?t():window.setTimeout(t,e.backoff)}))}},{key:"initializeStepsQueue",value:function(){this.queuedStep=void 0}},{key:"isDirty",value:function(){return this.hasQueuedSteps()||this.isSending}},{key:"ensureEmptyQueue",value:(s=i()(d.a.mark((function e(){var t=this;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e){t.isDirty()?t.on("emptyQueue",(function t(){this.off("emptyQueue",t),e()})):e()})));case 1:case"end":return e.stop()}}),e)}))),function(){return s.apply(this,arguments)})},{key:"enqueueSteps",value:function(e){var t=e.getState,n=e.state,r=e.localSteps;this.queuedStep={getState:t,state:n,localSteps:r}}},{key:"dequeueSteps",value:function(){var e=this.queuedStep,t=e.getState,n=e.state||t(),r=e.localSteps||Object(ln.d)(n)||{steps:[]};return this.queuedStep=void 0,{getState:t,state:n,localSteps:r}}},{key:"hasQueuedSteps",value:function(){return!!this.queuedStep}},{key:"rebaseStepsInQueue",value:function(){this.queuedStep&&(this.queuedStep={getState:this.queuedStep.getState})}},{key:"sendSteps",value:(o=i()(d.a.mark((function e(t,n,r){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.emit("enqueueSteps"),this.enqueueSteps({getState:t,state:n,localSteps:r}),e.next=4,this.processQueue();case 4:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return o.apply(this,arguments)})},{key:"processQueue",value:(a=i()(d.a.mark((function e(){var t,n,r,a,i,o,s;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isSending){e.next=2;break}return e.abrupt("return");case 2:if(this.hasQueuedSteps()){e.next=5;break}return this.emit("emptyQueue"),e.abrupt("return");case 5:return this.isSending=!0,e.next=8,this.afterBackoff();case 8:if(t=this.dequeueSteps(),n=t.getState,r=t.state,a=t.localSteps.steps,void 0!==(i=Object(ln.b)(r))){e.next=12;break}return e.abrupt("return");case 12:if(0!==a.length){e.next=14;break}return e.abrupt("return");case 14:return e.prev=14,o=this.config.noteId,e.next=18,this.service.pushSteps(o,i,a);case 18:s=e.sent,this.rebaseStepsInQueue(),this.resetBackoff(),this.emit("successfulPatch"),this.isSending=!1,s&&s.steps&&s.steps.length>0&&this.emit("data",s),e.next=32;break;case 26:e.prev=26,e.t0=e.catch(14),dn()("notes.lastPatchError")&&gn("notes.lastPatchError",e.t0),this.hasQueuedSteps()?this.rebaseStepsInQueue():this.enqueueSteps({getState:n}),this.increaseBackoff(),this.isSending=!1;case 32:return e.next=34,this.processQueue();case 34:case"end":return e.stop()}}),e,this,[[14,26]])}))),function(){return a.apply(this,arguments)})},{key:"connect",value:(r=i()(d.a.mark((function e(t){var n,r,a,i,o=this;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=t.version,r=t.doc,a=t.updatedAt,i=this.config.noteId,this.service.join(i),this.service.onStepsCreated(i,(function(e){o.emit("data",{version:e.version,steps:[e]})})),this.service.onTelepointerUpdated(i,(function(e){o.emit("telepointer",e)})),this.service.onSchemaUpdated(i,(function(){o.emit("schemaupdated")})),this.emit("connected",{version:n,doc:r,updatedAt:a});case 7:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"getSteps",value:(n=i()(d.a.mark((function e(t){var n;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.config.noteId,e.next=3,this.service.getSteps(n,t);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"sendTelepointer",value:(t=i()(d.a.mark((function e(t){var n;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.config.noteId,e.next=3,this.service.pushTelepointer(n,t);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"on",value:function(e,t){return this.eventEmitter.on(e,t),this}},{key:"off",value:function(e,t){return this.eventEmitter.off(e,t),this}},{key:"emit",value:function(e,t){return this.eventEmitter.emit(e,t),this}}]),e}();function yn(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function On(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?yn(Object(n),!0).forEach((function(t){R()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):yn(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var wn=new nn.a,kn=wn.encode.bind(wn);wn.encode=function(e){var t=kn(e);return 0===t.content.length&&0!=e.content.length?{content:[{type:"paragraph",content:[]}],type:"doc"}:t};var En=function(){function e(t,n){var r=this;xt()(this,e),R()(this,"processRemoteData",(function(e){var t=e.version,n=e.steps;if(n&&n.length){var a=n.map((function(e){return e.sessionId||r.serviceClient.getUserId(e.sessionId)}));r.emit("data",{json:n,version:t,userIds:a})}else console.warn("Collab.Provider: processRemoteData no steps ? ",n,e)})),R()(this,"onReceiveData",(function(e){r.queueData(e),r.processQueue()})),R()(this,"onReceiveTelepointer",(function(e){var t=e.sessionId,n=r.serviceClient.getUserId(t);if(n!==r.config.userId){var a=r.participants.get(n);a&&a.lastActive>e.timestamp||(r.updateParticipant(t,e.timestamp),r.emit("telepointer",e))}})),R()(this,"onReceiveSchemaUpdated",(function(){window.location.reload(!0)})),this.config=On({},t),this.config.sessionId=n.getSessionId(),this.config.userId=n.getUserId(),this.cancelLocalChanges=on()(this.cancelLocalChanges.bind(this),100),this.setReadOnly(!!this.config.readOnly),this.serviceClient=n,this.channel=t.channel||new bn(this.config,n),this.eventEmitter=new rn.EventEmitter2,this.queue=[],this.getState=function(){},this.participants=new Map,this.pauseQueue=!1,this.initialVersion=t.version,this.initialDate=t.updatedAt||new Date,this.pauseQueue=!1}var t;return St()(e,[{key:"initialize",value:function(e){var t=this;this.getState=e,this.channel.on("connected",(function(e){var n=e.doc,r=e.version,a=e.updatedAt,i=t.config.sessionId;t.emit("init",{sid:i,doc:n,version:r}),t.emit("connected",{sid:i}),t.listenStateEvents({lastRemoteSync:a})})),this.channel.on("data",this.onReceiveData),this.channel.on("telepointer",this.onReceiveTelepointer),this.channel.on("schemaupdated",this.onReceiveSchemaUpdated),this.channel.on("needcatchup",(function(){return t.catchup()}));var n=e(),r=wn.encode(n.doc),a=void 0!==this.initialVersion?this.initialVersion:r.version,i=On(On({},r),{},{version:a});return this.channel.connect({version:a,doc:i,updatedAt:this.initialDate}),this}},{key:"send",value:function(e,t,n){e.steps&&e.steps.length&&(this.isReadOnly()?this.cancelLocalChanges():this.channel.sendSteps(this.getState,n))}},{key:"sendMessage",value:function(e){if(e&&!this.isReadOnly())switch(e.type){case"telepointer":this.channel.sendTelepointer(On(On({},e),{},{timestamp:(new Date).getTime()}))}}},{key:"queueData",value:function(e){var t=[].concat(tn()(this.queue),[e]).sort((function(e,t){var n=e.version-e.steps.length,r=t.version-t.steps.length;return n>r?1:n<r||e.version>t.version?-1:e.version<t.version?1:0}));this.queue=t}},{key:"catchup",value:(t=i()(d.a.mark((function e(){var t,n,r,a,i,o,s,c,l;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.pauseQueue=!0,t=Object(ln.b)(this.getState()),e.prev=2,e.next=5,this.channel.getSteps(t);case 5:n=e.sent,r=n.doc,a=n.version,i=n.steps,r?(o=this.config.sessionId,s=Object(ln.d)(this.getState())||{},c=s.steps,l=void 0===c?[]:c,this.emit("init",{sid:o,doc:r,version:a}),l.length&&!this.isReadOnly()&&this.emit("local-steps",{steps:l})):i.length>0&&this.onReceiveData({steps:i,version:a},!0),this.queueTimeout=void 0,this.pauseQueue=!1,this.processQueue(),e.next=19;break;case 15:e.prev=15,e.t0=e.catch(2),this.pauseQueue=!1,this.programCatchup();case 19:case"end":return e.stop()}}),e,this,[[2,15]])}))),function(){return t.apply(this,arguments)})},{key:"programCatchup",value:function(){var e=this;this.queueTimeout||(this.queueTimeout=window.setTimeout((function(){e.catchup()}),1e3))}},{key:"cancelCatchup",value:function(){this.queueTimeout&&(window.clearTimeout(this.queueTimeout),this.queueTimeout=void 0)}},{key:"processQueue",value:function(){if(this.queue.length>0&&!this.pauseQueue)for(var e=Object(ln.b)(this.getState());this.queue.length>0;){var t=this.queue[0],n=t.version,r=t.steps.length+e;if(n==r)this.cancelCatchup(),this.queue.shift(),this.processRemoteData(t),e=n;else if(n<=r&&this.queue.shift(),n>r){this.programCatchup();break}}}},{key:"updateParticipant",value:function(e,t){var n=this,r=this.serviceClient.getUserId(e),a=function(e){var t=e.userId,n=e.sessionId;return{userId:n,sessionId:n||t,name:t,avatar:null,email:null}}({userId:r,sessionId:e});this.participants.set(r,On(On({name:"",email:"",avatar:"",sessionId:e,userId:r},a),{},{lastActive:t}));var i=[this.participants.get(r)],o=(new Date).getTime(),s=Array.from(this.participants.values()).filter((function(e){return(o-e.lastActive)/1e3>300}));s.forEach((function(e){return n.participants.delete(e.userId)})),this.emit("presence",{joined:i,left:s})}},{key:"emit",value:function(e,t){return this.eventEmitter.emit(e,t),this}},{key:"on",value:function(e,t){return this.eventEmitter.on(e,t),this}},{key:"off",value:function(e,t){return this.eventEmitter.off(e,t),this}},{key:"unsubscribeAll",value:function(e){this.eventEmitter.removeAllListeners(e)}},{key:"isDirty",value:function(){return!!this.dirtySince}},{key:"getDirtySince",value:function(){return this.dirtySince}},{key:"getLastLocalSave",value:function(){return this.lastLocalSave}},{key:"getLastRemoteSync",value:function(){return this.lastRemoteSync}},{key:"getLastSaveOrSync",value:function(){return this.lastLocalSave>this.lastRemoteSync?this.lastLocalSave:this.lastRemoteSync}},{key:"onLocalSave",value:function(){this.lastLocalSave=new Date,this.emit("collab-state-change")}},{key:"onRemoteSync",value:function(){this.lastRemoteSync=new Date,this.emit("collab-state-change")}},{key:"onChannelEmptyQueue",value:function(){this.dirtySince=void 0,this.emit("collab-state-change")}},{key:"onChannelEnqueue",value:function(){this.dirtySince||(this.dirtySince=new Date,this.emit("collab-state-change"))}},{key:"listenStateEvents",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.lastRemoteSync;this.channel.on("emptyQueue",this.onChannelEmptyQueue.bind(this)),this.channel.on("enqueueSteps",this.onChannelEnqueue.bind(this)),this.channel.on("successfulPatch",this.onLocalSave.bind(this)),this.on("data",this.onRemoteSync.bind(this)),this.on("init",this.onRemoteSync.bind(this)),t&&(this.lastRemoteSync=t)}},{key:"isReadOnly",value:function(){return this.readOnly}},{key:"setReadOnly",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.readOnly=!!e,this.readOnly&&this.cancelLocalChanges()}},{key:"cancelLocalChanges",value:function(){var e=this.getState&&this.getState();if(e){var t=cn()(e,"collab$.unconfirmed[0].origin.docs[0]"),n=cn()(e,"collab$.version"),r=this.config.sessionId;if(t&&n&&r){var a=t.toJSON();this.emit("init",{doc:a,version:n,sid:r})}}}}]),e}();var Pn=function(e){var t=e.doc,n=e.noteId,r=e.serviceClient;return Object(h.useMemo)((function(){var e=t&&t.version,a=t&&t.updatedAt;if(r&&void 0!==t)return new En({version:e,noteId:n,updatedAt:a},r)}),[n,t,r])},jn='[data-testid="ak-editor-main-toolbar"]',xn=function(e){var t=Cn(e);return Sn(e,t),function(){document.removeEventListener("scroll",t),window.visualViewport.removeEventListener("resize",t)}},Cn=function(e){return function(){var t=window.visualViewport,n=e.offsetHeight,r=t.height-n+document.documentElement.scrollTop;e.style.top="".concat(r,"px")}},Sn=function(e,t){e.style.position="absolute",e.style.bottom="auto",e.style.marginTop="-5rem",t(),document.addEventListener("scroll",t,{passive:!0}),window.visualViewport.addEventListener("resize",t,{passive:!0})},Mn=function(e){var t=Cn(e);document.addEventListener("scroll",t,{passive:!0}),window.visualViewport.addEventListener("resize",t,{passive:!0})},_n=function(e,t){e.forEach((function(e){Array.from(e.addedNodes).forEach((function(e){if(1===e.nodeType){var n=e;if(n.matches(jn)||n.querySelector(jn)){t.disconnect();var r=n.matches(jn)?n:n.querySelector(jn);return void(r&&(xn(r),Mn(r)))}}}))}))},Dn=function(){Object(h.useEffect)((function(){if(/iPhone|iPad|iPod/.test(window.navigator.userAgent)){var e,t=document.querySelector(jn);return t?(xn(t),Mn(t)):(e=new MutationObserver(_n)).observe(document.body,{childList:!0,subtree:!0}),function(){var n,r;null===(n=e)||void 0===n||n.disconnect(),t&&(r=Cn(t),document.removeEventListener("scroll",r),window.visualViewport.removeEventListener("resize",r))}}}),[])};var Nn=function(e){var t=e.doc,n=e.collabProvider,r=t&&t.file.id,a=n&&n.serviceClient,o=n&&n.channel;return{forceSync:Object(h.useCallback)(function(){var e=i()(d.a.mark((function e(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t&&o&&a)){e.next=5;break}return e.next=3,o.ensureEmptyQueue();case 3:return e.next=5,a.sync(r);case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),[t,o,a,r]),emergencySync:Object(h.useCallback)((function(){r&&a&&a.sync(r)}),[r,a])}};var In=function(e){var t=e.returnUrl,n=e.cozyClient,r=e.doc,a=Object(h.useContext)(Pe.a);return Object(h.useMemo)((function(){return t||(r?Object(O.g)(n,r.file):a?void 0:"/")}),[t,r,a,n])};var Tn=function(e){var t=e.noteId,n=e.title,r=e.setTitle,a=e.serviceClient,i=Object(h.useCallback)(a?function(e){var i;if("insertLineBreak"===(null===(i=e.nativeEvent)||void 0===i?void 0:i.inputType))return window.document.querySelector(".ProseMirror").focus();var o=e.target.value.replace(/[\r\t\n\xa0]+/g," ");n!=o&&(r(o),a.setTitle(t,o))}:function(){},[t,n,r,a]);Object(h.useEffect)((function(){a&&a.onTitleUpdated(t,(function(e){n!=e&&r(e)}))}),[n,r,a,t]);var o=Object(h.useMemo)(O.d,[]);return Object(h.useEffect)((function(){document.title=n&&""!=n?"".concat(n," - ").concat(o):o}),[o,n]),{onLocalTitleChange:i}},An=n("MsT6"),Ln=n("XyBq"),Rn=n("N9qa");function Un(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function zn(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Un(Object(n),!0).forEach((function(t){R()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Un(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Fn(e){var t,n,r=Object(w.useClient)(),a=e.noteId,i=e.readOnly,o=Object(j.useI18n)().t,s=Object(rt.a)(p.h),c=s.loading,l=s.isSharingShortcutCreated,u=Object(h.useRef)(),d=Object(F.A)(),f=De(a),v=Object(w.useQuery)(f.definition,f.options);Dn();var g=Object(h.useContext)(Pe.a),b=Object(h.useContext)(ht),y=b.doc,O=b.serviceClient,k=b.status,E=b.title,P=b.setTitle,x=In({returnUrl:e.returnUrl||(null==d||null===(t=d.state)||void 0===t?void 0:t.returnUrl),cozyClient:r,doc:y}),C=Pn({noteId:a,serviceClient:O,doc:y}),S=Tn({noteId:a,title:E,setTitle:P,serviceClient:O}).onLocalTitleChange,M=Nn({doc:y,collabProvider:C}),_=M.forceSync,D=M.emergencySync;Object(An.a)("beforeunload",(function(){_()})),Object(h.useEffect)((function(){return _}),[a,y,_]);var N=Object(h.useCallback)((function(){return C.isDirty()}),[C]),I=Object(Rn.a)({activate:N,onLeave:D,title:o("Notes.Editor.exit_confirmation_title"),message:o("Notes.Editor.exit_confirmation_message"),leaveLabel:o("Notes.Editor.exit_confirmation_leave"),cancelLabel:o("Notes.Editor.exit_confirmation_cancel")}),T=I.exitConfirmationModal,A=I.requestToLeave,L=null==v?void 0:v.data,R=null!==(n=null==L?void 0:L.trashed)&&void 0!==n&&n,U=i||R,z=nt(window.location.pathname)&&!c&&!l;return vn("client",r),vn("notes.service",O),vn("notes.collabProvider",C),vn("notes.channel",C&&C.channel),vn("notes.noteId",a),vn("notes.doc",y&&zn(zn({},y.doc),{},{version:y.version})),vn("notes.file",y&&y.file),vn("notes.returnUrl",x),y&&L?m.a.createElement(m.a.Fragment,null,m.a.createElement(w.RealTimeQueries,{doctype:"io.cozy.files"}),m.a.createElement(At.a,{bannerRef:u,readOnly:U,onTitleChange:S,onTitleBlur:D,collabProvider:C,defaultTitle:o("Notes.Editor.title_placeholder"),defaultValue:zn(zn({},y.doc),{},{version:y.version}),title:E&&E.length>0?E:void 0,headerMenu:m.a.createElement(ze,{leftComponent:m.a.createElement(Nt,{returnUrl:x,file:L,requestToLeave:A}),rightComponent:m.a.createElement(ut,{file:L,isPublic:g,isReadOnly:U,title:E}),bannerComponent:R?m.a.createElement(Pt,{noteId:a,isPublic:g,returnUrl:x}):z?m.a.createElement(Ln.a,{previewPath:p.h}):null,homeHref:C.serviceClient.cozyClient.getStackClient().uri,isPublic:g,file:L})}),m.a.createElement(Yt,{collabProvider:C,bannerRef:u}),T):"failed"===k||"failed"===v.fetchStatus?m.a.createElement(Tt,{returnUrl:x}):m.a.createElement(It,null)}Fn.propTypes={noteId:xe.a.string.isRequired,readOnly:xe.a.bool.isRequired,userName:xe.a.string,returnUrl:xe.a.oneOfType([xe.a.string,xe.a.bool])};var Bn=Object(b.a)()((function(e){var t=e.t;return m.a.createElement(I.a,{icon:"unlink",title:t("Error.unshared_title"),text:t("Error.unshared_text")})})),Vn=function(){var e=Object(w.useClient)(),t=e.getInstanceOptions().subdomain,n=Object(F.D)();return Object(h.useEffect)((function(){(function(){var r=i()(d.a.mark((function r(){var a,i,o,s;return d.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,Object(O.a)(e);case 2:a=r.sent,i=a.data,o=Object(w.generateWebLink)({slug:"notes",cozyUrl:e.getStackClient().uri,subDomainType:t,pathname:"/"}),s="/n/".concat(i.id),n(s,{replace:!0,state:{returnUrl:o}});case 7:case"end":return r.stop()}}),r)})));return function(){return r.apply(this,arguments)}})()()}),[e,t,n]),m.a.createElement(ve.b,{size:"xxlarge",middle:!0})},Wn=n("qvrG"),qn=n("G9XN"),Gn=n.n(qn),Kn=n("rUPj"),Hn=n.n(Kn),Qn=n("kLK4"),Jn=n("sHKu"),Xn=n("Jbzi"),$n=n("9Y1u"),Zn=n("WY6r"),Yn=n("N8wp"),er=n("CBSd"),tr=n("5z4W"),nr=f.b(F.h),rr=function(){var e=Object(F.I)().id,t=Object(O.h)();return m.a.createElement(mt,{noteId:e},m.a.createElement(Fn,{noteId:e,returnUrl:t,readOnly:!1}))},ar=function(){var e=Object(F.A)(),t=Object(F.D)(),n=e.state,a=function(){return m.a.createElement(Qn.a,l()({onClose:function(){return t(-1)}},n.shareModalProps))};return m.a.createElement(m.a.Fragment,null,m.a.createElement(nr,{location:(null==n?void 0:n.backgroundLocation)||e},m.a.createElement(F.e,{path:r.New,element:m.a.createElement(Vn,null)}),m.a.createElement(F.e,{path:r.Root,element:m.a.createElement(Ee,null)}),m.a.createElement(F.e,{path:r.Editor,element:m.a.createElement(rr,null)}),Oe.BarRoutes.map((function(e){return e}))),(null==n?void 0:n.backgroundLocation)&&(null==n?void 0:n.shareModalProps)&&m.a.createElement(nr,null,m.a.createElement(F.e,{path:r.ShareFromEditor,element:m.a.createElement(a,null)}),m.a.createElement(F.e,{path:r.ShareFromList,element:m.a.createElement(a,null)})))},ir={bottom:"4.5rem"},or=function(){var e=Object(w.useClient)(),t=Object($.default)().isMobile,n=Object(h.useState)(null),r=s()(n,2),a=r[0],o=r[1],c=Object(h.useState)(!1),l=s()(c,2),u=l[0],f=l[1],v=Object(h.useMemo)((function(){return Object(O.h)()}),[]),g=Object(rt.a)(p.h),b=g.loading,y=g.isSharingShortcutCreated,k=g.addSharingLink,E=nt(window.location.pathname),P=t&&E&&!b&&!y;return Object(h.useEffect)((function(){(function(){var t=i()(d.a.mark((function t(){var n,r,a,i,s,c;return d.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,!(n=new URLSearchParams(window.location.search)).has("id")){t.next=11;break}return r=n.get("id"),t.next=6,Object(O.b)(e,r);case 6:a=t.sent,f(a),o(r),t.next=18;break;case 11:return t.next=13,Object(O.i)(e);case 13:i=t.sent,s=i.id,c=i.readOnly,f(c),o(s);case 18:t.next=23;break;case 20:t.prev=20,t.t0=t.catch(0),o(!1);case 23:case"end":return t.stop()}}),t,null,[[0,20]])})));return function(){return t.apply(this,arguments)}})()()}),[e]),a?m.a.createElement(mt,{noteId:a},m.a.createElement(Fn,{readOnly:u,noteId:a,returnUrl:v}),P&&m.a.createElement(Jn.a,{link:k,isSharingShortcutCreated:y,style:ir})):null!==a?m.a.createElement(Bn,null):m.a.createElement(ve.b,{size:"xxlarge",middle:!0})},sr=function(e){var t=e.isPublic,n=Object(w.useClient)(),r=Object($.default)().isMobile,a=Object(er.a)().ClientErrors,i=Object(j.useI18n)().t,o=r?Object(tt.a)(n.getInstanceOptions().app.name,tr.name):"";return m.a.createElement(m.a.Fragment,null,m.a.createElement(B.HashRouter,null,m.a.createElement(Zn.b,{monoColumn:!0},m.a.createElement(Oe.BarComponent,{isPublic:t}),!t&&r&&m.a.createElement(Oe.BarCenter,null,m.a.createElement(Xn.a,null,o)),m.a.createElement(Zn.c,null,m.a.createElement(Zn.a,{className:r?"":"u-m-0 u-bdrs-0"},m.a.createElement(X.a,null,t?m.a.createElement(or,null):m.a.createElement(ar,null)),m.a.createElement(w.RealTimeQueries,{doctype:"io.cozy.settings"}))),m.a.createElement($n.a,null),m.a.createElement(Yn.a,{t:i}),dn()("debug")&&m.a.createElement(Gn.a,null))),m.a.createElement(a,null))},cr=function(e){var t=e.children;return e.isPublic?(Hn()("info","is public"),t):(Hn()("info","is not public"),m.a.createElement(Wn.DataProxyProvider,null,t))};t.default=function(e){return m.a.createElement(cr,null,m.a.createElement(Oe.BarProvider,null,m.a.createElement($.BreakpointsProvider,null,m.a.createElement(sr,e))))}},YDHN:function(e,t,n){e.exports={"saving-indicator":"saving-indicator--rzoXB"}},bOB9:function(e,t,n){"use strict";n.d(t,"j",(function(){return k})),n.d(t,"h",(function(){return E})),n.d(t,"c",(function(){return P})),n.d(t,"b",(function(){return _})),n.d(t,"i",(function(){return N})),n.d(t,"f",(function(){return T})),n.d(t,"e",(function(){return A})),n.d(t,"g",(function(){return L})),n.d(t,"d",(function(){return R})),n.d(t,"a",(function(){return U})),n.d(t,"l",(function(){return G})),n.d(t,"k",(function(){return K}));var r=n("J58c"),a=n.n(r),i=n("HZZ/"),o=n.n(i),s=n("XkwL"),c=n.n(s),l=n("hJxD"),u=n.n(l),d=n("6mlU"),p=n("/yh+"),f=n.n(p),h=n("xEu0"),m=n("v2Ur"),v=n("5z4W"),g=n.n(v);function b(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function y(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?b(Object(n),!0).forEach((function(t){a()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):b(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function O(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return w(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return w(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function w(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function k(e){return new URL(e.getStackClient().uri).hostname+Math.floor(100*Math.random())}function E(){var e,t=O(new URLSearchParams(window.location.search));try{for(t.s();!(e=t.n()).done;){var n=c()(e.value,2),r=n[0],a=n[1];if("returnUrl"===r)return a}}catch(i){t.e(i)}finally{t.f()}}function P(e,t,n){return j.apply(this,arguments)}function j(){return(j=o()(u.a.mark((function e(t,n,r){var a,i,o;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=h.models.note.fetchURL(t,n),i=window.location.toString(),e.t0=URL,e.next=5,a;case 5:return e.t1=e.sent,(o=new e.t0(e.t1)).searchParams.set("returnUrl",r||i),e.abrupt("return",o.toString());case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function x(e){return C.apply(this,arguments)}function C(){return(C=o()(u.a.mark((function e(t){var n,r,a;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.collection("io.cozy.permissions").fetchOwnPermissions();case 2:if(n=e.sent,r=f()(n,"data.attributes.permissions")){e.next=6;break}throw"can't get self permissions";case 6:return a=Object.values(r),e.abrupt("return",a.filter((function(e){return h.models.permission.isForType(e,"io.cozy.files")})));case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function S(e,t){return M.apply(this,arguments)}function M(){return(M=o()(u.a.mark((function e(t,n){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",t.query(t.find("io.cozy.files").getById(n)).then((function(e){return e&&e.data})));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function _(e,t){return D.apply(this,arguments)}function D(){return(D=o()(u.a.mark((function e(t,n){var r;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,S(t,n);case 2:return r=e.sent,e.abrupt("return",h.models.permission.isDocumentReadOnly({document:r,client:t,writability:["PATCH"]}));case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function N(e){return I.apply(this,arguments)}function I(){return(I=o()(u.a.mark((function e(t){var n,r,a,i;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,x(t);case 2:if(!((n=e.sent.filter((function(e){return h.models.permission.isForType(e,"io.cozy.files")&&e.values&&e.values.length>0}))).length<1)){e.next=7;break}throw new Error("No individual io.cozy.files permissions in current context");case 7:(n.length>1||n[0].values.length>1)&&console.warn("There are more than one permission for a file in current context. Let's take the first one, but it may not be the one you expect");case 8:return r=n[0],a=r.values[0],i=h.models.permission.isReadOnly(r,{writability:["PATCH"]}),e.abrupt("return",{id:a,readOnly:i});case 12:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function T(e){return"/folder/".concat(e)}function A(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=new URL(e.getStackClient().uri),r=e.getInstanceOptions(),a=r.subdomain,i="drive",o=null!==t?T(t):"",s=Object(h.generateWebLink)({cozyUrl:n.origin,slug:i,pathname:"/",subDomainType:a,hash:o});return s}function L(e,t){return A(e,h.models.file.getParentFolderId(t))}function R(){var e=Object(m.b)(),t=Object(m.a)(e.app.prefix||g.a.name_prefix,""),n=Object(m.a)(e.app.name,g.a.name);return""!=t?"".concat(t," ").concat(n):n}function U(e){return e.getStackClient().fetchJSON("POST","/notes",{data:{type:"io.cozy.notes.documents",attributes:{title:"",schema:y(y({},d.b),{},{version:d.c})}}})}var z=6e4,F=60*z,B=24*F,V=31*B,W=365*B,q=[[1e4,"just_now",1e3,1],[1*z,"secs_ago",1e3,10],[2*z,"min_ago",z,1],[5*z,"mins_ago",z,1],[20*z,"mins_ago",z,5],[1*F,"mins_ago",z,10],[2*F,"hour_ago",F,1],[1*B,"hours_ago",F,1],[2*B,"day_ago",B,1],[1*V,"days_ago",B,1],[2*V,"month_ago",V,1],[1*W,"monthes_ago",V,1],[2*W,"year_ago",W,1],[1/0,"years_ago",W,1]];function G(e,t){var n=(t||q).find((function(t){return e<t[0]})),r=c()(n,4),a=r[1],i=r[2],o=r[3];return{key:a,unit:i,coef:o,time:Math.floor(e/i/o)*o,interval:i*o}}function K(){var e=new URLSearchParams(window.location.search);return e.has("username")?e.get("username"):null}},bcvt:function(e,t,n){e.exports={empty:"empty--FqnXy",appHeader:"appHeader--2ilS0",tableSpecialRow:"tableSpecialRow--4oekp",tableCellEmpty:"tableCellEmpty--21fZ1",tableCellName:"tableCellName--2Jak9",tableCell:"tableCell--3-jDP",tableRow:"tableRow--3SicR",notable:"notable--tK8uq",actionMenuItem:"actionMenuItem--17ajc"}},bfH1:function(e,t,n){"use strict";var r=n("LGLP"),a=n.n(r),i=n("XkwL"),o=n.n(i),s=n("V3Qr"),c=n("igqv"),l=n("upXl"),u=n.n(l),d={allowBreakout:!0,allowTextColor:!0,allowTextAlignment:!0,allowIndentation:!0,allowTables:{allowColumnSorting:!0,allowColumnResizing:!0,allowMergeCells:!0,allowNumberColumn:!0,allowBackgroundColor:!0,allowHeaderRow:!0,allowHeaderColumn:!0,permittedLayouts:"all",stickToolbarToBottom:!0},allowPanel:!0,allowStatus:!0,allowRule:!0,allowDate:!0,allowTasksAndDecisions:!0},p=n("HZZ/"),f=n.n(p),h=n("hJxD"),m=n.n(h),v=n("4vUV"),g=n("uU7o");var b=n("N8wp"),y=function(e,t){switch(null==e?void 0:e.type){case v.e.Drop:return w(e,t);case v.e.Paste:return k(e,t);default:return O(t)}},O=function(e){var t=document.createElement(v.c.Input);t.setAttribute("accept","image/*"),t.type=v.f.File,t.dispatchEvent(new MouseEvent(v.e.Click)),t.addEventListener(v.e.Change,(function(){var n;return e(null===(n=t.files)||void 0===n?void 0:n[0])}))},w=function(e,t){var n,r,a=e.dataTransfer;return(1===(null==(r=null==a?void 0:a.files)?void 0:r.length)||(b.a.error("Error.only_one_image"),!1))&&t(null==a||null===(n=a.files)||void 0===n?void 0:n[0])},k=function(e,t){var n,r=e.clipboardData;return t(null==r||null===(n=r.files)||void 0===n?void 0:n[0])},E=function(e,t,n){var r=new window.FileReader;if(!n)throw Error(v.d.NoFileFoundAfterInput);r.readAsArrayBuffer(n),r.onloadend=f()(m.a.mark((function a(){var i,o,s;return m.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(i=Object(g.a)(r.result)){a.next=3;break}throw Error(v.d.FileNotProcessable);case 3:return a.prev=3,e.setUploading(!0),a.next=7,e.collabProvider.serviceClient.postImage(n.name,e.collabProvider.config.noteId,i,n.type);case 7:o=a.sent,s=o.data.id,t({src:s}),a.next=15;break;case 12:a.prev=12,a.t0=a.catch(3),b.a.error(e.t(void 0!==a.t0.status?"Error.".concat(a.t0.status):"Error.unknown_error"),{duration:4e3});case 15:return a.prev=15,e.setUploading(!1),a.finish(15);case 18:case"end":return a.stop()}}),a,null,[[3,12,15,18]])})))},P=n("ivGQ"),j=n.n(P),x=n("bQqJ"),C=n("UuKj"),S=n("9WMr"),M=n("MHrW"),_=n("Aaol");var D=function(){};t.a=function(e){var t=e.defaultValue,n=e.onTitleChange,r=e.onTitleBlur,i=e.defaultTitle,l=e.title,p=e.collabProvider,f=e.onContentChange,h=e.readOnly,m=e.bannerRef,v=e.headerMenu,g=e.isIntent,b=e.children,O=Object(_.useI18n)().t,w=Object(P.useRef)(null),k=Object(P.useCallback)((function(e){n&&n(e)}),[n]);Object(P.useMemo)((function(){return p&&p.setReadOnly(!!h)}),[h,p]);var N=Object(P.useMemo)((function(){return p&&{useNativePlugin:!0,provider:Promise.resolve(p),inviteToEditHandler:function(){},isInviteToEditButtonSelected:!1,userId:p.serviceClient.getSessionId()}}),[p]);Object(P.useEffect)((function(){var e;(e=w.current)&&(e.style.height="".concat(e.scrollHeight,"px"))}),[l]),Object(M.default)(w.current,"blur",r);var I,T=Object(P.useState)(!1),A=o()(T,2),L=A[0],R=A[1];return j.a.createElement("article",{className:"".concat(u.a["note-article"]).concat(g?" "+u.a["note-article--intents"]:"")},L&&j.a.createElement(S.a,null,j.a.createElement(x.b,{size:"xxlarge",middle:!0})),j.a.createElement("style",null,"#coz-bar ","{ display: none }"),v,j.a.createElement("section",{className:"note-editor-container"},j.a.createElement(s.a,a()({},d,{disabled:!p&&h,collabEdit:N,onChange:f||D,defaultValue:t,appearance:"full-page",placeholder:O("Notes.EditorView.main_placeholder"),shouldFocus:!h,legacyImageUploadProvider:(I={collabProvider:p,t:O,setUploading:R},Promise.resolve((function(e,t){return y(e,(function(e){return E(I,t,e)}))}))),contentComponents:j.a.createElement(c.a,{render:function(e){return j.a.createElement(j.a.Fragment,null,j.a.createElement("aside",{ref:m,className:u.a.banner}),j.a.createElement(C.default,{ref:w,className:u.a.title,multiline:!0,minRows:1,value:l,placeholder:i,fullWidth:!0,InputProps:{disableUnderline:!0},inputProps:{className:u.a.titleInput,readOnly:!!h},onChange:h?D:k}),j.a.Children.map(b,(function(t){return j.a.isValidElement(t)?j.a.cloneElement(t,{actions:e}):null})))}})}))))}},bxsC:function(e,t,n){"use strict";var r,a,i,o=n("J58c"),s=n.n(o),c=n("ivGQ"),l=n.n(c),u=n("iu8y"),d=n("zw+H"),p=n("EPWR"),f=n("HZZ/"),h=n.n(f),m=n("GeFe"),v=n.n(m),g=n("Zvb3"),b=n.n(g),y=n("hJxD"),O=n.n(y),w=n("Y/FK"),k=n.n(w),E=n("4z1N"),P=n("ut+C"),j=n("Lu4+"),x=n("uF5U"),C=n("l+VE"),S=n.n(C),M=n("9Jaj"),_=n("3xVv"),D=n("yCbO"),N=n.n(D),I=n("Czyx"),T=n("wjgK"),A=n("2KGD"),L=n("8DMk"),R=n.n(L),U=n("VCdh"),z=n("J/YY"),F=n.n(z),B=n("a1Fv"),V=n.n(B),W=n("g3eI"),q=n.n(W),G=n("wDGE"),K=n.n(G),H=n("K5K7"),Q=n("+k3U"),J=n("y3D9"),X=n("GyuN"),$=n("qheH"),Z=n("k359"),Y=I.default.figure(r||(r=N()(["\n  margin: 0;\n"])));Y.displayName="FigureWrapper";var ee=I.default.div(a||(a=N()(["\n  position: absolute;\n  width: 100%;\n  height: 100%;\n"]))),te=I.default.div(i||(i=N()(["\n  width: 100%;\n  position: relative;\n  padding-bottom: ","%;\n"])),(function(e){return e.dimensions.height/e.dimensions.width*100})),ne=function(e){var t=e.dimensions,n=e.children,r=e.onContextMenu;return l.a.createElement(te,{dimensions:t,onContextMenuCapture:r},l.a.createElement(ee,null,n))},re=n("4vUV"),ae=n("xEu0");function ie(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function oe(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ie(Object(n),!0).forEach((function(t){s()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ie(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function se(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=K()(e);if(t){var a=K()(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return q()(this,n)}}var ce,le,ue=function(e){V()(r,e);var t,n=se(r);function r(e){var t;v()(this,r),t=n.call(this,e),s()(F()(t),"mediaPluginState",void 0),s()(F()(t),"state",{imageUrl:"",imageError:"",imageLoading:!0}),s()(F()(t),"realtimeSubscription",void 0),s()(F()(t),"setViewMediaClientConfig",h()(O.a.mark((function e(){var n,r;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.props.mediaProvider;case 2:(n=e.sent)&&(r=n.viewMediaClientConfig,t.setState({viewMediaClientConfig:r}));case 4:case"end":return e.stop()}}),e)})))),s()(F()(t),"selectMediaSingleFromCard",(function(e){var n=e.event;t.selectMediaSingle(n)})),s()(F()(t),"selectMediaSingle",(function(e){e.stopPropagation();var n=t.props.getPos(),r=t.props.view.state;if(e.shiftKey){if(r.selection instanceof X.a)return;Object($.g)(t.props.view,r.selection.from<n?r.selection.from:n-1,r.selection.to>n?r.selection.to:n+2)}else Object($.f)(t.props.view,n-1)})),s()(F()(t),"fetchCozyImage",h()(O.a.mark((function e(){var n,r,a,i,o,s,c,l,u;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.setState({imageError:""}),t.state.collabEditProvider){e.next=3;break}throw Error(re.d.MissingCollabEdit);case 3:return n=t.state.collabEditProvider,r=n.serviceClient,a=n.config.noteId,e.prev=4,e.next=7,r.cozyClient.query(Object(ae.Q)(re.a.Files).getById(a));case 7:if(o=e.sent){e.next=10;break}throw Error(re.d.CouldNotGetNoteImages);case 10:if(s=null===(i=o.included)||void 0===i?void 0:i.find((function(e){return e.id===t.props.node.attrs.url}))){e.next=28;break}return e.prev=12,c=t.props.node.attrs.url,l=a,e.next=17,r.cozyClient.getStackClient().fetchJSON("POST","/notes/".concat(c,"/copy?To=").concat(l));case 17:if(u=e.sent){e.next=20;break}throw Error("failed to POST /notes/:id/copy");case 20:return t.mediaPluginState.updateMediaNodeAttrs(t.props.getPos().toString(),oe(oe({},t.props.node.attrs),{},{url:u.data.id}),!0),e.abrupt("return",t.setState({imageUrl:"".concat(r.stackClient.uri).concat(u.data.links.self),imageLoading:!1}));case 24:throw e.prev=24,e.t0=e.catch(12),console.error(re.d.CouldNotCopyImage),e.t0;case 28:!s.attributes.willBeResized&&t.setState({imageUrl:"".concat(r.stackClient.uri).concat(s.links.self),imageLoading:!1}),e.next=35;break;case 31:e.prev=31,e.t1=e.catch(4),t.setState({imageError:e.t1.message,imageLoading:!1}),console.error(e.t1);case 35:case"end":return e.stop()}}),e,null,[[4,31],[12,24]])})))),s()(F()(t),"subscribeToImageUpdate",(function(){var e;return null===(e=t.state.collabEditProvider)||void 0===e?void 0:e.serviceClient.realtime.subscribe(re.g.Updated,re.a.NoteEvents,t.state.collabEditProvider.config.noteId,(function(e){var n=e.image_id;t.props.node.attrs.url.includes(n)&&t.setState({imageLoading:!0},t.fetchCozyImage)}))})),s()(F()(t),"handleNewNode",(function(e){var n=e.node;t.mediaPluginState.handleMediaNodeMount(n,(function(){return t.props.getPos()}))}));var a=t.props.view;return t.mediaPluginState=Z.a.getState(a.state),t}return b()(r,[{key:"shouldComponentUpdate",value:function(e,t){var n=!this.state.viewMediaClientConfig&&t.viewMediaClientConfig;return!(this.state.imageUrl===t.imageUrl&&this.state.imageError===t.imageError&&this.props.selected===e.selected&&this.props.uploadComplete===e.uploadComplete&&this.props.node.attrs.id===e.node.attrs.id&&this.props.node.attrs.collection===e.node.attrs.collection&&this.props.maxDimensions.height===e.maxDimensions.height&&this.props.maxDimensions.width===e.maxDimensions.width&&this.props.contextIdentifierProvider===e.contextIdentifierProvider&&this.props.isLoading===e.isLoading&&this.props.mediaProvider===e.mediaProvider&&!n)}},{key:"componentDidMount",value:(t=h()(O.a.mark((function e(){var t,n,r;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.handleNewNode(this.props),t=this.props,n=t.contextIdentifierProvider,r=t.collabEditProvider,e.t0=this,e.next=5,n;case 5:return e.t1=e.sent,e.next=8,r;case 8:return e.t2=e.sent,e.t3={contextIdentifierProvider:e.t1,collabEditProvider:e.t2},e.t0.setState.call(e.t0,e.t3),this.realtimeSubscription=this.subscribeToImageUpdate(),e.next=14,this.fetchCozyImage();case 14:return e.next=16,this.setViewMediaClientConfig();case 16:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"componentWillUnmount",value:function(){var e,t=this.props.node;null===(e=this.realtimeSubscription)||void 0===e||e.unsubscribe(),this.mediaPluginState.handleMediaNodeUnmount(t)}},{key:"componentDidUpdate",value:function(e){e.node.attrs.id!==this.props.node.attrs.id&&(this.mediaPluginState.handleMediaNodeUnmount(e.node),this.handleNewNode(this.props)),this.mediaPluginState.updateElement(),this.setViewMediaClientConfig()}},{key:"render",value:function(){var e=this.props,t=e.node,n=e.selected,r=e.uploadComplete,a=e.originalDimensions,i=e.isLoading,o=e.maxDimensions,s=e.mediaOptions,c=this.state,u=c.viewMediaClientConfig,d=c.contextIdentifierProvider,p=t.attrs,f=p.id,h=p.type,m=p.collection,v=p.url,g=p.alt;if(this.state.imageLoading||!this.state.imageUrl||this.state.imageError||i||"external"!==h&&(!u||"boolean"==typeof r&&!r))return l.a.createElement(ne,{dimensions:a},l.a.createElement(Q.a,null));var b=d&&d.objectId,y="external"===h?{dataURI:this.state.imageUrl,name:v,mediaItemType:"external-image"}:{id:f,mediaItemType:"file",collectionName:m},O=u||{authProvider:function(){return{}}};return l.a.createElement(ne,{dimensions:a,onContextMenu:this.selectMediaSingle},l.a.createElement(J.a,{mediaClientConfig:O,resizeMode:"stretchy-fit",dimensions:o,originalDimensions:a,identifier:y,selectable:!0,selected:n,disableOverlay:!0,onClick:this.selectMediaSingleFromCard,useInlinePlayer:s&&s.allowLazyLoading,isLazy:s&&s.allowLazyLoading,featureFlags:s&&s.featureFlags,contextId:b,alt:g}))}}]),r}(c.Component),de=Object(H.a)(ue),pe=I.default.div(ce||(ce=N()(["\n  color: ",";\n  background: ",";\n  border-radius: ","px;\n  margin: 5px 3px 25px;\n  width: ","px;\n  min-height: ","px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n"])),Object(U.J)(A.B400,.4)||A.B400,Object(U.J)(A.B300,.6)||A.B300,Object(T.c)(),156,125),fe=I.default.div(le||(le=N()(["\n  background: ",";\n  border-radius: ","px;\n  margin: 2px 0;\n  width: 100%;\n  height: 2px;\n"])),A.B200,Object(T.c)()),he=function(e){var t=e.type;return"single"===(void 0===t?"group":t)?l.a.createElement(fe,null):l.a.createElement(pe,null,l.a.createElement(R.a,{label:"Document",size:"medium"}))},me=n("iO45"),ve=n("3mYb"),ge=n("PuAp"),be=n("CDNI"),ye=n("3Su3"),Oe=n("44lN"),we=n("AV8T"),ke=n("3sCF"),Ee=function(e,t){var n="";return 1===e.length?n=e[0].fileMimeType||"unknown":e.length>1&&(n="multiple"),{action:we.a.INSERTED,actionSubject:we.b.DOCUMENT,actionSubjectId:we.c.MEDIA,attributes:{type:we.c.MEDIA_GROUP,inputMethod:t,fileExtension:n},eventType:we.d.TRACK}};var Pe=function(e,t,n,r){var a=e.state,i=e.dispatch,o=a.tr,s=a.schema,c=s.nodes,l=c.media,u=c.paragraph;if(l&&t.length){var d=je(t,n,l),p=Ce(a),f=o.doc.resolve(p).parent,h=o.doc.nodeAt(p),m=!function(e){var t=e.schema,n=e.selection.$anchor.node();return n&&n.type===t.nodes.mediaGroup}(a)&&Object(Oe.e)(a,me.Fragment.from(a.schema.nodes.mediaGroup.createChecked({},d))),v=function(e,t){var n=e.schema.nodes.media,r=t&&t.type===n;return(Object(ve.j)(e)||Object(ve.n)(e)||Object(ve.m)(e)||Object(ye.d)(e)&&(!Object(be.h)(e)||Object(be.e)(e)))&&!r}(a,h),g=f.type===s.nodes.mediaGroup?d:[s.nodes.mediaGroup.createChecked({},d)];if(m){g=v?g.concat(u.create()):g;var b=Se(a);return b?p<=b.start?o.deleteRange(b.start,b.end).insert(p,g):o.insert(p,g).deleteRange(b.start,b.end):o.insert(p,g),Object(ke.a)(a,o,Ee(t,r)),i(o),void _e(e)}v&&f.type!==s.nodes.mediaGroup&&g.push(u.create()),Object(ke.a)(a,o,Ee(t,r)),i(Object(M.safeInsert)(me.Fragment.fromArray(g),p)(o))}},je=function(e,t,n){return e.map((function(e){var r=e.id,a=n.create({id:r,type:"file",collection:t});return Object(be.a)(e,a),a}))},xe=function(e){var t=e.schema.nodes,n=t.mediaGroup,r=t.listItem;if(Object(M.hasParentNode)((function(e){return e.type===r}))(e.selection)){var a=function(e){var t=e.schema.nodes,n=t.bulletList,r=t.orderedList;return Object(ge.b)((function(e){return e.type===n||e.type===r}))(e.selection.$from)}(e);if(a){var i=a.pos+a.node.nodeSize,o=e.doc.nodeAt(i);return o&&o.type===n?i+1:i}}},Ce=function(e){var t=e.selection,n=t.$from,r=t.$to,a=xe(e);if(a)return a;var i=Object(be.f)(e);return i&&(!Object(be.e)(e)||n.pos<i&&r.pos<i)?i:Object(be.e)(e)?r.pos:Object(ye.c)(e)?r.pos+1:Object(ye.a)(e)?n.pos-1:r.pos},Se=function(e){var t=e.selection,n=t.$from,r=t.$to;if(!Object(be.g)(e))return!Object(be.c)(e)||Object(be.f)(e)?Me(n.pos,r.pos):Me(Object(ye.f)(n)-1,Object(ye.e)(r))},Me=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e;return{start:e,end:t}},_e=function(e){var t=e.state,n=t.doc,r=Object(be.f)(t);if(r){var a=n.resolve(r),i=Object(ye.e)(a);i+1>=n.nodeSize-1?Object($.f)(e,r):Object($.g)(e,i+1)}},De=n("CW9m");function Ne(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}var Ie=function(e,t){return e.mediaNodes.reduce((function(e,n){return e||(n.node.attrs.id===t?n:e)}),null)},Te=function(e,t,n){return n?Ie(e,t):e.mediaGroupNodes[t]},Ae=function(e,t){return e.mediaOptions&&e.mediaOptions.allowMarkingUploadsAsIncomplete&&"boolean"==typeof e.mobileUploadComplete[t]?e.mobileUploadComplete[t]:void 0},Le=function(e,t,n){return function(r,a){var i,o=Z.a.getState(r);if(n)i=function(e,t){return e.mediaNodes.filter((function(e){return e.node.attrs.id===t}))}(o,e);else{var s=Te(o,e,n);i=s?[s]:[]}var c=r.schema.nodes.media;if(0===(i=i.filter((function(e){var t;try{t=r.doc.nodeAt(e.getPos())}catch(n){return!1}return t&&t.type===c}))).length)return!1;if(a){var l=r.tr;i.forEach((function(e){var n=e.getPos;return l.step(new De.a(n(),t))})),l.setMeta("addToHistory",!1),a(l)}return!0}},Re=function(e,t,n){return function(r,a){var i=Z.a.getState(r),o=Te(i,e,n);if(!o){var s=i.mediaNodes.find((function(t){return t.getPos().toString()===e}));return!!s&&(null==a||a(r.tr.step(new De.a(s.getPos(),t)).setMeta("addToHistory",!1)),!0)}return a&&a(r.tr.step(new De.a(o.getPos(),t)).setMeta("addToHistory",!1)),!0}},Ue=function(e,t){return function(n,r){return!!r&&(r(n.tr.step(new De.a(e,function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ne(Object(n),!0).forEach((function(t){s()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ne(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({type:"file",url:null},t))).setMeta("addToHistory",!1)),!0)}},ze=n("2AuG"),Fe=function(){function e(t,n,r){var a=this,i=(arguments.length>3&&void 0!==arguments[3]||ze.d,arguments.length>4?arguments[4]:void 0);v()(this,e),s()(this,"picker",void 0),s()(this,"onDragListeners",[]),s()(this,"errorReporter",void 0),s()(this,"pickerType",void 0),s()(this,"onStartListeners",[]),s()(this,"eventListeners",{}),s()(this,"analyticsName",void 0),s()(this,"erroredFiles",void 0),s()(this,"handleUploadPreviewUpdate",(function(e){var t=e.file,n=e.preview,r=a.erroredFiles.has(t.id),i=Object(ze.e)(n)?n:{dimensions:void 0,scaleFactor:void 0},o=i.dimensions,s=i.scaleFactor,c={id:t.id,fileName:t.name,fileSize:t.size,fileMimeType:t.type,dimensions:o,scaleFactor:s,status:r?"error":void 0};a.eventListeners[t.id]=[],a.onStartListeners.forEach((function(e){return e(c,(function(e){return a.subscribeStateChanged(t,e)}),a.analyticsName||a.pickerType)}))})),s()(this,"subscribeStateChanged",(function(e,t){var n=a.eventListeners[e.id];n&&n.push(t)})),s()(this,"handleUploadError",(function(e){var t=e.error,n=e.fileId,r=a.eventListeners[n];a.erroredFiles.add(n),r&&(r.forEach((function(e){return e({id:n,status:"error",error:t&&{description:t.description,name:t.name}})})),delete a.eventListeners[n])})),s()(this,"handleMobileUploadEnd",(function(e){var t=e.file,n=a.eventListeners[t.id];n&&n.forEach((function(e){return e({id:t.id,status:"mobile-upload-end",fileMimeType:t.type,collection:t.collectionName,publicId:t.publicId})}))})),s()(this,"handleReady",(function(e){var t=e.file,n=a.eventListeners[t.id];n&&(n.forEach((function(e){return e({id:t.id,status:"ready"})})),delete a.eventListeners[t.id])})),this.pickerType=t,this.errorReporter=n.errorReporter,this.analyticsName=i,this.erroredFiles=new Set}var t;return b()(e,[{key:"init",value:(t=h()(O.a.mark((function e(){var t;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("customMediaPicker"!==this.pickerType){e.next=4;break}t=this.picker=this.pickerConfig,e.next=8;break;case 4:if("popup"!==this.pickerType){e.next=8;break}return e.next=7,this.mediaPickerFactoryClass(this.config.mediaClientConfig,this.pickerConfig);case 7:t=this.picker=e.sent;case 8:if(t){e.next=10;break}return e.abrupt("return",this);case 10:return t.on("upload-preview-update",this.handleUploadPreviewUpdate),t.on("upload-end",this.handleReady),t.on("upload-error",this.handleUploadError),t.on("mobile-upload-end",this.handleMobileUploadEnd),e.abrupt("return",this);case 15:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"type",get:function(){return this.pickerType}},{key:"mediaPicker",get:function(){return this.picker}},{key:"destroy",value:function(){var e=this.picker;if(e){e.removeAllListeners("upload-preview-update"),e.removeAllListeners("upload-end"),e.removeAllListeners("upload-error"),this.onStartListeners=[],this.onDragListeners=[];try{"popup"===this.pickerType&&e.teardown()}catch(t){this.errorReporter.captureException(t)}}}},{key:"setUploadParams",value:function(e){this.picker&&this.picker.setUploadParams(e)}},{key:"onClose",value:function(e){var t=this.picker;if("popup"===this.pickerType){var n=t;return n.on("closed",e),function(){return n.off("closed",e)}}return function(){}}},{key:"show",value:function(){if("popup"===this.pickerType)try{this.picker.show()}catch(e){this.errorReporter.captureException(e)}}},{key:"hide",value:function(){"popup"===this.pickerType&&this.picker.hide()}},{key:"onNewMedia",value:function(e){this.onStartListeners.push(e)}},{key:"onDrag",value:function(e){this.onDragListeners.push(e)}}]),e}(),Be=n("ct2w");function Ve(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function We(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ve(Object(n),!0).forEach((function(t){s()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ve(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var qe=["ready","error","cancelled"],Ge=function(){function e(t,n,r,a,i){var o=this;v()(this,e),s()(this,"allowsUploads",!1),s()(this,"mediaClientConfig",void 0),s()(this,"uploadMediaClientConfig",void 0),s()(this,"ignoreLinks",!1),s()(this,"waitForMediaUpload",!0),s()(this,"allUploadsFinished",!0),s()(this,"showDropzone",!1),s()(this,"element",void 0),s()(this,"layout","center"),s()(this,"mediaNodes",[]),s()(this,"mediaGroupNodes",{}),s()(this,"mobileUploadComplete",{}),s()(this,"options",void 0),s()(this,"mediaProvider",void 0),s()(this,"pendingTask",Promise.resolve(null)),s()(this,"view",void 0),s()(this,"destroyed",!1),s()(this,"contextIdentifierProvider",void 0),s()(this,"errorReporter",void 0),s()(this,"popupPicker",void 0),s()(this,"customPicker",void 0),s()(this,"removeOnCloseListener",(function(){})),s()(this,"openMediaPickerBrowser",void 0),s()(this,"onPopupToogleCallback",(function(){})),s()(this,"reactContext",void 0),s()(this,"pickers",[]),s()(this,"pickerPromises",[]),s()(this,"editingMediaSinglePos",void 0),s()(this,"showEditingDialog",void 0),s()(this,"mediaOptions",void 0),s()(this,"dispatch",void 0),s()(this,"onContextIdentifierProvider",function(){var e=h()(O.a.mark((function e(t,n){return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!n){e.next=4;break}return e.next=3,n;case 3:o.contextIdentifierProvider=e.sent;case 4:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()),s()(this,"setMediaProvider",function(){var e=h()(O.a.mark((function e(t){var n,r,a,i;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=5;break}return o.destroyPickers(),o.allowsUploads=!1,o.destroyed||o.view.dispatch(o.view.state.tr.setMeta(Z.a,{allowsUploads:o.allowsUploads})),e.abrupt("return");case 5:return e.prev=5,e.next=8,t;case 8:o.mediaProvider=e.sent,o.mediaProvider.viewMediaClientConfig||(n=o.mediaProvider.viewMediaClientConfig)&&(o.mediaProvider.viewMediaClientConfig=n),S()(o.mediaProvider.viewMediaClientConfig,"MediaProvider promise did not resolve to a valid instance of MediaProvider - ".concat(o.mediaProvider)),e.next=21;break;case 13:return e.prev=13,e.t0=e.catch(5),r=new Error("Media functionality disabled due to rejected provider: ".concat(e.t0.message)),o.errorReporter.captureException(r),o.destroyPickers(),o.allowsUploads=!1,o.destroyed||o.view.dispatch(o.view.state.tr.setMeta(Z.a,{allowsUploads:o.allowsUploads})),e.abrupt("return");case 21:if(o.mediaClientConfig=o.mediaProvider.viewMediaClientConfig,o.allowsUploads=!!o.mediaProvider.uploadMediaClientConfig,a=o.view,i=o.allowsUploads,!o.destroyed&&a.dom.parentNode&&a.dispatch(a.state.tr.setMeta(Z.a,{allowsUploads:i})),!o.allowsUploads){e.next=35;break}if(o.uploadMediaClientConfig=o.mediaProvider.uploadMediaClientConfig,!o.mediaProvider.uploadParams||!o.uploadMediaClientConfig){e.next=32;break}return e.next=30,o.initPickers(o.mediaProvider.uploadParams,Fe,o.reactContext);case 30:e.next=33;break;case 32:o.destroyPickers();case 33:e.next=36;break;case 35:o.destroyPickers();case 36:case"end":return e.stop()}}),e,null,[[5,13]])})));return function(t){return e.apply(this,arguments)}}()),s()(this,"getMediaOptions",(function(){return o.options})),s()(this,"hasUserAuthProvider",(function(){return!!o.uploadMediaClientConfig&&!!o.uploadMediaClientConfig.userAuthProvider})),s()(this,"insertFile",(function(e,t,n){var r=We(We({},e),{},{contextId:o.contextIdentifierProvider?o.contextIdentifierProvider.objectId:void 0}),a=o.collectionFromProvider();if(void 0!==a){o.mediaOptions&&o.mediaOptions.allowMarkingUploadsAsIncomplete&&(o.mobileUploadComplete[r.id]=!1),"error"!==e.status&&o.updateAndDispatch({allUploadsFinished:!1}),Object(_.d)(o.view.state.schema,r.fileMimeType)?Object(_.c)(o.view,r,o.getInputMethod(n),a,o.mediaOptions&&o.mediaOptions.alignLeftOnInsert):Pe(o.view,[r],a,o.getInputMethod(n)),t(o.handleMediaState);var i=function(e){return e.status&&-1!==qe.indexOf(e.status)};i(r)||(o.addPendingTask(new Promise((function(e){t((function(t){i(t)&&e(t)}))}))),o.pendingTask.then((function(){o.updateAndDispatch({allUploadsFinished:!0})})));var s=o.view;s.hasFocus()||s.focus()}})),s()(this,"addPendingTask",(function(e){var t=o.pendingTask,n=function(){return t};o.pendingTask=e.then(n,n)})),s()(this,"splitMediaGroup",(function(){return Object(be.j)(o.view)})),s()(this,"onPopupPickerClose",(function(){o.onPopupToogleCallback(!1)})),s()(this,"shouldUseMediaPickerPopup",(function(){return!o.mediaOptions||o.mediaOptions&&void 0===o.mediaOptions.useMediaPickerPopup?o.hasUserAuthProvider():!!o.mediaOptions.useMediaPickerPopup})),s()(this,"showMediaPicker",(function(){if(o.openMediaPickerBrowser&&!o.shouldUseMediaPickerPopup())return o.openMediaPickerBrowser();o.popupPicker&&(o.popupPicker.show(),o.onPopupToogleCallback(!0))})),s()(this,"setBrowseFn",(function(e){o.openMediaPickerBrowser=e})),s()(this,"onPopupToggle",(function(e){o.onPopupToogleCallback=e})),s()(this,"waitForPendingTasks",(function(e,t){if(t&&o.pendingTask===t)return t;var n,r=o.pendingTask.then((function(){return o.waitForPendingTasks(void 0,o.pendingTask)}));if(!e)return r;var a=new Promise((function(t,r){n=window.setTimeout((function(){return r(new Error("Media operations did not finish in ".concat(e," ms")))}),e)}));return Promise.race([a,r.then((function(e){return clearTimeout(n),e}))])})),s()(this,"handleMediaNodeRemoval",(function(e,t){var n=e;n||(n=o.view.state.doc.nodeAt(t())),Object(be.i)(o.view,n,t)})),s()(this,"handleMediaNodeMount",(function(e,t){o.mediaNodes.unshift({node:e,getPos:t})})),s()(this,"handleMediaNodeUnmount",(function(e){o.mediaNodes=o.mediaNodes.filter((function(t){var n=t.node;return e!==n}))})),s()(this,"findMediaNode",(function(e){return Ie(o,e)})),s()(this,"destroyAllPickers",(function(e){e.forEach((function(e){return e.destroy()})),o.pickers.splice(0,o.pickers.length)})),s()(this,"destroyPickers",(function(){var e=o.pickers,t=o.pickerPromises;t.length===e.length?o.destroyAllPickers(o.pickers):Promise.all(t).then((function(e){return o.destroyAllPickers(e)})),o.popupPicker=void 0,o.customPicker=void 0})),s()(this,"getInputMethod",(function(e){switch(e){case"popup":return we.e.PICKER_CLOUD;case"clipboard":return we.e.CLIPBOARD;case"dropzone":return we.e.DRAG_AND_DROP}})),s()(this,"updateMediaNodeAttrs",(function(e,t,n){var r=o.view;if(r)return Re(e,t,n)(r.state,r.dispatch)})),s()(this,"handleMediaState",(function(e){switch(e.status){case"error":var t=o.options.uploadErrorHandler;t&&t(e);break;case"mobile-upload-end":var n={id:e.publicId||e.id};"string"==typeof e.collection&&(n.collection=e.collection),o.updateMediaNodeAttrs(e.id,n,Object(_.d)(o.view.state.schema,e.fileMimeType)),o.mobileUploadComplete[n.id]=!0,delete o.mediaGroupNodes[e.id]}})),s()(this,"isMobileUploadCompleted",(function(e){return Ae(o,e)})),s()(this,"removeNodeById",(function(e){var t=e.id,n=Te(o,t,Object(Be.a)(e.fileMimeType));n&&Object(be.i)(o.view,n.node,n.getPos)})),s()(this,"removeSelectedMediaContainer",(function(){var e=o.view,t=o.selectedMediaContainerNode();if(!t)return!1;var n=e.state.selection.from;return Object(be.i)(e,t.firstChild,(function(){return n+1})),!0})),s()(this,"selectedMediaContainerNode",(function(){var e=o.view.state,t=e.selection,n=e.schema;if(t instanceof E.NodeSelection&&(t.node.type===n.nodes.mediaSingle||t.node.type===n.nodes.mediaGroup))return t.node})),s()(this,"handleDrag",(function(e){var t="enter"===e;if(o.showDropzone!==t){o.showDropzone=t;var n=o.view;(0,n.dispatch)(n.state.tr)}})),this.reactContext=r,this.options=n,this.mediaOptions=a,this.dispatch=i,this.waitForMediaUpload=void 0===n.waitForMediaUpload||n.waitForMediaUpload;var c=t.schema.nodes;S()(c.media&&(c.mediaGroup||c.mediaSingle),"Editor: unable to init media plugin - media or mediaGroup/mediaSingle node absent in schema"),n.providerFactory.subscribe("mediaProvider",(function(e,t){return o.setMediaProvider(t)})),n.providerFactory.subscribe("contextIdentifierProvider",this.onContextIdentifierProvider),this.errorReporter=n.errorReporter||new x.a}var t;return b()(e,[{key:"updateElement",value:function(){var e,t=this.selectedMediaContainerNode(),n=this.view.state.schema.nodes.mediaSingle;t&&t.type===n&&(e=this.getDomElement(this.view.domAtPos.bind(this.view))),this.element!==e&&(this.element=e)}},{key:"getDomElement",value:function(e){var t=this.view.state,n=t.selection,r=t.schema;if(n instanceof E.NodeSelection&&n.node.type===r.nodes.mediaSingle){var a=Object(M.findDomRefAtPos)(n.from,e);if(a)return a.childNodes.length?a.querySelector(".wrapper")||a:a.parentNode}}},{key:"setView",value:function(e){this.view=e}},{key:"destroy",value:function(){if(!this.destroyed){this.destroyed=!0;var e=this.mediaNodes;e.splice(0,e.length),this.removeOnCloseListener(),this.destroyPickers()}}},{key:"initPickers",value:(t=h()(O.a.mark((function e(t,n,r){var a,i,o,s,c,l,u,d=this;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.destroyed&&this.uploadMediaClientConfig){e.next=2;break}return e.abrupt("return");case 2:if(a=this.errorReporter,i=this.pickers,o=this.pickerPromises,i.length){e.next=26;break}if(s={mediaClientConfig:this.uploadMediaClientConfig,errorReporter:a},c={uploadParams:t,proxyReactContext:r(),useForgePlugins:this.mediaOptions&&this.mediaOptions.useForgePlugins||!1,featureFlags:this.mediaOptions&&this.mediaOptions.featureFlags},!this.options.customMediaPicker){e.next=16;break}return l=new n("customMediaPicker",s,this.options.customMediaPicker).init(),o.push(l),e.t0=i,e.next=12,l;case 12:e.t1=this.customPicker=e.sent,e.t0.push.call(e.t0,e.t1),e.next=25;break;case 16:if(!this.shouldUseMediaPickerPopup()){e.next=25;break}return u=new n("popup",s,c).init(),o.push(u),e.t2=i,e.next=22,u;case 22:e.t3=this.popupPicker=e.sent,e.t2.push.call(e.t2,e.t3),this.removeOnCloseListener=this.popupPicker.onClose(this.onPopupPickerClose);case 25:i.forEach((function(e){e.onNewMedia(d.insertFile)}));case 26:i.forEach((function(e){return e.setUploadParams(t)}));case 27:case"end":return e.stop()}}),e,this)}))),function(e,n,r){return t.apply(this,arguments)})},{key:"collectionFromProvider",value:function(){return this.mediaProvider&&this.mediaProvider.uploadParams&&this.mediaProvider.uploadParams.collection}},{key:"updateAndDispatch",value:function(e){var t=this;Object.keys(e).forEach((function(n){var r=n,a=e[r];void 0!==a&&(t[r]=a)})),this.dispatch&&this.dispatch(Z.a,We({},this))}}]),e}(),Ke=function(e){return Z.a.getState(e)},He=function(e,t,n,r,a){var i=function(e){var t=document.createElement("div");return e?k.a.render(l.a.createElement(he,{type:"single"}),t):k.a.render(l.a.createElement(he),t),t}(a&&a.allowDropzoneDropLine);return new E.Plugin({state:{init:function(e,i){return new Ge(i,t,n,a,r)},apply:function(e,t){"number"==typeof t.editingMediaSinglePos&&(t.editingMediaSinglePos=e.mapping.map(t.editingMediaSinglePos));var n=e.getMeta(Z.a);if(n){var r=n.allowsUploads;t.updateAndDispatch({allowsUploads:void 0===r?t.allowsUploads:r})}return t}},filterTransaction:function(e,t){return!(e.selectionSet&&Object(M.isNodeSelection)(e.selection)&&e.selection.node.type===t.schema.nodes.media&&e.selection.$anchor.parent.type===t.schema.nodes.mediaSingle)},key:Z.a,view:function(e){var t=Ke(e.state);return t.setView(e),t.updateElement(),{update:function(){t.updateElement()}}},props:{decorations:function(e){if(Ke(e).showDropzone){var t=e.schema,n=e.selection.$anchor;if(e.selection instanceof E.NodeSelection){if(e.selection.node.type===t.nodes.mediaSingle){var r=j.a.node(e.selection.from,e.selection.to,{class:"richMedia-selected"});return j.b.create(e.doc,[r])}}else{var a=n.pos;if(n.parent.type!==t.nodes.paragraph&&n.parent.type!==t.nodes.codeBlock&&(a=Object(P.h)(e.doc,a,t.nodes.mediaGroup)),null!=a){var o=[j.a.widget(a,i,{key:"drop-placeholder"})];return j.b.create(e.doc,o)}}}},nodeViews:t.nodeViews,handleTextInput:function(e){return Ke(e.state).splitMediaGroup(),!1}}})},Qe=n("7rzR");function Je(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Xe(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Je(Object(n),!0).forEach((function(t){s()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Je(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var $e=new E.PluginKey("mediaEditorPlugin"),Ze=Object(Qe.a)($e,(function(e,t){switch(t.type){case"open":return Xe(Xe({},e),{},{editor:{identifier:t.identifier,pos:t.pos}});case"close":case"upload":return Xe(Xe({},e),{},{editor:void 0});case"setMediaClientConfig":return Xe(Xe({},e),{},{mediaClientConfig:t.mediaClientConfig});default:return e}}),{mapping:function(e,t){return t.editor?Xe(Xe({},t),{},{editor:Xe(Xe({},t.editor),{},{pos:e.mapping.map(t.editor.pos)})}):t}}),Ye=Ze.createPluginState,et=Ze.createCommand,tt=Ze.getPluginState;function nt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function rt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?nt(Object(n),!0).forEach((function(t){s()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):nt(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var at=function(){return et({type:"close"})},it=function(e,t){return et({type:"upload",newIdentifier:e},(function(n,r){var a=tt(r).editor;if(!a)return n;var i=n.mapping.map(a.pos),o=n.doc.nodeAt(i),s=r.schema.nodes.media;if(!o||o.type!==s)return n;var c=rt(rt({},o.attrs),{},{id:e.id,collection:e.collectionName||o.attrs.collection,occurrenceKey:e.occurrenceKey,width:t.width,height:t.height});return n.setNodeMarkup(i,void 0,c)}))},ot=function(e){return function(t){var n=function(){var e=h()(O.a.mark((function e(n,r){var a,i,o,s;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("mediaProvider"===n){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,r;case 4:if(a=e.sent){e.next=7;break}return e.abrupt("return");case 7:return e.next=9,a.uploadMediaClientConfig;case 9:if(e.t0=e.sent,e.t0){e.next=14;break}return e.next=13,a.viewMediaClientConfig;case 13:e.t0=e.sent;case 14:i=e.t0,o=t.dispatch,s=t.state,et({type:"setMediaClientConfig",mediaClientConfig:i})(s,o,t);case 17:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}();return e.subscribe("mediaProvider",n),{destroy:function(){e.unsubscribe("mediaProvider",n)}}}},st=function(e){var t=e.dispatch,n=e.providerFactory;return new E.Plugin({state:Ye(t,{}),key:$e,view:ot(n)})};function ct(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function lt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ct(Object(n),!0).forEach((function(t){s()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ct(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var ut=n("6drl"),dt=new E.PluginKey("mediaAltTextPlugin"),pt=Object(Qe.a)(dt,(function(e,t){switch(t.type){case"updateAltText":return lt({},e);case"openMediaAltTextMenu":return lt(lt({},e),{},{isAltTextEditorOpen:!0});case"closeMediaAltTextMenu":return lt(lt({},e),{},{isAltTextEditorOpen:!1});default:return e}}),{onSelectionChanged:function(e,t){return e.getMeta(ut.a)?t:{isAltTextEditorOpen:!1}}}),ft=pt.createPluginState,ht=pt.createCommand,mt=pt.getPluginState,vt=function(e){var t=e.dispatch;e.providerFactory;return new E.Plugin({state:ft(t,{isAltTextEditorOpen:!1}),key:dt,view:function(){return{update:function(e,t){var n=mt(e.state),r=mt(t);n&&r&&r.isAltTextEditorOpen&&!n.isAltTextEditorOpen&&!e.hasFocus()&&e.focus()}}}})},gt=n("pFaK"),bt=n("O+po");function yt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Ot(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?yt(Object(n),!0).forEach((function(t){s()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):yt(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var wt,kt,Et,Pt=ht((function(e){return!!Object(be.d)(e)&&{type:"closeMediaAltTextMenu"}})),jt=(wt=we.a.OPENED,kt=function(e){return!!Object(be.d)(e)&&{type:"openMediaAltTextMenu"}},Et=function(e){return e.setMeta("scrollIntoView",!1)},Object(ke.d)({action:wt,actionSubject:we.b.MEDIA,actionSubjectId:we.c.ALT_TEXT,eventType:we.d.TRACK})(ht(kt,Et)));var xt=n("XZ5u");function Ct(e,t){var n=e.$from,r=n.index(n.depth-1),a=n.node(n.depth-1);return a?a.maybeChild(r+t):null}function St(e){return function(t,n){var r=t.selection.$from,a=t.schema.nodes.paragraph,i=Ct(t.selection,-2);if(!i)return!1;var o=Ct(t.selection,-1),s=r.pos-o.nodeSize-i.nodeSize,c=t.tr;if(function(t){var n=!1;try{n=e(t)}catch(r){}return n}(i))c=c.replace(s-1,s+i.nodeSize);else if(Object(ve.q)(t.selection)?c.replace(r.pos,r.pos+r.parent.nodeSize-1):c.replace(r.pos-1,r.pos+r.parent.nodeSize-1),i.type===a){var l=s+i.nodeSize-2;Object(M.safeInsert)(r.parent.content,l)(c)}else{var u=s+i.nodeSize-1;Object(M.safeInsert)(r.parent.copy(r.parent.content),u)(c)}return n&&n(c),!0}}var Mt,_t=function(e){var t=Object(ve.l)(e);return function(e,n){var r=e.selection,a=e.schema,i=r.$from;if(!function(e){return!!e.empty&&e.$from.parentOffset<=0}(e.selection))return!1;if(!function(e,t){return e.$from.parent.type===t}(e.selection,a.nodes.paragraph))return!1;return!!function(e,t,n){var r=Ct(e,n);return!!r&&r.type===t}(e.selection,a.nodes.mediaSingle,-1)&&("wrap-right"===Ct(e.selection,-1).attrs.layout?St(t)(e,n):(n&&Object(xt.f)(e,(function(r){t(i.parent)&&!Object(ye.d)(e)&&r.replace(i.pos-1,i.pos+i.parent.nodeSize-1),n(r)})),!0))}};function Dt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Nt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Dt(Object(n),!0).forEach((function(t){s()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Dt(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}!function(e){e.showToolbar="MEDIA_SHOW_TOOLBAR",e.hideToolbar="MEDIA_HIDE_TOOLBAR",e.setUrl="MEDIA_SET_LINK_TO",e.unlink="MEDIA_LINKING_UNLINK"}(Mt||(Mt={}));function It(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Tt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?It(Object(n),!0).forEach((function(t){s()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):It(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var At=new E.PluginKey("mediaLinking"),Lt={visible:!1,editable:!1,mediaPos:null,link:""};var Rt=Object(Qe.a)(At,(function(e,t){switch(t.type){case Mt.showToolbar:return Nt(Nt({},e),{},{visible:!0});case Mt.setUrl:return Nt(Nt({},e),{},{editable:!0,link:t.payload});case Mt.hideToolbar:return Nt(Nt({},e),{},{visible:!1});case Mt.unlink:return Nt(Nt({},e),{},{link:"",visible:!1,editable:!1})}return e}),{mapping:function(e,t){return t&&null!==t.mediaPos?Tt(Tt({},t),{},{mediaPos:e.mapping.map(t.mediaPos)}):t},onSelectionChanged:function(e){if(!(e.selection instanceof E.NodeSelection))return Lt;var t=e.selection.$from.pos+1,n=e.doc.nodeAt(t);if(!n||"media"!==n.type.name)return Lt;var r=n.marks.find((function(e){return"link"===e.type.name}));return Tt(Tt({},Lt),{},r?{mediaPos:t,editable:!0,link:r.attrs.href}:{mediaPos:t})}}),Ut=Rt.createCommand,zt=Rt.getPluginState,Ft=n("7i3F"),Bt=n("eXjd"),Vt=function(e){var t=e.doc,n=e.selection,r=e.schema;if(t&&n&&n instanceof E.NodeSelection&&n.node.type===r.nodes.mediaSingle){var a=t.nodeAt(n.$anchor.pos+1);if(a&&a.type===r.nodes.media)return a}},Wt=n("5aEg"),qt=function(){var e=h()(O.a.mark((function e(t,n){var r;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("external"!==t.attrs.type){e.next=2;break}return e.abrupt("return","external");case 2:if(t.attrs.id){e.next=4;break}return e.abrupt("return");case 4:return e.prev=4,e.next=7,Object(Wt.a)(n).file.getCurrentState(t.attrs.id,{collectionName:t.attrs.collection});case 7:if(!(r=e.sent)||"error"===r.status){e.next=10;break}return e.abrupt("return",r.mediaType);case 10:e.next=14;break;case 12:e.prev=12,e.t0=e.catch(4);case 14:case"end":return e.stop()}}),e,null,[[4,12]])})));return function(t,n){return e.apply(this,arguments)}}();function Gt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Kt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Gt(Object(n),!0).forEach((function(t){s()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Gt(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Ht=Ut((function(e){var t=zt(e);if(t&&null!==t.mediaPos&&e.doc.nodeAt(t.mediaPos))return{type:Mt.showToolbar};return!1})),Qt=function(e,t,n){if(t&&n){var r=Vt(e);if(!r)return!1;var a=Ke(e).mediaClientConfig;if(!a)return!1;qt(r,a).then((function(e){"external"!==e&&"image"!==e||Vt(n.state)!==r||t(n.state.tr.setMeta(At,{type:Mt.showToolbar}))}))}return!0},Jt=Ut({type:Mt.hideToolbar}),Xt=function(e,t,n){Jt(e,t,n),n&&n.focus()};function $t(e,t,n){var r=n.forceRemove,a=void 0!==r&&r,i=n.url,o=zt(t);if(!o||null===o.mediaPos)return e;var s=t.doc.resolve(o.mediaPos),c=t.doc.nodeAt(s.pos);if(!c)return e;var l=t.schema.marks.link,u=t.schema.nodes.media;return Object(Bt.f)(l,(function(e,t){if(t&&t.type===u){if(a)return!1;var n=Object(Ft.g)(i);if(!e||e.href!==n)return""!==n.trim()&&Kt(Kt({},e),{},{href:n})}}),[u])(s.pos,s.pos+c.nodeSize,e,t),e}var Zt=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:void 0;return Object(ke.a)(t,e,{action:n,eventType:we.d.TRACK,actionSubject:we.b.MEDIA,actionSubjectId:we.c.LINK,attributes:r})},Yt=Ut({type:Mt.unlink},(function(e,t){var n=$t(e,t,{forceRemove:!0});return Zt(n,t,we.a.DELETED)})),en=function(e,t){var n=function(e){var t=e.schema.marks.link,n=zt(e);if(n&&null!==n.mediaPos){var r=e.doc.resolve(n.mediaPos),a=e.doc.nodeAt(r.pos);if(a)if(t.isInSet(a.marks))return a.marks.find((function(e){return e.type===t})).attrs.href}}(t);return n?e!==n?we.a.EDITED:void 0:we.a.ADDED},tn=function(e,t){return Ut({type:Mt.setUrl,payload:Object(Ft.g)(e)},(function(n,r){var a=en(e,r);if(!a)return n;try{var i=$t(n,r,{url:e});return Zt(n,r,a,a===we.a.ADDED?{inputMethod:t}:void 0),i}catch(o){throw Zt(n,r,we.a.ERRORED,{action:a}),o}}))};var nn=function(e){return Z.a.getState(e).ignoreLinks=!0,!1},rn=function(e){return Z.a.getState(e).splitMediaGroup()},an=function(){var e={};return bt.bindKeymapWithCommand(bt.undo.common,nn,e),bt.bindKeymapWithCommand(bt.enter.common,rn,e),bt.bindKeymapWithCommand(bt.insertNewLine.common,rn,e),Object(gt.b)(e)},on=n("5+wD"),sn=n.n(on),cn=n("X/1r"),ln=n("HGna"),un=function(e){var t=e.editorView,n=e.eventDispatcher,r=e.pluginKey,a=e.isDisabled,i=e.isReducedSpacing;return l.a.createElement(ln.a,{editorView:t,eventDispatcher:n,plugins:{mediaPlugin:r},render:function(e){var t,n=e.mediaPlugin;return n.allowsUploads?l.a.createElement(cn.a,{onClick:(t=n,function(){return t.showMediaPicker(),!0}),disabled:a,title:"Files & images",spacing:i?"none":"default",iconBefore:l.a.createElement(sn.a,{label:"Files & images"})}):null}})},dn=n("XLm4"),pn=n("06eS"),fn=n.n(pn),hn=n("GW/8"),mn=n("Km6/"),vn=n("WJQr"),gn=n("rgs1"),bn=n("x7QK"),yn=n.n(bn),On=n("laKe"),wn=n("KgC3"),kn=function(){function e(t){var n=this;v()(this,e),s()(this,"props",void 0),s()(this,"updateContextId",h()(O.a.mark((function e(){var t,r,a;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((t=n.getAttrs())&&"file"===t.type){e.next=3;break}return e.abrupt("return");case 3:return r=t.id,e.next=6,n.getObjectId();case 6:a=e.sent,Le(r,{__contextId:a},n.props.isMediaSingle)(n.props.view.state,n.props.view.dispatch);case 8:case"end":return e.stop()}}),e)})))),s()(this,"hasFileAttributesDefined",(function(){var e=n.getAttrs();return e&&"file"===e.type&&e.__fileName&&e.__fileMimeType&&e.__fileSize&&e.__contextId})),s()(this,"updateFileAttrs",h()(O.a.mark((function e(){var t,r,a,i,o,s,c,l,u,d,p,f,h,m=arguments;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=!(m.length>0&&void 0!==m[0])||m[0],r=n.getAttrs(),e.next=4,n.props.mediaProvider;case 4:if((a=e.sent)&&a.uploadParams&&r&&"file"===r.type&&!n.hasFileAttributesDefined()){e.next=7;break}return e.abrupt("return");case 7:return i=a.viewMediaClientConfig,o=Object(Wt.a)(i),s={collectionName:r.collection},e.prev=10,e.next=13,o.file.getCurrentState(r.id,s);case 13:if("error"!==(c=e.sent).status){e.next=16;break}return e.abrupt("return");case 16:e.next=21;break;case 18:return e.prev=18,e.t0=e.catch(10),e.abrupt("return");case 21:if(e.t1=n.getNodeContextId(),e.t1){e.next=26;break}return e.next=25,n.getObjectId();case 25:e.t1=e.sent;case 26:l=e.t1,d=(u=c).name,p=u.mimeType,f=u.size,En(r,h={__fileName:d,__fileMimeType:p,__fileSize:f,__contextId:l})&&Le(r.id,h,t)(n.props.view.state,n.props.view.dispatch);case 31:case"end":return e.stop()}}),e,null,[[10,18]])})))),s()(this,"getAttrs",(function(){var e=n.props.node.attrs;if(e)return e})),s()(this,"getObjectId",h()(O.a.mark((function e(){var t;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.props.contextIdentifierProvider;case 2:return t=e.sent,e.abrupt("return",t&&t.objectId);case 4:case"end":return e.stop()}}),e)})))),s()(this,"uploadExternalMedia",function(){var e=h()(O.a.mark((function e(t){var r,a,i,o,s,c,l,u;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.props.node,e.next=3,n.props.mediaProvider;case 3:if(a=e.sent,!r||!a){e.next=21;break}if((i=a.uploadMediaClientConfig)&&r.attrs.url){e.next=8;break}return e.abrupt("return");case 8:return o=Object(Wt.a)(i),s=a.uploadParams&&a.uploadParams.collection,e.prev=10,e.next=13,o.file.uploadExternal(r.attrs.url,s);case 13:c=e.sent,l=c.uploadableFileUpfrontIds,u=c.dimensions,Ue(t()+1,{id:l.id,collection:s,height:u.height,width:u.width,occurrenceKey:l.occurrenceKey})(n.props.view.state,n.props.view.dispatch),e.next=21;break;case 18:e.prev=18,e.t0=e.catch(10),n.props.dispatchAnalyticsEvent&&n.props.dispatchAnalyticsEvent({action:we.a.UPLOAD_EXTERNAL_FAIL,actionSubject:we.b.EDITOR,eventType:we.d.OPERATIONAL});case 21:case"end":return e.stop()}}),e,null,[[10,18]])})));return function(t){return e.apply(this,arguments)}}()),s()(this,"getNodeContextId",(function(){var e=n.getAttrs();if(e&&"file"===e.type)return e.__contextId})),s()(this,"updateDimensions",(function(e){Le(e.id,{height:e.height,width:e.width},!0)(n.props.view.state,n.props.view.dispatch)})),s()(this,"hasDifferentContextId",h()(O.a.mark((function e(){var t,r;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.getNodeContextId(),e.next=3,n.getObjectId();case 3:if(r=e.sent,!t||!r||t===r){e.next=6;break}return e.abrupt("return",!0);case 6:return e.abrupt("return",!1);case 7:case"end":return e.stop()}}),e)})))),s()(this,"isNodeFromDifferentCollection",h()(O.a.mark((function e(){var t,r,a,i,o;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.props.mediaProvider;case 2:if((t=e.sent)&&t.uploadParams){e.next=5;break}return e.abrupt("return",!1);case 5:if(r=t.uploadParams.collection,(a=n.getAttrs())&&"file"===a.type){e.next=9;break}return e.abrupt("return",!1);case 9:if(i=a.collection,o=a.__contextId,e.t0=o,e.t0){e.next=15;break}return e.next=14,n.getObjectId();case 14:e.t0=e.sent;case 15:if(!e.t0||r===i){e.next=18;break}return e.abrupt("return",!0);case 18:return e.abrupt("return",!1);case 19:case"end":return e.stop()}}),e)})))),s()(this,"copyNodeFromBlobUrl",function(){var e=h()(O.a.mark((function e(t){var r,a,i,o,s,c,l,u,d,p,f,h,m,v,g,b,y,w,k;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((r=n.getAttrs())&&"external"===r.type){e.next=3;break}return e.abrupt("return");case 3:if(a=r.url,i=Object(wn.b)(a)){e.next=7;break}return e.abrupt("return");case 7:return e.next=9,n.props.mediaProvider;case 9:if((o=e.sent)&&o.uploadParams){e.next=12;break}return e.abrupt("return");case 12:if(s=o.uploadParams.collection,c=i.contextId,l=i.id,u=i.collection,d=i.height,p=i.width,f=i.mimeType,h=i.name,m=i.size,(v=o.uploadMediaClientConfig)&&v.getAuthFromContext){e.next=17;break}return e.abrupt("return");case 17:return g=Object(Wt.a)(v),e.next=20,v.getAuthFromContext(c);case 20:return b=e.sent,y={id:l,collection:u,authProvider:function(){return Promise.resolve(b)}},w={collection:s,authProvider:v.authProvider,occurrenceKey:yn()()},e.next=25,g.file.copyFile(y,w);case 25:k=e.sent,Ue(t()+1,{id:k.id,collection:s,height:d,width:p,__fileName:h,__fileMimeType:f,__fileSize:m})(n.props.view.state,n.props.view.dispatch);case 27:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),s()(this,"copyNode",h()(O.a.mark((function e(){var t,r,a,i,o,s,c,l,u,d,p,f,h,m,v,g;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.props.mediaProvider;case 2:if(t=e.sent,r=n.props,a=r.isMediaSingle,i=r.view,o=n.getAttrs(),t&&t.uploadParams&&o&&"file"===o.type){e.next=7;break}return e.abrupt("return");case 7:if(s=n.getNodeContextId(),!((c=t.uploadMediaClientConfig)&&c.getAuthFromContext&&s)){e.next=25;break}return l=Object(Wt.a)(c),e.next=13,c.getAuthFromContext(s);case 13:return u=e.sent,e.next=16,n.getObjectId();case 16:return d=e.sent,p=o.id,f=o.collection,h={id:p,collection:f,authProvider:function(){return Promise.resolve(u)}},m=t.uploadParams.collection,v={collection:m,authProvider:c.authProvider,occurrenceKey:yn()()},e.next=23,l.file.copyFile(h,v);case 23:g=e.sent,Re(h.id,{id:g.id,collection:m,__contextId:d},a)(i.state,i.dispatch);case 25:case"end":return e.stop()}}),e)})))),this.props=t}var t,n;return b()(e,[{key:"isMediaBlobUrl",value:function(){var e=this.getAttrs();return!(!e||"external"!==e.type||!Object(wn.c)(e.url))}},{key:"getRemoteDimensions",value:(n=h()(O.a.mark((function e(){var t,n,r,a,i,o,s,c,l,u;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.props.mediaProvider;case 2:if(t=e.sent,n=this.props.mediaOptions,r=this.getAttrs(),t&&r){e.next=7;break}return e.abrupt("return",!1);case 7:if(a=r.height,i=r.width,"external"!==r.type&&r.id){e.next=10;break}return e.abrupt("return",!1);case 10:if(o=r.id,s=r.collection,!a||!i){e.next=13;break}return e.abrupt("return",!1);case 13:if(!n||n.allowRemoteDimensionsFetch){e.next=15;break}return e.abrupt("return",{id:o,height:On.a,width:On.b});case 15:return c=t.viewMediaClientConfig,l=Object(Wt.a)(c),e.next=19,l.getImageMetadata(o,{collection:s});case 19:if((u=e.sent)&&u.original){e.next=22;break}return e.abrupt("return",!1);case 22:return e.abrupt("return",{id:o,height:u.original.height||On.a,width:u.original.width||On.b});case 23:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"handleExternalMedia",value:(t=h()(O.a.mark((function e(t){return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isMediaBlobUrl()){e.next=12;break}return e.prev=1,e.next=4,this.copyNodeFromBlobUrl(t);case 4:e.next=10;break;case 6:return e.prev=6,e.t0=e.catch(1),e.next=10,this.uploadExternalMedia(t);case 10:e.next=14;break;case 12:return e.next=14,this.uploadExternalMedia(t);case 14:case"end":return e.stop()}}),e,this,[[1,6]])}))),function(e){return t.apply(this,arguments)})}]),e}(),En=function(e,t){return e.__fileName!==t.__fileName||e.__fileMimeType!==t.__fileMimeType||e.__fileSize!==t.__fileSize||e.__contextId!==t.__contextId};function Pn(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=K()(e);if(t){var a=K()(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return q()(this,n)}}var jn=function(e){return Object(Oe.c)(e.anchorPos,e.headPos,e.getPos(),e.node.nodeSize)},xn=function(e){V()(n,e);var t=Pn(n);function n(e){var r;return v()(this,n),r=t.call(this,e),s()(F()(r),"mediaPluginState",void 0),s()(F()(r),"mediaNodes",void 0),s()(F()(r),"state",{viewMediaClientConfig:void 0}),s()(F()(r),"updateNodeAttrs",(function(e){var t=e.view,n=e.mediaProvider,a=e.contextIdentifierProvider;r.mediaNodes.forEach((function(e){new kn({view:t,mediaProvider:n,contextIdentifierProvider:a,node:e,isMediaSingle:!1}).updateFileAttrs(!1)}))})),s()(F()(r),"setMediaItems",(function(e){var t=e.node;r.mediaNodes=[],t.forEach((function(t,n){r.mediaPluginState.mediaGroupNodes[t.attrs.id]={node:t,getPos:function(){return e.getPos()+n+1}},r.mediaNodes.push(t)}))})),s()(F()(r),"getIdentifier",(function(e){return"external"===e.attrs.type?{mediaItemType:"external-image",dataURI:e.attrs.url}:{id:e.attrs.id,mediaItemType:"file",collectionName:e.attrs.collection}})),s()(F()(r),"isNodeSelected",(function(e){var t=jn(r.props);return t===Oe.a.selectedInRange||t===Oe.a.selectedInside&&r.props.anchorPos===e})),s()(F()(r),"renderChildNodes",(function(){var e=r.state.viewMediaClientConfig,t=r.props,n=t.getPos,a=t.allowLazyLoading,i=t.disabled,o=t.mediaOptions,s=r.mediaNodes.map((function(e,t){var o=function(){return n()+t+1};return{identifier:r.getIdentifier(e),isLazy:a,selected:r.isNodeSelected(o()),onClick:function(){Object($.f)(r.props.view,o())},actions:[{handler:i?function(){}:r.mediaPluginState.handleMediaNodeRemoval.bind(null,void 0,o),icon:l.a.createElement(fn.a,{label:"delete"})}]}}));return l.a.createElement(hn.a,{items:s,mediaClientConfig:e,featureFlags:o.featureFlags})})),r.mediaNodes=[],r.mediaPluginState=Z.a.getState(e.view.state),r.setMediaItems(e),r.state={viewMediaClientConfig:void 0},r}return b()(n,[{key:"componentDidMount",value:function(){var e=this;this.updateMediaClientConfig(),this.mediaNodes.forEach(function(){var t=h()(O.a.mark((function t(n){var r,a,i,o,s;return O.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if("external"!==n.attrs.type){t.next=2;break}return t.abrupt("return");case 2:if(r=e.props,a=r.view,i=r.mediaProvider,o=r.contextIdentifierProvider,s=new kn({view:a,mediaProvider:i,contextIdentifierProvider:o,node:n,isMediaSingle:!1}),s.getNodeContextId()){t.next=8;break}return t.next=8,s.updateContextId();case 8:return t.next=10,s.hasDifferentContextId();case 10:if(!t.sent){t.next=14;break}return t.next=14,s.copyNode();case 14:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())}},{key:"UNSAFE_componentWillReceiveProps",value:function(e){this.updateMediaClientConfig(),this.setMediaItems(e),!1!==e.isCopyPasteEnabled&&this.updateNodeAttrs(e)}},{key:"shouldComponentUpdate",value:function(e){return t=this.props,n=e,jn(t)!==jn(n)||jn(n)===Oe.a.selectedInside&&t.anchorPos!==n.anchorPos||this.props.node!==e.node||this.state.viewMediaClientConfig!==this.mediaPluginState.mediaClientConfig;var t,n}},{key:"updateMediaClientConfig",value:function(){var e=this.state.viewMediaClientConfig,t=this.mediaPluginState.mediaClientConfig;!e&&t&&this.setState({viewMediaClientConfig:t})}},{key:"render",value:function(){return this.renderChildNodes()}}]),n}(l.a.Component);s()(xn,"displayName","MediaGroup");var Cn,Sn=function(e){V()(n,e);var t=Pn(n);function n(){return v()(this,n),t.apply(this,arguments)}return b()(n,[{key:"render",value:function(e,t){var n=this,r=e.providerFactory,a=e.mediaOptions,i=this.getPos;return l.a.createElement(dn.a,{providers:["mediaProvider","contextIdentifierProvider"],providerFactory:r,renderNode:function(e){var r=e.mediaProvider,o=e.contextIdentifierProvider;return l.a.createElement(ln.a,{editorView:n.view,plugins:{reactNodeViewState:vn.b,editorDisabledPlugin:gn.b},render:function(e){var s=e.editorDisabledPlugin;return r?l.a.createElement(xn,{node:n.node,getPos:i,view:n.view,forwardRef:t,disabled:(s||{}).editorDisabled,allowLazyLoading:a.allowLazyLoading,mediaProvider:r,contextIdentifierProvider:o,isCopyPasteEnabled:a.isCopyPasteEnabled,anchorPos:n.view.state.selection.$anchor.pos,headPos:n.view.state.selection.$head.pos,mediaOptions:a}):null}})}})}}]),n}(mn.a),Mn=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return function(a,i,o){return new Sn(a,i,o,e,t,{providerFactory:n,mediaOptions:r}).init()}},_n=n("RNXH"),Dn=n.n(_n),Nn=n("LGLP"),In=n.n(Nn),Tn=n("ww0P"),An=n("iHxc"),Ln=n("bHTr"),Rn=n("WISH"),Un=n("RFGA"),zn=I.default.div(Cn||(Cn=N()(["\n  img {\n    width: 100%;\n  }\n\n  & > div {\n    ",";\n    position: relative;\n    clear: both;\n  }\n"])),Un.a);zn.displayName="ResizerWrapper";var Fn=n("9Bpa"),Bn=n("VUve"),Vn=n("LPnw"),Wn=[250,384,576,768];function qn(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=K()(e);if(t){var a=K()(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return q()(this,n)}}var Gn=function(e){V()(a,e);var t,n,r=qn(a);function a(){var e;v()(this,a);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return e=r.call.apply(r,[this].concat(n)),s()(F()(e),"state",{offsetLeft:Kn(e.insideInlineLike,e.insideLayout,e.props.view.dom,void 0),isVideoFile:!0}),s()(F()(e),"calcNewSize",(function(t,n){var r=e.props,a=r.layout,i=r.view.state,o=100*Object(Ln.b)(t,e.props.lineLength);e.setState({resizedPctWidth:o});var s=Object(M.hasParentNodeOfType)(i.schema.nodes.table)(i.selection)?a:e.calcUnwrappedLayout(o,t);return o<=100?(!e.wrappedLayout||n&&100===o||(s=a),{width:o,layout:s}):{width:e.props.pctWidth||null,layout:s}})),s()(F()(e),"calcUnwrappedLayout",(function(e,t){return e<=100?"center":t<=Rn.V?"wide":"full-width"})),s()(F()(e),"calcColumnLeftOffset",(function(){var t=e.state.offsetLeft;return e.insideInlineLike?Object(Ln.a)(t,e.props.lineLength,e.props.gridSize):0})),s()(F()(e),"wrapper",void 0),s()(F()(e),"calcPxWidth",(function(t){var n=e.props,r=n.width,a=n.height,i=n.layout,o=n.pctWidth,s=n.lineLength,c=n.containerWidth,l=n.fullWidthMode,u=n.getPos,d=n.view.state,p=e.state.resizedPctWidth,f="function"==typeof u?u():void 0;return Object(_.a)({origWidth:r,origHeight:a,pctWidth:o,state:d,containerWidth:{width:c,lineLength:s},isFullWidthModeEnabled:l,layout:t||i,pos:f,resizedPctWidth:p})})),s()(F()(e),"highlights",(function(t,n){var r=Object(Bn.c)(t,n),a=e.props.view.state.schema.nodes,i=a.layoutColumn,o=a.table,s=a.expand,c=a.nestedExpand;if(e.$pos&&Object(M.findParentNodeOfTypeClosestToPos)(e.$pos,[i,o,s,c].filter(Boolean)))return[];if(r>Rn.V)return["full-width"];var l=e.props,u=l.layout,d=l.lineLength,p=l.gridSize,f=Object(Ln.a)(r,d,p),h=Math.round(f),m=[];return"wrap-left"===u||"align-start"===u?m.push(0,h):"wrap-right"===u||"align-end"===u?m.push(p,p-h):e.insideInlineLike?m.push(Math.round(f+e.calcColumnLeftOffset())):m.push(Math.floor((p-h)/2),Math.ceil((p+h)/2)),m})),s()(F()(e),"saveWrapper",(function(t){return e.wrapper=t})),e}return b()(a,[{key:"componentDidUpdate",value:function(){var e=Kn(this.insideInlineLike,this.insideLayout,this.props.view.dom,this.wrapper);return e!==this.state.offsetLeft&&e>=0&&this.setState({offsetLeft:e}),!0}},{key:"wrappedLayout",get:function(){return On.e.indexOf(this.props.layout)>-1}},{key:"componentDidMount",value:(n=h()(O.a.mark((function e(){var t;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t=this.props.viewMediaClientConfig)){e.next=4;break}return e.next=4,this.checkVideoFile(t);case 4:this.props.pctWidth&&this.setState({resizedPctWidth:this.props.pctWidth});case 5:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"UNSAFE_componentWillReceiveProps",value:function(e){this.props.viewMediaClientConfig!==e.viewMediaClientConfig&&this.checkVideoFile(e.viewMediaClientConfig),this.props.layout!==e.layout&&this.checkLayout(this.props.layout,e.layout)}},{key:"checkVideoFile",value:(t=h()(O.a.mark((function e(t){var n,r,a,i;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((n=this.$pos)&&t){e.next=3;break}return e.abrupt("return");case 3:if((r=this.props.view.state.doc.nodeAt(n.pos+1))&&r.attrs.id){e.next=6;break}return e.abrupt("return");case 6:return a=Object(Wt.a)(t),e.prev=7,e.next=10,a.file.getCurrentState(r.attrs.id,{collectionName:r.attrs.collection});case 10:(i=e.sent)&&"error"!==i.status&&"image"===i.mediaType&&this.setState({isVideoFile:!1}),e.next=17;break;case 14:e.prev=14,e.t0=e.catch(7),this.setState({isVideoFile:!1});case 17:case"end":return e.stop()}}),e,this,[[7,14]])}))),function(e){return t.apply(this,arguments)})},{key:"checkLayout",value:function(e,t){var n=this.state.resizedPctWidth;if(On.e.indexOf(e)>-1&&"center"===t&&n){var r=this.calcUnwrappedLayout(n,this.calcPxWidth(t));this.props.updateSize(n,r)}}},{key:"$pos",get:function(){if("function"!=typeof this.props.getPos)return null;var e=this.props.getPos();return Number.isNaN(e)||"number"!=typeof e?null:this.props.view.state.doc.resolve(e)}},{key:"gridWidth",get:function(){var e=this.props.gridSize;return this.wrappedLayout||this.insideInlineLike?e:e/2}},{key:"insideInlineLike",get:function(){var e=this.$pos;if(!e)return!1;var t=this.props.view.state.schema.nodes.listItem;return!!Object(M.findParentNodeOfTypeClosestToPos)(e,[t])}},{key:"insideLayout",get:function(){var e=this.$pos;if(!e)return!1;var t=this.props.view.state.schema.nodes.layoutColumn;return!!Object(M.findParentNodeOfTypeClosestToPos)(e,[t])}},{key:"render",value:function(){var e=this,t=this.props,n=t.width,r=t.height,a=t.layout,i=t.pctWidth,o=t.containerWidth,s=t.fullWidthMode,c=t.selected,u=t.view.state,d=t.children,p=this.calcPxWidth(),f=r/n*p,h=p,m={};Bn.a.forEach((function(t){var n="left"===t?"right":"left";m[t]=["full-width","wide","center"].concat("wrap-".concat(n)).concat("align-".concat(Bn.b[n])).indexOf(a)>-1,"left"===t&&e.insideInlineLike&&(m[t]=!1)}));this.$pos,Rn.V,this.props.allowBreakoutSnapPoints,this.props.containerWidth,this.props.gridSize,this.gridWidth,this.insideInlineLike,this.insideLayout,this.state.isVideoFile,this.props.lineLength,this.state.offsetLeft,this.wrappedLayout;return l.a.createElement(zn,{ratio:(f/h*100).toFixed(3),layout:a,isResized:!!i,containerWidth:o||n,innerRef:this.saveWrapper,fullWidthMode:s},l.a.createElement(Fn.a,In()({},this.props,{width:h,height:f,selected:c,enable:m,calcNewSize:this.calcNewSize,snapPoints:Wn,scaleFactor:this.wrappedLayout||this.insideInlineLike?1:2,highlights:this.highlights,handleResizeStart:function(){var e=Object(Vn.c)(u);return!e||!e.dragging},nodeType:"media",dispatchAnalyticsEvent:this.props.dispatchAnalyticsEvent}),d))}}]),a}(l.a.Component);function Kn(e,t,n,r){var a=0;r&&e&&!t&&(a=r.getBoundingClientRect().left-n.getBoundingClientRect().left);return a}var Hn=n("YZT1"),Qn=n("XKts"),Jn=function(){return document.querySelectorAll(".ProseMirror > p").forEach((function(e){return e.setAttribute("contenteditable","false")}))},Xn=function(){return document.querySelectorAll(".ProseMirror > p").forEach((function(e){return e.setAttribute("contenteditable","")}))},$n=function(){return document.querySelector(".ua-firefox")};function Zn(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Yn(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Zn(Object(n),!0).forEach((function(t){s()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Zn(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function er(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=K()(e);if(t){var a=K()(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return q()(this,n)}}var tr=function(e){V()(r,e);var t,n=er(r);function r(){var e;v()(this,r);for(var t=arguments.length,a=new Array(t),i=0;i<t;i++)a[i]=arguments[i];return e=n.call.apply(n,[this].concat(a)),s()(F()(e),"state",{width:void 0,height:void 0,viewMediaClientConfig:void 0,isCopying:!1}),s()(F()(e),"createMediaNodeUpdater",(function(t){var n=e.props.node.firstChild;return new kn(Yn(Yn({},t),{},{isMediaSingle:!0,node:n||e.props.node,dispatchAnalyticsEvent:e.props.dispatchAnalyticsEvent}))})),s()(F()(e),"setViewMediaClientConfig",function(){var t=h()(O.a.mark((function t(n){var r,a;return O.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,n.mediaProvider;case 2:(r=t.sent)&&(a=r.viewMediaClientConfig,e.setState({viewMediaClientConfig:a}));case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),s()(F()(e),"updateMediaNodeAttributes",function(){var t=h()(O.a.mark((function t(n){var r,a,i,o,s,c;return O.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=e.createMediaNodeUpdater(n),a=e.props.mediaPluginState.addPendingTask,i=e.props.node.firstChild){t.next=5;break}return t.abrupt("return");case 5:return t.next=7,r.getRemoteDimensions();case 7:if((o=t.sent)&&r.updateDimensions(o),"external"!==i.attrs.type||!i.attrs.__external){t.next=15;break}return s=r.handleExternalMedia(e.props.getPos),a(s),t.next=14,s;case 14:return t.abrupt("return");case 15:if(r.getNodeContextId()){t.next=19;break}return t.next=19,r.updateContextId();case 19:return t.next=21,r.hasDifferentContextId();case 21:if(!t.sent){t.next=34;break}return e.setState({isCopying:!0}),t.prev=24,c=r.copyNode(),a(c),t.next=29,c;case 29:t.next=34;break;case 31:t.prev=31,t.t0=t.catch(24),e.setState({isCopying:!1});case 34:case"end":return t.stop()}}),t,null,[[24,31]])})));return function(e){return t.apply(this,arguments)}}()),s()(F()(e),"selectMediaSingle",(function(t){var n=t.event;n.stopPropagation();var r=e.props.getPos(),a=e.props.view.state;if(n.shiftKey){if(a.selection instanceof X.a)return;Object($.g)(e.props.view,a.selection.from<r?a.selection.from:r,a.selection.to>r?a.selection.to:r+3)}else Object($.f)(e.props.view,r)})),s()(F()(e),"updateSize",(function(t,n){var r=e.props.view,a=r.state,i=r.dispatch,o=e.props.getPos();if(void 0!==o){var s=a.tr.setNodeMarkup(o,void 0,Yn(Yn({},e.props.node.attrs),{},{layout:n,width:t}));return s.setMeta("scrollIntoView",!1),i(s)}})),s()(F()(e),"forwardInnerRef",(function(t){e.props.forwardRef(t)})),s()(F()(e),"getLineLength",(function(e,t){if(Object(Qn.c)(e,t)){var n=e.state.doc.resolve(t),r=e.nodeDOM(n.pos);if(n.nodeAfter&&Qn.b.indexOf(n.nodeAfter.attrs.layout)>-1&&r&&r.parentElement)return r.parentElement.offsetWidth;if(r instanceof HTMLElement)return r.offsetWidth}return null})),e}return b()(r,[{key:"UNSAFE_componentWillReceiveProps",value:function(e){e.mediaProvider!==this.props.mediaProvider&&this.setViewMediaClientConfig(e),!1!==e.isCopyPasteEnabled&&this.createMediaNodeUpdater(e).updateFileAttrs()}},{key:"componentDidMount",value:(t=h()(O.a.mark((function e(){var t;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.props.contextIdentifierProvider,e.next=3,Promise.all([this.setViewMediaClientConfig(this.props),this.updateMediaNodeAttributes(this.props)]);case 3:return e.t0=this,e.next=6,t;case 6:e.t1=e.sent,e.t2={contextIdentifierProvider:e.t1},e.t0.setState.call(e.t0,e.t2),(n=$n()).addEventListener("dragstart",Jn),n.addEventListener("dragend",Xn);case 10:case"end":return e.stop()}var n}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"componentWillUnmount",value:function(){var e;(e=$n()).removeEventListener("dragstart",Jn),e.removeEventListener("dragend",Xn)}},{key:"render",value:function(){var e=this.props,t=e.selected,n=e.getPos,r=e.node,a=e.mediaOptions,i=e.fullWidthMode,o=e.view.state,s=e.view,c=r.attrs,u=c.layout,d=c.width,p=r.firstChild.attrs,f=p.width,h=p.height;f&&h||(f=250,h=187.5);var m={layout:u,width:f,height:h,containerWidth:this.props.width,lineLength:this.props.lineLength||768,pctWidth:d||250/768*100,fullWidthMode:i},v=l.a.createElement(Y,{innerRef:this.forwardInnerRef}),g=!!this.props.mediaOptions.allowResizing;if(!this.props.mediaOptions.allowResizingInTables){var b=n();if(b){var y=o.doc.resolve(b),O=o.schema.nodes.table,w=!!Object(M.findParentNodeOfTypeClosestToPos)(y,[O]);g=g&&!w}}var k=this.getLineLength(s,n())||m.lineLength;return g?l.a.createElement(Gn,In()({},m,{lineLength:k,view:this.props.view,getPos:n,updateSize:this.updateSize,displayGrid:Object(Hn.a)(this.props.eventDispatcher),gridSize:12,viewMediaClientConfig:this.state.viewMediaClientConfig,allowBreakoutSnapPoints:a&&a.allowBreakoutSnapPoints,selected:t(),dispatchAnalyticsEvent:this.props.dispatchAnalyticsEvent}),v):l.a.createElement(On.c,m,v)}}]),r}(c.Component);s()(tr,"defaultProps",{mediaOptions:{}}),s()(tr,"displayName","MediaSingleNode");var nr=function(e){V()(n,e);var t=er(n);function n(){var e;v()(this,n);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return e=t.call.apply(t,[this].concat(a)),s()(F()(e),"lastOffsetLeft",0),s()(F()(e),"forceViewUpdate",!1),s()(F()(e),"selectionType",null),s()(F()(e),"checkAndUpdateSelectionType",(function(){var t=e.getPos,n=e.view.state.selection,r=Object(Oe.c)(n.$anchor.pos,n.$head.pos,t(),e.node.nodeSize);return e.selectionType=r,r})),s()(F()(e),"isNodeSelected",(function(){return e.checkAndUpdateSelectionType(),null!==e.selectionType})),e}return b()(n,[{key:"createDomRef",value:function(){var e=document.createElement("div");return Tn.a.chrome&&this.reactComponentProps.mediaOptions&&this.reactComponentProps.mediaOptions.allowMediaSingleEditable&&(e.contentEditable="true"),e}},{key:"getContentDOM",value:function(){return{dom:document.createElement("div")}}},{key:"viewShouldUpdate",value:function(e){return this.forceViewUpdate?(this.forceViewUpdate=!1,!0):this.node.attrs!==e.attrs||(this.selectionType!==this.checkAndUpdateSelectionType()||Dn()(K()(n.prototype),"viewShouldUpdate",this).call(this,e))}},{key:"getNodeMediaId",value:function(e){if(e.firstChild)return e.firstChild.attrs.id}},{key:"update",value:function(e,t,r){var a=this;return r||(r=function(e,t){return a.getNodeMediaId(e)===a.getNodeMediaId(t)}),Dn()(K()(n.prototype),"update",this).call(this,e,t,r)}},{key:"render",value:function(e,t){var n=this,r=this.reactComponentProps,a=r.eventDispatcher,i=r.fullWidthMode,o=r.providerFactory,s=r.mediaOptions,c=r.dispatchAnalyticsEvent,u=this.getPos;return l.a.createElement(dn.a,{providers:["mediaProvider","contextIdentifierProvider"],providerFactory:o,renderNode:function(e){var r=e.mediaProvider,o=e.contextIdentifierProvider;return l.a.createElement(ln.a,{editorView:n.view,plugins:{width:An.b,mediaPluginState:Z.a},render:function(e){var d=e.width,p=e.mediaPluginState;return l.a.createElement(tr,{width:d.width,lineLength:d.lineLength,node:n.node,getPos:u,mediaProvider:r,contextIdentifierProvider:o,mediaOptions:s,view:n.view,fullWidthMode:i,selected:n.isNodeSelected,eventDispatcher:a,mediaPluginState:p,dispatchAnalyticsEvent:c,forwardRef:t})}})}})}},{key:"ignoreMutation",value:function(){if(this.dom){var e=this.dom.offsetLeft;e!==this.lastOffsetLeft&&(this.lastOffsetLeft=e,this.forceViewUpdate=!0,this.update(this.node,[],(function(){return!0})))}return!0}}]),n}(mn.a),rr=function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};return function(i,o,s){return new nr(i,o,s,e,t,{eventDispatcher:t,fullWidthMode:a.fullWidthEnabled,providerFactory:n,mediaOptions:a,dispatchAnalyticsEvent:r,isCopyPasteEnabled:a.isCopyPasteEnabled}).init()}},ar=n("QGb3"),ir=n.n(ar),or=n("CzxY"),sr=n.n(or),cr=n("368d"),lr=n("tUdN"),ur=n("Havv"),dr=n.n(ur),pr=n("YyNJ"),fr=n("uxt/"),hr=n("qwOa"),mr=Object(hr.e)({annotate:{id:"fabric.editor.annotate",defaultMessage:"Annotate",description:"Annotate an image by drawing arrows, adding text, or scribbles."}});function vr(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=K()(e);if(t){var a=K()(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return q()(this,n)}}var gr,br,yr=function(e,t){var n=Z.a.getState(e);if(!n)return!1;var r=e.schema.nodes.mediaSingle,a=n.selectedMediaContainerNode();if(!a||a.type!==r)return!1;var i,o=a.firstChild.attrs,s=o.id,c=o.collection,l=o.occurrenceKey;return Object(ke.d)({action:we.a.CLICKED,actionSubject:we.b.MEDIA,actionSubjectId:we.c.ANNOTATE_BUTTON,eventType:we.d.UI})((i=e.selection.from+1,et({type:"open",identifier:{id:s,collectionName:c,mediaItemType:"file",occurrenceKey:l},pos:i})))(e,t)},Or=function(e){V()(a,e);var t,n,r=vr(a);function a(){var e;v()(this,a);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return e=r.call.apply(r,[this].concat(n)),s()(F()(e),"state",{isImage:!1}),s()(F()(e),"onClickAnnotation",(function(){var t=e.props.view;t&&yr(t.state,t.dispatch)})),e}return b()(a,[{key:"componentDidMount",value:(n=h()(O.a.mark((function e(){return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.checkIsImage();case 2:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"checkIsImage",value:(t=h()(O.a.mark((function e(){var t,n;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=Object(Wt.a)(this.props.viewMediaClientConfig),this.props.id){e.next=3;break}return e.abrupt("return");case 3:return e.prev=3,e.next=6,t.file.getCurrentState(this.props.id,{collectionName:this.props.collection});case 6:(n=e.sent)&&"error"!==n.status&&"image"===n.mediaType&&this.setState({isImage:!0}),e.next=12;break;case 10:e.prev=10,e.t0=e.catch(3);case 12:case"end":return e.stop()}}),e,this,[[3,10]])}))),function(){return t.apply(this,arguments)})},{key:"componentDidUpdate",value:function(e){var t=this;e.id!==this.props.id&&this.setState({isImage:!1},(function(){t.checkIsImage()}))}},{key:"render",value:function(){if(!this.state.isImage)return null;var e=this.props.intl.formatMessage(mr.annotate);return l.a.createElement(l.a.Fragment,null,l.a.createElement(fr.a,null),l.a.createElement(pr.a,{title:e,icon:l.a.createElement(dr.a,{label:e}),onClick:this.onClickAnnotation}))}}]),a}(l.a.Component),wr=function(e,t){return function(n,r){var a=e.selectedMediaContainerNode();return a&&e.mediaClientConfig?l.a.createElement(Or,{key:r,viewMediaClientConfig:e.mediaClientConfig,id:a.firstChild.attrs.id,collection:a.firstChild.attrs.collection,view:n,intl:t}):null}},kr=n("VqFj"),Er=n.n(kr),Pr=n("1mRP"),jr=n.n(Pr),xr=n("VrxG"),Cr=n("BXdW"),Sr=n("pev1"),Mr=n("gnaU");function _r(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=K()(e);if(t){var a=K()(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return q()(this,n)}}var Dr=Object(hr.e)({backLink:{id:"fabric.editor.backLink",defaultMessage:"Go back",description:"Go back from media linking toolbar to main toolbar"}}),Nr=I.default.section(gr||(gr=N()(["\n  display: flex;\n  line-height: 0;\n  padding: 12px 24px 12px 0;\n  margin: 0 4px 0 32px;\n  border-top: 1px solid ",";\n  align-items: start;\n  display: flex;\n  flex-direction: column;\n"])),A.R400),Ir=I.default.span(br||(br=N()(["\n  padding: 4px 8px 4px 0px;\n"]))),Tr=function(e){V()(n,e);var t=_r(n);function n(){var e;v()(this,n);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return e=t.call.apply(t,[this].concat(a)),s()(F()(e),"state",{validationErrors:[]}),s()(F()(e),"handleSubmit",(function(t){var n=t.url,r=t.inputMethod;e.props.onSubmit(n,{inputMethod:r})})),s()(F()(e),"handleOnBack",(function(t){var n=t.url,r=t.inputMethod,a=e.props.onBack;a&&a(n,{inputMethod:r})})),s()(F()(e),"handleCancel",(function(){var t=e.props.onCancel;t&&t()})),s()(F()(e),"handleUnlink",(function(){var t=e.props.onUnlink;t&&t()})),s()(F()(e),"handleOnBlur",(function(t){e.props.onBlur(t.url)})),s()(F()(e),"renderContainer",(function(t){var n,r=t.activityProvider,a=t.inputProps,i=a.onChange,o=a.onKeyDown,s=a.onSubmit,c=a.value,u=t.currentInputMethod,d=t.renderRecentList,p=e.props,f=p.intl.formatMessage,h=p.displayUrl,m=f(Dr.backLink),v=f(cr.b.unlink),g=e.state.validationErrors.map((function(e,t){return l.a.createElement(Mr.a,{key:t},e)}));return l.a.createElement("div",{className:"recent-list"},l.a.createElement(Cr.a,{provider:!!r},l.a.createElement(Cr.e,null,l.a.createElement(Ir,null,l.a.createElement(pr.a,{title:m,icon:l.a.createElement(Er.a,{label:m}),onClick:function(){return e.handleOnBack({url:c,inputMethod:u})}})),l.a.createElement(xr.a,{testId:"media-link-input",placeholder:(n=!!r,f(n?cr.b.placeholder:cr.b.linkPlaceholder)),autoFocus:!0,onCancel:e.handleCancel,defaultValue:c,onSubmit:function(t){var n=e.getValidationErrors(t,u);e.setState({validationErrors:n}),n.length||s()},onChange:function(t){e.setState({validationErrors:[]}),i(t)},onKeyDown:o}),Object(Ft.g)(h)&&l.a.createElement(l.a.Fragment,null,l.a.createElement(fr.a,null),l.a.createElement(pr.a,{title:v,icon:l.a.createElement(jr.a,{label:v}),onClick:e.handleUnlink}))),!!g.length&&l.a.createElement(Nr,null,g),d()))})),e}return b()(n,[{key:"getValidationErrors",value:function(e,t){var n=this.props.intl.formatMessage;return t===we.e.TYPEAHEAD?[]:e?Object(Ft.g)(e)?[]:[n(cr.b.invalidLink)]:[n(cr.b.emptyLink)]}},{key:"render",value:function(){var e=this.props,t=e.providerFactory,n=e.displayUrl;return l.a.createElement(Sr.a,{defaultUrl:Object(Ft.g)(n),providerFactory:t,onSubmit:this.handleSubmit,onBlur:this.handleOnBlur,render:this.renderContainer})}}]),n}(l.a.PureComponent);function Ar(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Lr(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ar(Object(n),!0).forEach((function(t){s()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ar(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Rr(e){var t=zt(e);if(!t||null===t.mediaPos)return!1;var n=e.schema,r=n.nodes.media,a=n.marks.link,i=e.doc.nodeAt(t.mediaPos);if(!i||i.type!==r)return!1;var o=e.doc.resolve(t.mediaPos).parent;return o&&o.type.allowsMarkType(a)}var Ur,zr,Fr,Br,Vr,Wr,qr=function(e,t,n,r,a){var i=t.link,o=t.visible,s=t.editable,c=t.mediaPos;if(o&&null!==c&&n.doc.nodeAt(c))return Lr(Lr({},e),{},{height:Cr.c,width:Cr.d,forcePlacement:!0,items:[{type:"custom",render:function(e,t){return e&&a?l.a.createElement(Tr,{key:t,displayUrl:i,providerFactory:a,intl:r,editing:s,onUnlink:function(){return Yt(e.state,e.dispatch,e)},onBack:function(t,n){t.trim()&&n.inputMethod&&tn(t,n.inputMethod)(e.state,e.dispatch,e),Xt(e.state,e.dispatch,e)},onCancel:function(){return Xt(e.state,e.dispatch,e)},onSubmit:function(t,n){tn(t,n.inputMethod)(e.state,e.dispatch,e),Xt(e.state,e.dispatch,e)},onBlur:function(){Xt(e.state,e.dispatch,e)}}):null}}]})},Gr=n("nazu"),Kr=Object(hr.e)({altText:{id:"fabric.editor.addAltText",defaultMessage:"Alt text",description:"Add an alt text for this image"},editAltText:{id:"fabric.editor.editAltText",defaultMessage:"Edit alt text",description:"Edit an alt text for this image"},back:{id:"fabric.editor.closeAltTextEdit",defaultMessage:"Back",description:"Back to toolbar"},clear:{id:"fabric.editor.clearAltTextEdit",defaultMessage:"Clear alt text",description:"Clear alt text"},placeholder:{id:"fabric.editor.placeholderAltText",defaultMessage:"Describe this image with alt text",description:"Describe this image with alt text"},supportText:{id:"fabric.editor.supportAltText",defaultMessage:"Alt text is useful for people using screen readers because of visual limitations.",description:"Alt text is useful for people using screen readers because of visual limitations."},validationMessage:{id:"fabric.editor.alttext.validation",defaultMessage:"Please remove any special characters in alt text.",description:"Please remove any special characters in alt text. "}}),Hr=n("VfAS"),Qr=n.n(Hr),Jr=n("/V8Q"),Xr=n("Mlj8");function $r(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=K()(e);if(t){var a=K()(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return q()(this,n)}}var Zr=Cr.d,Yr=I.default.p(Ur||(Ur=N()(["\n  color: ",";\n  font-size: 12px;\n  padding: 12px 40px;\n  line-height: 20px;\n  border-top: 1px solid ",";\n  margin: 0;\n"])),A.N100,A.N30),ea=I.default.div(zr||(zr=N()(["\n  width: ","px;\n  display: flex;\n  flex-direction: column;\n  overflow: auto;\n  line-height: 2;\n"])),Zr),ta=I.default.section(Fr||(Fr=N()(["\n  display: flex;\n  line-height: 0;\n  padding: 5px 0;\n  align-items: center;\n"]))),na=I.default.section(Br||(Br=N()(["\n  display: flex;\n  line-height: 0;\n  padding: 12px 24px 12px 0;\n  margin: 0 12px 0 40px;\n  border-top: 1px solid ",";\n  align-items: start;\n  display: flex;\n  flex-direction: column;\n"])),A.R400),ra=I.default.div(Vr||(Vr=N()(["\n  display: flex;\n  padding: 4px 8px;\n"]))),aa=I.default.span(Wr||(Wr=N()(["\n  color: ",";\n"])),A.N80),ia=function(e){V()(n,e);var t=$r(n);function n(e){var r;v()(this,n),r=t.call(this,e),s()(F()(r),"fireCustomAnalytics",void 0),s()(F()(r),"state",{showClearTextButton:Boolean(r.props.value),validationErrors:r.props.value?r.getValidationErrors(r.props.value):[],lastValue:r.props.value}),s()(F()(r),"prevValue",void 0),s()(F()(r),"closeMediaAltTextMenu",(function(){var e=r.props.view;Pt(e.state,e.dispatch)})),s()(F()(r),"dispatchCancelEvent",(function(e){var t=r.props.view;t.someProp("handleKeyDown",(function(n){return n(t,e)}))})),s()(F()(r),"updateAltText",(function(e){var t=r.props.view;!function(e){return ht((function(e){return!!Object(be.d)(e)&&{type:"updateAltText"}}),(function(t,n){var r=Object(be.b)(n),a=t.selection.from+1;return r&&(t.setMeta("scrollIntoView",!1),t.setNodeMarkup(a,void 0,Ot(Ot({},r.attrs),{},{alt:e}))),t}))}(0===e.length?null:e)(t.state,t.dispatch)})),s()(F()(r),"handleOnChange",(function(e){var t=r.getValidationErrors(e);r.setState({showClearTextButton:Boolean(e),validationErrors:t,lastValue:e},(function(){t&&t.length||r.updateAltText(e)}))})),s()(F()(r),"handleOnBlur",(function(){var e=r.props.value,t=(r.state.lastValue||e||"").trim();r.handleOnChange(t)})),s()(F()(r),"handleClearText",(function(){r.handleOnChange("")}));var a=e.createAnalyticsEvent;return r.fireCustomAnalytics=Object(Xr.a)(a),r}return b()(n,[{key:"componentDidMount",value:function(){this.prevValue=this.props.value}},{key:"componentWillUnmount",value:function(){this.fireAnalytics(we.a.CLOSED),!this.prevValue&&this.props.value&&this.fireAnalytics(we.a.ADDED),this.prevValue&&!this.props.value&&this.fireAnalytics(we.a.CLEARED),this.prevValue&&this.prevValue!==this.props.value&&this.fireAnalytics(we.a.EDITED)}},{key:"getValidationErrors",value:function(e){var t=this.props.altTextValidator;return e&&"function"==typeof t&&t(e)||[]}},{key:"render",value:function(){var e=this.props.intl.formatMessage,t=this.state.showClearTextButton,n=e(Kr.back),r=l.a.createElement(bt.ToolTipContent,{description:n,keymap:bt.escape,shortcutOverride:"Esc"}),a=(this.state.validationErrors||[]).map((function(e,t){return l.a.createElement(Mr.a,{key:t},e)}));return l.a.createElement(ea,null,l.a.createElement(ta,null,l.a.createElement(ra,null,l.a.createElement(pr.a,{title:e(Kr.back),icon:l.a.createElement(Er.a,{label:e(Kr.back)}),tooltipContent:r,onClick:this.closeMediaAltTextMenu})),l.a.createElement(xr.a,{testId:"alt-text-input",placeholder:e(Kr.placeholder),defaultValue:this.state.lastValue,onCancel:this.dispatchCancelEvent,onChange:this.handleOnChange,onBlur:this.handleOnBlur,onSubmit:this.closeMediaAltTextMenu,maxLength:510,autoFocus:!0}),t&&l.a.createElement(ra,null,l.a.createElement(pr.a,{testId:"alt-text-clear-button",title:e(Kr.clear),icon:l.a.createElement(aa,null,l.a.createElement(Qr.a,{label:e(Kr.clear)})),tooltipContent:e(Kr.clear),onClick:this.handleClearText}))),!!a.length&&l.a.createElement(na,null,a),l.a.createElement(Yr,null,e(Kr.supportText)))}},{key:"fireAnalytics",value:function(e){this.props.createAnalyticsEvent&&this.fireCustomAnalytics&&this.fireCustomAnalytics({payload:{action:e,actionSubject:we.b.MEDIA,actionSubjectId:we.c.ALT_TEXT,eventType:we.d.TRACK}})}}]),n}(l.a.Component),oa=Object(Jr.a)()(Object(hr.f)(ia)),sa=n("5tuL");function ca(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function la(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ca(Object(n),!0).forEach((function(t){s()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ca(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var ua,da=function(e,t){var n=Object(be.b)(t),r=n&&n.attrs.alt?Kr.editAltText:Kr.altText,a=e.formatMessage(r);return{title:a,type:"button",onClick:jt,showTitle:!0,testId:"alt-text-edit-button",tooltipContent:l.a.createElement(bt.ToolTipContent,{description:a,keymap:bt.addAltText})}},pa=function(e){return{type:"custom",render:function(t,n){if(!t)return null;var r=Object(be.b)(t.state);return r?l.a.createElement(oa,{view:t,key:n,value:r.attrs.alt,altTextValidator:e&&e.altTextValidator}):null}}},fa=function(e,t){return la(la({},e),{},{width:Zr,className:sa.a.FLOATING_TOOLBAR_COMPONENT,items:[pa(t)]})},ha=n("XkwL"),ma=n.n(ha),va=n("VKpd"),ga=n.n(va),ba=n("qZ6Q"),ya=n.n(ba),Oa=n("+oBr"),wa=n("9JXw"),ka=I.default.div(ua||(ua=N()(["\n  display: flex;\n  align-items: center;\n  margin-right: 4px;\n"]))),Ea=function(e){var t=e.editorState,n=e.mediaLinkingState,r=e.intl,a=e.showSeparatorLeft,i=e.onAddLink,o=e.onEditLink,s=e.onOpenLink,u=Object(c.useState)(!1),d=ma()(u,2),p=d[0],f=d[1];if(Object(c.useEffect)((function(){var e;f(!1);var n=Vt(t);if(n){var r=null===(e=Z.a.getState(t))||void 0===e?void 0:e.mediaClientConfig;r&&qt(n,r).then((function(e){"external"!==e&&"image"!==e||f(!0)}))}}),[t]),!p)return null;if(n&&n.editable){var h=Object(Oa.a)(n.link),m=r.formatMessage(cr.b.editLink),v=r.formatMessage(h?wa.a.openLink:cr.b.unableToOpenLink);return l.a.createElement(l.a.Fragment,null,a&&l.a.createElement(ka,null,l.a.createElement(fr.a,null)),l.a.createElement(ka,null,l.a.createElement(pr.a,{onClick:o,title:m,tooltipContent:l.a.createElement(bt.ToolTipContent,{description:m,keymap:bt.addLink})},m)),l.a.createElement(ka,null,l.a.createElement(fr.a,null)),l.a.createElement(pr.a,{target:"_blank",href:h?n.link:void 0,disabled:!h,onClick:s,title:v,icon:l.a.createElement(ya.a,{label:v}),className:"hyperlink-open-link"}))}var g=r.formatMessage(cr.b.addLink);return l.a.createElement(l.a.Fragment,null,a&&l.a.createElement(ka,null,l.a.createElement(fr.a,null)),l.a.createElement(pr.a,{testId:"add-link-button",onClick:i,title:g,tooltipContent:l.a.createElement(bt.ToolTipContent,{description:g,keymap:bt.addLink}),icon:l.a.createElement(ga.a,{label:g})}))};function Pa(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function ja(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Pa(Object(n),!0).forEach((function(t){s()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Pa(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var xa=function(e,t){return t&&t(Object(M.removeSelectedNode)(e.tr)),!0},Ca=n("9XXW"),Sa=n("0cE9");function Ma(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=K()(e);if(t){var a=K()(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return q()(this,n)}}var _a=function(e){V()(n,e);var t=Ma(n);function n(){var e;v()(this,n);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return e=t.call.apply(t,[this].concat(a)),s()(F()(e),"onUploadStart",(function(t,n){var r=e.props.view,a=r.state,i=r.dispatch;it(t,n)(a,i)})),s()(F()(e),"onClose",(function(){var t=e.props.view,n=t.state,r=t.dispatch;at()(n,r)})),e}return b()(n,[{key:"render",value:function(){var e=this.props.mediaEditorState,t=e.editor,n=e.mediaClientConfig;if(!t||!n)return null;var r=t.identifier;return l.a.createElement(Sa.a,{identifier:r,mediaClientConfig:n,onUploadStart:this.onUploadStart,onClose:this.onClose})}}]),n}(l.a.PureComponent);function Da(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=K()(e);if(t){var a=K()(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return q()(this,n)}}s()(_a,"displayName","MediaEditor");var Na={on:function(){},removeAllListeners:function(){},emit:function(){},destroy:function(){},setUploadParams:function(){}},Ia=function(e){V()(n,e);var t=Da(n);function n(){var e;v()(this,n);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return e=t.call.apply(t,[this].concat(a)),s()(F()(e),"state",{}),s()(F()(e),"handleMediaProvider",function(){var t=h()(O.a.mark((function t(n,r){var a,i,o,s,c,l,u,d;return O.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=e.props,i=a.mediaState,o=a.analyticsName,t.next=3,r;case 3:if((s=t.sent)&&s.uploadParams){t.next=6;break}return t.abrupt("return");case 6:return t.next=8,s.uploadMediaClientConfig;case 8:if(t.t0=t.sent,t.t0){t.next=13;break}return t.next=12,s.viewMediaClientConfig;case 12:t.t0=t.sent;case 13:if(c=t.t0){t.next=16;break}return t.abrupt("return");case 16:return l={mediaClientConfig:c,errorReporter:i.options.errorReporter||new x.a,featureFlags:i.mediaOptions&&i.mediaOptions.featureFlags},t.next=19,new Fe("customMediaPicker",l,Na,ze.d,o).init();case 19:(u=t.sent).onNewMedia(i.insertFile),u.setUploadParams(s.uploadParams),d={uploadParams:s.uploadParams},e.setState({pickerFacadeInstance:u,config:d,mediaClientConfig:c});case 24:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}()),e}return b()(n,[{key:"componentDidMount",value:function(){this.props.mediaState.options.providerFactory.subscribe("mediaProvider",this.handleMediaProvider)}},{key:"componentWillUnmount",value:function(){this.props.mediaState.options.providerFactory.unsubscribe("mediaProvider",this.handleMediaProvider)}},{key:"render",value:function(){var e=this.state,t=e.mediaClientConfig,n=e.config,r=e.pickerFacadeInstance;return t&&n&&r?this.props.children({mediaClientConfig:t,config:n,pickerFacadeInstance:r}):null}}]),n}(l.a.Component),Ta=function(e){var t=e.mediaState,n=e.featureFlags;return l.a.createElement(Ia,{mediaState:t,analyticsName:"clipboard"},(function(e){var t=e.mediaClientConfig,r=e.config,a=e.pickerFacadeInstance;return l.a.createElement(ze.b,{mediaClientConfig:t,config:r,onError:a.handleUploadError,onPreviewUpdate:a.handleUploadPreviewUpdate,onEnd:a.handleReady,featureFlags:n})}))};function Aa(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function La(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Aa(Object(n),!0).forEach((function(t){s()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Aa(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Ra=function(e){var t=e.mediaState,n=e.isActive,r=e.featureFlags;return l.a.createElement(Ia,{mediaState:t,analyticsName:"dropzone"},(function(e){var a=e.mediaClientConfig,i=e.config,o=e.pickerFacadeInstance,s=t.options.customDropzoneContainer,c=t.handleDrag,u=La(La({},i),{},{container:s});return n?l.a.createElement(ze.c,{mediaClientConfig:a,config:u,onError:o.handleUploadError,onPreviewUpdate:o.handleUploadPreviewUpdate,onEnd:o.handleReady,onDragEnter:function(){return c("enter")},onDragLeave:function(){return c("leave")},featureFlags:r}):null}))},Ua=function(e){var t=e.mediaState,n=e.isOpen,r=e.onBrowseFn,a=e.featureFlags;return l.a.createElement(Ia,{mediaState:t,analyticsName:"browser"},(function(e){var t=e.mediaClientConfig,i=e.config,o=e.pickerFacadeInstance;return l.a.createElement(ze.a,{onBrowseFn:r,isOpen:n,config:i,mediaClientConfig:t,onEnd:o.handleReady,onError:o.handleUploadError,onPreviewUpdate:o.handleUploadPreviewUpdate,featureFlags:a})}))};function za(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=K()(e);if(t){var a=K()(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return q()(this,n)}}var Fa=function(e){V()(n,e);var t=za(n);function n(){var e;v()(this,n);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return e=t.call.apply(t,[this].concat(a)),s()(F()(e),"state",{isPopupOpened:!1}),s()(F()(e),"onBrowseFn",(function(t){var n=e.props.mediaState;n&&n.setBrowseFn(t)})),e}return b()(n,[{key:"componentDidMount",value:function(){var e=this;this.props.mediaState.onPopupToggle((function(t){e.setState({isPopupOpened:t})}))}},{key:"render",value:function(){var e=this.props.mediaState,t=this.state.isPopupOpened,n=e.mediaOptions&&e.mediaOptions.featureFlags;return l.a.createElement(l.a.Fragment,null,l.a.createElement(Ta,{mediaState:e,featureFlags:n}),l.a.createElement(Ra,{mediaState:e,isActive:!t,featureFlags:n}),!e.shouldUseMediaPickerPopup()&&l.a.createElement(Ua,{onBrowseFn:this.onBrowseFn,mediaState:e,featureFlags:n}))}}]),n}(l.a.Component);s()(Fa,"displayName","MediaPickerComponents");var Ba=n("8unR");function Va(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=K()(e);if(t){var a=K()(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return q()(this,n)}}var Wa=function(e){V()(n,e);var t=Va(n);function n(){var e;v()(this,n);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return e=t.call.apply(t,[this].concat(a)),s()(F()(e),"renderMediaNodeWithState",(function(t,n,r){return function(a){var i=a.width,o=e.getPos,s=e.reactComponentProps.mediaOptions,c=e.view.state.selection,u=e.getAttrs(),d=u.width,p=u.height;d=d||On.b,p=p||On.a;var f={width:"".concat(i.width,"px"),height:"".concat(p/d*i.width,"px")},h={width:d,height:p};return l.a.createElement(de,{view:e.view,node:e.node,getPos:o,selected:e.isNodeInsideSelection(c.from,c.to)||c instanceof E.NodeSelection&&c.from===o(),originalDimensions:h,maxDimensions:f,mediaProvider:t,contextIdentifierProvider:n,uploadComplete:e.uploadComplete(),mediaOptions:s,collabEditProvider:r})}})),s()(F()(e),"renderMediaNodeWithProviders",(function(t){var n=t.mediaProvider,r=t.contextIdentifierProvider,a=t.collabEditProvider;return l.a.createElement(ln.a,{editorView:e.view,plugins:{width:An.b},render:e.renderMediaNodeWithState(n,r,a)})})),e}return b()(n,[{key:"createDomRef",value:function(){var e=document.createElement("div");return Tn.a.chrome&&this.reactComponentProps.mediaOptions&&this.reactComponentProps.mediaOptions.allowMediaSingleEditable&&(e.contentEditable="true"),e}},{key:"viewShouldUpdate",value:function(e){return this.node.attrs!==e.attrs||Dn()(K()(n.prototype),"viewShouldUpdate",this).call(this,e)}},{key:"stopEvent",value:function(e){if(-1!==["mousedown","contextmenu"].indexOf(e.type)&&2===e.button)return!0;return!1}},{key:"getAttrs",value:function(){return this.node.attrs}},{key:"uploadComplete",value:function(){return Ae(Z.a.getState(this.view.state),this.node.attrs.id)}},{key:"render",value:function(){var e=this.reactComponentProps.providerFactory;return l.a.createElement(dn.a,{providers:["mediaProvider","contextIdentifierProvider","collabEditProvider"],providerFactory:e,renderNode:this.renderMediaNodeWithProviders})}}]),n}(n("Dol8").a),qa=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return function(a,i,o){return new Wa(a,i,o,e,t,{eventDispatcher:t,providerFactory:n,mediaOptions:r}).init()}},Ga={allowResizing:!0,allowAdvancedToolBarOptions:!0,allowResizingInTables:!1,allowAnnotation:!0,UNSAFE_allowImageCaptions:!0};function Ka(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Ha(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ka(Object(n),!0).forEach((function(t){s()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ka(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Qa=function(e){return{name:"media",nodes:function(){var t=e||{},n=t.allowMediaGroup,r=void 0===n||n,a=t.allowMediaSingle,i=void 0!==a&&a,o=t.UNSAFE_allowImageCaptions,s=void 0!==o&&o?u.b:u.a;return[{name:"mediaGroup",node:d.a},{name:"mediaSingle",node:s},{name:"media",node:p.b}].filter((function(e){return"mediaGroup"===e.name?r:"mediaSingle"!==e.name||i}))},pmPlugins:function(){var t=[{name:"media",plugin:function(t){t.schema;var n=t.dispatch,r=t.eventDispatcher,a=t.providerFactory,i=t.errorReporter,o=t.portalProviderAPI,s=t.reactContext,c=t.dispatchAnalyticsEvent;return He(0,{providerFactory:a,nodeViews:{mediaGroup:Mn(o,r,a,e),mediaSingle:rr(o,r,a,c,e),media:qa(o,r,a,e)},errorReporter:i,uploadErrorHandler:e&&e.uploadErrorHandler,waitForMediaUpload:e&&e.waitForMediaUpload,customDropzoneContainer:e&&e.customDropzoneContainer,customMediaPicker:e&&e.customMediaPicker,allowResizing:!(!e||!e.allowResizing)},s,n,e)}},{name:"mediaKeymap",plugin:function(){return an()}}];return e&&e.allowMediaSingle&&t.push({name:"mediaSingleKeymap",plugin:function(e){return function(e){var t={},n=_t(e);return bt.bindKeymapWithCommand(bt.backspace.common,n,t),Object(gt.b)(t)}(e.schema)}}),e&&e.allowAnnotation&&t.push({name:"mediaEditor",plugin:st}),e&&e.allowAltTextOnImages&&(t.push({name:"mediaAltText",plugin:vt}),t.push({name:"mediaAltTextKeymap",plugin:function(e){var t;e.schema;return t={},bt.bindKeymapWithCommand(bt.addAltText.common,jt,t),bt.bindKeymapWithCommand(bt.escape.common,Pt,t),Object(gt.b)(t)}})),e&&e.allowLinking&&(t.push({name:"mediaLinking",plugin:function(e){return function(e){return new E.Plugin({key:At,state:Rt.createPluginState(e,Lt)})}(e.dispatch)}}),t.push({name:"mediaLinkingKeymap",plugin:function(e){var t;e.schema;return t={},bt.bindKeymapWithCommand(bt.addLink.common,Qt,t),Object(gt.b)(t)}})),t},contentComponent:function(t){var n=t.editorView,r=t.eventDispatcher,a=e&&e.allowAnnotation?l.a.createElement(ln.a,{editorView:n,plugins:{mediaEditorState:$e},eventDispatcher:r,render:function(e){var t=e.mediaEditorState;return l.a.createElement(_a,{mediaEditorState:t,view:n})}}):null;return l.a.createElement(l.a.Fragment,null,l.a.createElement(ln.a,{editorView:n,plugins:{mediaState:Z.a},render:function(e){var t=e.mediaState;return l.a.createElement(Fa,{mediaState:t})}}),a)},secondaryToolbarComponent:function(e){var t=e.editorView,n=e.eventDispatcher,r=e.disabled;return l.a.createElement(un,{editorView:t,eventDispatcher:n,pluginKey:Z.a,isDisabled:r,isReducedSpacing:!0})},pluginsOptions:{quickInsert:function(e){var t=e.formatMessage;return[{id:"media",title:t(Ba.a.filesAndImages),description:t(Ba.a.filesAndImagesDescription),priority:400,keywords:["attachment","gif","media","picture"],icon:function(){return l.a.createElement(Ca.j,{label:t(Ba.a.filesAndImages)})},action:function(e,t){Z.a.getState(t).showMediaPicker();var n=e("");return Object(ke.a)(t,n,{action:we.a.OPENED,actionSubject:we.b.PICKER,actionSubjectId:we.c.PICKER_CLOUD,attributes:{inputMethod:we.e.QUICK_INSERT},eventType:we.d.UI})}}]},floatingToolbar:function(t,n,r){return function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=n.providerFactory,a=n.allowResizing,i=n.allowAnnotation,o=n.allowLinking,s=n.allowAdvancedToolBarOptions,c=n.allowResizingInTables,u=n.allowAltTextOnImages,d=n.altTextValidator,p=e.schema.nodes.mediaSingle,f=Z.a.getState(e),h=zt(e);if(p&&f){var m={title:"Media floating controls",nodeType:p,getDomRef:function(){return f.element}};if(o&&h&&h.visible&&Rr(e)){var v=qr(m,h,e,t,r);if(v)return v}var g=[];if(s){if((g=Object(Gr.a)(e,t,e.schema.nodes.mediaSingle,a,c)).length&&i&&g.push({type:"custom",render:wr(f,t)}),o&&Rr(e)){var b=g.length>0;g.push({type:"custom",render:function(e,n){if(null!=e&&e.state){var r=function(){if(e){var t=e.state,n=e.dispatch;Ht(t,n)}};return l.a.createElement(Ea,{key:n,editorState:e.state,intl:t,mediaLinkingState:h,onAddLink:r,onEditLink:r,onOpenLink:function(){if(e){var t=e.state;return(0,e.dispatch)(Object(ke.a)(t,t.tr,{eventType:we.d.TRACK,action:we.a.VISITED,actionSubject:we.b.MEDIA,actionSubjectId:we.c.LINK})),!0}},showSeparatorLeft:b})}return null}})}g.length&&g.push({type:"separator"})}if(u){var y=mt(e);if(y.isAltTextEditorOpen)return fa(m,{altTextValidator:d});g.push(da(t,e),{type:"separator"})}var O=[].concat(ir()(g),[{type:"button",appearance:"danger",icon:sr.a,onMouseEnter:Object(lr.b)(p,!0),onMouseLeave:Object(lr.b)(p,!1),title:t.formatMessage(cr.a.remove),onClick:xa,testId:"media-toolbar-remove-button"}]);return ja(ja({},m),{},{items:O})}}(t,n,{providerFactory:r,allowResizing:e&&e.allowResizing,allowResizingInTables:e&&e.allowResizingInTables,allowAnnotation:e&&e.allowAnnotation,allowLinking:e&&e.allowLinking,allowAdvancedToolBarOptions:e&&e.allowAdvancedToolBarOptions,allowAltTextOnImages:e&&e.allowAltTextOnImages,altTextValidator:e&&e.altTextValidator})}}}};t.a=function(e){return Qa(Ha(Ha({},e),Ga))}},ct2w:function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var r=function(e){return!!e&&(e.indexOf("image/")>-1||e.indexOf("video/")>-1)}},dmP3:function(e){e.exports=JSON.parse('{"Notes":{"Add":{"add_note":"Добавить заметку"},"Delete":{"delete_note":"Удалить","deleted":"Заметка перемещена в корзину вашего Диска","failed":"Не удалось удалить заметку, попробуйте снова"},"EditorView":{"main_placeholder":"Напишите что-нибудь…"},"Editor":{"title_placeholder":"Напишите заголовок","exit_confirmation_message":"Автоматическое сохранение не учло последние изменения в вашем документе. Пожалуйста, оставайтесь на текущей заметке, если хотите сохранить их.","exit_confirmation_title":"Отменить изменения?","exit_confirmation_leave":"Выйти без сохранения","exit_confirmation_cancel":"Отмена","read_only":"Эта заметка доступна только для чтения."},"Files":{"share":{"cta":"Поделиться"}},"List":{"latest_notes":"Последние заметки","name":"Название","updated_at":"Обновлено","location":"Расположение","sharings":"Доступы","at":"%{date} в %{time}"},"Empty":{"welcome":"Добро пожаловать в Twake Notes","after_created":"После создания заметки вы найдете ее в своем "},"SavingIndicator":{"saved":{"default":"Сохранено","just_now":"Сохранено","secs_ago":"Сохранено (%{time} сек. назад)","min_ago":"Сохранено (%{time} мин. назад)","mins_ago":"Сохранено (%{time} мин. назад)","hour_ago":"Сохранено (%{time} час назад)","hours_ago":"Сохранено (%{time} часа(-ов) назад)","day_ago":"Сохранено (%{time} день назад)","days_ago":"Сохранено (%{time} дня(-ей) назад)","month_ago":"Сохранено (%{time} месяц назад)","monthes_ago":"Сохранено (%{time} месяца(-ев) назад)","year_ago":"Сохранено (%{time} год назад)","years_ago":"Сохранено (%{time} лет назад)"},"saving":"Сохранение...","still_saving":"Сохранение......","out_of_sync":{"default":"Сохранено (не в сети)","just_now":"Сохранено (не в сети)","secs_ago":"Сохранено (не в сети %{time} сек)","min_ago":"Сохранено (не в сети %{time} мин)","mins_ago":"Сохранено (не в сети %{time} мин)","hour_ago":"Сохранено (не в сети %{time} час)","hours_ago":"Сохранено (не в сети %{time} часа(-ов))","day_ago":"Сохранено (не в сети %{time} день)","days_ago":"Сохранено (не в сети %{time} дня(-ей))","month_ago":"Сохранено (не в сети %{time} месяц)","monthes_ago":"Сохранено (не в сети %{time} месяца(-ев))","year_ago":"Сохранено (не в сети %{time} год)","years_ago":"Сохранено (не в сети %{time} лет)"},"saving_impossible":{"default":"Изменения не сохранены (не в сети)","just_now":"Изменения не сохранены (не в сети)","secs_ago":"Изменения не сохранены (не в сети %{time} сек)","min_ago":"Изменения не сохранены (не в сети %{time} мин)","mins_ago":"Изменения не сохранены (не в сети %{time} мин)","hour_ago":"Изменения не сохранены (не в сети %{time} час)","hours_ago":"Изменения не сохранены (не в сети %{time} часа(-ов))","day_ago":"Изменения не сохранены (не в сети %{time} день)","days_ago":"Изменения не сохранены (не в сети %{time} дня(-ей))","month_ago":"Изменения не сохранены (не в сети %{time} месяц)","monthes_ago":"Изменения не сохранены (не в сети %{time} месяца(-ев))","year_ago":"Изменения не сохранены (не в сети %{time} год)","years_ago":"Изменения не сохранены (не в сети %{time} лет)"}},"OfflineIndicator":{"message":"Вы больше не подключены к интернету. Ваши изменения будут сохранены после восстановления соединения."}},"Error":{"422":"Принимаются только изображения","unshared_title":"Доступ больше не активен","unshared_text":"Владелец мог отозвать доступ. Вы больше не можете редактировать заметку по этому адресу.","loading_error_title":"Не удалось загрузить заметку","loading_error_text_noReturnUrl":"Заметка могла быть удалена, или на серверах возникли временные неполадки. Пожалуйста, попробуйте позже.","back":"назад","unknown_error":"Произошла непредвиденная ошибка","only_one_image":"Нельзя перетаскивать несколько изображений одновременно"},"manifest":{"short_description":"Twake Notes — это ваше личное и совместное приложение для заметок.","long_description":"Notes — это онлайн-редактор текста, который уже может предложить вам:\\n\\n* Создавать свои заметки с основными функциями (жирный, подчеркивание, ссылки, таблицы...)\\n* Хранить и находить заметки среди других документов в вашем личном Диске\\n* Легко редактировать заметки с любых устройств\\n* Доступ к заметкам в автономном режиме\\n* Для фанатов: использование горячих клавиш и ввод в формате markdown ... и даже совместное редактирование заметок с другими пользователями (скоро)!","screenshots":["screenshots/en/screenshot01.png","screenshots/en/screenshot02.png"]},"Intents":{"save":"Сохранить"},"TrashedBanner":{"text":"Элемент перемещен в корзину","redirect":"Открыть корзину","restore":"Восстановить","restoreSuccess":"Элемент восстановлен","restoreError":"Произошла ошибка, попробуйте снова.","destroy":"Удалить навсегда"},"DestroyConfirm":{"title":"Удалить навсегда?","forbidden":"Вы больше не сможете получить доступ к этому файлу.","restore":"Вы не сможете восстановить этот файл, если у вас нет резервной копии.","cancel":"Отмена","delete":"Удалить навсегда","deleteError":"Произошла ошибка, попробуйте снова."},"MoreButton":{"more":"Еще"}}')},eUFy:function(e,t,n){var r={"./atlassian_missing_french":"xyGe","./atlassian_missing_french.json":"xyGe","./en":"2maa","./en.json":"2maa","./fr":"Hsuv","./fr.json":"Hsuv","./ru":"dmP3","./ru.json":"dmP3","./vi":"GwML","./vi.json":"GwML"};function a(e){var t=i(e);return n(t)}function i(e){if(!n.o(r,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return r[e]}a.keys=function(){return Object.keys(r)},a.resolve=i,e.exports=a,a.id="eUFy"},hhV5:function(e,t,n){e.exports={"sharing-button":"sharing-button--nzFli"}},jXUu:function(e,t,n){"use strict";var r=n("GeFe"),a=n.n(r),i=n("Zvb3"),o=n.n(i),s=n("J/YY"),c=n.n(s),l=n("a1Fv"),u=n.n(l),d=n("g3eI"),p=n.n(d),f=n("wDGE"),h=n.n(f),m=n("J58c"),v=n.n(m),g=n("ivGQ"),b=n.n(g),y=n("dKM3"),O=n("zy2m"),w=n("G09D");function k(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=h()(e);if(t){var a=h()(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return p()(this,n)}}var E=function(e){u()(n,e);var t=k(n);function n(e){var r;return a()(this,n),r=t.call(this,e),v()(c()(r),"handleRef",(function(e){r.setState({target:e||void 0})})),v()(c()(r),"updatePopupPlacement",(function(e){r.setState({popupPlacement:e})})),r.state={popupPlacement:["bottom","left"]},r}return o()(n,[{key:"renderDropdown",value:function(){var e=this.state.target,t=this.props,n=t.children,r=t.mountTo,a=t.boundariesElement,i=t.scrollableElement,o=t.onOpenChange,s=t.fitHeight,c=t.fitWidth,l=t.zIndex;return b.a.createElement(O.a,{target:e,mountTo:r,boundariesElement:a,scrollableElement:i,onPlacementChanged:this.updatePopupPlacement,fitHeight:s,fitWidth:c,zIndex:l},b.a.createElement("div",{style:{height:0,minWidth:c||0}},b.a.createElement(y.a,{disabled:!0,isOpen:!0,onOpenChange:o,appearance:"tall",position:"top left",shouldFlip:!1,shouldFitContainer:!0},n)))}},{key:"render",value:function(){var e=this.props,t=e.trigger,n=e.isOpen;return b.a.createElement(b.a.Fragment,null,b.a.createElement("div",{ref:this.handleRef},t),n?this.renderDropdown():null)}}]),n}(g.PureComponent),P=Object(w.a)(E);t.a=P},k359:function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var r=new(n("4z1N").PluginKey)("mediaPlugin")},nXPL:function(e,t,n){"use strict";n.r(t),n.d(t,"initApp",(function(){return W}));var r=n("J58c"),a=n.n(r),i=(n("QLHQ"),n("k37E"),n("woVZ"),n("bvF7")),o=n("+2kq"),s=n("QNBQ"),c=n("0Cco"),l=n("cyLt"),u=n("f2KQ"),d=n("QJcL"),p=n("q5Wy"),f=n("v2Ur"),h=n("euuj"),m=n.n(h),v=n("ivGQ"),g=n.n(v),b=n("Y/FK"),y=n.n(b),O=n("qwOa"),w=n("P0ff"),k=n("VjF3"),E=(n("AdhS"),n("oULE"),n("xEu0")),P=n.n(E),j=n("xzHV"),x=n("8ZpT"),C=n.n(x),S=n("HROS"),M=n("+s1f"),_=n("I6L4"),D=n("9sfc"),N=(n("cRRo"),n("5LIP")),I=n("Aaol"),T=n("0Lot"),A=n("BqmN"),L=n("4vUV");function R(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function U(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?R(Object(n),!0).forEach((function(t){a()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):R(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var z=n("5z4W"),F=n("xyGe"),B={en:{react:n("WNgr"),atlaskit:i.a},fr:{react:n("5mip"),atlaskit:U(U({},o.a),F)},ru:{react:n("TqgK"),atlaskit:s.a},vi:{react:n("/Uvb"),atlaskit:c.vi}},V=Object(T.a)({disableGlobal:!0}),W=function(){var e=Object(f.b)(),t=Object(f.a)(e.app.slug,z.slug),n=Object(f.a)(e.app.version,z.version);Object(O.d)(B.en.react),Object(O.d)(B.fr.react),Object(O.d)(B.ru.react),Object(O.d)(B.vi.react);var r=Object(f.a)(e.locale,"en"),a=["en","fr","ru","vi"].includes(r)?r:"en",i=window.location?window.location.protocol:"https:",o=Object(f.c)(),s=e.token,c=Boolean(o),p=new P.a({uri:"".concat(i,"//").concat(e.domain),token:s,autoHydrate:!0,appMetadata:{slug:t,version:n}});return j.Document.cozyClient||j.Document.registerClient(p),p.registerPlugin(M.RealtimePlugin),p.registerPlugin(C.a.plugin),c||(window.React=g.a,window.ReactDOM=y.a,u.a({dsn:"https://16c26a60d9019eea9d9a9775573e3765@errors.cozycloud.cc/73",environment:"production",release:z.version,integrations:[new l.a({levels:["error"]}),d.a({useEffect:g.a.useEffect,useLocation:w.A,useNavigationType:w.F,createRoutesFromChildren:w.q,matchRoutes:k.r})],tracesSampleRate:.1,ignoreErrors:[/^Warning: /],defaultIntegrations:!1})),{appLocale:a,client:p,isPublic:c}},q=m()(W);document.addEventListener("DOMContentLoaded",(function(){var e=q();!function(e,t,r){var a=n("Q6Vf").default;Object(b.render)(g.a.createElement(S.WebviewIntentProvider,null,g.a.createElement(I.default,{lang:e,dictRequire:function(e){return n("eUFy")("./".concat(e))}},g.a.createElement(A.b,{generateClassName:V},g.a.createElement(O.c,{locale:e,messages:B[e].atlaskit},g.a.createElement(E.CozyProvider,{client:t},g.a.createElement(N.default,{ignoreCozySettings:r},g.a.createElement(p.a.Provider,{value:r},g.a.createElement(_.a,{doctype:"io.cozy.files",documentType:"Notes",previewPath:L.h,isPublic:r},g.a.createElement(D.a,null,g.a.createElement(a,{isPublic:r})))))))))),document.querySelector("[role=application]"))}(e.appLocale,e.client,e.isPublic)}))},o9PO:function(e,t,n){e.exports={banner:"banner--MWCHK",grid:"grid--1HNmF",chip:"chip--3hU4-"}},q5Wy:function(e,t,n){"use strict";var r=n("ivGQ"),a=n.n(r).a.createContext(!1);t.a=a},uU7o:function(e,t,n){"use strict";n.d(t,"a",(function(){return r})),n.d(t,"b",(function(){return a}));var r=function(e){return null!==e&&"string"!=typeof e&&e},a=function(e){var t;return(null===(t=/(.+)(\/.+)$/.exec(e))||void 0===t?void 0:t[1])||e}},upXl:function(e,t,n){e.exports={"note-article":"note-article--2yQdC","note-article--intents":"note-article--intents--ghgU0",banner:"banner--1nSEd",title:"title--2DQ8I",titleInput:"titleInput--2ERlh"}},"v/Qj":function(e,t,n){"use strict";var r=n("q5Wy"),a=n("bOB9"),i=n("ivGQ"),o=n("xEu0");t.a=function(){var e=Object(o.useClient)(),t=Object(i.useContext)(r.a),n=Object(i.useMemo)((function(){return Object(a.k)()||(t?"?":Object(a.j)(e))}),[e,t]);return{userId:n,userName:n}}},v2Ur:function(e,t,n){"use strict";n.d(t,"b",(function(){return r})),n.d(t,"a",(function(){return a})),n.d(t,"c",(function(){return i}));n("wlqn");var r=function(){var e=document.querySelector("[role=application]");return JSON.parse(e.dataset.cozy)},a=function(e,t){return/^\{\{\.[a-zA-Z]*\}\}$/.test(e)?t:e},i=function(){return new URLSearchParams(window.location.search).get("sharecode")}},xyGe:function(e){e.exports=JSON.parse('{"fabric.editor.editMode.inviteToEditButton.title":"Inviter à éditer","fabric.editor.blockquote2":"Citation","fabric.editor.remove":"Supprimer","fabric.editor.linkPlaceholder":"Coller le lien","fabric.editor.linkAddress":"Adresse du lien","fabric.editor.layoutWide":"Élargir","fabric.editor.layoutFullWidth":"Pleine largeur","fabric.editor.layoutFixedWidth":"Retour au centre","fabric.editor.alignImageLeft":"Aligner l\'image à gauche","fabric.editor.alignImageCenter":"Centrer l\'image","fabric.editor.alignImageRight":"Aligner l\'image à droite","fabric.editor.numberedColumn":"Lignes numérotées","fabric.editor.taskPlaceholder":"Saisissez votre action"}')}});