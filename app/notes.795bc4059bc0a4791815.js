!function(e){function t(t){for(var r,o,s=t[0],c=t[1],l=t[2],d=0,p=[];d<s.length;d++)o=s[d],Object.prototype.hasOwnProperty.call(i,o)&&i[o]&&p.push(i[o][0]),i[o]=0;for(r in c)Object.prototype.hasOwnProperty.call(c,r)&&(e[r]=c[r]);for(u&&u(t);p.length;)p.shift()();return a.push.apply(a,l||[]),n()}function n(){for(var e,t=0;t<a.length;t++){for(var n=a[t],r=!0,s=1;s<n.length;s++){var c=n[s];0!==i[c]&&(r=!1)}r&&(a.splice(t--,1),e=o(o.s=n[0]))}return e}var r={},i={4:0},a=[];function o(t){if(r[t])return r[t].exports;var n=r[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,o),n.l=!0,n.exports}o.e=function(e){var t=[],n=i[e];if(0!==n)if(n)t.push(n[2]);else{var r=new Promise((function(t,r){n=i[e]=[t,r]}));t.push(n[2]=r);var a,s=document.createElement("script");s.charset="utf-8",s.timeout=120,o.nc&&s.setAttribute("nonce",o.nc),s.src=function(e){return o.p+"vendors/"+({2:"@atlaskit-internal-editor-core-config-panel",3:"@atlaskit-internal_media-card"}[e]||e)+"."+{2:"bcd61036dc4dca7d337a",3:"848ba7058fc0419c657a"}[e]+".js"}(e);var c=new Error;a=function(t){s.onerror=s.onload=null,clearTimeout(l);var n=i[e];if(0!==n){if(n){var r=t&&("load"===t.type?"missing":t.type),a=t&&t.target&&t.target.src;c.message="Loading chunk "+e+" failed.\n("+r+": "+a+")",c.name="ChunkLoadError",c.type=r,c.request=a,n[1](c)}i[e]=void 0}};var l=setTimeout((function(){a({type:"timeout",target:s})}),12e4);s.onerror=s.onload=a,document.head.appendChild(s)}return Promise.all(t)},o.m=e,o.c=r,o.d=function(e,t,n){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)o.d(n,r,function(t){return e[t]}.bind(null,r));return n},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="",o.oe=function(e){throw console.error(e),e};var s=window.webpackJsonp=window.webpackJsonp||[],c=s.push.bind(s);s.push=t,s=s.slice();for(var l=0;l<s.length;l++)t(s[l]);var u=c;a.push([6,0,1]),n()}({0:function(e,t){},1:function(e,t){},2:function(e,t){},"2maa":function(e){e.exports=JSON.parse('{"Notes":{"Add":{"add_note":"Add a note"},"Delete":{"delete_note":"Delete","deleted":"The note has been moved to the trash of your Drive","failed":"The note could not be deleted, please try again"},"EditorView":{"main_placeholder":"Write anything…"},"Editor":{"title_placeholder":"Write your title","exit_confirmation_message":"Automatic saving has not taken into account the latest changes in your doc. Please stay on your current note if you want to keep them.","exit_confirmation_title":"Abandon your changes?","exit_confirmation_leave":"Leave without saving","exit_confirmation_cancel":"Cancel","read_only":"This note is in read-only mode."},"Files":{"share":{"cta":"Share"}},"List":{"latest_notes":"Latest Notes","name":"Name","updated_at":"Updated at","location":"Location","sharings":"Sharings","at":"%{date} at %{time}"},"Empty":{"welcome":"Welcome on Cozy Notes","after_created":"Once your Note is created, you can find it in your "},"SavingIndicator":{"saved":{"default":"Up to date","just_now":"Up to date","secs_ago":"Up to date (saved %{time} sec. ago)","min_ago":"Up to date (saved %{time} min. ago)","mins_ago":"Up to date (saved %{time} min. ago)","hour_ago":"Up to date (saved %{time} hour ago)","hours_ago":"Up to date (saved %{time} hours ago)","day_ago":"Up to date (saved %{time} day ago)","days_ago":"Up to date (saved %{time} days ago)","month_ago":"Up to date (saved %{time} month ago)","monthes_ago":"Up to date (saved %{time} monthes ago)","year_ago":"Up to date (saved %{time} year ago)","years_ago":"Up to date (saved %{time} years ago)"},"saving":"Saving...","still_saving":"Saving......","out_of_sync":{"default":"Saved (off-line)","just_now":"Saved (off-line)","secs_ago":"Saved (off-line for %{time} sec)","min_ago":"Saved (off-line for %{time} min)","mins_ago":"Saved (off-line for %{time} min)","hour_ago":"Saved (off-line for %{time} hour)","hours_ago":"Saved (off-line for %{time} hours)","day_ago":"Saved (off-line for %{time} day)","days_ago":"Saved (off-line for %{time} days)","month_ago":"Saved (off-line for %{time} month)","monthes_ago":"Saved (off-line for %{time} monthes)","year_ago":"Saved (off-line for %{time} year)","years_ago":"Saved (off-line for %{time} years)"},"saving_impossible":{"default":"Changes unsaved (off-line)","just_now":"Changes unsaved (off-line)","secs_ago":"Changes unsaved (off-line for %{time} sec)","min_ago":"Changes unsaved (off-line for %{time} min)","mins_ago":"Changes unsaved (off-line for %{time} min)","hour_ago":"Changes unsaved (off-line for %{time} hour)","hours_ago":"Changes unsaved (off-line for %{time} hours)","day_ago":"Changes unsaved (off-line for %{time} day)","days_ago":"Changes unsaved (off-line for %{time} days)","month_ago":"Changes unsaved (off-line for %{time} month)","monthes_ago":"Changes unsaved (off-line for %{time} monthes)","year_ago":"Changes unsaved (off-line for %{time} year)","years_ago":"Changes unsaved (off-line for %{time} years)"}},"OfflineIndicator":{"message":"You\'re not connected to internet anymore. Your changes will be saved once you will be connected again."}},"Error":{"422":"Only images are accepted","unshared_title":"This share is no longer active","unshared_text":"The owner may have revoked this sharing. You can no longer edit a note at this address.","loading_error_title":"The note couldn\'t be loaded","loading_error_text_noReturnUrl":"The note may not exists anymore, or our servers may have a temporary glitch. Please try again later.","back":"back","unknown_error":"An unexpected error occured","only_one_image":"You cannot drag and drop multiple pictures at the same time"},"manifest":{"short_description":"Cozy Notes is your personal and collaborative note-taking application.","long_description":"Notes is an online text editor that can already offer you to:\\n\\n* Create your own notes with the essential features (bold, underlined, links, tables...)\\n* Fill and find your notes with you other documents in files of your personal Drive\\n* Edit easily your notes from all your devices\\n* Access your notes offline\\n* For the fans, use shortcuts and input in markdown format ... and even write with contacts together on the same note (coming soon)!","screenshots":["screenshots/en/screenshot01.png","screenshots/en/screenshot02.png"]},"Intents":{"save":"Save"},"TrashedBanner":{"text":"The item has been trashed","redirect":"Open the trash","restore":"Restore","restoreSuccess":"The item has been restored","restoreError":"An error has occurred, please try again.","destroy":"Delete permanently"},"DestroyConfirm":{"title":"Permanently delete?","forbidden":"You won\'t be able to access this file anymore.","restore":"You won\'t be able to restore this file if you didn\'t make a backup.","cancel":"Cancel","delete":"Delete permanently","deleteError":"An error has occurred, please try again."}}')},"2pt2":function(e,t,n){var r={"./_lib/build_formatting_tokens_reg_exp/index.js":"fQxh","./ar/build_distance_in_words_locale/index.js":"7ale","./ar/build_format_locale/index.js":"BUJk","./ar/index.js":"HoPF","./be/build_distance_in_words_locale/index.js":"rXT6","./be/build_format_locale/index.js":"6c7I","./be/index.js":"y+wm","./bg/build_distance_in_words_locale/index.js":"QV4S","./bg/build_format_locale/index.js":"h7EV","./bg/index.js":"6drF","./ca/build_distance_in_words_locale/index.js":"wVGO","./ca/build_format_locale/index.js":"qOJT","./ca/index.js":"J4Lj","./cs/build_distance_in_words_locale/index.js":"qeVT","./cs/build_format_locale/index.js":"9c+d","./cs/index.js":"jOEl","./da/build_distance_in_words_locale/index.js":"P7Gw","./da/build_format_locale/index.js":"ILGm","./da/index.js":"qqlu","./de/build_distance_in_words_locale/index.js":"Y5iN","./de/build_format_locale/index.js":"P5x0","./de/index.js":"1aUX","./el/build_distance_in_words_locale/index.js":"42PH","./el/build_format_locale/index.js":"wtRR","./el/index.js":"Nutn","./en/build_distance_in_words_locale/index.js":"jiHV","./en/build_format_locale/index.js":"Fyqn","./en/index.js":"mnDI","./eo/build_distance_in_words_locale/index.js":"+LkS","./eo/build_format_locale/index.js":"+W4M","./eo/index.js":"CG0c","./es/build_distance_in_words_locale/index.js":"zthh","./es/build_format_locale/index.js":"qi+F","./es/index.js":"jiRl","./fi/build_distance_in_words_locale/index.js":"+5Qr","./fi/build_format_locale/index.js":"y4fA","./fi/index.js":"kPjA","./fil/build_distance_in_words_locale/index.js":"yta+","./fil/build_format_locale/index.js":"A/Ua","./fil/index.js":"HcOy","./fr/build_distance_in_words_locale/index.js":"dS4D","./fr/build_format_locale/index.js":"yxzQ","./fr/index.js":"9cqe","./hr/build_distance_in_words_locale/index.js":"Z4qh","./hr/build_format_locale/index.js":"GXOL","./hr/index.js":"rGV6","./hu/build_distance_in_words_locale/index.js":"A6Uc","./hu/build_format_locale/index.js":"+c4x","./hu/index.js":"fxkC","./id/build_distance_in_words_locale/index.js":"riUr","./id/build_format_locale/index.js":"siJb","./id/index.js":"SJjQ","./is/build_distance_in_words_locale/index.js":"ROjY","./is/build_format_locale/index.js":"qi1n","./is/index.js":"KnO/","./it/build_distance_in_words_locale/index.js":"6Ku4","./it/build_format_locale/index.js":"YYsG","./it/index.js":"nOHs","./ja/build_distance_in_words_locale/index.js":"L5XS","./ja/build_format_locale/index.js":"SxiJ","./ja/index.js":"XIbb","./ko/build_distance_in_words_locale/index.js":"Hbvh","./ko/build_format_locale/index.js":"cEgd","./ko/index.js":"szAg","./mk/build_distance_in_words_locale/index.js":"FaeQ","./mk/build_format_locale/index.js":"sIRx","./mk/index.js":"Caof","./nb/build_distance_in_words_locale/index.js":"NrmK","./nb/build_format_locale/index.js":"S7yZ","./nb/index.js":"Rk98","./nl/build_distance_in_words_locale/index.js":"BZiP","./nl/build_format_locale/index.js":"HdNd","./nl/index.js":"J+GK","./pl/build_distance_in_words_locale/index.js":"Ky9W","./pl/build_format_locale/index.js":"uxkL","./pl/index.js":"0x8W","./pt/build_distance_in_words_locale/index.js":"pN3j","./pt/build_format_locale/index.js":"RFRV","./pt/index.js":"lwnL","./ro/build_distance_in_words_locale/index.js":"JAuI","./ro/build_format_locale/index.js":"j1sQ","./ro/index.js":"gHE0","./ru/build_distance_in_words_locale/index.js":"7ryk","./ru/build_format_locale/index.js":"cTIL","./ru/index.js":"8J30","./sk/build_distance_in_words_locale/index.js":"2oAD","./sk/build_format_locale/index.js":"jVdS","./sk/index.js":"a5Cf","./sl/build_distance_in_words_locale/index.js":"m2c+","./sl/build_format_locale/index.js":"l1+s","./sl/index.js":"qHQe","./sr/build_distance_in_words_locale/index.js":"h7wD","./sr/build_format_locale/index.js":"oLNh","./sr/index.js":"oBDG","./sv/build_distance_in_words_locale/index.js":"RjDH","./sv/build_format_locale/index.js":"LRUT","./sv/index.js":"9KBP","./th/build_distance_in_words_locale/index.js":"SjuW","./th/build_format_locale/index.js":"yHKE","./th/index.js":"rRsv","./tr/build_distance_in_words_locale/index.js":"oPNn","./tr/build_format_locale/index.js":"JNO2","./tr/index.js":"Ra5m","./zh_cn/build_distance_in_words_locale/index.js":"+qzK","./zh_cn/build_format_locale/index.js":"EDbf","./zh_cn/index.js":"SUby","./zh_tw/build_distance_in_words_locale/index.js":"HKTt","./zh_tw/build_format_locale/index.js":"L1Oa","./zh_tw/index.js":"ZoqY"};function i(e){var t=a(e);return n(t)}function a(e){if(!n.o(r,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return r[e]}i.keys=function(){return Object.keys(r)},i.resolve=a,e.exports=i,i.id="2pt2"},3:function(e,t){},"3xVv":function(e,t,n){"use strict";n.d(t,"d",(function(){return E})),n.d(t,"b",(function(){return P})),n.d(t,"c",(function(){return C})),n.d(t,"e",(function(){return _})),n.d(t,"a",(function(){return M}));var r=n("J58c"),i=n.n(r),a=n("iO45"),o=n("9Jaj"),s=n("laKe"),c=n("bHTr"),l=n("WISH"),u=n("3mYb"),d=n("PuAp"),p=n("CDNI"),f=n("I/PM"),h=n("AV8T"),m=n("3sCF"),v=n("Eh77"),b=n("OZn/"),g=n("ct2w"),y=n("3Su3");function w(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function O(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?w(Object(n),!0).forEach((function(t){i()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):w(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var k=function(e,t){return{action:h.a.INSERTED,actionSubject:h.b.DOCUMENT,actionSubjectId:h.c.MEDIA,attributes:{inputMethod:e,fileExtension:t,type:h.c.MEDIA_SINGLE},eventType:h.d.TRACK}};function x(e){return Object(y.a)(e)&&!Object(u.d)(e.selection,e.doc,d.g)}function j(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return function(n,r){var i=n.tr,o=n.schema.nodes.paragraph,s=t.inputMethod,c=t.fileExtension,l=0;return x(n)&&(e.push(o.create()),l=1),i.replaceSelection(new a.Slice(a.Fragment.from(e),0,l)),s&&Object(m.a)(n,i,k(s,c)),r&&r(i),!0}}var E=function(e,t){return!!e.nodes.mediaSingle&&Object(g.a)(t)},P=function(e,t,n){var r=e.state,i=e.dispatch,a=r.schema.nodes,o=a.mediaSingle,s=a.media;return!!o&&(!(t.type!==s||!Object(g.a)(t.attrs.__fileMimeType)&&"external"!==t.attrs.type)&&j([o.create({},t)],{inputMethod:n,fileExtension:t.attrs.__fileMimeType})(r,i))},C=function(e,t,n,r,i){if(void 0===r)return!1;var s,c=e.state,l=e.dispatch,u=c.selection.$from.node(-1),d=S(c.schema,r,i)(t),p=u&&u.type.validContent(a.Fragment.from(d));if(t.fileName){var f=t.fileName.lastIndexOf(".");s=f>=0?t.fileName.substring(f+1):void 0}if(p)j([d],{fileExtension:s,inputMethod:n})(c,l);else{var h=null;if(Object(b.b)(e.state).newInsertionBehaviour&&(h=Object(v.b)(d,c.selection.from)(c.tr)),!h){var g=x(e.state)?a.Fragment.fromArray([d,c.schema.nodes.paragraph.create()]):d;h=Object(o.safeInsert)(g,void 0,!0)(c.tr)}n&&(h=Object(m.a)(c,h,k(n,s))),l(h)}return!0},S=function(e,t,n){return function(r){var i=r.id,a=r.dimensions,o=r.contextId,s=r.scaleFactor,c=void 0===s?1:s,l=a||{height:void 0,width:void 0},u=l.width,d=l.height,f=e.nodes,h=f.media,m=f.mediaSingle,v=h.create({id:i,type:"file",collection:t,contextId:o,width:u&&Math.round(u/c),height:d&&Math.round(d/c)}),b=n?{layout:"align-start"}:{};return Object(p.a)(r,v),m.createChecked(b,v)}};function _(e,t){var n=t.nodes,r=n.mediaSingle,i=n.layoutSection,a=n.table,s=n.bulletList,c=n.orderedList,l=n.media,u=n.expand;return function(t){var n=e;return Object(o.hasParentNodeOfType)([i,a,s,c,u])(t)&&(n=Object(f.e)(n,(function(e){return"mediaSingle"===e.type.name?r.createChecked({},e.content,e.marks):e}))),n=Object(f.e)(n,(function(e){return"media"===e.type.name&&"external"===e.attrs.type?l.createChecked(O(O({},e.attrs),{},{__external:!0}),e.content,e.marks):e}))}}var M=function(e){var t=e.origWidth,n=e.origHeight,r=e.layout,i=e.pctWidth,a=e.containerWidth,o=e.resizedPctWidth,c=a.width,u=a.lineLength,d=D(a,i,t,n),p=D(a,o,t,n);if("wide"===r){if(u){var f=Math.ceil(u*l.Z);return f>c?u:f}}else{if("full-width"===r)return c-l.d;if(d)return s.e.indexOf(r)>-1?p?o<50?p:d:Math.max(d,t):p||d;if("center"===r)return p||Math.min(t,u||c);if(r&&-1!==s.e.indexOf(r)){var h=Math.ceil((u||c)/2);return t<=h?t:h}}return t},D=function(e,t,n,r){return t&&n&&r&&Math.ceil(Object(c.d)(t/100,e.lineLength||e.width))}},4:function(e,t){},"4vUV":function(e,t,n){"use strict";var r,i,a,o,s,c,l;n.d(t,"d",(function(){return r})),n.d(t,"c",(function(){return i})),n.d(t,"f",(function(){return a})),n.d(t,"e",(function(){return o})),n.d(t,"g",(function(){return s})),n.d(t,"a",(function(){return c})),n.d(t,"i",(function(){return l})),n.d(t,"h",(function(){return d})),n.d(t,"b",(function(){return u})),function(e){e.NoFileFoundAfterInput="No File was detected during the upload procedure.",e.FileNotProcessable="Could not process the uploaded image.",e.CouldNotFindFileInCurrentNote="Could not find file in current note.",e.MissingCollabEdit="`CollabEditProvider` was `undefined` in `fetchCozyImage`. <Media> was unable to fetch the image source. The component might be unmounted.",e.CouldNotGetNoteImages="MediaNode failed to fetch included files in the current note",e.CouldNotCopyImage="Could not copy image from another note"}(r||(r={})),function(e){e.Input="input"}(i||(i={})),function(e){e.File="file"}(a||(a={})),function(e){e.Click="click",e.Change="change",e.Drop="drop",e.Paste="paste"}(o||(o={})),function(e){e.Created="CREATED",e.Updated="UPDATED"}(s||(s={})),function(e){e.Files="io.cozy.files",e.NoteEvents="io.cozy.notes.events",e.Thumbnails="io.cozy.files.thumbnails"}(c||(c={})),function(e){e.Drive="drive",e.Home="home",e.Notes="notes"}(l||(l={}));var u,d="/preview/";!function(e){e.Files="Files",e.Notes="Notes"}(u||(u={}))},"5tuL":function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var r={FLOATING_TOOLBAR_COMPONENT:"".concat("pm-alt-text","-alt-text-floating-toolbar")}},"5z4W":function(e,t){e.exports={name:"Notes",name_prefix:"Cozy",slug:"notes",icon:"icon.svg",categories:["cozy"],version:"1.36.0",licence:"AGPL-3.0",editor:"Cozy",source:"https://github.com/cozy/cozy-notes.git@build",developer:{name:"Cozy Cloud",url:"https://cozy.io"},screenshots:["screenshots/fr/screenshot01.png","screenshots/fr/screenshot02.png"],langs:["en","fr"],routes:{"/":{folder:"/",index:"index.html",public:!1},"/public":{folder:"/",index:"index.html",public:!0},"/preview":{folder:"/",index:"index.html",public:!0},"/intents":{folder:"/intents",index:"index.html",public:!1}},intents:[{action:"OPEN",type:["io.cozy.notes.documents"],href:"/intents"}],permissions:{apps:{description:"Required by the cozy-bar to display the icons of the apps",type:"io.cozy.apps",verbs:["GET"]},files:{description:"Notes as files",type:"io.cozy.files"},settings:{description:"Required by the cozy-bar to display Claudy and know which applications are coming soon",type:"io.cozy.settings",verbs:["GET"]},sharings:{description:"Required to have access to the sharings in realtime",type:"io.cozy.sharings",verbs:["GET"]},contacts:{type:"io.cozy.contacts",verbs:["GET","POST"]},groups:{type:"io.cozy.contacts.groups",verbs:["GET"]},intents:{type:"io.cozy.notes.documents",verbs:["GET"]}}}},6:function(e,t,n){n("jI5P"),e.exports=n("nXPL")},"6mlU":function(e,t,n){"use strict";n.d(t,"c",(function(){return i})),n.d(t,"a",(function(){return a})),n.d(t,"b",(function(){return l}));var r=n("iO45"),i=4,a=function(){return i},o=[["date",{inline:!0,group:"inline",selectable:!0,attrs:{timestamp:{default:""}},parseDOM:[{tag:'span[data-node-type="date"]'}]}],["status",{inline:!0,group:"inline",selectable:!0,attrs:{text:{default:""},color:{default:""},localId:{default:"dfab1003-a025-425f-869b-4592431ae618"},style:{default:""}},parseDOM:[{tag:'span[data-node-type="status"]'}]}],["doc",{content:"(block)+",marks:"alignment breakout indentation link unsupportedMark unsupportedNodeAttribute"}],["paragraph",{selectable:!1,content:"inline*",group:"block",marks:"strong code em link strike subsup textColor typeAheadQuery underline unsupportedMark unsupportedNodeAttribute",parseDOM:[{tag:"p"}]}],["text",{group:"inline"}],["bulletList",{group:"block",content:"listItem+",selectable:!1,parseDOM:[{tag:"ul"}],marks:"unsupportedMark unsupportedNodeAttribute"}],["orderedList",{group:"block",content:"listItem+",marks:"unsupportedMark unsupportedNodeAttribute",selectable:!1,parseDOM:[{tag:"ol"}]}],["listItem",{content:"(paragraph | mediaSingle | codeBlock) (paragraph | bulletList | orderedList | mediaSingle | codeBlock)*",marks:"link unsupportedMark unsupportedNodeAttribute",defining:!0,selectable:!1,parseDOM:[{tag:"li"}]}],["heading",{attrs:{level:{default:1}},content:"inline*",group:"block",defining:!0,selectable:!1,parseDOM:[{tag:"h1",attrs:{level:1}},{tag:"h2",attrs:{level:2}},{tag:"h3",attrs:{level:3}},{tag:"h4",attrs:{level:4}},{tag:"h5",attrs:{level:5}},{tag:"h6",attrs:{level:6}}]}],["blockquote",{content:"paragraph+",group:"block",defining:!0,selectable:!1,parseDOM:[{tag:"blockquote"}]}],["codeBlock",{attrs:{language:{default:null},uniqueId:{default:null}},content:"text*",marks:"unsupportedMark unsupportedNodeAttribute",group:"block",code:!0,defining:!0,parseDOM:[{tag:"pre",preserveWhitespace:"full"},{tag:"div[style]",preserveWhitespace:"full"},{tag:"table[style]",preserveWhitespace:"full"},{tag:"div.code-block",preserveWhitespace:"full"}]}],["rule",{group:"block",parseDOM:[{tag:"hr"}]}],["panel",{group:"block",content:"(paragraph | heading | bulletList | orderedList )+",marks:"unsupportedMark unsupportedNodeAttribute",attrs:{panelType:{default:"info"}},parseDOM:[{tag:"div[data-panel-type]"}]}],["confluenceUnsupportedBlock",{group:"block",attrs:{cxhtml:{default:null}},parseDOM:[{tag:'div[data-node-type="confluenceUnsupportedBlock"]'}]}],["confluenceUnsupportedInline",{group:"inline",inline:!0,atom:!0,attrs:{cxhtml:{default:null}},parseDOM:[{tag:'div[data-node-type="confluenceUnsupportedInline"]'}]}],["unsupportedBlock",{inline:!1,group:"block",atom:!0,selectable:!0,attrs:{originalValue:{default:{}}},parseDOM:[{tag:'[data-node-type="unsupportedBlock"]'}]}],["unsupportedInline",{inline:!0,group:"inline",selectable:!0,attrs:{originalValue:{default:{}}},parseDOM:[{tag:'[data-node-type="unsupportedInline"]'}]}],["hardBreak",{inline:!0,group:"inline",selectable:!1,parseDOM:[{tag:"br"}]}],["mediaSingle",{inline:!1,group:"block",selectable:!0,atom:!0,content:"media | media ( unsupportedBlock)",attrs:{width:{default:null},layout:{default:"center"}},marks:"unsupportedMark unsupportedNodeAttribute link",parseDOM:[{tag:'div[data-node-type="mediaSingle"]'}]}],["table",{content:"tableRow+",attrs:{isNumberColumnEnabled:{default:!1},layout:{default:"default"},__autoSize:{default:!1}},marks:"unsupportedMark unsupportedNodeAttribute",tableRole:"table",isolating:!0,selectable:!1,group:"block",parseDOM:[{tag:"table"}]}],["media",{selectable:!0,attrs:{id:{default:""},type:{default:"file"},collection:{default:""},occurrenceKey:{default:null},alt:{default:null},width:{default:null},height:{default:null},url:{default:null},__fileName:{default:null},__fileSize:{default:null},__fileMimeType:{default:null},__displayType:{default:null},__contextId:{default:null},__external:{default:!1}},parseDOM:[{tag:'div[data-node-type="media"]'},{tag:'img[src^="data:image"]',ignore:!0},{tag:"img:not(.smart-link-icon)"}]}],["tableHeader",{selectable:!1,content:"(paragraph | panel | blockquote | orderedList | bulletList | rule | heading | codeBlock | mediaSingle | decisionList | taskList )+",attrs:{colspan:{default:1},rowspan:{default:1},colwidth:{default:null},background:{default:null}},tableRole:"header_cell",isolating:!0,marks:"link alignment unsupportedMark unsupportedNodeAttribute",parseDOM:[{tag:"th"}]}],["decisionList",{group:"block",defining:!0,content:"decisionItem+",marks:"unsupportedMark unsupportedNodeAttribute",selectable:!1,attrs:{localId:{default:""}},parseDOM:[{tag:'ol[data-node-type="decisionList"]',priority:100}]}],["tableRow",{selectable:!1,content:"(tableCell | tableHeader)+",marks:"unsupportedMark unsupportedNodeAttribute",tableRole:"row",parseDOM:[{tag:"tr"}]}],["decisionItem",{content:"inline*",defining:!0,marks:"_",attrs:{localId:{default:""},state:{default:"DECIDED"}},parseDOM:[{tag:"li[data-decision-local-id]",priority:100}]}],["tableCell",{selectable:!1,content:"(paragraph | panel | blockquote | orderedList | bulletList | rule | heading | codeBlock | mediaSingle | decisionList | taskList | unsupportedBlock)+",attrs:{colspan:{default:1},rowspan:{default:1},colwidth:{default:null},background:{default:null}},tableRole:"cell",marks:"link alignment unsupportedMark unsupportedNodeAttribute",isolating:!0,parseDOM:[{tag:".ak-renderer-table-number-column",ignore:!0},{tag:"td"}]}],["taskList",{group:"block",defining:!0,selectable:!1,content:"taskItem+ (taskItem|taskList)*",marks:"unsupportedMark unsupportedNodeAttribute",attrs:{localId:{default:""}},parseDOM:[{tag:'div[data-node-type="actionList"]',priority:100}]}],["taskItem",{content:"inline*",defining:!0,selectable:!1,marks:"_",attrs:{localId:{default:""},state:{default:"TODO"}},parseDOM:[{tag:"div[data-task-local-id]",priority:100}]}]],s=[["link",{excludes:"link color",group:"link",attrs:{href:{},__confluenceMetadata:{default:null}},inclusive:!1,parseDOM:[{tag:"[data-block-link]"},{tag:"a[href]",context:"paragraph/|heading/|mediaSingle/|taskItem/|decisionItem/"},{tag:"a[href]"}]}],["em",{inclusive:!0,group:"fontStyle",parseDOM:[{tag:"i"},{tag:"em"},{style:"font-style=italic"}]}],["strong",{inclusive:!0,group:"fontStyle",parseDOM:[{tag:"strong"},{tag:"b"},{tag:"span"}]}],["textColor",{attrs:{color:{}},inclusive:!0,group:"color",parseDOM:[{style:"color"}]}],["strike",{inclusive:!0,group:"fontStyle",parseDOM:[{tag:"strike"},{tag:"s"},{tag:"del"},{style:"text-decoration"}]}],["subsup",{inclusive:!0,group:"fontStyle",attrs:{type:{default:"sub"}},parseDOM:[{tag:"sub",attrs:{type:"sub"}},{tag:"sup",attrs:{type:"sup"}},{tag:"span",style:"vertical-align=super"},{tag:"span",style:"vertical-align=sub"}]}],["underline",{inclusive:!0,group:"fontStyle",parseDOM:[{tag:"u"},{style:"text-decoration"}]}],["code",{excludes:"fontStyle link searchQuery color",inclusive:!0,parseDOM:[{tag:"span.code",preserveWhitespace:!0},{tag:"code",preserveWhitespace:!0},{tag:"tt",preserveWhitespace:!0},{tag:"span",preserveWhitespace:!0}]}],["typeAheadQuery",{inclusive:!0,group:"searchQuery",parseDOM:[{tag:"span[data-type-ahead-query]"}],attrs:{trigger:{default:""}}}],["alignment",{excludes:"alignment indentation",group:"alignment",attrs:{align:{}},parseDOM:[{tag:"div.fabric-editor-block-mark"}]}],["breakout",{spanning:!1,inclusive:!1,parseDOM:[{tag:"div.fabric-editor-breakout-mark"}],attrs:{mode:{default:"wide"}}}],["indentation",{excludes:"indentation alignment",group:"indentation",attrs:{level:{}},parseDOM:[{tag:"div.fabric-editor-indentation-mark"}]}],["unsupportedMark",{attrs:{originalValue:{}}}],["unsupportedNodeAttribute",{attrs:{type:{},unsupported:{}}}]];function c(e){return e.reduce((function(e,t){return e[t[0]]=t[1],e}),{})}var l={nodes:o,marks:s,version:i},u={nodes:c(o),marks:c(s)};new r.Schema(u)},"8BHA":function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var r=new(n("4z1N").PluginKey)("imageUploadPlugin")},"8Zd7":function(e,t,n){"use strict";var r=n("ivGQ"),i=n("HZZ/"),a=n.n(i),o=n("GeFe"),s=n.n(o),c=n("Zvb3"),l=n.n(c),u=n("J58c"),d=n.n(u),p=n("hJxD"),f=n.n(p),h=n("6mlU"),m=[{type:"paragraph"}];function v(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function b(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?v(Object(n),!0).forEach((function(t){d()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):v(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var g=function(){function e(t){var n=this;s()(this,e),d()(this,"postImage",function(){var e=a()(f.a.mark((function e(t,r,i,a){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",n.stackClient.fetchJSON("POST",n.path(r,"images?Name=".concat(t)),i,{headers:{"Content-Type":a}}));case 1:case"end":return e.stop()}}),e)})));return function(t,n,r,i){return e.apply(this,arguments)}}());var r=t.userId,i=t.cozyClient,o=t.schema,c=t.realtime,l=new Date,u=l.getTime()+"."+l.getMilliseconds()+"."+Math.random();this.sessionId=r+":"+u,this.userId=this.getUserId(r),this.cozyClient=i,this.stackClient=i.getStackClient(),this.schema=o,this.schemaVersion=h.c,this.onRealtimeEvent=this.onRealtimeEvent.bind(this),this.realtime=c||i.plugins.realtime,this.resetCallbacks()}var t,n,r,i,o,c,u,p,v,g,y,w,O;return l()(e,[{key:"resetCallbacks",value:function(){this.callbacks={}}},{key:"setCallback",value:function(e,t,n){this.callbacks[e]=this.callbacks[e]||{},this.callbacks[e][t]=n}},{key:"getUserId",value:function(e){return e?e.match(/[^:]+/)[0]:this.userId}},{key:"getSessionId",value:function(){return this.sessionId}},{key:"close",value:function(){this.realtime.unsubscribeAll(),this.resetCallbacks()}},{key:"defaultTitle",value:function(){return(new Date).toISOString()}},{key:"path",value:function(e,t){return e?t?"/notes/".concat(e,"/").concat(t):"/notes/".concat(e):"/notes"}},{key:"client2server",value:function(e){return b({sessionID:e.sessionId||this.sessionId},e)}},{key:"server2client",value:function(e){return b({sessionId:e.sessionID,userId:this.getUserId(e.sessionID)},e)}},{key:"create",value:(O=a()(f.a.mark((function e(t,n,r){var i,a;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a={data:{type:"io.cozy.notes.documents",attributes:{title:t||this.defaultTitle(),schema:n||this.schema||h.b,content:r?(null===(i=r.content)||void 0===i?void 0:i.length)>0?r:b(b({},r),{},{content:m}):void 0}}},e.abrupt("return",this.stackClient.fetchJSON("POST",this.path(),a));case 2:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return O.apply(this,arguments)})},{key:"updateSchema",value:(w=a()(f.a.mark((function e(t,n){var r,i;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.stackClient.fetchJSON("PUT",this.path(t,"schema"),{data:{type:"io.cozy.notes.documents",attributes:{schema:b(b({},n),{},{version:h.c})}}});case 2:return r=e.sent,i=this.formatDoc(r.data),this.schemaVersion=i.schemaVersion,e.abrupt("return",i);case 6:case"end":return e.stop()}}),e,this)}))),function(e,t){return w.apply(this,arguments)})},{key:"sync",value:(y=a()(f.a.mark((function e(t){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.stackClient.fetchJSON("POST",this.path(t,"sync"));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return y.apply(this,arguments)})},{key:"setTitle",value:(g=a()(f.a.mark((function e(t,n){var r;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r={data:{type:"io.cozy.notes.documents",id:t,attributes:this.client2server({title:n})}},e.next=3,this.stackClient.fetchJSON("PUT",this.path(t,"title"),r);case 3:case"end":return e.stop()}}),e,this)}))),function(e,t){return g.apply(this,arguments)})},{key:"onRealtimeEvent",value:function(e){var t=e.id||e._id,n=e.doctype||e.type;if("file"===n&&(n="io.cozy.files"),this.callbacks[n]&&this.callbacks[n][t])return this.callbacks[n][t](e);console.warn("Event not managed",n,t,this.callbacks)}},{key:"join",value:(v=a()(f.a.mark((function e(t){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all([this.realtime.subscribe(null,"io.cozy.notes.events",t,this.onRealtimeEvent)]);case 2:this.realtime.subscribe("UPDATED","io.cozy.files",t,this.onRealtimeEvent);case 3:case"end":return e.stop()}}),e,this)}))),function(e){return v.apply(this,arguments)})},{key:"onStepsCreated",value:(p=a()(f.a.mark((function e(t,n){var r=this;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.setCallback("io.cozy.notes.steps",t,(function(e){return n(r.server2client(e))}));case 1:case"end":return e.stop()}}),e,this)}))),function(e,t){return p.apply(this,arguments)})},{key:"onTelepointerUpdated",value:(u=a()(f.a.mark((function e(t,n){var r=this;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.setCallback("io.cozy.notes.telepointers",t,(function(e){return n(r.server2client(e))}));case 1:case"end":return e.stop()}}),e,this)}))),function(e,t){return u.apply(this,arguments)})},{key:"onSchemaUpdated",value:(c=a()(f.a.mark((function e(t,n){var r=this;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.setCallback("io.cozy.files",t,(function(e){if(e.metadata.schema.version!==r.schemaVersion)return n(e)}));case 1:case"end":return e.stop()}}),e,this)}))),function(e,t){return c.apply(this,arguments)})},{key:"onTitleUpdated",value:(o=a()(f.a.mark((function e(t,n){var r=this;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.setCallback("io.cozy.notes.documents",t,(function(e){return e.sessionID&&e.sessionID==r.sessionId?null:n(e.title)}));case 1:case"end":return e.stop()}}),e,this)}))),function(e,t){return o.apply(this,arguments)})},{key:"getDoc",value:(i=a()(f.a.mark((function e(t){var n,r;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.stackClient.fetchJSON("GET",this.path(t));case 2:return n=e.sent,r=this.formatDoc(n.data),this.schemaVersion=r.schemaVersion,e.abrupt("return",r);case 6:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"getFormatedDoc",value:function(e){var t=this.formatDoc(e);return this.schemaVersion=t.schemaVersion,t}},{key:"formatDoc",value:function(e){return{doc:e.attributes.metadata.content,version:e.attributes.metadata.version,title:e.attributes.metadata.title,updatedAt:new Date(e.attributes.updated_at),file:e,schemaVersion:e.attributes.metadata.schema.version}}},{key:"pushSteps",value:(r=a()(f.a.mark((function e(t,n,r){var i,a,o=this;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i={headers:{"if-match":n}},a={data:r.map((function(e){return{type:"io.cozy.notes.steps",attributes:o.client2server(e.toJSON())}}))},e.next=4,this.stackClient.fetchJSON("PATCH",this.path(t),a,i);case 4:return e.abrupt("return",null);case 5:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return r.apply(this,arguments)})},{key:"getSteps",value:(n=a()(f.a.mark((function e(t,n){var r,i,a,o,s,c,l,u,d,p,h=this;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.stackClient.fetchJSON("GET","".concat(this.path(t,"steps"),"?Version=").concat(n));case 3:if(0!=(r=e.sent).data.length){e.next=8;break}return e.abrupt("return",{steps:[],version:n});case 8:return i=r.data.map((function(e){return h.server2client(e.attributes)})),a=r.data[r.data.length-1].attributes.version,e.abrupt("return",{version:a,steps:i});case 11:e.next=28;break;case 13:if(e.prev=13,e.t0=e.catch(0),o=e.t0.response,s=e.t0.reason&&e.t0.reason.data,c=s&&s.attributes&&s.attributes.metadata,l=c&&c.content,u=c&&c.version,412!=o.status||!l||!u){e.next=27;break}return p={_id:t,_type:"io.cozy.notes.events",doctype:d="io.cozy.notes.documents",title:c.title},this.callbacks[d]&&this.callbacks[d][t]&&this.callbacks[d][t](p),e.abrupt("return",{doc:l,version:u});case 27:throw e.t0;case 28:case"end":return e.stop()}}),e,this,[[0,13]])}))),function(e,t){return n.apply(this,arguments)})},{key:"pushTelepointer",value:(t=a()(f.a.mark((function e(t,n){var r;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r={data:{type:"io.cozy.notes.telepointers",id:t,attributes:this.client2server(n)}},e.abrupt("return",this.stackClient.fetchJSON("PUT",this.path(t,"telepointer"),r));case 2:case"end":return e.stop()}}),e,this)}))),function(e,n){return t.apply(this,arguments)})}]),e}();t.a=function(e){var t=e.userId,n=e.userName,i=e.cozyClient;return Object(r.useMemo)((function(){return new g({userId:t,userName:n,cozyClient:i})}),[i,t,n])}},AdhS:function(e,t,n){},AvBw:function(e,t,n){"use strict";n.d(t,"a",(function(){return s})),n.d(t,"b",(function(){return c}));var r=n("9Jaj"),i=n("JdMa"),a=n("8BHA"),o=function(e){return function(t){return function(e,t){return e.setMeta(a.a,t)}(t,{name:"START_UPLOAD",event:e})}},s=function(e){return function(t,n){if(!a.a.getState(t).enabled||!e.src)return!1;var o=Object(i.b)(e.src,t.schema);return!!o&&(n&&n(Object(r.safeInsert)(o,t.selection.$to.pos)(t.tr).scrollIntoView()),!0)}},c=function(e){return function(t,n){return!!a.a.getState(t).enabled&&(n&&n(o(e)(t.tr)),!0)}}},CDNI:function(e,t,n){"use strict";n.d(t,"f",(function(){return f})),n.d(t,"e",(function(){return h})),n.d(t,"d",(function(){return m})),n.d(t,"h",(function(){return v})),n.d(t,"c",(function(){return k})),n.d(t,"g",(function(){return j})),n.d(t,"i",(function(){return E})),n.d(t,"j",(function(){return P})),n.d(t,"a",(function(){return S})),n.d(t,"k",(function(){return _})),n.d(t,"l",(function(){return I})),n.d(t,"b",(function(){return N}));var r=n("XZ5u"),i=(n("iO45"),n("4z1N")),a=n("9Jaj"),o=n("eXjd"),s=n("3mYb"),c=n("I/PM"),l=n("odni"),u=n("ct2w"),d=n("3Su3"),p=n("a+IN"),f=(n("KgC3"),function(e){return j(e)||w(e)||v(e)||b(e)}),h=function(e){var t=e.selection.node;return t&&t.type!==e.schema.nodes.media&&t.isBlock},m=function(e){var t=e.selection.node;return t&&t.type===e.schema.nodes.mediaSingle},v=function(e){if(Object(d.a)(e))return O(e,e.selection.$from)},b=function(e){if(e.selection instanceof p.a){var t=e.selection.$from,n=e.schema.nodes.mediaGroup;return g(t,n)||y(t,n)}},g=function(e,t){if(e.nodeBefore&&e.nodeBefore.type===t)return e.pos-e.nodeBefore.nodeSize+1},y=function(e,t){if(e.nodeAfter&&e.nodeAfter.type===t)return e.pos+1},w=function(e){if(Object(d.c)(e))return x(e,e.selection.$to)},O=function(e,t){var n,r;if(h(e)?(n=t.pos,r=t.nodeBefore):(n=Object(d.f)(t)-1,r=e.doc.resolve(n).nodeBefore),r&&r.type===e.schema.nodes.mediaGroup)return n-r.nodeSize+1},k=function(e){return e.selection.$from.parent.type===e.schema.nodes.paragraph&&Object(d.a)(e)&&Object(d.c)(e)},x=function(e,t){var n,r,i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(h(e)?(n=t.pos,r=t.nodeAfter):(n=Object(d.e)(t),r=e.doc.nodeAt(n)),r&&r.type===e.schema.nodes.mediaGroup)return i?n+1:n+r.nodeSize-1},j=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=e.selection.$from;if((t=t||r).parent.type===e.schema.nodes.mediaGroup)return n?Object(d.f)(t):Object(d.e)(t)-1};var E=function(e,t,n){var r=t.attrs.id,o=e.state,c=o.tr,l=o.selection,u=o.doc,p=n();c.deleteRange(p,p+t.nodeSize),Object(s.r)(r)&&c.setMeta("addToHistory",!1);var f=u.resolve(p),h=f.nodeBefore,m=f.parent,v=f.index()===m.childCount-1;if(l.from===p&&!v&&!Object(d.b)(o)&&h&&"media"===h.type.name){var b=Object(a.findPositionOfNodeBefore)(c.selection);b&&c.setSelection(i.NodeSelection.create(c.doc,b))}e.dispatch(c)},P=function(e){var t=e.state.selection;return t instanceof i.NodeSelection&&t.node.type===e.state.schema.nodes.media&&(Object(r.e)(e.state,e.dispatch),t.$to.nodeAfter?(Object(r.g)(e.state,e.dispatch),Object(o.e)(!1)(e.state,e.dispatch)):Object(o.c)(e.state,e.dispatch),!0)},C=function(e){return e.length>1&&"_"===e[0]&&"_"===e[1]},S=function(e,t){Object.keys(t.attrs).filter(C).forEach((function(n){var r=n.substring(2),i=e[r];void 0!==i&&(t.attrs[n]=i)}))},_=function(e,t){var n=t.nodes,r=n.mediaGroup,i=n.mediaSingle,a=n.media;return Object(c.e)(e,(function(e,t){return t||e.type!==a?e:i&&(Object(u.a)(e.attrs.__fileMimeType)||"external"===e.attrs.type)?i.createChecked({},e):r.createChecked({},[e])}))},M=function(e){return"0"===e.style.opacity||"none"===e.style.display||"hidden"===e.style.visibility},D=["DIV","TD"];var I=function(e){var t=(new DOMParser).parseFromString(e,"text/html").body,n=t.querySelector('b[id^="docs-internal-guid-"]');n&&Object(l.g)(t,n);var r=t.querySelectorAll("img");return r.length?(r.forEach((function(e){var n=e.parentElement;if(n)if(M(n)||M(e))n.removeChild(e);else if(!(n instanceof HTMLDivElement)){var r=Object(l.h)(n,(function(e){return e.parentElement===t||function(e){return!!e&&-1!==D.indexOf(e.tagName)}(e.parentElement)}));r&&r.parentElement&&(r.parentElement.insertBefore(e,r.nextElementSibling||r),n.innerText=n.innerText.trim(),Object(l.f)(n))}})),t.lastElementChild&&"BR"===t.lastElementChild.tagName&&t.removeChild(t.lastElementChild),t.innerHTML):e},N=function(e){if(!m(e))return null;var t=e.tr,n=t.selection.from+1,r=t.doc.nodeAt(n);return r&&r.type===e.schema.nodes.media?r:null}},G09D:function(e,t,n){"use strict";n.d(t,"a",(function(){return k}));var r=n("GeFe"),i=n.n(r),a=n("Zvb3"),o=n.n(a),s=n("J/YY"),c=n.n(s),l=n("a1Fv"),u=n.n(l),d=n("g3eI"),p=n.n(d),f=n("wDGE"),h=n.n(f),m=n("J58c"),v=n.n(m),b=n("ivGQ"),g=n.n(b),y=n("Y/FK"),w=n.n(y);function O(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=h()(e);if(t){var i=h()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return p()(this,n)}}function k(e){return function(t){u()(r,t);var n=O(r);function r(){var e;i()(this,r);for(var t=arguments.length,a=new Array(t),o=0;o<t;o++)a[o]=arguments[o];return e=n.call.apply(n,[this].concat(a)),v()(c()(e),"handleClick",(function(t){var n=w.a.findDOMNode(c()(e));(!n||t.target instanceof Node&&!n.contains(t.target))&&e.props.handleClickOutside&&e.props.handleClickOutside(t)})),v()(c()(e),"handleKeydown",(function(t){"Escape"===t.code&&e.props.handleEscapeKeydown?e.props.handleEscapeKeydown(t):"Enter"===t.code&&e.props.handleEnterKeydown&&e.props.handleEnterKeydown(t)})),e}return o()(r,[{key:"componentDidMount",value:function(){this.props.handleClickOutside&&document.addEventListener("click",this.handleClick,!1),this.props.handleEscapeKeydown&&document.addEventListener("keydown",this.handleKeydown,!1)}},{key:"componentWillUnmount",value:function(){this.props.handleClickOutside&&document.removeEventListener("click",this.handleClick,!1),this.props.handleEscapeKeydown&&document.removeEventListener("keydown",this.handleKeydown,!1)}},{key:"render",value:function(){return g.a.createElement(e,this.props)}}]),r}(b.PureComponent)}},Gfcl:function(e,t,n){"use strict";var r=n("HZZ/"),i=n.n(r),a=n("J58c"),o=n.n(a),s=n("hJxD"),c=n.n(s),l=n("4z1N"),u=n("fiXu"),d=n("X5HD"),p=n("JdMa"),f=n("AvBw"),h=n("8BHA"),m=n("4vUV");function v(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function b(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?v(Object(n),!0).forEach((function(t){o()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):v(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var g=function(e,t){return function(t,n){return!!e(n)&&(n.preventDefault(),n.stopPropagation(),n.type===m.e.Drop&&Object(p.d)(n,t),Object(f.b)(n)(t.state,t.dispatch),!0)}},y=function(e){var t,n=e.dispatch,r=e.providerFactory;return new l.Plugin({state:{init:function(e,t){return{active:!1,enabled:Object(p.a)(t),hidden:!t.schema.nodes.media||!t.schema.nodes.mediaSingle}},apply:function(e,t,r,i){var a=Object(p.c)(i),o=Object(p.a)(i),s=function(e,t){var n=e.getMeta(h.a);return n&&"START_UPLOAD"===n.name?{event:n.event}:t.activeUpload}(e,t);if(a!==t.active||o!==t.enabled||s!==t.activeUpload){var c=b(b({},t),{},{active:a,enabled:o,activeUpload:s});return n(h.a,c),c}return t}},key:h.a,view:function(){var e=function(){var e=i()(c.a.mark((function e(n,r){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("imageUploadProvider"===n&&r){e.next=2;break}return e.abrupt("return");case 2:return e.prev=2,e.next=5,r;case 5:t=e.sent,e.next=11;break;case 8:e.prev=8,e.t0=e.catch(2),t=void 0;case 11:case"end":return e.stop()}}),e,null,[[2,8]])})));return function(t,n){return e.apply(this,arguments)}}();return r.subscribe("imageUploadProvider",e),{update:function(e,n){var r=e.state,i=h.a.getState(r),a=h.a.getState(n);i.activeUpload!==a.activeUpload&&i.activeUpload&&t&&t(i.activeUpload.event,(function(t){return Object(f.a)(t)(e.state,e.dispatch)}))},destroy:function(){r.unsubscribe("imageUploadProvider",e)}}},props:{handleDOMEvents:{drop:g(d.a),paste:g(u.b)}}})},w=n("cwpE");var O=function(e){if(e.nodes.media&&e.nodes.mediaSingle){var t=Object(w.a)(/!\[(.*)\]\((\S+)\)$/,(function(e,t,n,r){var i=e.schema,a={src:t[2],alt:t[1]},o=Object(p.b)(a.src,i);return o?e.tr.replaceWith(n,r,o):null}));return Object(w.c)("image-upload",{rules:[t]})}};window.document.addEventListener("dragover",(function(e){return e.preventDefault(),!(null==e?void 0:e.target).closest(".ProseMirror")&&null!==e.dataTransfer&&(e.dataTransfer.dropEffect="none")}));t.a=function(){return{name:"imageUpload",pmPlugins:function(){return[{name:"imageUpload",plugin:y},{name:"imageUploadInputRule",plugin:function(e){var t=e.schema;return O(t)}}]}}}},Hsuv:function(e){e.exports=JSON.parse('{"Notes":{"Add":{"add_note":"Ajouter une note"},"Delete":{"delete_note":"Supprimer","deleted":"La note a été placée dans la corbeille de votre Drive","failed":"La note n\'a pas pu être supprimée, merci de re-essayer plus tard"},"EditorView":{"main_placeholder":"Écrivez ce que vous souhaitez…"},"Editor":{"title_placeholder":"Écrivez votre titre","exit_confirmation_message":"La sauvegarde automatique n\'a pas encore pris en compte vos dernières modifications. Merci de retourner sur votre note pour ne pas les perdre.","exit_confirmation_title":"Abandonner les modifications ?","exit_confirmation_leave":"Quitter sans sauvegarder","exit_confirmation_cancel":"Retour","read_only":"Cette note est en mode lecture-seule."},"Files":{"share":{"cta":"Partager"}},"List":{"latest_notes":"Notes récentes","name":"Nom","updated_at":"Mise à jour","location":"Emplacement","sharings":"Partage","at":"%{date} à %{time}"},"Empty":{"welcome":"Bienvenue sur Cozy Notes","after_created":"Une fois votre note créée, il vous est possible de la retrouver dans "},"SavingIndicator":{"saved":{"default":"À jour","just_now":"À jour","secs_ago":"À jour (enregistré il y a %{time} sec.)","min_ago":"À jour (enregistré il y a %{time} min.)","mins_ago":"À jour (enregistré il y a %{time} min.)","hour_ago":"À jour (enregistré il y a %{time} heure)","hours_ago":"À jour (enregistré il y a %{time} heures)","day_ago":"À jour (enregistré il y a %{time} jour)","days_ago":"À jour (enregistré il y a %{time} jours)","month_ago":"À jour (enregistré il y a %{time} mois)","monthes_ago":"À jour (enregistré il y a %{time} mois)","year_ago":"À jour (enregistré il y a %{time} an)","years_ago":"À jour (enregistré il y a %{time} ans)"},"saving":"Enregistrement en cours...","still_saving":"Enregistrement en cours......","out_of_sync":{"default":"Enregistré (hors ligne)","just_now":"Enregistré (hors ligne)","secs_ago":"Enregistré (hors ligne depuis %{time} sec)","min_ago":"Enregistré (hors ligne depuis %{time} min)","mins_ago":"Enregistré (hors ligne depuis %{time} min)","hour_ago":"Enregistré (hors ligne depuis %{time} h)","hours_ago":"Enregistré (hors ligne depuis %{time} h)","day_ago":"Enregistré (hors ligne depuis %{time} jour)","days_ago":"Enregistré (hors ligne depuis %{time} jours)","month_ago":"Enregistré (hors ligne depuis %{time} mois)","monthes_ago":"Enregistré (hors ligne depuis %{time} mois)","year_ago":"Enregistré (hors ligne depuis %{time} an)","years_ago":"Enregistré (hors ligne depuis %{time} ans)"},"saving_impossible":{"default":"Non enregistré (hors ligne)","just_now":"Non enregistré (hors ligne)","secs_ago":"Non enregistré (hors ligne depuis %{time} sec)","min_ago":"Non enregistré (hors ligne depuis %{time} min)","mins_ago":"Non enregistré (hors ligne depuis %{time} min)","hour_ago":"Non enregistré (hors ligne depuis %{time} h)","hours_ago":"Non enregistré (hors ligne depuis %{time} h)","day_ago":"Non enregistré (hors ligne depuis %{time} jour)","days_ago":"Non enregistré (hors ligne depuis %{time} jours)","month_ago":"Non enregistré (hors ligne depuis %{time} mois)","monthes_ago":"Non enregistré (hors ligne depuis %{time} mois)","year_ago":"Non enregistré (hors ligne depuis %{time} an)","years_ago":"Non enregistré (hors ligne depuis %{time} ans)"}},"OfflineIndicator":{"message":"Vous n’êtes plus connecté à internet. Vos modifications seront enregistrées quand vous serez connecté à nouveau."}},"Error":{"422":"Seules les images sont acceptées","unshared_title":"Le partage n\'est plus actif","unshared_text":"Le propriétaire a peut-être révoqué ce partage. Vous ne pouvez plus éditer de note à cette adresse.","loading_error_title":"La note n\'a pas pu être chargée","loading_error_text_noReturnUrl":"Cette note n\'existe peut-être plus, ou nos serveurs ont peut-être un moment d\'égarement. Merci de retenter plus tard.","back":"Retour","unknown_error":"Une erreur inattendue s\'est produite","only_one_image":"Vous ne pouvez pas glisser-déposer plusieurs images en même temps"},"manifest":{"short_description":"Cozy Notes est votre application de prise de notes personnelles et collaboratives.","long_description":"Notes est un éditeur de texte en ligne destiné à :\\n\\n* Créer vos propres notes avec les fonctionnalités essentielles (gras, souligné, liens, tableaux...)\\n* Classer et retrouver vos notes avec vos autres documents, dans les répertoires de votre Drive personnel\\n* Éditer facilement vos notes depuis tous vos appareils\\n* Accéder à vos notes, même sans internet, stockées sur votre PC\\n* Pour les aficionados, utiliser les raccourcis et la saisie au format markdown\\n*  ... et même écrire à plusieurs simultanément sur la même note (à venir) ! ","screenshots":["screenshots/fr/screenshot01.png","screenshots/fr/screenshot02.png"]},"Intents":{"save":"Enregistrer"},"TrashedBanner":{"text":"Cet élément est dans la corbeille","redirect":"Ouvrir la corbeille","restore":"Restaurer","restoreSuccess":"Cet élément a été restauré avec succès","restoreError":"Une erreur s\'est produite, veuillez réessayer","destroy":"Supprimer définitivement"},"DestroyConfirm":{"title":"Supprimer définitivement ?","forbidden":"Vous ne pourrez plus accéder à ce fichier.","restore":"Vous ne pourrez pas restaurer ce fichier.","cancel":"Annuler","delete":"Supprimer définitivement","deleteError":"Une erreur s\'est produite, veuillez réessayer"}}')},IDw7:function(e,t,n){e.exports={"header-menu":"header-menu--HN4tE","app-icon":"app-icon--2S30F","home-link":"home-link--3zbZf","file-infos":"file-infos--1KJvL"}},JdMa:function(e,t,n){"use strict";n.d(t,"c",(function(){return i})),n.d(t,"a",(function(){return a})),n.d(t,"b",(function(){return o})),n.d(t,"d",(function(){return s}));var r=n("4z1N"),i=function(e){var t=e.schema.nodes.media;return e.selection instanceof r.NodeSelection&&e.selection.node.type===t},a=function(e){var t=e.schema.nodes.mediaSingle,n=e.selection.$to;if(t)for(var r=n.depth;r>=0;r--){var i=n.index(r);if(n.node(r).canReplaceWith(i,i,t))return!0}return!1},o=function(e,t){var n=t.nodes,r=n.media,i=n.mediaSingle;if(!r||!i)return null;var a=r.createChecked({type:"external",url:e});return i.createChecked({},a)},s=function(e,t){var n,i=e.clientX,a=e.clientY;return t.dispatch(t.state.tr.setSelection(r.TextSelection.create(t.state.doc,(null===(n=t.posAtCoords({left:i,top:a}))||void 0===n?void 0:n.pos)||0)))}},MjaT:function(e,t,n){"use strict";n.d(t,"a",(function(){return d}));var r,i=n("yCbO"),a=n.n(i),o=n("Czyx"),s=n("QdRn"),c=n("WISH"),l=n("2KGD"),u=n("K4GK"),d=Object(o.css)(r||(r=a()(["\n  .ProseMirror {\n    "," & [layout='full-width'] .",",\n    & [layout='wide'] ."," {\n      margin-left: 50%;\n      transform: translateX(-50%);\n    }\n\n    & [layout^='wrap-'] + [layout^='wrap-'] {\n      clear: none;\n      & + p,\n      & + div[class^='fabric-editor-align'],\n      & + ul,\n      & + ol,\n      & + h1,\n      & + h2,\n      & + h3,\n      & + h4,\n      & + h5,\n      & + h6 {\n        clear: both !important;\n      }\n      & ."," {\n        margin-left: 0;\n        margin-right: 0;\n      }\n    }\n\n    .mediaSingleView-content-wrap[layout^='wrap-'] {\n      max-width: 100%;\n      // overwrite default Prosemirror setting making it clear: both\n      clear: inherit;\n    }\n\n    .mediaSingleView-content-wrap[layout='wrap-left'] {\n      float: left;\n    }\n\n    .mediaSingleView-content-wrap[layout='wrap-right'] {\n      float: right;\n    }\n\n    .mediaSingleView-content-wrap[layout='wrap-right']\n      + .mediaSingleView-content-wrap[layout='wrap-left'] {\n      clear: both;\n    }\n\n    /* Larger margins for resize handlers when at depth 0 of the document */\n    & > .mediaSingleView-content-wrap {\n      .richMedia-resize-handle-right {\n        margin-right: -","px;\n      }\n      .richMedia-resize-handle-left {\n        margin-left: -","px;\n      }\n    }\n  }\n\n  .richMedia-resize-handle-right,\n  .richMedia-resize-handle-left {\n    display: flex;\n    flex-direction: column;\n\n    /* vertical align */\n    justify-content: center;\n  }\n\n  .richMedia-resize-handle-right {\n    align-items: flex-end;\n    padding-right: 12px;\n    margin-right: -","px;\n  }\n\n  .richMedia-resize-handle-left {\n    align-items: flex-start;\n    padding-left: 12px;\n    margin-left: -","px;\n  }\n\n  .richMedia-resize-handle-right::after,\n  .richMedia-resize-handle-left::after {\n    content: ' ';\n    display: flex;\n    width: 3px;\n    height: 64px;\n\n    border-radius: 6px;\n  }\n\n  .",":hover .richMedia-resize-handle-left::after,\n  .",":hover .richMedia-resize-handle-right::after {\n    background: ",";\n  }\n\n  ."," .richMedia-resize-handle-right::after,\n  ."," .richMedia-resize-handle-left::after,\n  ."," .richMedia-resize-handle-right:hover::after,\n  ."," .richMedia-resize-handle-left:hover::after,\n  .",".is-resizing .richMedia-resize-handle-right::after,\n  .",".is-resizing .richMedia-resize-handle-left::after {\n    background: ",";\n  }\n\n  .__resizable_base__ {\n    left: unset !important;\n    width: auto !important;\n    height: auto !important;\n  }\n\n  /* Danger when top level node for smart cards / inline links */\n  .danger > div > div > .media-card-frame,\n  .danger > span > a {\n    background-color: ",";\n    box-shadow: 0px 0px 0px ","px\n      ",";\n    transition: background-color 0s;\n    transition: box-shadow 0s;\n  }\n\n  /* Danger when nested node or common */\n  .danger {\n    /* Media single */\n    ."," .","::after {\n      border: ","px solid ",";\n    }\n\n    .richMedia-selected .richMedia-resize-handle-right::after,\n    .richMedia-selected .richMedia-resize-handle-left::after {\n      background: ",";\n    }\n\n    /* Smart cards */\n    div div .media-card-frame,\n    .inlineCardView-content-wrap > span > a {\n      background-color: rgb(255, 189, 173, 0.5); /* R75 with 50% opactiy */\n      transition: background-color 0s;\n    }\n\n    div div .media-card-frame::after {\n      box-shadow: none;\n    }\n  }\n"])),s.a,s.b,s.b,s.b,c.v,c.v,c.u,c.u,s.b,s.b,l.N60,c.H,c.H,s.b,s.b,s.b,s.b,l.B200,c.h,c.D,c.j,s.b,u.b,c.D,c.j,c.j)},NZnG:function(e,t,n){"use strict";n.d(t,"a",(function(){return R}));var r,i,a,o=n("GeFe"),s=n.n(o),c=n("Zvb3"),l=n.n(c),u=n("J/YY"),d=n.n(u),p=n("a1Fv"),f=n.n(p),h=n("g3eI"),m=n.n(h),v=n("wDGE"),b=n.n(v),g=n("J58c"),y=n.n(g),w=n("yCbO"),O=n.n(w),k=n("ivGQ"),x=n.n(k),j=n("Czyx"),E=n("dKM3"),P=n("DzbU"),C=n("x3sL"),S=n("kSuG"),_=n("zy2m"),M=n("WISH"),D=n("G09D");function I(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=b()(e);if(t){var i=b()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return m()(this,n)}}var N=j.default.div(r||(r=O()(["\n  /* tooltip in ToolbarButton is display:block */\n  & > div > div {\n    display: flex;\n  }\n"]))),T=Object(D.a)(E.a),A=j.default.div(i||(i=O()(["\n  ",";\n"])),(function(e){return e.isSelected?"&& > span, && > span:hover { background: #6c798f; color: #fff; }":""})),L=j.default.span(a||(a=O()(["\n  ",";\n"])),(function(e){return e.hasElemBefore?"margin-left: 8px;":""})),R=function(e){f()(n,e);var t=I(n);function n(){var e;s()(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return e=t.call.apply(t,[this].concat(i)),y()(d()(e),"state",{popupPlacement:["bottom","left"]}),y()(d()(e),"handleRef",(function(t){e.setState({target:t||void 0})})),y()(d()(e),"updatePopupPlacement",(function(t){e.setState({popupPlacement:t})})),y()(d()(e),"handleClose",(function(){e.props.onOpenChange&&e.props.onOpenChange({isOpen:!1})})),e}return l()(n,[{key:"renderItem",value:function(e){var t=this.props,n=t.onItemActivated,r=t.onMouseEnter,i=t.onMouseLeave;if(!e.onClick&&!e.value&&!e.value.name)return x.a.createElement("span",{key:String(e.content)},e.content);var a=x.a.createElement(A,{key:e.key||e.content,isSelected:e.isActive},x.a.createElement(P.a,{elemBefore:e.elemBefore,elemAfter:e.elemAfter,isDisabled:e.isDisabled,onClick:function(){return n&&n({item:e})},onMouseEnter:function(){return r&&r({item:e})},onMouseLeave:function(){return i&&i({item:e})},className:e.className},x.a.createElement(L,{hasElemBefore:!!e.elemBefore},e.content)));return e.tooltipDescription?x.a.createElement(S.a,{key:e.key||e.content,content:e.tooltipDescription,position:e.tooltipPosition},a):a}},{key:"renderDropdownMenu",value:function(){var e=this,t=this.state,n=t.target,r=t.popupPlacement,i=this.props,a=i.items,o=i.mountTo,s=i.boundariesElement,c=i.scrollableElement,l=i.offset,u=i.fitHeight,d=i.fitWidth,p=i.isOpen,f=i.zIndex;return x.a.createElement(_.a,{target:p?n:void 0,mountTo:o,boundariesElement:s,scrollableElement:c,onPlacementChanged:this.updatePopupPlacement,fitHeight:u,fitWidth:d,zIndex:f||M.n,offset:l},x.a.createElement(T,{isOpen:!0,appearance:"tall",position:r.join(" "),shouldFlip:!0,shouldFitContainer:!0,isTriggerNotTabbable:!0,handleClickOutside:this.handleClose,handleEscapeKeydown:this.handleClose},x.a.createElement("div",{style:{height:0,minWidth:d||0}}),a.map((function(t,n){return x.a.createElement(C.a,{key:n},t.items.map((function(t){return e.renderItem(t)})))}))))}},{key:"render",value:function(){var e=this.props,t=e.children,n=e.isOpen;return x.a.createElement(N,null,x.a.createElement("div",{ref:this.handleRef},t),n?this.renderDropdownMenu():null)}}]),n}(k.PureComponent)},Q6Vf:function(e,t,n){"use strict";n.r(t);var r,i=n("HZZ/"),a=n.n(i),o=n("XkwL"),s=n.n(o),c=n("LGLP"),l=n.n(c),u=n("hJxD"),d=n.n(u),p=n("ivGQ"),f=n.n(p),h=n("mZuE"),m=n("6Vpj"),v=n("QJcL"),b=n("p/pw"),g=n("N8wp"),y=n("Jbzi"),w=n("9Y1u"),O=n("bQqJ"),k=n("Rx+m"),x=n("BE3H"),j=n.n(x),E=n("WY6r"),P=n("kLK4"),C=n("xEu0"),S=n("Aaol"),_=n("vTbG");!function(e){e.New="new",e.Editor="n/:id",e.Root="/",e.ShareFromEditor="n/:id/share",e.ShareFromList="share"}(r||(r={}));var M=n("pX20"),D=n("/s+K"),I=n("AHiN"),N=n("SOA1"),T=n("bOB9");function A(e){var t=e.className,n=Object(S.useI18n)().t,r=Object(C.useClient)(),i=Object(p.useState)(!1),o=s()(i,2),c=o[0],l=o[1],u=Object(p.useCallback)(a()(d.a.mark((function e(){var t,n;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return l(!0),e.next=3,Object(T.a)(r);case 3:return t=e.sent,n=t.data,e.next=7,Object(T.c)(r,n);case 7:window.location.href=e.sent;case 8:case"end":return e.stop()}}),e)}))),[r]);return f.a.createElement(D.a,{onClick:u,type:"submit",busy:c,startIcon:f.a.createElement(I.default,{icon:"plus"}),label:n("Notes.Add.add_note"),className:t})}function L(e){var t=Object(C.useClient)()||e.client;return f.a.createElement(N.a,{onClick:a()(d.a.mark((function e(){var n,r;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(T.a)(t);case 2:return n=e.sent,r=n.data,e.next=6,Object(T.c)(t,r);case 6:window.location.href=e.sent;case 7:case"end":return e.stop()}}),e)}))),icon:"plus",className:"u-c-pointer"})}var R,z=n("AjpU"),U=n("RLdO"),F=n("9Ub/"),B=Object(U.a)()(Object(z.a)()((function(e){var t=e.t;return!e.breakpoints.isMobile&&f.a.createElement(F.a,{variant:"h3",component:"h1"},t("Notes.List.latest_notes"))}))),V=n("mU0V"),W=n("/5Aj"),q=n("lomp"),H=n.n(q),G=n("nOWK"),K=n.n(G),Q=new H.a({id:"icon_note_empty_77efa79dd615f19897a8ed6ec9097298",use:"icon_note_empty_77efa79dd615f19897a8ed6ec9097298-usage",viewBox:"0 0 171 168",content:'<symbol xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 171 168" id="icon_note_empty_77efa79dd615f19897a8ed6ec9097298">\n    <defs>\n        <path id="icon_note_empty_77efa79dd615f19897a8ed6ec9097298_a" d="M.02.12h36.532v20.674H.02z" />\n    </defs>\n    <g fill="none" fill-rule="evenodd">\n        <path fill="#0DCBCF" d="M48.367 47.28c3.795-4.135 9.702 2.27 5.938 6.374-8.105 8.832-11.21 22.848-5.617 33.864 6.83 13.453 25.138 8.377 36.387 4.37 5.26-1.871 7.054 6.655 1.834 8.515-15.343 5.464-37.282 8.714-45.942-8.858-7.276-14.767-3.455-32.433 7.4-44.265" />\n        <path fill="#D6FAFB" d="M59.57 16.922c.739-4.162 1.797-8.167 3.764-11.417C66.807-.21 73.009-.675 79.69.561c3.047.47 76.99 11.012 78.873 11.76 6.957 2.843 7.343 8.129 5.837 14.148-.141.971-20.067 84.443-21.43 88.854-1.852 5.978-4.906 11.375-10.609 11.973-5.714.623-75.27-18.403-78.5-19.534-3.954-1.39-5.72-3.632-6.159-6.323-.603-1.443-.376-3.088-.067-5.144.8-5.412 8.228-69.79 11.935-79.373" />\n        <path fill="#FFF" d="M65.047 19.073S64.561 3.301 79.004 5.122c14.443 1.819 89.593 13.951 89.593 13.951v9.972l-15.17 7.281-88.38-17.253z" />\n        <path fill="#ACF5F7" d="M53.622 31.458c.246-4.25.829-8.372 2.413-11.844 2.795-6.122 8.927-7.314 15.747-6.87 3.103.105 6.245.706 8.959 1.155 13.33 2.21 60.933 9.536 62.437 9.936.853.239 3.242 1.012 3.93 1.337 5.173 2.422 4.26 6.643 3.56 12.102-.023.988-10.066 86.694-10.903 91.263-1.155 6.187-3.561 11.933-9.185 13.21-5.636 1.297-77.342-9.496-80.695-10.235-4.111-.928-6.143-2.958-6.897-5.597-.781-1.368-.738-3.034-.675-5.12.157-5.506 8.735-79.333 11.309-89.337" />\n        <path fill="#79ECEE" d="M134.818 99.416c4.069-24.17 8.504-48.43 11.948-72.677.037-.293.209-1.305.35-1.515-.04-.744 2.317.264 4.506.067.068 0 .925-.114.992-.114.716-.138 1.42-.29 2.149-.552 3.554-1.285 4.98-4.27 4.938-7.584-.046-2.971-2.376-4.28-2.285-5.071.047-.427 2.619.902 2.915 1 .405.133 3.131 1.892 4.372 4.065 1.249 2.19.856 5.296.785 8.049-.244 9.277-8.008 66.518-9.51 78.49.026.153-.358 3.1-.546 4.417-.38 2.901-.772 5.807-1.182 8.707-.319 2.271-1.653 15.153-1.929 15.747-3.391 7.361-12.892 9.872-20.513 9.34-.434.025-.851-.016-1.524-.102-.844-.108-2.024.034-3.35-.235.145-2.458 5.937-30.472 7.884-42.032" />\n        <path fill="#FFF" d="M98.24 56.354c3.65-6.425 11.472-9.96 18.354-7.212a10.488 10.488 0 0 1 4.359 2.129c.117.074.22.173.33.253.099.086.2.171.29.253a10.141 10.141 0 0 1 3.012 3.703c.14.243.285.483.408.733.028.087.095.136.12.22.089.233.126.462.208.7.4 1.024.667 2.088.785 3.213.399 2.397.348 4.8-.468 7.371-1.431 4.512-6.871 6.769-11.066 7.466-3.062.503-6.549-.22-9.546-1.52-4.286-1.86-5.61-4.269-6.733-7.469-1.146-3.274-1.878-6.632-.054-9.84M57.875 49.863c1.7-3.323 4.417-5.416 7.697-6.62.072-.048.117-.104.197-.162 2.037-1.45 4.806-2 7.4-1.642 6.076.399 11.603 5.645 13.426 11.64.926 3.055.816 6.827-.747 9.66-2.345 4.249-6.24 6.338-10.86 7.305-7.715 1.625-16.183-3.686-18.103-11.22-.745-2.904-.38-6.293.99-8.961" />\n        <path fill="#FFF" d="M97.573 60.005c.542 1.111 2.285 1.832 3.325 1.161 1.116-.715 1.315-2.42.479-3.462-.451-.557-1.063-.82-1.666-.79a.296.296 0 0 0-.235-.062c-1.392.108-2.635 1.68-1.903 3.153M82.511 58.042c.543 1.11 2.287 1.83 3.325 1.159 1.12-.72 1.318-2.42.479-3.46-.453-.558-1.059-.82-1.668-.791a.295.295 0 0 0-.227-.065c-1.4.11-2.637 1.679-1.909 3.157" />\n        <path fill="#FFF" d="M83.12 55.648c.916-3.33 5.387-5.305 8.553-5.085 3.765.266 8.59 3.494 9.277 7.454.373 2.132-3.201 2.492-3.554.466-.782-4.47-8.893-6.614-10.702-2.003-.036.357-.226.713-.675 1.002-.022.023-.05.037-.07.05-1.412.921-3.292-.203-2.83-1.884" />\n        <path fill="#79ECEE" d="M130.887 48.194c1.972 3.09 7.333 4.648 10.183 2.337 3.064-2.497 3.1-7.587.281-10.373-1.511-1.495-3.399-2.072-5.16-1.798a1.058 1.058 0 0 0-.718-.108c-4.064.775-7.221 5.81-4.586 9.942M127.85 77.94c1.733 2.724 6.45 4.093 8.956 2.058 2.697-2.199 2.723-6.673.244-9.122-1.327-1.316-2.985-1.825-4.536-1.582a.938.938 0 0 0-.63-.094c-3.578.679-6.353 5.109-4.034 8.74M123.467 106.767c1.607 2.793 6.26 4.374 8.854 2.454 2.796-2.074 3.021-6.54.654-9.102-1.267-1.375-2.901-1.949-4.46-1.781a.948.948 0 0 0-.627-.127c-3.603.52-6.573 4.823-4.42 8.556" />\n        <path fill="#D6FAFB" d="M134.92 71.16l.384-.004c3.34-.056 4.832 2.564 4.435 4.87.819 3.035 6.732 4.083 9.188 4.55 3.327.638 6.204.138 7.935-1.695a5.354 5.354 0 0 0 .518-.67c.964-1.44 1.663-2.972 2.485-4.46.207-1.606.413-3.208.626-4.844 1.045.01 7.44.93 7.404 5.085-.061 7.397-4.113 11.963-9.873 13.901.007-.076.018-.156.03-.233a.106.106 0 0 0-.042.013l.012.22c-2.516.844-5.377 1.193-8.431 1.044-7.434-.364-19.518-4.398-19.253-13.56.07-2.467 2.191-4.176 4.582-4.217M155.979 103.575c.026.15-.358 3.097-.548 4.415-.379 2.903-.77 5.807-1.182 8.708-.04.298-.1.792-.173 1.41-.423.111-.846.232-1.267.325-9.933 2.216-23.748-2.264-26.83-12.978-1.387-4.823 5.737-6.845 8.28-3.535 3.25 3.006 6.375 4.279 10.726 4.987 2.315.378 9.589 1.174 10.133-1.001l.86-2.331z" />\n        <path fill="#D6FAFB" d="M155.43 107.99c.19-1.318.575-4.264.549-4.415.141-1.139.343-2.691.587-4.57 1.43-.943 3.35-1.181 4.91-.156 4.028 2.644 5.269 6.247 3.534 10.833-1.791 4.722-6.312 7.18-10.936 8.425.075-.617.134-1.11.175-1.409.412-2.901.803-5.805 1.182-8.708" />\n        <path fill="#0DCBCF" d="M97.295 86.818c.143-.42-.082-.821-.543-.907l-15.969-2.926c-.445-.086-.826.224-.826.667 0 0-.792 8.124 7.2 9.59 7.994 1.46 10.138-6.424 10.138-6.424M106.717 66.413a2.628 2.628 0 0 0 2.9-2.325c.148-1.137.803-3.051 3.438-2.757 2.873.313 2.836 2.714 2.758 3.44a2.632 2.632 0 0 0 2.32 2.906 2.635 2.635 0 0 0 2.902-2.328c.367-3.341-1.301-8.563-7.404-9.24-6.1-.67-8.868 4.061-9.233 7.399a2.623 2.623 0 0 0 2.319 2.905M65.97 60.55a2.618 2.618 0 0 0 2.898-2.323c.154-1.135.809-3.045 3.444-2.756 2.873.32 2.836 2.715 2.758 3.446a2.628 2.628 0 0 0 2.324 2.898 2.633 2.633 0 0 0 2.896-2.326c.369-3.336-1.295-8.561-7.399-9.232-6.107-.682-8.87 4.055-9.24 7.395a2.62 2.62 0 0 0 2.319 2.898M7.328 107.186s-4.037-2.086 6.805-8.374c10.108-5.864 7.278 10.253 7.278 10.253l-14.083-1.88z" />\n        <path fill="#DFFCFC" d="M77.122 128.065c-3.962-7.31-6.318-14.535-8.397-21.528-3.496-11.78-4.837-23.725-10.418-35.926-.384-.842-1.51-1.893-2.359-2.092a1247.17 1247.17 0 0 1-45.203-11.481C5.086 55.485.713 55.304.083 59.109c-.007.039-.016.076-.022.12-.14.995-.046 2.243.353 3.81.19.754.696 1.372 1.281 1.841C4.793 75.29 6.898 85.406 10.32 95.907c3.831 11.75 8.712 23.72 12.591 35.483.415 1.26 1.806 2.668 3.07 2.721.323.013.648.028.971.04 3.006 1.149 30.837 7.319 41.229 8.583 4.412.538 18.182 5.133 17.55-.856-.335-3.168-7.048-10.931-8.61-13.813" />\n        <path fill="#0DCBCF" d="M24.169 106.068c-4.748.862-9.072.078-13.23-2.376-3.782-2.232-6.633 3.978-2.878 6.194a24.375 24.375 0 0 0 16.752 2.983c4.29-.779 3.694-7.587-.644-6.801" />\n        <path fill="#0DCBCF" d="M26.43 113.925c-4.822.208-9-1.152-12.787-4.147-3.445-2.725-7.11 3.043-3.69 5.747a24.362 24.362 0 0 0 16.193 5.225c4.356-.19 4.689-7.017.284-6.825" />\n        <path fill="#0DCBCF" d="M27.7 121.497c-4.773-.725-8.608-2.867-11.746-6.535-2.856-3.338-7.566 1.615-4.73 4.929a24.372 24.372 0 0 0 14.88 8.249c4.313.653 5.952-5.982 1.595-6.643" />\n        <path fill="#D6FAFB" d="M56.82 163.387c2.634 1.707 9.394 3.19 14.841 3.785 14.866 1.625 35.651.773 44.451-2.186 8.875-2.98 9.27-7.505-13.293-9.77-19.21-1.926-41.628.772-46.423 4.818-1.286 1.083-1.211 2.293.423 3.353" />\n        <path fill="#FFF" d="M85.93 121.501l-8.872-2.495 5.144-7.99 53.966-19.197a4.453 4.453 0 0 1 5.686 2.7l.746 2.099a4.45 4.45 0 0 1-2.702 5.686L85.93 121.5z" />\n        <path fill="#0DCBCF" d="M154.388 66.712c-4.389-3.498-9.232 3.746-4.877 7.216 9.374 7.469 14.612 20.835 10.794 32.583-4.663 14.35-23.538 12.171-35.273 9.956-5.483-1.035-5.935 7.667-.492 8.695 16.003 3.021 38.184 2.835 44.015-15.867 4.9-15.715-1.61-32.577-14.167-42.583" />\n        <path fill="#0DCBCF" d="M117.57 120.966c-.858-.505-1.8-.82-2.724-.954.007-.692-.294-1.44-.896-2.045a5.36 5.36 0 0 0-1.042-.795c.604-.217 1.24-.4 1.767-.57 4.603-1.484-.888-7.006-5.49-5.523-4.248 1.372-8.193 3.504-7.248 7.418.244 1.01 1.247 2.234 2.773 2.788.09.031.177.056.268.09.235 1.784 2.018 3.698 4.6 4.72.32.126.656.225.99.326.556 1.45 2.692 2.89 4.895 2.99 5.026.234 8.746-1.607 9.6-4.766.4-1.491-1.568-3.332-3.883-3.906-1.418-.35-2.69-.218-3.61.227" />\n        <path fill="#0DCBCF" d="M116.74 108.083c-2.338-.522-12.208 2.855-5.111 5.063 1.627.505 1.248.814 2.754 1.558-.564.2-1.05.473-1.4.824-2.277.728-2.681 3.583-1.654 5.93 1.48 3.38 2.415 7.939 7.426 7.805 5.597-.148 12.373-6.007 12.023-9.417-.211-2.065-1.65-5.025-4.013-6.767-1.204-.887-7.684-4.475-10.024-4.996" />\n        <path fill="#0DCBCF" d="M118.038 108.505s-11.852-4.477-13.846-1.858c-1.799 2.363-5.817 10.49-3.131 10.95 2.683.463 10.129-2.62 10.129-2.62l6.848-6.472z" />\n        <g transform="translate(134.244 38.595)">\n            <mask id="icon_note_empty_77efa79dd615f19897a8ed6ec9097298_b" fill="#fff">\n                <use xlink:href="#icon_note_empty_77efa79dd615f19897a8ed6ec9097298_a" />\n            </mask>\n            <path fill="#D6FAFB" d="M9.325 7.036c.397 5.93 8.7 6.329 13.777 4.795.42-.158.845-.317 1.23-.505a9.225 9.225 0 0 0 1.389-.872c.082-.06.995-.824 1.133-.954 1.086-1.008 2.065-2.238 2.415-3.433.248-2.072.485-4.087.695-5.947a8.54 8.54 0 0 1 2.63 1.137C34 2.191 34.869 3.2 35.499 4.768c.088.213.125.438.17.665.332.608.553 1.271.557 1.963 1.55 5.622-2.602 9.814-8.58 11.908.032-.244.058-.477.09-.717-.01.004-.02.011-.029.015-.018.233-.03.458-.061.702C17.12 22.994.906 20.164.03 7.036c-.365-5.393 8.932-5.393 9.294 0" mask="url(#icon_note_empty_77efa79dd615f19897a8ed6ec9097298_b)" />\n        </g>\n        <path fill="#ACF5F7" d="M67.018 83.907a4.967 4.967 0 1 1-9.935 0 4.966 4.966 0 0 1 4.967-4.967 4.967 4.967 0 0 1 4.968 4.967M73.57 105.824a4.967 4.967 0 1 1-9.935 0 4.966 4.966 0 0 1 4.966-4.966 4.967 4.967 0 0 1 4.969 4.966M80.564 124.544a4.967 4.967 0 0 1-4.968 4.966 4.966 4.966 0 0 1-4.967-4.966 4.967 4.967 0 1 1 9.935 0" />\n    </g>\n</symbol>'}),J=(K.a.add(Q),Q),X=n("xzHV"),$={_type:"io.cozy.apps",_id:"io.cozy.apps/notes"},Y=function(e){var t=Object(p.useState)(Object(T.e)(e)),n=s()(t,2),r=n[0],i=n[1];return Object(p.useEffect)((function(){(function(){var t=a()(d.a.mark((function t(){var n,r;return d.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,X.CozyFolder.getReferencedFolders($);case 3:n=t.sent,r=Object(T.e)(e,n[0]._id),i(r),t.next=11;break;case 8:t.prev=8,t.t0=t.catch(0),i(Object(T.e)(e));case 11:case"end":return t.stop()}}),t,null,[[0,8]])})));return function(){return t.apply(this,arguments)}})()()}),[e]),{notesFolder:r}},Z=n("CE71"),ee=n("4vUV"),te=Object(z.a)()(Object(C.withClient)((function(e){var t=e.t,n=e.client,r=Y(n).notesFolder;return f.a.createElement("div",{className:"empty"},f.a.createElement(W.a,{id:"empty",icon:J,title:t("Notes.Empty.welcome"),text:f.a.createElement(Z.default,{href:r,app:{slug:ee.i.Drive}},(function(e){var n=e.href,r=e.onClick;return f.a.createElement("span",{className:"u-mb-half"},t("Notes.Empty.after_created")," ",f.a.createElement("a",{href:n,onClick:r},"Cozy Drive"),".")}))},f.a.createElement(A,{className:"u-mt-1"})))}))),ne=n("J58c"),re=n.n(ne),ie=n("/gvb"),ae=n("hAvo"),oe=n("HCvV"),se=n("83GJ"),ce=n("Wz2g"),le=new H.a({id:"icon-note-32_0b87f187ce7a65cb93dbf28b37a73b8d",use:"icon-note-32_0b87f187ce7a65cb93dbf28b37a73b8d-usage",viewBox:"0 0 32 32",content:'<symbol xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 32 32" id="icon-note-32_0b87f187ce7a65cb93dbf28b37a73b8d">\n<style type="text/css">\n\t#icon-note-32_0b87f187ce7a65cb93dbf28b37a73b8d .st0{fill-rule:evenodd;clip-rule:evenodd;fill:#ACF5F7;}\n\t#icon-note-32_0b87f187ce7a65cb93dbf28b37a73b8d .st1{fill-rule:evenodd;clip-rule:evenodd;fill:#0DCBCF;}\n</style>\n<g transform="translate(2)">\n\t<path class="st0" d="M0,2c0-1.1,0.9-2,2-2h22c1.1,0,2,0.9,2,2v28c0,1.1-0.9,2-2,2H2c-1.1,0-2-0.9-2-2V2z" />\n\t<path class="st1" d="M6,8h14v2H6V8z M6,12h8v2H6V12z M6,16h14v2H6V16z M6,20h10v2H6V20z" />\n</g>\n<g transform="translate(0 4)">\n\t<path class="st1" d="M1.5,0h2C4.3,0,5,0.7,5,1.5l0,0C5,2.3,4.3,3,3.5,3h-2C0.7,3,0,2.3,0,1.5l0,0C0,0.7,0.7,0,1.5,0z" />\n\t<path class="st1" d="M1.5,7h2C4.3,7,5,7.7,5,8.5l0,0C5,9.3,4.3,10,3.5,10h-2C0.7,10,0,9.3,0,8.5l0,0C0,7.7,0.7,7,1.5,7z" />\n\t<path class="st1" d="M1.5,14h2C4.3,14,5,14.7,5,15.5l0,0C5,16.3,4.3,17,3.5,17h-2C0.7,17,0,16.3,0,15.5l0,0C0,14.7,0.7,14,1.5,14z" />\n\t<path class="st1" d="M1.5,21h2C4.3,21,5,21.7,5,22.5l0,0C5,23.3,4.3,24,3.5,24h-2C0.7,24,0,23.3,0,22.5l0,0C0,21.7,0.7,21,1.5,21z" />\n</g>\n<g>\n\t<path class="st1" d="M31.4,18.4l-2.8-2.8c0.8-0.8,2-0.8,2.8,0S32.2,17.6,31.4,18.4z" />\n\t<path class="st1" d="M30.7,19.1L20.8,29l-2.5,0.9c-0.5,0.2-1.1-0.1-1.3-0.6c-0.1-0.2-0.1-0.5,0-0.7l0.9-2.5l9.9-9.9L30.7,19.1z" />\n</g>\n</symbol>'}),ue=(K.a.add(le),le),de=n("bcvt"),pe=n.n(de);!function(e){e.ExtraLarge="isExtraLarge",e.Large="isLarge",e.Medium="isMedium",e.Small="isSmall",e.Tiny="isTiny",e.Desktop="isDesktop",e.Tablet="isTablet",e.Mobile="isMobile"}(R||(R={}));var fe=n("2GvR"),he=n("hX+F"),me=n("uU7o"),ve=function(e){var t=e.drivePath,n=e.path,r=e.target;return e.noLink?f.a.createElement(he.a,null,Object(me.b)(n)):f.a.createElement(Z.default,{href:t,app:{slug:ee.i.Drive}},(function(e){var t=e.href,i=e.onClick;return f.a.createElement(fe.a,l()({href:t,onClick:i},function(e){return"string"!=typeof e?{}:"_blank"===e?{target:"_blank",rel:"noreferrer noopener"}:{target:e}}(r)),Object(me.b)(n))}))},be=function(e){var t=e.hideOn,n=e.showOn,r=e.children,i=Object(k.default)(),a=t&&i[t],o=n&&i[n],s=f.a.createElement(f.a.Fragment,null,r);return t?a?null:s:n?o?s:null:s};function ge(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function ye(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ge(Object(n),!0).forEach((function(t){re()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ge(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var we=Object(z.a)()(Object(C.withClient)((function(e){var t=e.note,n=e.f,i=e.t,o=e.client,c=Object(k.default)().isMobile,l=Object(h.g)(),u=X.CozyFile.splitFilename(t),v=u.filename,b=u.extension,g=Object(p.useState)(!1),y=s()(g,2),w=y[0],O=y[1],x=Object(_.b)().showAlert,j=Object(p.useCallback)((function(e){O(!0),e.stopPropagation()}),[O]),E=Object(p.useCallback)((function(){return O(!1)}),[O]),P=Object(p.useCallback)(a()(d.a.mark((function e(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,o.destroy(t);case 3:O(!1),x({message:i("Notes.Delete.deleted"),severity:"success"}),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),x({message:i("Notes.Delete.failed"),severity:"error"});case 10:case"end":return e.stop()}}),e,null,[[0,7]])}))),[o,t,i,O,x]),C=Object(p.useMemo)((function(){return Object(T.e)(o,t.dir_id)}),[o,t]),S=f.a.createRef(),M=function(){var e=a()(d.a.mark((function e(){var n;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Object(T.c)(o,t);case 3:n=e.sent,window.location.href=n,e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),x({message:i("Error.loading_error_title"),severity:"error"});case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(){return e.apply(this,arguments)}}();return f.a.createElement(f.a.Fragment,null,f.a.createElement(V.f,{className:"u-c-pointer ".concat(pe.a.tableRow),role:"button",tabIndex:"0",onKeyDown:function(e){"Enter"===e.key&&M()},onClick:M},f.a.createElement(V.c,{className:"".concat(pe.a.tableCellName," u-flex u-flex-items-center u-fz-medium")},f.a.createElement(I.default,{icon:ue,size:32,className:"u-mr-1 u-flex-shrink-0"}),c?f.a.createElement("div",{className:"u-flex u-flex-column u-flex-grow-1",style:{minWidth:0}},f.a.createElement(F.a,{display:"inline",noWrap:!0},v),f.a.createElement(ve,{drivePath:C,path:t.path,noLink:!0})):f.a.createElement("div",{className:"u-flex-grow-1"},f.a.createElement(F.a,{display:"inline",noWrap:!0},v),f.a.createElement("span",{className:"u-ellipsis"},b))),f.a.createElement(be,{hideOn:R.Mobile},f.a.createElement(V.c,{className:pe.a.tableCell},i("Notes.List.at",{date:n(t.updated_at,"DD MMMM"),time:n(t.updated_at,"HH:mm")})),f.a.createElement(V.c,{className:"".concat(pe.a.tableCell," u-flex-shrink-0"),onClick:function(e){return e.stopPropagation()}},f.a.createElement(ve,{drivePath:C,path:t.path})),f.a.createElement(V.c,{className:pe.a.tableCell},f.a.createElement(m.b,{onClick:function(e){return e.stopPropagation()},to:r.ShareFromList,state:{backgroundLocation:l,shareModalProps:{document:ye(ye({},t),{},{name:t.attributes.name}),documentType:ee.b.Notes,sharingDesc:t.attributes.name}}},f.a.createElement(ce.a,{docId:t._id,size:24})))),f.a.createElement(V.c,{className:pe.a.tableCell,onClick:c?j:void 0},f.a.createElement("span",{ref:S},f.a.createElement(oe.a,{onClick:c?void 0:j},f.a.createElement(I.default,{icon:"dots"}))))),w&&f.a.createElement(ie.a,{onClose:E,anchorElRef:S,popperOptions:{strategy:"fixed"}},f.a.createElement(m.b,{style:{color:"var(--primaryTextColor)"},className:pe.a.actionMenuItem,onClick:E,to:r.ShareFromList,state:{backgroundLocation:l,shareModalProps:{document:ye(ye({},t),{},{name:t.attributes.name}),documentType:ee.b.Notes,sharingDesc:t.attributes.name}}},f.a.createElement(ae.a,{left:f.a.createElement(I.default,{icon:se.a}),autoclose:!0,right:f.a.createElement(be,{showOn:R.Mobile},f.a.createElement(ce.a,{docId:t.id,size:"small"}))},i("Notes.Files.share.cta"))),f.a.createElement(ae.a,{onClick:P,left:f.a.createElement(I.default,{icon:"trash"})},i("Notes.Delete.delete_note"))))}))),Oe=function(){return f.a.createElement(V.f,{className:pe.a.tableSpecialRow},f.a.createElement(V.c,{className:pe.a.tableCellEmpty},f.a.createElement(te,null)))},ke=function(){return f.a.createElement(V.f,{className:pe.a.tableSpecialRow},f.a.createElement(V.c,{className:"".concat(pe.a.tableCellEmpty," u-ta-center")},f.a.createElement(O.b,{size:"xxlarge"})))},xe=Object(z.a)()((function(e){var t=e.t,n=e.notes,r=e.fetchStatus;return f.a.createElement(V.a,{className:"".concat(pe.a.table," ").concat(0===n.length&&pe.a.notable)},n.length>0&&f.a.createElement(V.d,null,f.a.createElement(V.f,null,f.a.createElement(V.e,{className:pe.a.tableCellName},t("Notes.List.name")),f.a.createElement(be,{hideOn:R.Mobile},f.a.createElement(V.e,{className:pe.a.tableCell},t("Notes.List.updated_at")),f.a.createElement(V.e,{className:"".concat(pe.a.tableCell," u-flex-shrink-0")},t("Notes.List.location")),f.a.createElement(V.e,{className:pe.a.tableCell},t("Notes.List.sharings"))),f.a.createElement(V.e,{className:pe.a.tableCell}))),f.a.createElement(V.b,null,"loading"===r?f.a.createElement(ke,null):0===n.length?f.a.createElement(Oe,null):n.map((function(e){return f.a.createElement(we,{note:e,key:e._id})}))))})),je=function(e,t){return"loaded"===e&&t.length>0},Ee=function(){return f.a.createElement(C.Query,{query:function(){return Object(C.Q)("io.cozy.notes")}},(function(e){var t=e.data,n=e.fetchStatus;return f.a.createElement(f.a.Fragment,null,f.a.createElement(M.a,null,f.a.createElement(be,{hideOn:R.Mobile},f.a.createElement("div",{className:t.length>0?"".concat(pe.a.appHeader," u-flex u-flex-justify-between u-flex-items-center u-mt-1"):""},t.length>0&&f.a.createElement(B,null),je(n,t)&&f.a.createElement(A,null))),f.a.createElement(xe,{notes:t,fetchStatus:n})),je(n,t)&&f.a.createElement(be,{showOn:R.Mobile},f.a.createElement(b.BarRight,null,f.a.createElement(L,null))))}))},Pe=n("ii0b"),Ce=n.n(Pe),Se=n("XyBq"),_e=n("MsT6"),Me=n("bfH1"),De=n("aoYa"),Ie=n("nyYD"),Ne=n("hhV5"),Te=n.n(Ne);function Ae(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Le(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ae(Object(n),!0).forEach((function(t){re()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ae(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Re=function(e){var t=e.file,n=e.title,i=Object(p.useCallback)((function(){}),[]),a=Object(h.g)();if(t){var o,s=t.id;return f.a.createElement(m.b,{to:r.ShareFromList,state:{backgroundLocation:a,shareModalProps:{document:Le(Le({},t),{},{name:n||(null==t||null===(o=t.attributes)||void 0===o?void 0:o.name)}),documentType:ee.b.Notes,sharingDesc:n}},style:{textDecoration:"none"}},f.a.createElement(Ie.a,{theme:"primary",docId:s,onClick:i,extension:"narrow",className:Te.a["sharing-button"]}))}return null},ze=f.a.forwardRef((function(e,t){return f.a.createElement("div",{ref:t},f.a.createElement(I.default,e))})),Ue=function(e){var t=e.isPublic,n=e.isReadOnly,r=e.title,i=e.file,a=Object(S.useI18n)().t;return t?n?f.a.createElement(De.a,{title:a("Notes.Editor.read_only")},f.a.createElement(ze,{icon:"lock",color:"var(--primaryTextColor)"})):null:f.a.createElement(Re,{file:i,title:r})};Ue.propTypes={isPublic:Ce.a.bool.isRequired,isReadOnly:Ce.a.bool.isRequired,title:Ce.a.string.isRequired,file:Ce.a.object.isRequired};var Fe=Ue;var Be=function(){return f.a.createElement("div",{className:"u-mv-3"},f.a.createElement(O.b,{size:"xxlarge",middle:!0}))};var Ve=function(e){var t=e.returnUrl,n=Object(S.useI18n)().t;return f.a.createElement(W.a,{icon:"cross-small",title:n("Error.loading_error_title"),text:f.a.createElement(f.a.Fragment,null,f.a.createElement("p",{className:"u-mb-half"},n("Error.loading_error_text_noReturnUrl")),t&&f.a.createElement(D.a,{variant:"text",label:n("Error.back"),href:t}))})},We=n("MoN4"),qe=n("JlEO"),He=n("YDHN"),Ge=n.n(He),Ke=n("Y/FK"),Qe=n.n(Ke),Je=n("eCKM"),Xe=n("/5sY"),$e=n("OY/u"),Ye=n("o9PO"),Ze=n.n(Ye),et=Object($e.a)({tooltipPlacementBottom:{margin:"12px 24px"},tooltipPlacementTop:{margin:"12px 24px"}},{name:"MuiTooltip"})(De.a);function tt(e){return f.a.createElement(et,{title:e.content,open:e.open||void 0,key:e.open?"open":"auto"},e.children)}function nt(e){var t=e.bannerRef&&e.bannerRef.current;return t?Qe.a.createPortal(f.a.createElement("div",{className:Ze.a.banner},e.content),t):null}function rt(e){var t=Object(S.useI18n)().t,n=Object(k.default)().isMobile,r=f.a.createElement(Je.a,{direction:"row",container:!0,wrap:"nowrap",spacing:1,className:Ze.a.grid},f.a.createElement(Je.a,{item:!0},f.a.createElement(Xe.a.Round,{className:Ze.a.chip},f.a.createElement(I.default,{icon:"offline",color:"var(--iconTextColor)"}))),f.a.createElement(Je.a,{item:!0},t("Notes.OfflineIndicator.message"))),i=n?nt:tt;return f.a.createElement(i,{open:e.open,content:r,bannerRef:e.bannerRef},e.children)}var it=n("y0wq"),at=n.n(it);var ot=function(e){var t=Object(S.useI18n)().t,n=Object(k.default)().isMobile,r=new Date,i=e.collabProvider,a=r-(i.getLastSaveOrSync()||r),o=i.isDirty(),c=r-i.getDirtySince();!function(e){var t=Object(p.useState)(null),n=s()(t,2)[1],r=Object(p.useCallback)(at()((function(){return n(new Date)}),200),[n]);Object(p.useEffect)((function(){return e.on("collab-state-change",r),function(){return e.off("collab-state-change",r)}}),[e,r])}(i);var l,u=function(e){var t=e.isOutOfSync,n=new Date,r=Object(qe.a)()||t,i=Object(p.useMemo)((function(){return new Date}),[r]);return{isDisconnected:r,disconnectedAge:r?n-i:0}}({isOutOfSync:function(e){var t=e.isDirty,n=e.dirtyAge;return t&&n&&n>3e4}({isDirty:o,dirtyAge:c})}),d=u.isDisconnected,h=u.disconnectedAge,m=function(e){var t=e.disconnectedAge,n=e.isDisconnected&&t<5e3,r=5e3-t;return Object(We.a)(n&&r),n}({isDisconnected:d,disconnectedAge:h}),v=d?h:o?c:a,b=Object(T.l)(v),g=b.key,y=b.time,w=b.interval;Object(We.a)(w),l=o?d?"saving_impossible.".concat(g):c>5e3?"still_saving":"saving":d?"out_of_sync.".concat(g):"saved.default";var O=t("Notes.SavingIndicator.".concat(l),{time:y}),x=f.a.createElement(F.a,{className:Ge.a["saving-indicator"],variant:"body1"},O);return d?f.a.createElement(rt,{open:m,bannerRef:e.bannerRef},x):n?null:x},st=n("GeFe"),ct=n.n(st),lt=n("Zvb3"),ut=n.n(lt),dt=n("/dlN"),pt=n("q5Wy"),ft=function(){function e(){ct()(this,e)}return ut()(e,[{key:"preventDefault",value:function(){this.prevented=!0}}]),e}();function ht(e,t,n){var r=function(){var e=new ft;n&&n(e),e.prevented||(document.location=t)};return function(t){t.preventDefault(),e(r)}}function mt(e){var t=e.returnUrl,n=e.file,r=e.requestToLeave,i=Object(p.useContext)(pt.a),a=Object(C.useClient)();if(i)return null;if(t){var o=C.models.file.getParentFolderId(n),s=Object(T.f)(o),c=function(e,t){try{var n=e.getInstanceOptions().subdomain;return Object(C.deconstructCozyWebLinkWithSlug)(t,n).slug}catch(r){return ee.i.Notes}}(a,t);return f.a.createElement(Z.default,{app:{slug:c},href:t,nativePath:s},(function(e){var t=e.onClick,n=e.href;return f.a.createElement(dt.ButtonLink,{icon:"previous",onClick:ht(r,n,t),href:n,className:"sto-app-back",subtle:!0})}))}return f.a.createElement(dt.Button,{icon:"previous",href:"#/",onClick:ht(r,"#/"),className:"sto-app-back",subtle:!0})}mt.propTypes={returnUrl:Ce.a.string,file:Ce.a.object.isRequired,requestToLeave:Ce.a.func};var vt=n("QGb3"),bt=n.n(vt),gt=n("HrPx"),yt=n("RDSZ"),wt=n("gTK3"),Ot=n("8ZpT"),kt=n.n(Ot),xt=n("mXbR"),jt=n.n(xt),Et=n("JSg/"),Pt=n.n(Et),Ct=n("XA6X"),St=n.n(Ct),_t=n("/yh+"),Mt=n.n(_t);function Dt(e,t){var n=jt()("debug.".concat(e));Object(p.useEffect)((function(){n&&It(e,t)}),[n,e,t])}function It(e,t){St()(window,"cozy.debug.".concat(e),t)}St()(window,"cozy.debug.showSwitcher",(function(){return kt()("switcher",!0)})),St()(window,"cozy.debug.notes.debugCollab",function(){var e=a()(d.a.mark((function e(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return kt()("debug.client",!0),kt()("debug.notes.service",!0),kt()("debug.notes.collabProvider",!0),kt()("debug.notes.channel",!0),kt()("debug.notes.noteId",!0),kt()("debug.notes.doc",!0),kt()("debug.notes.file",!0),kt()("debug.notes.returnUrl",!0),kt()("debug.notes.dirtyRef",!0),kt()("debug.notes.lastPatchError",!0),e.next=12,new Promise((function(e){window.setTimeout(a()(d.a.mark((function t(){var n,r,i,o,s,c,l,u,p,f,h,m,v,b,g,y,w,O,k,x,j,E,P,C,S,_;return d.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=Mt()(window,"cozy.debug.notes.collabProvider"),r=Mt()(window,"cozy.debug.notes.channel"),(i={date:(new Date).toISOString()}).noteId=Mt()(window,"cozy.debug.notes.noteId"),i.initialVersion=Mt()(window,"cozy.debug.notes.initialVersion"),i.returnUrl=Mt()(window,"cozy.debug.notes.returnUrl"),o=n&&n.getState(),s=n&&o&&Object(yt.b)(o),c=o&&Object(yt.d)(o)||{steps:[]},l=c.steps,i.state={version:s,steps:l,length:l&&l.length},u=r&&r.backoff,p=r&&r.failures,f=r&&r.isDirty(),h=r&&r.isSending,m=r&&r.hasQueuedSteps(),v=r&&r.queuedStep,b=v&&v.state,g=b&&Object(yt.b)(b),y=v&&v.localSteps&&v.localSteps.steps,i.queue={backoff:u,failures:p,isDirty:f,isSending:h,hasQueue:m,version:g,steps:y,length:y&&y.length},w=n.isDirty(),O=n.getLastRemoteSync(),k=n.getLastLocalSave(),i.collabState={dirtySince:w,lastRemoteSync:O,lastLocalSave:k},x=n&&n.serviceClient,j=x&&x.realtime,E=j&&j.websocket,P=j&&j.retryManager,i.realtime={hasRealtime:!!j,started:j&&j.isStarted,hasWebsocket:j&&j.hasWebSocket(),isOpen:j&&j.isWebSocketOpen(),readyState:E&&E.readyState,bufferedAmount:E&&E.bufferedAmount,url:E&&E.url,retries:P&&P.retries,wait:P&&P.wait},C=Mt()(window,"cozy.debug.client"),i.client={token:C.stackClient.token,credentials:C.stackClient.getCredentials(),authorization:C.stackClient.getAuthorizationHeader(),uri:C.uri},(S=Mt()(window,"cozy.debug.notes.lastPatchError"))||!f){t.next=43;break}case 33:if(!r.isSending){t.next=38;break}return t.next=36,new Promise((function(e){return window.setTimeout(e,50)}));case 36:t.next=33;break;case 38:return r.resetBackoff(),r.processQueue(),t.next=42,Promise.race([new Promise((function(e){return window.setTimeout(e,2e3)})),new Promise((function(e){(function(){var t=a()(d.a.mark((function t(){var n;return d.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n=Mt()(window,"cozy.debug.notes.lastPatchError");case 1:if(n){t.next=7;break}return t.next=4,new Promise((function(e){return window.setTimeout(e,50)}));case 4:n=Mt()(window,"cozy.debug.notes.lastPatchError"),t.next=1;break;case 7:S=n,e();case 9:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}})()()}))]);case 42:r.isDirty()&&(r.backoff=u,r.failures=p);case 43:_=S&&S.message;try{_=JSON.parse(S.message)}catch(M){}i.lastPatchError={name:S&&S.name,status:S&&S.status,message:_},e(i);case 47:case"end":return t.stop()}}),t)}))),250)}));case 12:return e.abrupt("return",e.sent);case 13:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}());var Nt=function(){function e(t,n){ct()(this,e),this.config=t,this.service=n,this.eventEmitter=new gt.EventEmitter2,this.resetBackoff(),this.initializeStepsQueue(),this.isSending=!1}var t,n,r,i,o,s;return ut()(e,[{key:"resetBackoff",value:function(){this.backoff=0,this.failures=0}},{key:"increaseBackoff",value:function(){this.failures=this.failures+1,this.failures%4==0&&this.emit("needcatchup",{failures:this.failures}),this.backoff=Math.max(Math.min(2*this.backoff,3e5),128)}},{key:"afterBackoff",value:function(){var e=this;return new Promise((function(t){e.backoff<128?t():window.setTimeout(t,e.backoff)}))}},{key:"initializeStepsQueue",value:function(){this.queuedStep=void 0}},{key:"isDirty",value:function(){return this.hasQueuedSteps()||this.isSending}},{key:"ensureEmptyQueue",value:(s=a()(d.a.mark((function e(){var t=this;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e){t.isDirty()?t.on("emptyQueue",(function t(){this.off("emptyQueue",t),e()})):e()})));case 1:case"end":return e.stop()}}),e)}))),function(){return s.apply(this,arguments)})},{key:"enqueueSteps",value:function(e){var t=e.getState,n=e.state,r=e.localSteps;this.queuedStep={getState:t,state:n,localSteps:r}}},{key:"dequeueSteps",value:function(){var e=this.queuedStep,t=e.getState,n=e.state||t(),r=e.localSteps||Object(yt.d)(n)||{steps:[]};return this.queuedStep=void 0,{getState:t,state:n,localSteps:r}}},{key:"hasQueuedSteps",value:function(){return!!this.queuedStep}},{key:"rebaseStepsInQueue",value:function(){this.queuedStep&&(this.queuedStep={getState:this.queuedStep.getState})}},{key:"sendSteps",value:(o=a()(d.a.mark((function e(t,n,r){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.emit("enqueueSteps"),this.enqueueSteps({getState:t,state:n,localSteps:r}),e.next=4,this.processQueue();case 4:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return o.apply(this,arguments)})},{key:"processQueue",value:(i=a()(d.a.mark((function e(){var t,n,r,i,a,o,s;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isSending){e.next=2;break}return e.abrupt("return");case 2:if(this.hasQueuedSteps()){e.next=5;break}return this.emit("emptyQueue"),e.abrupt("return");case 5:return this.isSending=!0,e.next=8,this.afterBackoff();case 8:if(t=this.dequeueSteps(),n=t.getState,r=t.state,i=t.localSteps.steps,void 0!==(a=Object(yt.b)(r))){e.next=12;break}return e.abrupt("return");case 12:if(0!==i.length){e.next=14;break}return e.abrupt("return");case 14:return e.prev=14,o=this.config.noteId,e.next=18,this.service.pushSteps(o,a,i);case 18:s=e.sent,this.rebaseStepsInQueue(),this.resetBackoff(),this.emit("successfulPatch"),this.isSending=!1,s&&s.steps&&s.steps.length>0&&this.emit("data",s),e.next=32;break;case 26:e.prev=26,e.t0=e.catch(14),kt()("notes.lastPatchError")&&It("notes.lastPatchError",e.t0),this.hasQueuedSteps()?this.rebaseStepsInQueue():this.enqueueSteps({getState:n}),this.increaseBackoff(),this.isSending=!1;case 32:return e.next=34,this.processQueue();case 34:case"end":return e.stop()}}),e,this,[[14,26]])}))),function(){return i.apply(this,arguments)})},{key:"connect",value:(r=a()(d.a.mark((function e(t){var n,r,i,a,o=this;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=t.version,r=t.doc,i=t.updatedAt,a=this.config.noteId,this.service.join(a),this.service.onStepsCreated(a,(function(e){o.emit("data",{version:e.version,steps:[e]})})),this.service.onTelepointerUpdated(a,(function(e){o.emit("telepointer",e)})),this.service.onSchemaUpdated(a,(function(){o.emit("schemaupdated")})),this.emit("connected",{version:n,doc:r,updatedAt:i});case 7:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"getSteps",value:(n=a()(d.a.mark((function e(t){var n;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.config.noteId,e.next=3,this.service.getSteps(n,t);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"sendTelepointer",value:(t=a()(d.a.mark((function e(t){var n;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.config.noteId,e.next=3,this.service.pushTelepointer(n,t);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"on",value:function(e,t){return this.eventEmitter.on(e,t),this}},{key:"off",value:function(e,t){return this.eventEmitter.off(e,t),this}},{key:"emit",value:function(e,t){return this.eventEmitter.emit(e,t),this}}]),e}(),Tt=n("Mx+G"),At=n.n(Tt);function Lt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Rt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Lt(Object(n),!0).forEach((function(t){re()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Lt(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var zt=new wt.a,Ut=zt.encode.bind(zt);zt.encode=function(e){var t=Ut(e);return 0===t.content.length&&0!=e.content.length?{content:[{type:"paragraph",content:[]}],type:"doc"}:t};var Ft=function(){function e(t,n){var r=this;ct()(this,e),re()(this,"processRemoteData",(function(e){var t=e.version,n=e.steps;if(n&&n.length){var i=n.map((function(e){return e.sessionId||r.serviceClient.getUserId(e.sessionId)}));r.emit("data",{json:n,version:t,userIds:i})}else console.warn("Collab.Provider: processRemoteData no steps ? ",n,e)})),re()(this,"onReceiveData",(function(e){r.queueData(e),r.processQueue()})),re()(this,"onReceiveTelepointer",(function(e){var t=e.sessionId,n=r.serviceClient.getUserId(t);if(n!==r.config.userId){var i=r.participants.get(n);i&&i.lastActive>e.timestamp||(r.updateParticipant(t,e.timestamp),r.emit("telepointer",e))}})),re()(this,"onReceiveSchemaUpdated",(function(){window.location.reload(!0)})),this.config=Rt({},t),this.config.sessionId=n.getSessionId(),this.config.userId=n.getUserId(),this.cancelLocalChanges=At()(this.cancelLocalChanges.bind(this),100),this.setReadOnly(!!this.config.readOnly),this.serviceClient=n,this.channel=t.channel||new Nt(this.config,n),this.eventEmitter=new gt.EventEmitter2,this.queue=[],this.getState=function(){},this.participants=new Map,this.pauseQueue=!1,this.initialVersion=t.version,this.initialDate=t.updatedAt||new Date,this.pauseQueue=!1}var t;return ut()(e,[{key:"initialize",value:function(e){var t=this;this.getState=e,this.channel.on("connected",(function(e){var n=e.doc,r=e.version,i=e.updatedAt,a=t.config.sessionId;t.emit("init",{sid:a,doc:n,version:r}),t.emit("connected",{sid:a}),t.listenStateEvents({lastRemoteSync:i})})),this.channel.on("data",this.onReceiveData),this.channel.on("telepointer",this.onReceiveTelepointer),this.channel.on("schemaupdated",this.onReceiveSchemaUpdated),this.channel.on("needcatchup",(function(){return t.catchup()}));var n=e(),r=zt.encode(n.doc),i=void 0!==this.initialVersion?this.initialVersion:r.version,a=Rt(Rt({},r),{},{version:i});return this.channel.connect({version:i,doc:a,updatedAt:this.initialDate}),this}},{key:"send",value:function(e,t,n){e.steps&&e.steps.length&&(this.isReadOnly()?this.cancelLocalChanges():this.channel.sendSteps(this.getState,n))}},{key:"sendMessage",value:function(e){if(e&&!this.isReadOnly())switch(e.type){case"telepointer":this.channel.sendTelepointer(Rt(Rt({},e),{},{timestamp:(new Date).getTime()}))}}},{key:"queueData",value:function(e){var t=[].concat(bt()(this.queue),[e]).sort((function(e,t){var n=e.version-e.steps.length,r=t.version-t.steps.length;return n>r?1:n<r||e.version>t.version?-1:e.version<t.version?1:0}));this.queue=t}},{key:"catchup",value:(t=a()(d.a.mark((function e(){var t,n,r,i,a,o,s,c,l;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.pauseQueue=!0,t=Object(yt.b)(this.getState()),e.prev=2,e.next=5,this.channel.getSteps(t);case 5:n=e.sent,r=n.doc,i=n.version,a=n.steps,r?(o=this.config.sessionId,s=Object(yt.d)(this.getState())||{},c=s.steps,l=void 0===c?[]:c,this.emit("init",{sid:o,doc:r,version:i}),l.length&&!this.isReadOnly()&&this.emit("local-steps",{steps:l})):a.length>0&&this.onReceiveData({steps:a,version:i},!0),this.queueTimeout=void 0,this.pauseQueue=!1,this.processQueue(),e.next=19;break;case 15:e.prev=15,e.t0=e.catch(2),this.pauseQueue=!1,this.programCatchup();case 19:case"end":return e.stop()}}),e,this,[[2,15]])}))),function(){return t.apply(this,arguments)})},{key:"programCatchup",value:function(){var e=this;this.queueTimeout||(this.queueTimeout=window.setTimeout((function(){e.catchup()}),1e3))}},{key:"cancelCatchup",value:function(){this.queueTimeout&&(window.clearTimeout(this.queueTimeout),this.queueTimeout=void 0)}},{key:"processQueue",value:function(){if(this.queue.length>0&&!this.pauseQueue)for(var e=Object(yt.b)(this.getState());this.queue.length>0;){var t=this.queue[0],n=t.version,r=t.steps.length+e;if(n==r)this.cancelCatchup(),this.queue.shift(),this.processRemoteData(t),e=n;else if(n<=r&&this.queue.shift(),n>r){this.programCatchup();break}}}},{key:"updateParticipant",value:function(e,t){var n=this,r=this.serviceClient.getUserId(e),i=function(e){var t=e.userId,n=e.sessionId;return{userId:n,sessionId:n||t,name:t,avatar:null,email:null}}({userId:r,sessionId:e});this.participants.set(r,Rt(Rt({name:"",email:"",avatar:"",sessionId:e,userId:r},i),{},{lastActive:t}));var a=[this.participants.get(r)],o=(new Date).getTime(),s=Array.from(this.participants.values()).filter((function(e){return(o-e.lastActive)/1e3>300}));s.forEach((function(e){return n.participants.delete(e.userId)})),this.emit("presence",{joined:a,left:s})}},{key:"emit",value:function(e,t){return this.eventEmitter.emit(e,t),this}},{key:"on",value:function(e,t){return this.eventEmitter.on(e,t),this}},{key:"off",value:function(e,t){return this.eventEmitter.off(e,t),this}},{key:"unsubscribeAll",value:function(e){this.eventEmitter.removeAllListeners(e)}},{key:"isDirty",value:function(){return!!this.dirtySince}},{key:"getDirtySince",value:function(){return this.dirtySince}},{key:"getLastLocalSave",value:function(){return this.lastLocalSave}},{key:"getLastRemoteSync",value:function(){return this.lastRemoteSync}},{key:"getLastSaveOrSync",value:function(){return this.lastLocalSave>this.lastRemoteSync?this.lastLocalSave:this.lastRemoteSync}},{key:"onLocalSave",value:function(){this.lastLocalSave=new Date,this.emit("collab-state-change")}},{key:"onRemoteSync",value:function(){this.lastRemoteSync=new Date,this.emit("collab-state-change")}},{key:"onChannelEmptyQueue",value:function(){this.dirtySince=void 0,this.emit("collab-state-change")}},{key:"onChannelEnqueue",value:function(){this.dirtySince||(this.dirtySince=new Date,this.emit("collab-state-change"))}},{key:"listenStateEvents",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.lastRemoteSync;this.channel.on("emptyQueue",this.onChannelEmptyQueue.bind(this)),this.channel.on("enqueueSteps",this.onChannelEnqueue.bind(this)),this.channel.on("successfulPatch",this.onLocalSave.bind(this)),this.on("data",this.onRemoteSync.bind(this)),this.on("init",this.onRemoteSync.bind(this)),t&&(this.lastRemoteSync=t)}},{key:"isReadOnly",value:function(){return this.readOnly}},{key:"setReadOnly",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.readOnly=!!e,this.readOnly&&this.cancelLocalChanges()}},{key:"cancelLocalChanges",value:function(){var e=this.getState&&this.getState();if(e){var t=Mt()(e,"collab$.unconfirmed[0].origin.docs[0]"),n=Mt()(e,"collab$.version"),r=this.config.sessionId;if(t&&n&&r){var i=t.toJSON();this.emit("init",{doc:i,version:n,sid:r})}}}}]),e}();var Bt=function(e){var t=e.doc,n=e.noteId,r=e.serviceClient;return Object(p.useMemo)((function(){var e=t&&t.version,i=t&&t.updatedAt;if(r&&void 0!==t)return new Ft({version:e,noteId:n,updatedAt:i},r)}),[n,t,r])};var Vt=function(e){var t=e.noteId,n=e.title,r=e.setTitle,i=e.serviceClient,a=Object(p.useCallback)(i?function(e){var a;if("insertLineBreak"===(null===(a=e.nativeEvent)||void 0===a?void 0:a.inputType))return window.document.querySelector(".ProseMirror").focus();var o=e.target.value.replace(/[\r\t\n\xa0]+/g," ");n!=o&&(r(o),i.setTitle(t,o))}:function(){},[t,n,r,i]);Object(p.useEffect)((function(){i&&i.onTitleUpdated(t,(function(e){n!=e&&r(e)}))}),[n,r,i,t]);var o=Object(p.useMemo)(T.d,[]);return Object(p.useEffect)((function(){document.title=n&&""!=n?"".concat(n," - ").concat(o):o}),[o,n]),{onLocalTitleChange:a}};var Wt=function(e){var t=e.doc,n=e.collabProvider,r=t&&t.file.id,i=n&&n.serviceClient,o=n&&n.channel;return{forceSync:Object(p.useCallback)(function(){var e=a()(d.a.mark((function e(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t&&o&&i)){e.next=5;break}return e.next=3,o.ensureEmptyQueue();case 3:return e.next=5,i.sync(r);case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),[t,o,i,r]),emergencySync:Object(p.useCallback)((function(){r&&i&&i.sync(r)}),[r,i])}};var qt=function(e){var t=e.returnUrl,n=e.cozyClient,r=e.doc,i=Object(p.useContext)(pt.a);return Object(p.useMemo)((function(){return t||(r?Object(T.g)(n,r.file):i?void 0:"/")}),[t,r,i,n])},Ht=n("v2Ur"),Gt=n("whoR"),Kt=n("3uoH"),Qt=n("pSj2"),Jt=n("OEPu"),Xt=n("4jS1"),$t=n("i5f2"),Yt=n("dUf/"),Zt=n("jMeN"),en=n("P/GF"),tn=function(e){var t=e.noteId,n=e.onCancel,r=e.onConfirm,i=Object(S.useI18n)().t,o=Object(C.useClient)(),c=Object(p.useState)(!1),l=s()(c,2),u=l[0],h=l[1],m=Object(_.b)().showAlert,v=function(){var e=a()(d.a.mark((function e(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,h(!0),e.next=4,o.collection("io.cozy.files").deleteFilePermanently(t);case 4:r(),e.next=12;break;case 7:e.prev=7,e.t0=e.catch(0),m({message:i("TrashedBanner.deleteError"),severity:"error"}),n(),h(!1);case 12:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(){return e.apply(this,arguments)}}();return f.a.createElement(Qt.a,{open:!0,onClose:n,title:i("DestroyConfirm.title"),content:f.a.createElement(Jt.a,null,f.a.createElement(Xt.b,{gutters:"disabled",size:"small"},f.a.createElement($t.a,null,f.a.createElement(I.default,{icon:Zt.a})),f.a.createElement(Yt.a,{primary:i("DestroyConfirm.forbidden")})),f.a.createElement(Xt.b,{gutters:"disabled",size:"small"},f.a.createElement($t.a,null,f.a.createElement(I.default,{icon:en.a})),f.a.createElement(Yt.a,{primary:i("DestroyConfirm.restore")}))),actions:f.a.createElement(f.a.Fragment,null,f.a.createElement(D.a,{variant:"secondary",onClick:n,label:i("DestroyConfirm.cancel"),disabled:u}),f.a.createElement(D.a,{color:"error",onClick:v,label:i("DestroyConfirm.delete"),busy:u}))})},nn=function(e){var t=e.noteId,n=e.isPublic,r=e.returnUrl,i=Object(S.useI18n)().t,o=Object(C.useClient)(),c=Object(_.b)().showAlert,l=Object(k.default)().isMobile,u=Object(p.useState)(!1),h=s()(u,2),m=h[0],v=h[1],b=Object(p.useState)(!1),g=s()(b,2),y=g[0],w=g[1],O=function(){var e=a()(d.a.mark((function e(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,o.collection("io.cozy.files").restore(t);case 3:c({message:i("TrashedBanner.restoreSuccess"),severity:"secondary"}),e.next=9;break;case 6:e.prev=6,e.t0=e.catch(0),c({message:i("TrashedBanner.restoreError"),severity:"error"});case 9:return e.prev=9,w(!1),e.finish(9);case 12:case"end":return e.stop()}}),e,null,[[0,6,9,12]])})));return function(){return e.apply(this,arguments)}}(),x=function(){var e=a()(d.a.mark((function e(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:v(!0);case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return f.a.createElement(f.a.Fragment,null,f.a.createElement(Gt.a,{square:!0,severity:"secondary",icon:f.a.createElement(I.default,{icon:Kt.a,size:32}),block:l,action:n?null:f.a.createElement(f.a.Fragment,null,f.a.createElement(D.a,{size:"small",variant:"text",label:i("TrashedBanner.restore"),onClick:O,busy:y}),f.a.createElement(D.a,{size:"small",variant:"text",label:i("TrashedBanner.destroy"),onClick:x,disabled:y}))},i("TrashedBanner.text")),m?f.a.createElement(tn,{noteId:t,onCancel:function(){v(!1)},onConfirm:function(){window.location=r}}):null)},rn=C.fetchPolicies.olderThan(3e5),an=function(e){return{definition:Object(C.Q)("io.cozy.files").getById(e),options:{as:"io.cozy.files/".concat(e),fetchPolicy:rn,singleDocData:!0}}},on=n("N9qa"),sn=n("eCKa"),cn=n("xr2j"),ln=n("gMSI"),un=n("IDw7"),dn=n.n(un),pn=n("0nAg");function fn(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function hn(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?fn(Object(n),!0).forEach((function(t){re()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):fn(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var mn=function(e){var t=e.file,n=Object(C.useClient)(),r=an(t.dir_id),i=Object(C.useQuery)(r.definition,hn(hn({},r.options),{},{enabled:!!t.dir_id})),a=Object(p.useMemo)((function(){return i.data?Object(pn.ensureFilePath)(t,i.data):void 0}),[t,i.data]),o=Object(p.useMemo)((function(){return Object(T.e)(n,t.dir_id)}),[n,t.dir_id]);return a?f.a.createElement(be,{hideOn:R.Mobile},f.a.createElement(ve,{drivePath:o,path:a.path,target:"_blank"})):null},vn=function(e){var t,n=e.homeHref,r=e.leftComponent,i=e.rightComponent,a=e.isPublic,o=e.file,s=e.bannerComponent,c=(t=Object(C.useClient)(),{fetchHomeIcon:function(){return"".concat(t.options.uri,"/assets/images/icon-cozy-home.svg")},fetchNoteIcon:function(){return"/public/".concat(t.instanceOptions.app.icon)}}),u=c.fetchHomeIcon,d=c.fetchNoteIcon,p=C.models.file.splitFilename(o.attributes).filename;return f.a.createElement("header",null,f.a.createElement("div",{className:dn.a["header-menu"]},f.a.createElement(be,{hideOn:R.Mobile},f.a.createElement(Z.default,{app:{slug:ee.i.Home},href:n},(function(e){var t=e.href;return f.a.createElement(ln.a,l()({},!a&&{href:t},{className:dn.a["home-link"]}),f.a.createElement(sn.default,{app:ee.i.Home,alt:ee.i.Home,fetchIcon:u}))})),f.a.createElement(cn.a,{orientation:"vertical",className:"u-mh-1"})),r,f.a.createElement("div",{className:dn.a["file-infos"]},f.a.createElement(be,{hideOn:R.Mobile},f.a.createElement(sn.default,{app:o.attributes.cozyMetadata.createdByApp,className:dn.a["app-icon"],fetchIcon:d})),f.a.createElement("div",null,f.a.createElement(F.a,null,f.a.createElement("strong",null,p)),!a&&f.a.createElement(mn,{file:o}))),i),s)};vn.propTypes={homeHref:Ce.a.string,leftComponent:Ce.a.node,rightComponent:Ce.a.node,isPublic:Ce.a.bool,file:Ce.a.object.isRequired,bannerComponent:Ce.a.node};var bn=vn,gn=n("v/Qj"),yn=n("8Zd7"),wn=n("6mlU"),On=Object(p.createContext)(),kn=function(e){var t,n=e.children,r=e.noteId,i=e.readOnly,o=void 0!==i&&i,c=Object(C.useClient)(),l=Object(p.useRef)(r),u=Object(p.useState)("pending"),h=s()(u,2),m=h[0],v=h[1],b=Object(p.useState)(),g=s()(b,2),y=g[0],w=g[1],O=Object(p.useState)(),k=s()(O,2),x=k[0],j=k[1],E=Object(gn.a)(),P=E.userName,S=E.userId,_=Object(yn.a)({userId:S,userName:P,cozyClient:c}),M=(t=r,{definition:Object(C.Q)("io.cozy.notes").getById(t),options:{as:"io.cozy.notes/".concat(t),fetchPolicy:rn,singleDocData:!0}}),D=Object(C.useQuery)(M.definition,M.options);return Object(p.useEffect)((function(){var e=function(){var e=a()(d.a.mark((function e(){var t;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(v("loading"),e.prev=1,t=_.getFormatedDoc(null==D?void 0:D.data),o||t.schemaVersion===Object(wn.a)()){e.next=8;break}if("failed"===m){e.next=8;break}return e.next=7,_.updateSchema(r,wn.b);case 7:t=e.sent;case 8:w(t.title||""),j(t),v("loaded"),e.next=16;break;case 13:e.prev=13,e.t0=e.catch(1),v("failed");case 16:case"end":return e.stop()}}),e,null,[[1,13]])})));return function(){return e.apply(this,arguments)}}();"loaded"===D.fetchStatus&&_&&"loading"!==m&&void 0===x&&e()}),[x,r,D,o,_,m]),Object(p.useEffect)((function(){r!==l.current&&(v("pending"),w(void 0),j(void 0)),l.current=r}),[r]),f.a.createElement(On.Provider,{value:{doc:x,serviceClient:_,status:m,title:y,setTitle:w}},n)},xn='[data-testid="ak-editor-main-toolbar"]',jn=function(e){var t=En(e);return Pn(e,t),function(){document.removeEventListener("scroll",t),window.visualViewport.removeEventListener("resize",t)}},En=function(e){return function(){var t=window.visualViewport,n=e.offsetHeight,r=t.height-n+document.documentElement.scrollTop;e.style.top="".concat(r,"px")}},Pn=function(e,t){e.style.position="absolute",e.style.bottom="auto",e.style.marginTop="-5rem",t(),document.addEventListener("scroll",t,{passive:!0}),window.visualViewport.addEventListener("resize",t,{passive:!0})},Cn=function(e){var t=En(e);document.addEventListener("scroll",t,{passive:!0}),window.visualViewport.addEventListener("resize",t,{passive:!0})},Sn=function(e,t){e.forEach((function(e){Array.from(e.addedNodes).forEach((function(e){if(1===e.nodeType){var n=e;if(n.matches(xn)||n.querySelector(xn)){t.disconnect();var r=n.matches(xn)?n:n.querySelector(xn);return void(r&&(jn(r),Cn(r)))}}}))}))},_n=function(){Object(p.useEffect)((function(){if(/iPhone|iPad|iPod/.test(window.navigator.userAgent)){var e,t=document.querySelector(xn);return t?(jn(t),Cn(t)):(e=new MutationObserver(Sn)).observe(document.body,{childList:!0,subtree:!0}),function(){var n,r;null===(n=e)||void 0===n||n.disconnect(),t&&(r=En(t),document.removeEventListener("scroll",r),window.visualViewport.removeEventListener("resize",r))}}}),[])};function Mn(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Dn(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Mn(Object(n),!0).forEach((function(t){re()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Mn(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function In(e){var t,n,r=Object(C.useClient)(),i=e.noteId,a=e.readOnly,o=Object(S.useI18n)().t,c=Object(p.useRef)(),l=Object(h.g)(),u=an(i),d=Object(C.useQuery)(u.definition,u.options);_n();var m=Object(p.useContext)(pt.a),v=Object(p.useContext)(On),b=v.doc,g=v.serviceClient,y=v.status,w=v.title,O=v.setTitle,k=qt({returnUrl:e.returnUrl||(null==l||null===(t=l.state)||void 0===t?void 0:t.returnUrl),cozyClient:r,doc:b}),x=Bt({noteId:i,serviceClient:g,doc:b}),j=Vt({noteId:i,title:w,setTitle:O,serviceClient:g}).onLocalTitleChange,E=Wt({doc:b,collabProvider:x}),P=E.forceSync,_=E.emergencySync;Object(_e.a)("beforeunload",(function(){P()})),Object(p.useEffect)((function(){return P}),[i,b,P]);var M,D,I,N,T,A=Object(p.useCallback)((function(){return x.isDirty()}),[x]),L=Object(on.a)({activate:A,onLeave:_,title:o("Notes.Editor.exit_confirmation_title"),message:o("Notes.Editor.exit_confirmation_message"),leaveLabel:o("Notes.Editor.exit_confirmation_leave"),cancelLabel:o("Notes.Editor.exit_confirmation_cancel")}),R=L.exitConfirmationModal,z=L.requestToLeave,U=null==d?void 0:d.data,F=null!==(n=null==U?void 0:U.trashed)&&void 0!==n&&n,B=a||F,V=(M=window.location.pathname,D=Object(p.useState)(!1),I=s()(D,2),N=I[0],T=I[1],Object(p.useEffect)((function(){T(ee.h===M&&!!Object(Ht.c)())}),[M]),N);return Dt("client",r),Dt("notes.service",g),Dt("notes.collabProvider",x),Dt("notes.channel",x&&x.channel),Dt("notes.noteId",i),Dt("notes.doc",b&&Dn(Dn({},b.doc),{},{version:b.version})),Dt("notes.file",b&&b.file),Dt("notes.returnUrl",k),b&&U?f.a.createElement(f.a.Fragment,null,f.a.createElement(C.RealTimeQueries,{doctype:"io.cozy.files"}),f.a.createElement(Me.a,{bannerRef:c,readOnly:B,onTitleChange:j,onTitleBlur:_,collabProvider:x,defaultTitle:o("Notes.Editor.title_placeholder"),defaultValue:Dn(Dn({},b.doc),{},{version:b.version}),title:w&&w.length>0?w:void 0,headerMenu:f.a.createElement(bn,{leftComponent:f.a.createElement("div",{className:"u-mr-1"},f.a.createElement(mt,{returnUrl:k,file:U,requestToLeave:z})),rightComponent:f.a.createElement(Fe,{file:U,isPublic:m,isReadOnly:B,title:w}),bannerComponent:F?f.a.createElement(nn,{noteId:i,isPublic:m,returnUrl:k}):V?f.a.createElement(Se.a,{previewPath:ee.h}):null,homeHref:x.serviceClient.cozyClient.getStackClient().uri,isPublic:m,file:U})}),f.a.createElement(ot,{collabProvider:x,bannerRef:c}),R):"failed"===y||"failed"===d.fetchStatus?f.a.createElement(Ve,{returnUrl:k}):f.a.createElement(Be,null)}In.propTypes={noteId:Ce.a.string.isRequired,readOnly:Ce.a.bool.isRequired,userName:Ce.a.string,returnUrl:Ce.a.oneOfType([Ce.a.string,Ce.a.bool]).isRequired};var Nn=Object(z.a)()((function(e){var t=e.t;return f.a.createElement(W.a,{icon:"unlink",title:t("Error.unshared_title"),text:t("Error.unshared_text")})})),Tn=function(){var e=Object(C.useClient)(),t=e.getInstanceOptions().subdomain,n=Object(h.h)();return Object(p.useEffect)((function(){(function(){var r=a()(d.a.mark((function r(){var i,a,o,s;return d.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,Object(T.a)(e);case 2:i=r.sent,a=i.data,o=Object(C.generateWebLink)({slug:"notes",cozyUrl:e.getStackClient().uri,subDomainType:t,pathname:"/"}),s="/n/".concat(a.id),n(s,{replace:!0,state:{returnUrl:o}});case 7:case"end":return r.stop()}}),r)})));return function(){return r.apply(this,arguments)}})()()}),[e,t,n]),f.a.createElement(O.b,{size:"xxlarge",middle:!0})},An=n("5z4W"),Ln=v.b(h.c),Rn=function(){var e=Object(h.j)().id,t=Object(T.h)();return f.a.createElement(kn,{noteId:e},f.a.createElement(In,{noteId:e,returnUrl:t,readOnly:!1}))},zn=function(){var e=Object(h.g)(),t=Object(h.h)(),n=e.state,i=function(){return f.a.createElement(P.a,l()({onClose:function(){return t(-1)}},n.shareModalProps))};return f.a.createElement(f.a.Fragment,null,f.a.createElement(Ln,{location:(null==n?void 0:n.backgroundLocation)||e},f.a.createElement(h.a,{path:r.New,element:f.a.createElement(Tn,null)}),f.a.createElement(h.a,{path:r.Root,element:f.a.createElement(Ee,null)}),f.a.createElement(h.a,{path:r.Editor,element:f.a.createElement(Rn,null)})),(null==n?void 0:n.backgroundLocation)&&(null==n?void 0:n.shareModalProps)&&f.a.createElement(Ln,null,f.a.createElement(h.a,{path:r.ShareFromEditor,element:f.a.createElement(i,null)}),f.a.createElement(h.a,{path:r.ShareFromList,element:f.a.createElement(i,null)})))},Un=function(){var e=Object(C.useClient)(),t=Object(p.useState)(null),n=s()(t,2),r=n[0],i=n[1],o=Object(p.useState)(!1),c=s()(o,2),l=c[0],u=c[1],h=Object(p.useMemo)((function(){return Object(T.h)()}),[]);return Object(p.useEffect)((function(){(function(){var t=a()(d.a.mark((function t(){var n,r,a,o,s,c;return d.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,!(n=new URLSearchParams(window.location.search)).has("id")){t.next=11;break}return r=n.get("id"),t.next=6,Object(T.b)(e,r);case 6:a=t.sent,u(a),i(r),t.next=18;break;case 11:return t.next=13,Object(T.i)(e);case 13:o=t.sent,s=o.id,c=o.readOnly,u(c),i(s);case 18:t.next=23;break;case 20:t.prev=20,t.t0=t.catch(0),i(!1);case 23:case"end":return t.stop()}}),t,null,[[0,20]])})));return function(){return t.apply(this,arguments)}})()()}),[e]),r?f.a.createElement(kn,{noteId:r},f.a.createElement(In,{readOnly:l,noteId:r,returnUrl:h})):null!==r?f.a.createElement(Nn,null):f.a.createElement(O.b,{size:"xxlarge",middle:!0})},Fn=function(e){var t=e.isPublic,n=Object(C.useClient)(),r=Object(k.default)().isMobile,i=j()().ClientErrors,a=Object(S.useI18n)().t,o=r?Object(Ht.a)(n.getInstanceOptions().app.name,An.name):"",s=(jt()("switcher"),Pt.a);return f.a.createElement(f.a.Fragment,null,f.a.createElement(m.a,null,f.a.createElement(E.b,{monoColumn:!0},f.a.createElement(b.BarComponent,null),!t&&r&&f.a.createElement(b.BarCenter,null,f.a.createElement(y.a,null,o)),f.a.createElement(E.c,null,f.a.createElement(E.a,null,f.a.createElement(_.a,null,t?f.a.createElement(Un,null):f.a.createElement(zn,null)))),f.a.createElement(w.a,null),f.a.createElement(g.a,{t:a}),f.a.createElement(s,null))),f.a.createElement(i,null))};t.default=function(e){return f.a.createElement(b.BarProvider,null,f.a.createElement(k.BreakpointsProvider,null,f.a.createElement(Fn,e)))}},YDHN:function(e,t,n){e.exports={"saving-indicator":"saving-indicator--rzoXB"}},bOB9:function(e,t,n){"use strict";n.d(t,"j",(function(){return k})),n.d(t,"h",(function(){return x})),n.d(t,"c",(function(){return j})),n.d(t,"b",(function(){return M})),n.d(t,"i",(function(){return I})),n.d(t,"f",(function(){return T})),n.d(t,"e",(function(){return A})),n.d(t,"g",(function(){return L})),n.d(t,"d",(function(){return R})),n.d(t,"a",(function(){return z})),n.d(t,"l",(function(){return H})),n.d(t,"k",(function(){return G}));var r=n("J58c"),i=n.n(r),a=n("HZZ/"),o=n.n(a),s=n("XkwL"),c=n.n(s),l=n("hJxD"),u=n.n(l),d=n("/yh+"),p=n.n(d),f=n("xEu0"),h=n("v2Ur"),m=n("6mlU"),v=n("5z4W"),b=n.n(v);function g(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function y(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?g(Object(n),!0).forEach((function(t){i()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):g(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function w(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return O(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return O(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function O(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function k(e){return new URL(e.getStackClient().uri).hostname+Math.floor(100*Math.random())}function x(){var e,t=w(new URLSearchParams(window.location.search));try{for(t.s();!(e=t.n()).done;){var n=c()(e.value,2),r=n[0],i=n[1];if("returnUrl"===r)return i}}catch(a){t.e(a)}finally{t.f()}}function j(e,t,n){return E.apply(this,arguments)}function E(){return(E=o()(u.a.mark((function e(t,n,r){var i,a,o;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=f.models.note.fetchURL(t,n),a=window.location.toString(),e.t0=URL,e.next=5,i;case 5:return e.t1=e.sent,(o=new e.t0(e.t1)).searchParams.set("returnUrl",r||a),e.abrupt("return",o.toString());case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function P(e){return C.apply(this,arguments)}function C(){return(C=o()(u.a.mark((function e(t){var n,r,i;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.collection("io.cozy.permissions").fetchOwnPermissions();case 2:if(n=e.sent,r=p()(n,"data.attributes.permissions")){e.next=6;break}throw"can't get self permissions";case 6:return i=Object.values(r),e.abrupt("return",i.filter((function(e){return f.models.permission.isForType(e,"io.cozy.files")})));case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function S(e,t){return _.apply(this,arguments)}function _(){return(_=o()(u.a.mark((function e(t,n){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",t.query(t.find("io.cozy.files").getById(n)).then((function(e){return e&&e.data})));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function M(e,t){return D.apply(this,arguments)}function D(){return(D=o()(u.a.mark((function e(t,n){var r;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,S(t,n);case 2:return r=e.sent,e.abrupt("return",f.models.permission.isDocumentReadOnly({document:r,client:t,writability:["PATCH"]}));case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function I(e){return N.apply(this,arguments)}function N(){return(N=o()(u.a.mark((function e(t){var n,r,i,a;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,P(t);case 2:if(!((n=e.sent.filter((function(e){return f.models.permission.isForType(e,"io.cozy.files")&&e.values&&e.values.length>0}))).length<1)){e.next=7;break}throw new Error("No individual io.cozy.files permissions in current context");case 7:(n.length>1||n[0].values.length>1)&&console.warn("There are more than one permission for a file in current context. Let's take the first one, but it may not be the one you expect");case 8:return r=n[0],i=r.values[0],a=f.models.permission.isReadOnly(r,{writability:["PATCH"]}),e.abrupt("return",{id:i,readOnly:a});case 12:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function T(e){return"/folder/".concat(e)}function A(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=new URL(e.getStackClient().uri),r=e.getInstanceOptions(),i=r.subdomain,a="drive",o=null!==t?T(t):"",s=Object(f.generateWebLink)({cozyUrl:n.origin,slug:a,pathname:"/",subDomainType:i,hash:o});return s}function L(e,t){return A(e,f.models.file.getParentFolderId(t))}function R(){var e=Object(h.b)(),t=Object(h.a)(e.app.prefix||b.a.name_prefix,""),n=Object(h.a)(e.app.name,b.a.name);return""!=t?"".concat(t," ").concat(n):n}function z(e){return e.getStackClient().fetchJSON("POST","/notes",{data:{type:"io.cozy.notes.documents",attributes:{title:"",schema:y(y({},m.b),{},{version:m.c})}}})}var U=6e4,F=60*U,B=24*F,V=31*B,W=365*B,q=[[1e4,"just_now",1e3,1],[1*U,"secs_ago",1e3,10],[2*U,"min_ago",U,1],[5*U,"mins_ago",U,1],[20*U,"mins_ago",U,5],[1*F,"mins_ago",U,10],[2*F,"hour_ago",F,1],[1*B,"hours_ago",F,1],[2*B,"day_ago",B,1],[1*V,"days_ago",B,1],[2*V,"month_ago",V,1],[1*W,"monthes_ago",V,1],[2*W,"year_ago",W,1],[1/0,"years_ago",W,1]];function H(e,t){var n=(t||q).find((function(t){return e<t[0]})),r=c()(n,4),i=r[1],a=r[2],o=r[3];return{key:i,unit:a,coef:o,time:Math.floor(e/a/o)*o,interval:a*o}}function G(){var e=new URLSearchParams(window.location.search);return e.has("username")?e.get("username"):null}},bcvt:function(e,t,n){e.exports={empty:"empty--FqnXy",appHeader:"appHeader--2ilS0",tableSpecialRow:"tableSpecialRow--4oekp",tableCellEmpty:"tableCellEmpty--21fZ1",tableCellName:"tableCellName--2Jak9",tableCell:"tableCell--3-jDP",tableRow:"tableRow--3SicR",notable:"notable--tK8uq",actionMenuItem:"actionMenuItem--17ajc"}},bfH1:function(e,t,n){"use strict";var r=n("LGLP"),i=n.n(r),a=n("XkwL"),o=n.n(a),s=n("ivGQ"),c=n.n(s),l=n("V3Qr"),u=n("igqv"),d=n("Aaol"),p=n("MHrW"),f=n("9WMr"),h=n("bQqJ"),m=n("UuKj"),v=n("HZZ/"),b=n.n(v),g=n("hJxD"),y=n.n(g),w=n("4vUV"),O=n("uU7o"),k=n("N8wp");var x=function(e,t){switch(null==e?void 0:e.type){case w.e.Drop:return E(e,t);case w.e.Paste:return P(e,t);default:return j(t)}},j=function(e){var t=document.createElement(w.c.Input);t.setAttribute("accept","image/*"),t.type=w.f.File,t.dispatchEvent(new MouseEvent(w.e.Click)),t.addEventListener(w.e.Change,(function(){var n;return e(null===(n=t.files)||void 0===n?void 0:n[0])}))},E=function(e,t){var n,r,i=e.dataTransfer;return(1===(null==(r=null==i?void 0:i.files)?void 0:r.length)||(k.a.error("Error.only_one_image"),!1))&&t(null==i||null===(n=i.files)||void 0===n?void 0:n[0])},P=function(e,t){var n,r=e.clipboardData;return t(null==r||null===(n=r.files)||void 0===n?void 0:n[0])},C=function(e,t,n){var r=new window.FileReader;if(!n)throw Error(w.d.NoFileFoundAfterInput);r.readAsArrayBuffer(n),r.onloadend=b()(y.a.mark((function i(){var a,o,s;return y.a.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:if(a=Object(O.a)(r.result)){i.next=3;break}throw Error(w.d.FileNotProcessable);case 3:return i.prev=3,e.setUploading(!0),i.next=7,e.collabProvider.serviceClient.postImage(n.name,e.collabProvider.config.noteId,a,n.type);case 7:o=i.sent,s=o.data.id,t({src:s}),i.next=15;break;case 12:i.prev=12,i.t0=i.catch(3),k.a.error(e.t(void 0!==i.t0.status?"Error.".concat(i.t0.status):"Error.unknown_error"),{duration:4e3});case 15:return i.prev=15,e.setUploading(!1),i.finish(15);case 18:case"end":return i.stop()}}),i,null,[[3,12,15,18]])})))},S={allowBreakout:!0,allowTextColor:!0,allowTextAlignment:!0,allowIndentation:!0,allowTables:{allowColumnSorting:!0,allowColumnResizing:!0,allowMergeCells:!0,allowNumberColumn:!0,allowBackgroundColor:!0,allowHeaderRow:!0,allowHeaderColumn:!0,permittedLayouts:"all",stickToolbarToBottom:!0},allowPanel:!0,allowStatus:!0,allowRule:!0,allowDate:!0,allowTasksAndDecisions:!0},_=n("upXl"),M=n.n(_);var D=function(){};t.a=function(e){var t=e.defaultValue,n=e.onTitleChange,r=e.onTitleBlur,a=e.defaultTitle,v=e.title,b=e.collabProvider,g=e.onContentChange,y=e.readOnly,w=e.bannerRef,O=e.headerMenu,k=e.isIntent,j=e.children,E=Object(d.useI18n)().t,P=Object(s.useRef)(null),_=Object(s.useCallback)((function(e){n&&n(e)}),[n]);Object(s.useMemo)((function(){return b&&b.setReadOnly(!!y)}),[y,b]);var I=Object(s.useMemo)((function(){return b&&{useNativePlugin:!0,provider:Promise.resolve(b),inviteToEditHandler:function(){},isInviteToEditButtonSelected:!1,userId:b.serviceClient.getSessionId()}}),[b]);Object(s.useEffect)((function(){var e;(e=P.current)&&(e.style.height="".concat(e.scrollHeight,"px"))}),[v]),Object(p.a)(P.current,"blur",r);var N,T=Object(s.useState)(!1),A=o()(T,2),L=A[0],R=A[1];return c.a.createElement("article",{className:"".concat(M.a["note-article"]).concat(k?" "+M.a["note-article--intents"]:"")},L&&c.a.createElement(f.a,null,c.a.createElement(h.b,{size:"xxlarge",middle:!0})),c.a.createElement("style",null,"#coz-bar ","{ display: none }"),O,c.a.createElement("section",{className:"note-editor-container"},c.a.createElement(l.a,i()({},S,{disabled:!b&&y,collabEdit:I,onChange:g||D,defaultValue:t,appearance:"full-page",placeholder:E("Notes.EditorView.main_placeholder"),shouldFocus:!y,legacyImageUploadProvider:(N={collabProvider:b,t:E,setUploading:R},Promise.resolve((function(e,t){return x(e,(function(e){return C(N,t,e)}))}))),contentComponents:c.a.createElement(u.a,{render:function(e){return c.a.createElement(c.a.Fragment,null,c.a.createElement("aside",{ref:w,className:M.a.banner}),c.a.createElement(m.a,{ref:P,className:M.a.title,multiline:!0,minRows:1,value:v,placeholder:a,fullWidth:!0,InputProps:{disableUnderline:!0},inputProps:{className:M.a.titleInput,readOnly:!!y},onChange:y?D:_}),c.a.Children.map(j,(function(t){return c.a.isValidElement(t)?c.a.cloneElement(t,{actions:e}):null})))}})}))))}},bxsC:function(e,t,n){"use strict";var r,i,a,o=n("J58c"),s=n.n(o),c=n("ivGQ"),l=n.n(c),u=n("iu8y"),d=n("zw+H"),p=n("EPWR"),f=n("HZZ/"),h=n.n(f),m=n("GeFe"),v=n.n(m),b=n("Zvb3"),g=n.n(b),y=n("hJxD"),w=n.n(y),O=n("Y/FK"),k=n.n(O),x=n("4z1N"),j=n("ut+C"),E=n("Lu4+"),P=n("uF5U"),C=n("l+VE"),S=n.n(C),_=n("9Jaj"),M=n("3xVv"),D=n("yCbO"),I=n.n(D),N=n("Czyx"),T=n("wjgK"),A=n("2KGD"),L=n("8DMk"),R=n.n(L),z=n("VCdh"),U=n("J/YY"),F=n.n(U),B=n("a1Fv"),V=n.n(B),W=n("g3eI"),q=n.n(W),H=n("wDGE"),G=n.n(H),K=n("K5K7"),Q=n("+k3U"),J=n("y3D9"),X=n("GyuN"),$=n("qheH"),Y=n("k359"),Z=N.default.figure(r||(r=I()(["\n  margin: 0;\n"])));Z.displayName="FigureWrapper";var ee=N.default.div(i||(i=I()(["\n  position: absolute;\n  width: 100%;\n  height: 100%;\n"]))),te=N.default.div(a||(a=I()(["\n  width: 100%;\n  position: relative;\n  padding-bottom: ","%;\n"])),(function(e){return e.dimensions.height/e.dimensions.width*100})),ne=function(e){var t=e.dimensions,n=e.children,r=e.onContextMenu;return l.a.createElement(te,{dimensions:t,onContextMenuCapture:r},l.a.createElement(ee,null,n))},re=n("4vUV"),ie=n("xEu0");function ae(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function oe(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ae(Object(n),!0).forEach((function(t){s()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ae(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function se(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=G()(e);if(t){var i=G()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return q()(this,n)}}var ce,le,ue=function(e){V()(r,e);var t,n=se(r);function r(e){var t;v()(this,r),t=n.call(this,e),s()(F()(t),"mediaPluginState",void 0),s()(F()(t),"state",{imageUrl:"",imageError:"",imageLoading:!0}),s()(F()(t),"realtimeSubscription",void 0),s()(F()(t),"setViewMediaClientConfig",h()(w.a.mark((function e(){var n,r;return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.props.mediaProvider;case 2:(n=e.sent)&&(r=n.viewMediaClientConfig,t.setState({viewMediaClientConfig:r}));case 4:case"end":return e.stop()}}),e)})))),s()(F()(t),"selectMediaSingleFromCard",(function(e){var n=e.event;t.selectMediaSingle(n)})),s()(F()(t),"selectMediaSingle",(function(e){e.stopPropagation();var n=t.props.getPos(),r=t.props.view.state;if(e.shiftKey){if(r.selection instanceof X.a)return;Object($.g)(t.props.view,r.selection.from<n?r.selection.from:n-1,r.selection.to>n?r.selection.to:n+2)}else Object($.f)(t.props.view,n-1)})),s()(F()(t),"fetchCozyImage",h()(w.a.mark((function e(){var n,r,i,a,o,s,c,l,u;return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.setState({imageError:""}),t.state.collabEditProvider){e.next=3;break}throw Error(re.d.MissingCollabEdit);case 3:return n=t.state.collabEditProvider,r=n.serviceClient,i=n.config.noteId,e.prev=4,e.next=7,r.cozyClient.query(Object(ie.Q)(re.a.Files).getById(i));case 7:if(o=e.sent){e.next=10;break}throw Error(re.d.CouldNotGetNoteImages);case 10:if(s=null===(a=o.included)||void 0===a?void 0:a.find((function(e){return e.id===t.props.node.attrs.url}))){e.next=28;break}return e.prev=12,c=t.props.node.attrs.url,l=i,e.next=17,r.cozyClient.getStackClient().fetchJSON("POST","/notes/".concat(c,"/copy?To=").concat(l));case 17:if(u=e.sent){e.next=20;break}throw Error("failed to POST /notes/:id/copy");case 20:return t.mediaPluginState.updateMediaNodeAttrs(t.props.getPos().toString(),oe(oe({},t.props.node.attrs),{},{url:u.data.id}),!0),e.abrupt("return",t.setState({imageUrl:"".concat(r.stackClient.uri).concat(u.data.links.self),imageLoading:!1}));case 24:throw e.prev=24,e.t0=e.catch(12),console.error(re.d.CouldNotCopyImage),e.t0;case 28:!s.attributes.willBeResized&&t.setState({imageUrl:"".concat(r.stackClient.uri).concat(s.links.self),imageLoading:!1}),e.next=35;break;case 31:e.prev=31,e.t1=e.catch(4),t.setState({imageError:e.t1.message,imageLoading:!1}),console.error(e.t1);case 35:case"end":return e.stop()}}),e,null,[[4,31],[12,24]])})))),s()(F()(t),"subscribeToImageUpdate",(function(){var e;return null===(e=t.state.collabEditProvider)||void 0===e?void 0:e.serviceClient.realtime.subscribe(re.g.Updated,re.a.NoteEvents,t.state.collabEditProvider.config.noteId,(function(e){var n=e.image_id;t.props.node.attrs.url.includes(n)&&t.setState({imageLoading:!0},t.fetchCozyImage)}))})),s()(F()(t),"handleNewNode",(function(e){var n=e.node;t.mediaPluginState.handleMediaNodeMount(n,(function(){return t.props.getPos()}))}));var i=t.props.view;return t.mediaPluginState=Y.a.getState(i.state),t}return g()(r,[{key:"shouldComponentUpdate",value:function(e,t){var n=!this.state.viewMediaClientConfig&&t.viewMediaClientConfig;return!(this.state.imageUrl===t.imageUrl&&this.state.imageError===t.imageError&&this.props.selected===e.selected&&this.props.uploadComplete===e.uploadComplete&&this.props.node.attrs.id===e.node.attrs.id&&this.props.node.attrs.collection===e.node.attrs.collection&&this.props.maxDimensions.height===e.maxDimensions.height&&this.props.maxDimensions.width===e.maxDimensions.width&&this.props.contextIdentifierProvider===e.contextIdentifierProvider&&this.props.isLoading===e.isLoading&&this.props.mediaProvider===e.mediaProvider&&!n)}},{key:"componentDidMount",value:(t=h()(w.a.mark((function e(){var t,n,r;return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.handleNewNode(this.props),t=this.props,n=t.contextIdentifierProvider,r=t.collabEditProvider,e.t0=this,e.next=5,n;case 5:return e.t1=e.sent,e.next=8,r;case 8:return e.t2=e.sent,e.t3={contextIdentifierProvider:e.t1,collabEditProvider:e.t2},e.t0.setState.call(e.t0,e.t3),this.realtimeSubscription=this.subscribeToImageUpdate(),e.next=14,this.fetchCozyImage();case 14:return e.next=16,this.setViewMediaClientConfig();case 16:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"componentWillUnmount",value:function(){var e,t=this.props.node;null===(e=this.realtimeSubscription)||void 0===e||e.unsubscribe(),this.mediaPluginState.handleMediaNodeUnmount(t)}},{key:"componentDidUpdate",value:function(e){e.node.attrs.id!==this.props.node.attrs.id&&(this.mediaPluginState.handleMediaNodeUnmount(e.node),this.handleNewNode(this.props)),this.mediaPluginState.updateElement(),this.setViewMediaClientConfig()}},{key:"render",value:function(){var e=this.props,t=e.node,n=e.selected,r=e.uploadComplete,i=e.originalDimensions,a=e.isLoading,o=e.maxDimensions,s=e.mediaOptions,c=this.state,u=c.viewMediaClientConfig,d=c.contextIdentifierProvider,p=t.attrs,f=p.id,h=p.type,m=p.collection,v=p.url,b=p.alt;if(this.state.imageLoading||!this.state.imageUrl||this.state.imageError||a||"external"!==h&&(!u||"boolean"==typeof r&&!r))return l.a.createElement(ne,{dimensions:i},l.a.createElement(Q.a,null));var g=d&&d.objectId,y="external"===h?{dataURI:this.state.imageUrl,name:v,mediaItemType:"external-image"}:{id:f,mediaItemType:"file",collectionName:m},w=u||{authProvider:function(){return{}}};return l.a.createElement(ne,{dimensions:i,onContextMenu:this.selectMediaSingle},l.a.createElement(J.a,{mediaClientConfig:w,resizeMode:"stretchy-fit",dimensions:o,originalDimensions:i,identifier:y,selectable:!0,selected:n,disableOverlay:!0,onClick:this.selectMediaSingleFromCard,useInlinePlayer:s&&s.allowLazyLoading,isLazy:s&&s.allowLazyLoading,featureFlags:s&&s.featureFlags,contextId:g,alt:b}))}}]),r}(c.Component),de=Object(K.a)(ue),pe=N.default.div(ce||(ce=I()(["\n  color: ",";\n  background: ",";\n  border-radius: ","px;\n  margin: 5px 3px 25px;\n  width: ","px;\n  min-height: ","px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n"])),Object(z.J)(A.B400,.4)||A.B400,Object(z.J)(A.B300,.6)||A.B300,Object(T.c)(),156,125),fe=N.default.div(le||(le=I()(["\n  background: ",";\n  border-radius: ","px;\n  margin: 2px 0;\n  width: 100%;\n  height: 2px;\n"])),A.B200,Object(T.c)()),he=function(e){var t=e.type;return"single"===(void 0===t?"group":t)?l.a.createElement(fe,null):l.a.createElement(pe,null,l.a.createElement(R.a,{label:"Document",size:"medium"}))},me=n("iO45"),ve=n("3mYb"),be=n("PuAp"),ge=n("CDNI"),ye=n("3Su3"),we=n("44lN"),Oe=n("AV8T"),ke=n("3sCF"),xe=function(e,t){var n="";return 1===e.length?n=e[0].fileMimeType||"unknown":e.length>1&&(n="multiple"),{action:Oe.a.INSERTED,actionSubject:Oe.b.DOCUMENT,actionSubjectId:Oe.c.MEDIA,attributes:{type:Oe.c.MEDIA_GROUP,inputMethod:t,fileExtension:n},eventType:Oe.d.TRACK}};var je=function(e,t,n,r){var i=e.state,a=e.dispatch,o=i.tr,s=i.schema,c=s.nodes,l=c.media,u=c.paragraph;if(l&&t.length){var d=Ee(t,n,l),p=Ce(i),f=o.doc.resolve(p).parent,h=o.doc.nodeAt(p),m=!function(e){var t=e.schema,n=e.selection.$anchor.node();return n&&n.type===t.nodes.mediaGroup}(i)&&Object(we.e)(i,me.Fragment.from(i.schema.nodes.mediaGroup.createChecked({},d))),v=function(e,t){var n=e.schema.nodes.media,r=t&&t.type===n;return(Object(ve.j)(e)||Object(ve.n)(e)||Object(ve.m)(e)||Object(ye.d)(e)&&(!Object(ge.h)(e)||Object(ge.e)(e)))&&!r}(i,h),b=f.type===s.nodes.mediaGroup?d:[s.nodes.mediaGroup.createChecked({},d)];if(m){b=v?b.concat(u.create()):b;var g=Se(i);return g?p<=g.start?o.deleteRange(g.start,g.end).insert(p,b):o.insert(p,b).deleteRange(g.start,g.end):o.insert(p,b),Object(ke.a)(i,o,xe(t,r)),a(o),void Me(e)}v&&f.type!==s.nodes.mediaGroup&&b.push(u.create()),Object(ke.a)(i,o,xe(t,r)),a(Object(_.safeInsert)(me.Fragment.fromArray(b),p)(o))}},Ee=function(e,t,n){return e.map((function(e){var r=e.id,i=n.create({id:r,type:"file",collection:t});return Object(ge.a)(e,i),i}))},Pe=function(e){var t=e.schema.nodes,n=t.mediaGroup,r=t.listItem;if(Object(_.hasParentNode)((function(e){return e.type===r}))(e.selection)){var i=function(e){var t=e.schema.nodes,n=t.bulletList,r=t.orderedList;return Object(be.b)((function(e){return e.type===n||e.type===r}))(e.selection.$from)}(e);if(i){var a=i.pos+i.node.nodeSize,o=e.doc.nodeAt(a);return o&&o.type===n?a+1:a}}},Ce=function(e){var t=e.selection,n=t.$from,r=t.$to,i=Pe(e);if(i)return i;var a=Object(ge.f)(e);return a&&(!Object(ge.e)(e)||n.pos<a&&r.pos<a)?a:Object(ge.e)(e)?r.pos:Object(ye.c)(e)?r.pos+1:Object(ye.a)(e)?n.pos-1:r.pos},Se=function(e){var t=e.selection,n=t.$from,r=t.$to;if(!Object(ge.g)(e))return!Object(ge.c)(e)||Object(ge.f)(e)?_e(n.pos,r.pos):_e(Object(ye.f)(n)-1,Object(ye.e)(r))},_e=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e;return{start:e,end:t}},Me=function(e){var t=e.state,n=t.doc,r=Object(ge.f)(t);if(r){var i=n.resolve(r),a=Object(ye.e)(i);a+1>=n.nodeSize-1?Object($.f)(e,r):Object($.g)(e,a+1)}},De=n("CW9m");function Ie(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}var Ne=function(e,t){return e.mediaNodes.reduce((function(e,n){return e||(n.node.attrs.id===t?n:e)}),null)},Te=function(e,t,n){return n?Ne(e,t):e.mediaGroupNodes[t]},Ae=function(e,t){return e.mediaOptions&&e.mediaOptions.allowMarkingUploadsAsIncomplete&&"boolean"==typeof e.mobileUploadComplete[t]?e.mobileUploadComplete[t]:void 0},Le=function(e,t,n){return function(r,i){var a,o=Y.a.getState(r);if(n)a=function(e,t){return e.mediaNodes.filter((function(e){return e.node.attrs.id===t}))}(o,e);else{var s=Te(o,e,n);a=s?[s]:[]}var c=r.schema.nodes.media;if(0===(a=a.filter((function(e){var t;try{t=r.doc.nodeAt(e.getPos())}catch(n){return!1}return t&&t.type===c}))).length)return!1;if(i){var l=r.tr;a.forEach((function(e){var n=e.getPos;return l.step(new De.a(n(),t))})),l.setMeta("addToHistory",!1),i(l)}return!0}},Re=function(e,t,n){return function(r,i){var a=Y.a.getState(r),o=Te(a,e,n);if(!o){var s=a.mediaNodes.find((function(t){return t.getPos().toString()===e}));return!!s&&(null==i||i(r.tr.step(new De.a(s.getPos(),t)).setMeta("addToHistory",!1)),!0)}return i&&i(r.tr.step(new De.a(o.getPos(),t)).setMeta("addToHistory",!1)),!0}},ze=function(e,t){return function(n,r){return!!r&&(r(n.tr.step(new De.a(e,function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ie(Object(n),!0).forEach((function(t){s()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ie(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({type:"file",url:null},t))).setMeta("addToHistory",!1)),!0)}},Ue=n("2AuG"),Fe=function(){function e(t,n,r){var i=this,a=(arguments.length>3&&void 0!==arguments[3]||Ue.d,arguments.length>4?arguments[4]:void 0);v()(this,e),s()(this,"picker",void 0),s()(this,"onDragListeners",[]),s()(this,"errorReporter",void 0),s()(this,"pickerType",void 0),s()(this,"onStartListeners",[]),s()(this,"eventListeners",{}),s()(this,"analyticsName",void 0),s()(this,"erroredFiles",void 0),s()(this,"handleUploadPreviewUpdate",(function(e){var t=e.file,n=e.preview,r=i.erroredFiles.has(t.id),a=Object(Ue.e)(n)?n:{dimensions:void 0,scaleFactor:void 0},o=a.dimensions,s=a.scaleFactor,c={id:t.id,fileName:t.name,fileSize:t.size,fileMimeType:t.type,dimensions:o,scaleFactor:s,status:r?"error":void 0};i.eventListeners[t.id]=[],i.onStartListeners.forEach((function(e){return e(c,(function(e){return i.subscribeStateChanged(t,e)}),i.analyticsName||i.pickerType)}))})),s()(this,"subscribeStateChanged",(function(e,t){var n=i.eventListeners[e.id];n&&n.push(t)})),s()(this,"handleUploadError",(function(e){var t=e.error,n=e.fileId,r=i.eventListeners[n];i.erroredFiles.add(n),r&&(r.forEach((function(e){return e({id:n,status:"error",error:t&&{description:t.description,name:t.name}})})),delete i.eventListeners[n])})),s()(this,"handleMobileUploadEnd",(function(e){var t=e.file,n=i.eventListeners[t.id];n&&n.forEach((function(e){return e({id:t.id,status:"mobile-upload-end",fileMimeType:t.type,collection:t.collectionName,publicId:t.publicId})}))})),s()(this,"handleReady",(function(e){var t=e.file,n=i.eventListeners[t.id];n&&(n.forEach((function(e){return e({id:t.id,status:"ready"})})),delete i.eventListeners[t.id])})),this.pickerType=t,this.errorReporter=n.errorReporter,this.analyticsName=a,this.erroredFiles=new Set}var t;return g()(e,[{key:"init",value:(t=h()(w.a.mark((function e(){var t;return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("customMediaPicker"!==this.pickerType){e.next=4;break}t=this.picker=this.pickerConfig,e.next=8;break;case 4:if("popup"!==this.pickerType){e.next=8;break}return e.next=7,this.mediaPickerFactoryClass(this.config.mediaClientConfig,this.pickerConfig);case 7:t=this.picker=e.sent;case 8:if(t){e.next=10;break}return e.abrupt("return",this);case 10:return t.on("upload-preview-update",this.handleUploadPreviewUpdate),t.on("upload-end",this.handleReady),t.on("upload-error",this.handleUploadError),t.on("mobile-upload-end",this.handleMobileUploadEnd),e.abrupt("return",this);case 15:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"type",get:function(){return this.pickerType}},{key:"mediaPicker",get:function(){return this.picker}},{key:"destroy",value:function(){var e=this.picker;if(e){e.removeAllListeners("upload-preview-update"),e.removeAllListeners("upload-end"),e.removeAllListeners("upload-error"),this.onStartListeners=[],this.onDragListeners=[];try{"popup"===this.pickerType&&e.teardown()}catch(t){this.errorReporter.captureException(t)}}}},{key:"setUploadParams",value:function(e){this.picker&&this.picker.setUploadParams(e)}},{key:"onClose",value:function(e){var t=this.picker;if("popup"===this.pickerType){var n=t;return n.on("closed",e),function(){return n.off("closed",e)}}return function(){}}},{key:"show",value:function(){if("popup"===this.pickerType)try{this.picker.show()}catch(e){this.errorReporter.captureException(e)}}},{key:"hide",value:function(){"popup"===this.pickerType&&this.picker.hide()}},{key:"onNewMedia",value:function(e){this.onStartListeners.push(e)}},{key:"onDrag",value:function(e){this.onDragListeners.push(e)}}]),e}(),Be=n("ct2w");function Ve(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function We(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ve(Object(n),!0).forEach((function(t){s()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ve(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var qe=["ready","error","cancelled"],He=function(){function e(t,n,r,i,a){var o=this;v()(this,e),s()(this,"allowsUploads",!1),s()(this,"mediaClientConfig",void 0),s()(this,"uploadMediaClientConfig",void 0),s()(this,"ignoreLinks",!1),s()(this,"waitForMediaUpload",!0),s()(this,"allUploadsFinished",!0),s()(this,"showDropzone",!1),s()(this,"element",void 0),s()(this,"layout","center"),s()(this,"mediaNodes",[]),s()(this,"mediaGroupNodes",{}),s()(this,"mobileUploadComplete",{}),s()(this,"options",void 0),s()(this,"mediaProvider",void 0),s()(this,"pendingTask",Promise.resolve(null)),s()(this,"view",void 0),s()(this,"destroyed",!1),s()(this,"contextIdentifierProvider",void 0),s()(this,"errorReporter",void 0),s()(this,"popupPicker",void 0),s()(this,"customPicker",void 0),s()(this,"removeOnCloseListener",(function(){})),s()(this,"openMediaPickerBrowser",void 0),s()(this,"onPopupToogleCallback",(function(){})),s()(this,"reactContext",void 0),s()(this,"pickers",[]),s()(this,"pickerPromises",[]),s()(this,"editingMediaSinglePos",void 0),s()(this,"showEditingDialog",void 0),s()(this,"mediaOptions",void 0),s()(this,"dispatch",void 0),s()(this,"onContextIdentifierProvider",function(){var e=h()(w.a.mark((function e(t,n){return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!n){e.next=4;break}return e.next=3,n;case 3:o.contextIdentifierProvider=e.sent;case 4:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()),s()(this,"setMediaProvider",function(){var e=h()(w.a.mark((function e(t){var n,r,i,a;return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=5;break}return o.destroyPickers(),o.allowsUploads=!1,o.destroyed||o.view.dispatch(o.view.state.tr.setMeta(Y.a,{allowsUploads:o.allowsUploads})),e.abrupt("return");case 5:return e.prev=5,e.next=8,t;case 8:o.mediaProvider=e.sent,o.mediaProvider.viewMediaClientConfig||(n=o.mediaProvider.viewMediaClientConfig)&&(o.mediaProvider.viewMediaClientConfig=n),S()(o.mediaProvider.viewMediaClientConfig,"MediaProvider promise did not resolve to a valid instance of MediaProvider - ".concat(o.mediaProvider)),e.next=21;break;case 13:return e.prev=13,e.t0=e.catch(5),r=new Error("Media functionality disabled due to rejected provider: ".concat(e.t0.message)),o.errorReporter.captureException(r),o.destroyPickers(),o.allowsUploads=!1,o.destroyed||o.view.dispatch(o.view.state.tr.setMeta(Y.a,{allowsUploads:o.allowsUploads})),e.abrupt("return");case 21:if(o.mediaClientConfig=o.mediaProvider.viewMediaClientConfig,o.allowsUploads=!!o.mediaProvider.uploadMediaClientConfig,i=o.view,a=o.allowsUploads,!o.destroyed&&i.dom.parentNode&&i.dispatch(i.state.tr.setMeta(Y.a,{allowsUploads:a})),!o.allowsUploads){e.next=35;break}if(o.uploadMediaClientConfig=o.mediaProvider.uploadMediaClientConfig,!o.mediaProvider.uploadParams||!o.uploadMediaClientConfig){e.next=32;break}return e.next=30,o.initPickers(o.mediaProvider.uploadParams,Fe,o.reactContext);case 30:e.next=33;break;case 32:o.destroyPickers();case 33:e.next=36;break;case 35:o.destroyPickers();case 36:case"end":return e.stop()}}),e,null,[[5,13]])})));return function(t){return e.apply(this,arguments)}}()),s()(this,"getMediaOptions",(function(){return o.options})),s()(this,"hasUserAuthProvider",(function(){return!!o.uploadMediaClientConfig&&!!o.uploadMediaClientConfig.userAuthProvider})),s()(this,"insertFile",(function(e,t,n){var r=We(We({},e),{},{contextId:o.contextIdentifierProvider?o.contextIdentifierProvider.objectId:void 0}),i=o.collectionFromProvider();if(void 0!==i){o.mediaOptions&&o.mediaOptions.allowMarkingUploadsAsIncomplete&&(o.mobileUploadComplete[r.id]=!1),"error"!==e.status&&o.updateAndDispatch({allUploadsFinished:!1}),Object(M.d)(o.view.state.schema,r.fileMimeType)?Object(M.c)(o.view,r,o.getInputMethod(n),i,o.mediaOptions&&o.mediaOptions.alignLeftOnInsert):je(o.view,[r],i,o.getInputMethod(n)),t(o.handleMediaState);var a=function(e){return e.status&&-1!==qe.indexOf(e.status)};a(r)||(o.addPendingTask(new Promise((function(e){t((function(t){a(t)&&e(t)}))}))),o.pendingTask.then((function(){o.updateAndDispatch({allUploadsFinished:!0})})));var s=o.view;s.hasFocus()||s.focus()}})),s()(this,"addPendingTask",(function(e){var t=o.pendingTask,n=function(){return t};o.pendingTask=e.then(n,n)})),s()(this,"splitMediaGroup",(function(){return Object(ge.j)(o.view)})),s()(this,"onPopupPickerClose",(function(){o.onPopupToogleCallback(!1)})),s()(this,"shouldUseMediaPickerPopup",(function(){return!o.mediaOptions||o.mediaOptions&&void 0===o.mediaOptions.useMediaPickerPopup?o.hasUserAuthProvider():!!o.mediaOptions.useMediaPickerPopup})),s()(this,"showMediaPicker",(function(){if(o.openMediaPickerBrowser&&!o.shouldUseMediaPickerPopup())return o.openMediaPickerBrowser();o.popupPicker&&(o.popupPicker.show(),o.onPopupToogleCallback(!0))})),s()(this,"setBrowseFn",(function(e){o.openMediaPickerBrowser=e})),s()(this,"onPopupToggle",(function(e){o.onPopupToogleCallback=e})),s()(this,"waitForPendingTasks",(function(e,t){if(t&&o.pendingTask===t)return t;var n,r=o.pendingTask.then((function(){return o.waitForPendingTasks(void 0,o.pendingTask)}));if(!e)return r;var i=new Promise((function(t,r){n=window.setTimeout((function(){return r(new Error("Media operations did not finish in ".concat(e," ms")))}),e)}));return Promise.race([i,r.then((function(e){return clearTimeout(n),e}))])})),s()(this,"handleMediaNodeRemoval",(function(e,t){var n=e;n||(n=o.view.state.doc.nodeAt(t())),Object(ge.i)(o.view,n,t)})),s()(this,"handleMediaNodeMount",(function(e,t){o.mediaNodes.unshift({node:e,getPos:t})})),s()(this,"handleMediaNodeUnmount",(function(e){o.mediaNodes=o.mediaNodes.filter((function(t){var n=t.node;return e!==n}))})),s()(this,"findMediaNode",(function(e){return Ne(o,e)})),s()(this,"destroyAllPickers",(function(e){e.forEach((function(e){return e.destroy()})),o.pickers.splice(0,o.pickers.length)})),s()(this,"destroyPickers",(function(){var e=o.pickers,t=o.pickerPromises;t.length===e.length?o.destroyAllPickers(o.pickers):Promise.all(t).then((function(e){return o.destroyAllPickers(e)})),o.popupPicker=void 0,o.customPicker=void 0})),s()(this,"getInputMethod",(function(e){switch(e){case"popup":return Oe.e.PICKER_CLOUD;case"clipboard":return Oe.e.CLIPBOARD;case"dropzone":return Oe.e.DRAG_AND_DROP}})),s()(this,"updateMediaNodeAttrs",(function(e,t,n){var r=o.view;if(r)return Re(e,t,n)(r.state,r.dispatch)})),s()(this,"handleMediaState",(function(e){switch(e.status){case"error":var t=o.options.uploadErrorHandler;t&&t(e);break;case"mobile-upload-end":var n={id:e.publicId||e.id};"string"==typeof e.collection&&(n.collection=e.collection),o.updateMediaNodeAttrs(e.id,n,Object(M.d)(o.view.state.schema,e.fileMimeType)),o.mobileUploadComplete[n.id]=!0,delete o.mediaGroupNodes[e.id]}})),s()(this,"isMobileUploadCompleted",(function(e){return Ae(o,e)})),s()(this,"removeNodeById",(function(e){var t=e.id,n=Te(o,t,Object(Be.a)(e.fileMimeType));n&&Object(ge.i)(o.view,n.node,n.getPos)})),s()(this,"removeSelectedMediaContainer",(function(){var e=o.view,t=o.selectedMediaContainerNode();if(!t)return!1;var n=e.state.selection.from;return Object(ge.i)(e,t.firstChild,(function(){return n+1})),!0})),s()(this,"selectedMediaContainerNode",(function(){var e=o.view.state,t=e.selection,n=e.schema;if(t instanceof x.NodeSelection&&(t.node.type===n.nodes.mediaSingle||t.node.type===n.nodes.mediaGroup))return t.node})),s()(this,"handleDrag",(function(e){var t="enter"===e;if(o.showDropzone!==t){o.showDropzone=t;var n=o.view;(0,n.dispatch)(n.state.tr)}})),this.reactContext=r,this.options=n,this.mediaOptions=i,this.dispatch=a,this.waitForMediaUpload=void 0===n.waitForMediaUpload||n.waitForMediaUpload;var c=t.schema.nodes;S()(c.media&&(c.mediaGroup||c.mediaSingle),"Editor: unable to init media plugin - media or mediaGroup/mediaSingle node absent in schema"),n.providerFactory.subscribe("mediaProvider",(function(e,t){return o.setMediaProvider(t)})),n.providerFactory.subscribe("contextIdentifierProvider",this.onContextIdentifierProvider),this.errorReporter=n.errorReporter||new P.a}var t;return g()(e,[{key:"updateElement",value:function(){var e,t=this.selectedMediaContainerNode(),n=this.view.state.schema.nodes.mediaSingle;t&&t.type===n&&(e=this.getDomElement(this.view.domAtPos.bind(this.view))),this.element!==e&&(this.element=e)}},{key:"getDomElement",value:function(e){var t=this.view.state,n=t.selection,r=t.schema;if(n instanceof x.NodeSelection&&n.node.type===r.nodes.mediaSingle){var i=Object(_.findDomRefAtPos)(n.from,e);if(i)return i.childNodes.length?i.querySelector(".wrapper")||i:i.parentNode}}},{key:"setView",value:function(e){this.view=e}},{key:"destroy",value:function(){if(!this.destroyed){this.destroyed=!0;var e=this.mediaNodes;e.splice(0,e.length),this.removeOnCloseListener(),this.destroyPickers()}}},{key:"initPickers",value:(t=h()(w.a.mark((function e(t,n,r){var i,a,o,s,c,l,u,d=this;return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.destroyed&&this.uploadMediaClientConfig){e.next=2;break}return e.abrupt("return");case 2:if(i=this.errorReporter,a=this.pickers,o=this.pickerPromises,a.length){e.next=26;break}if(s={mediaClientConfig:this.uploadMediaClientConfig,errorReporter:i},c={uploadParams:t,proxyReactContext:r(),useForgePlugins:this.mediaOptions&&this.mediaOptions.useForgePlugins||!1,featureFlags:this.mediaOptions&&this.mediaOptions.featureFlags},!this.options.customMediaPicker){e.next=16;break}return l=new n("customMediaPicker",s,this.options.customMediaPicker).init(),o.push(l),e.t0=a,e.next=12,l;case 12:e.t1=this.customPicker=e.sent,e.t0.push.call(e.t0,e.t1),e.next=25;break;case 16:if(!this.shouldUseMediaPickerPopup()){e.next=25;break}return u=new n("popup",s,c).init(),o.push(u),e.t2=a,e.next=22,u;case 22:e.t3=this.popupPicker=e.sent,e.t2.push.call(e.t2,e.t3),this.removeOnCloseListener=this.popupPicker.onClose(this.onPopupPickerClose);case 25:a.forEach((function(e){e.onNewMedia(d.insertFile)}));case 26:a.forEach((function(e){return e.setUploadParams(t)}));case 27:case"end":return e.stop()}}),e,this)}))),function(e,n,r){return t.apply(this,arguments)})},{key:"collectionFromProvider",value:function(){return this.mediaProvider&&this.mediaProvider.uploadParams&&this.mediaProvider.uploadParams.collection}},{key:"updateAndDispatch",value:function(e){var t=this;Object.keys(e).forEach((function(n){var r=n,i=e[r];void 0!==i&&(t[r]=i)})),this.dispatch&&this.dispatch(Y.a,We({},this))}}]),e}(),Ge=function(e){return Y.a.getState(e)},Ke=function(e,t,n,r,i){var a=function(e){var t=document.createElement("div");return e?k.a.render(l.a.createElement(he,{type:"single"}),t):k.a.render(l.a.createElement(he),t),t}(i&&i.allowDropzoneDropLine);return new x.Plugin({state:{init:function(e,a){return new He(a,t,n,i,r)},apply:function(e,t){"number"==typeof t.editingMediaSinglePos&&(t.editingMediaSinglePos=e.mapping.map(t.editingMediaSinglePos));var n=e.getMeta(Y.a);if(n){var r=n.allowsUploads;t.updateAndDispatch({allowsUploads:void 0===r?t.allowsUploads:r})}return t}},filterTransaction:function(e,t){return!(e.selectionSet&&Object(_.isNodeSelection)(e.selection)&&e.selection.node.type===t.schema.nodes.media&&e.selection.$anchor.parent.type===t.schema.nodes.mediaSingle)},key:Y.a,view:function(e){var t=Ge(e.state);return t.setView(e),t.updateElement(),{update:function(){t.updateElement()}}},props:{decorations:function(e){if(Ge(e).showDropzone){var t=e.schema,n=e.selection.$anchor;if(e.selection instanceof x.NodeSelection){if(e.selection.node.type===t.nodes.mediaSingle){var r=E.a.node(e.selection.from,e.selection.to,{class:"richMedia-selected"});return E.b.create(e.doc,[r])}}else{var i=n.pos;if(n.parent.type!==t.nodes.paragraph&&n.parent.type!==t.nodes.codeBlock&&(i=Object(j.h)(e.doc,i,t.nodes.mediaGroup)),null!=i){var o=[E.a.widget(i,a,{key:"drop-placeholder"})];return E.b.create(e.doc,o)}}}},nodeViews:t.nodeViews,handleTextInput:function(e){return Ge(e.state).splitMediaGroup(),!1}}})},Qe=n("7rzR");function Je(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Xe(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Je(Object(n),!0).forEach((function(t){s()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Je(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var $e=new x.PluginKey("mediaEditorPlugin"),Ye=Object(Qe.a)($e,(function(e,t){switch(t.type){case"open":return Xe(Xe({},e),{},{editor:{identifier:t.identifier,pos:t.pos}});case"close":case"upload":return Xe(Xe({},e),{},{editor:void 0});case"setMediaClientConfig":return Xe(Xe({},e),{},{mediaClientConfig:t.mediaClientConfig});default:return e}}),{mapping:function(e,t){return t.editor?Xe(Xe({},t),{},{editor:Xe(Xe({},t.editor),{},{pos:e.mapping.map(t.editor.pos)})}):t}}),Ze=Ye.createPluginState,et=Ye.createCommand,tt=Ye.getPluginState;function nt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function rt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?nt(Object(n),!0).forEach((function(t){s()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):nt(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var it=function(){return et({type:"close"})},at=function(e,t){return et({type:"upload",newIdentifier:e},(function(n,r){var i=tt(r).editor;if(!i)return n;var a=n.mapping.map(i.pos),o=n.doc.nodeAt(a),s=r.schema.nodes.media;if(!o||o.type!==s)return n;var c=rt(rt({},o.attrs),{},{id:e.id,collection:e.collectionName||o.attrs.collection,occurrenceKey:e.occurrenceKey,width:t.width,height:t.height});return n.setNodeMarkup(a,void 0,c)}))},ot=function(e){return function(t){var n=function(){var e=h()(w.a.mark((function e(n,r){var i,a,o,s;return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("mediaProvider"===n){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,r;case 4:if(i=e.sent){e.next=7;break}return e.abrupt("return");case 7:return e.next=9,i.uploadMediaClientConfig;case 9:if(e.t0=e.sent,e.t0){e.next=14;break}return e.next=13,i.viewMediaClientConfig;case 13:e.t0=e.sent;case 14:a=e.t0,o=t.dispatch,s=t.state,et({type:"setMediaClientConfig",mediaClientConfig:a})(s,o,t);case 17:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}();return e.subscribe("mediaProvider",n),{destroy:function(){e.unsubscribe("mediaProvider",n)}}}},st=function(e){var t=e.dispatch,n=e.providerFactory;return new x.Plugin({state:Ze(t,{}),key:$e,view:ot(n)})};function ct(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function lt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ct(Object(n),!0).forEach((function(t){s()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ct(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var ut=n("6drl"),dt=new x.PluginKey("mediaAltTextPlugin"),pt=Object(Qe.a)(dt,(function(e,t){switch(t.type){case"updateAltText":return lt({},e);case"openMediaAltTextMenu":return lt(lt({},e),{},{isAltTextEditorOpen:!0});case"closeMediaAltTextMenu":return lt(lt({},e),{},{isAltTextEditorOpen:!1});default:return e}}),{onSelectionChanged:function(e,t){return e.getMeta(ut.a)?t:{isAltTextEditorOpen:!1}}}),ft=pt.createPluginState,ht=pt.createCommand,mt=pt.getPluginState,vt=function(e){var t=e.dispatch;e.providerFactory;return new x.Plugin({state:ft(t,{isAltTextEditorOpen:!1}),key:dt,view:function(){return{update:function(e,t){var n=mt(e.state),r=mt(t);n&&r&&r.isAltTextEditorOpen&&!n.isAltTextEditorOpen&&!e.hasFocus()&&e.focus()}}}})},bt=n("pFaK"),gt=n("O+po");function yt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function wt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?yt(Object(n),!0).forEach((function(t){s()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):yt(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Ot,kt,xt,jt=ht((function(e){return!!Object(ge.d)(e)&&{type:"closeMediaAltTextMenu"}})),Et=(Ot=Oe.a.OPENED,kt=function(e){return!!Object(ge.d)(e)&&{type:"openMediaAltTextMenu"}},xt=function(e){return e.setMeta("scrollIntoView",!1)},Object(ke.d)({action:Ot,actionSubject:Oe.b.MEDIA,actionSubjectId:Oe.c.ALT_TEXT,eventType:Oe.d.TRACK})(ht(kt,xt)));var Pt=n("XZ5u");function Ct(e,t){var n=e.$from,r=n.index(n.depth-1),i=n.node(n.depth-1);return i?i.maybeChild(r+t):null}function St(e){return function(t,n){var r=t.selection.$from,i=t.schema.nodes.paragraph,a=Ct(t.selection,-2);if(!a)return!1;var o=Ct(t.selection,-1),s=r.pos-o.nodeSize-a.nodeSize,c=t.tr;if(function(t){var n=!1;try{n=e(t)}catch(r){}return n}(a))c=c.replace(s-1,s+a.nodeSize);else if(Object(ve.q)(t.selection)?c.replace(r.pos,r.pos+r.parent.nodeSize-1):c.replace(r.pos-1,r.pos+r.parent.nodeSize-1),a.type===i){var l=s+a.nodeSize-2;Object(_.safeInsert)(r.parent.content,l)(c)}else{var u=s+a.nodeSize-1;Object(_.safeInsert)(r.parent.copy(r.parent.content),u)(c)}return n&&n(c),!0}}var _t,Mt=function(e){var t=Object(ve.l)(e);return function(e,n){var r=e.selection,i=e.schema,a=r.$from;if(!function(e){return!!e.empty&&e.$from.parentOffset<=0}(e.selection))return!1;if(!function(e,t){return e.$from.parent.type===t}(e.selection,i.nodes.paragraph))return!1;return!!function(e,t,n){var r=Ct(e,n);return!!r&&r.type===t}(e.selection,i.nodes.mediaSingle,-1)&&("wrap-right"===Ct(e.selection,-1).attrs.layout?St(t)(e,n):(n&&Object(Pt.f)(e,(function(r){t(a.parent)&&!Object(ye.d)(e)&&r.replace(a.pos-1,a.pos+a.parent.nodeSize-1),n(r)})),!0))}};function Dt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function It(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Dt(Object(n),!0).forEach((function(t){s()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Dt(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}!function(e){e.showToolbar="MEDIA_SHOW_TOOLBAR",e.hideToolbar="MEDIA_HIDE_TOOLBAR",e.setUrl="MEDIA_SET_LINK_TO",e.unlink="MEDIA_LINKING_UNLINK"}(_t||(_t={}));function Nt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Tt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Nt(Object(n),!0).forEach((function(t){s()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Nt(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var At=new x.PluginKey("mediaLinking"),Lt={visible:!1,editable:!1,mediaPos:null,link:""};var Rt=Object(Qe.a)(At,(function(e,t){switch(t.type){case _t.showToolbar:return It(It({},e),{},{visible:!0});case _t.setUrl:return It(It({},e),{},{editable:!0,link:t.payload});case _t.hideToolbar:return It(It({},e),{},{visible:!1});case _t.unlink:return It(It({},e),{},{link:"",visible:!1,editable:!1})}return e}),{mapping:function(e,t){return t&&null!==t.mediaPos?Tt(Tt({},t),{},{mediaPos:e.mapping.map(t.mediaPos)}):t},onSelectionChanged:function(e){if(!(e.selection instanceof x.NodeSelection))return Lt;var t=e.selection.$from.pos+1,n=e.doc.nodeAt(t);if(!n||"media"!==n.type.name)return Lt;var r=n.marks.find((function(e){return"link"===e.type.name}));return Tt(Tt({},Lt),{},r?{mediaPos:t,editable:!0,link:r.attrs.href}:{mediaPos:t})}}),zt=Rt.createCommand,Ut=Rt.getPluginState,Ft=n("7i3F"),Bt=n("eXjd"),Vt=function(e){var t=e.doc,n=e.selection,r=e.schema;if(t&&n&&n instanceof x.NodeSelection&&n.node.type===r.nodes.mediaSingle){var i=t.nodeAt(n.$anchor.pos+1);if(i&&i.type===r.nodes.media)return i}},Wt=n("5aEg"),qt=function(){var e=h()(w.a.mark((function e(t,n){var r;return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("external"!==t.attrs.type){e.next=2;break}return e.abrupt("return","external");case 2:if(t.attrs.id){e.next=4;break}return e.abrupt("return");case 4:return e.prev=4,e.next=7,Object(Wt.a)(n).file.getCurrentState(t.attrs.id,{collectionName:t.attrs.collection});case 7:if(!(r=e.sent)||"error"===r.status){e.next=10;break}return e.abrupt("return",r.mediaType);case 10:e.next=14;break;case 12:e.prev=12,e.t0=e.catch(4);case 14:case"end":return e.stop()}}),e,null,[[4,12]])})));return function(t,n){return e.apply(this,arguments)}}();function Ht(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Gt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ht(Object(n),!0).forEach((function(t){s()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ht(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Kt=zt((function(e){var t=Ut(e);if(t&&null!==t.mediaPos&&e.doc.nodeAt(t.mediaPos))return{type:_t.showToolbar};return!1})),Qt=function(e,t,n){if(t&&n){var r=Vt(e);if(!r)return!1;var i=Ge(e).mediaClientConfig;if(!i)return!1;qt(r,i).then((function(e){"external"!==e&&"image"!==e||Vt(n.state)!==r||t(n.state.tr.setMeta(At,{type:_t.showToolbar}))}))}return!0},Jt=zt({type:_t.hideToolbar}),Xt=function(e,t,n){Jt(e,t,n),n&&n.focus()};function $t(e,t,n){var r=n.forceRemove,i=void 0!==r&&r,a=n.url,o=Ut(t);if(!o||null===o.mediaPos)return e;var s=t.doc.resolve(o.mediaPos),c=t.doc.nodeAt(s.pos);if(!c)return e;var l=t.schema.marks.link,u=t.schema.nodes.media;return Object(Bt.f)(l,(function(e,t){if(t&&t.type===u){if(i)return!1;var n=Object(Ft.g)(a);if(!e||e.href!==n)return""!==n.trim()&&Gt(Gt({},e),{},{href:n})}}),[u])(s.pos,s.pos+c.nodeSize,e,t),e}var Yt=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:void 0;return Object(ke.a)(t,e,{action:n,eventType:Oe.d.TRACK,actionSubject:Oe.b.MEDIA,actionSubjectId:Oe.c.LINK,attributes:r})},Zt=zt({type:_t.unlink},(function(e,t){var n=$t(e,t,{forceRemove:!0});return Yt(n,t,Oe.a.DELETED)})),en=function(e,t){var n=function(e){var t=e.schema.marks.link,n=Ut(e);if(n&&null!==n.mediaPos){var r=e.doc.resolve(n.mediaPos),i=e.doc.nodeAt(r.pos);if(i)if(t.isInSet(i.marks))return i.marks.find((function(e){return e.type===t})).attrs.href}}(t);return n?e!==n?Oe.a.EDITED:void 0:Oe.a.ADDED},tn=function(e,t){return zt({type:_t.setUrl,payload:Object(Ft.g)(e)},(function(n,r){var i=en(e,r);if(!i)return n;try{var a=$t(n,r,{url:e});return Yt(n,r,i,i===Oe.a.ADDED?{inputMethod:t}:void 0),a}catch(o){throw Yt(n,r,Oe.a.ERRORED,{action:i}),o}}))};var nn=function(e){return Y.a.getState(e).ignoreLinks=!0,!1},rn=function(e){return Y.a.getState(e).splitMediaGroup()},an=function(){var e={};return gt.bindKeymapWithCommand(gt.undo.common,nn,e),gt.bindKeymapWithCommand(gt.enter.common,rn,e),gt.bindKeymapWithCommand(gt.insertNewLine.common,rn,e),Object(bt.b)(e)},on=n("5+wD"),sn=n.n(on),cn=n("X/1r"),ln=n("HGna"),un=function(e){var t=e.editorView,n=e.eventDispatcher,r=e.pluginKey,i=e.isDisabled,a=e.isReducedSpacing;return l.a.createElement(ln.a,{editorView:t,eventDispatcher:n,plugins:{mediaPlugin:r},render:function(e){var t,n=e.mediaPlugin;return n.allowsUploads?l.a.createElement(cn.a,{onClick:(t=n,function(){return t.showMediaPicker(),!0}),disabled:i,title:"Files & images",spacing:a?"none":"default",iconBefore:l.a.createElement(sn.a,{label:"Files & images"})}):null}})},dn=n("XLm4"),pn=n("06eS"),fn=n.n(pn),hn=n("GW/8"),mn=n("Km6/"),vn=n("WJQr"),bn=n("rgs1"),gn=n("x7QK"),yn=n.n(gn),wn=n("laKe"),On=n("KgC3"),kn=function(){function e(t){var n=this;v()(this,e),s()(this,"props",void 0),s()(this,"updateContextId",h()(w.a.mark((function e(){var t,r,i;return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((t=n.getAttrs())&&"file"===t.type){e.next=3;break}return e.abrupt("return");case 3:return r=t.id,e.next=6,n.getObjectId();case 6:i=e.sent,Le(r,{__contextId:i},n.props.isMediaSingle)(n.props.view.state,n.props.view.dispatch);case 8:case"end":return e.stop()}}),e)})))),s()(this,"hasFileAttributesDefined",(function(){var e=n.getAttrs();return e&&"file"===e.type&&e.__fileName&&e.__fileMimeType&&e.__fileSize&&e.__contextId})),s()(this,"updateFileAttrs",h()(w.a.mark((function e(){var t,r,i,a,o,s,c,l,u,d,p,f,h,m=arguments;return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=!(m.length>0&&void 0!==m[0])||m[0],r=n.getAttrs(),e.next=4,n.props.mediaProvider;case 4:if((i=e.sent)&&i.uploadParams&&r&&"file"===r.type&&!n.hasFileAttributesDefined()){e.next=7;break}return e.abrupt("return");case 7:return a=i.viewMediaClientConfig,o=Object(Wt.a)(a),s={collectionName:r.collection},e.prev=10,e.next=13,o.file.getCurrentState(r.id,s);case 13:if("error"!==(c=e.sent).status){e.next=16;break}return e.abrupt("return");case 16:e.next=21;break;case 18:return e.prev=18,e.t0=e.catch(10),e.abrupt("return");case 21:if(e.t1=n.getNodeContextId(),e.t1){e.next=26;break}return e.next=25,n.getObjectId();case 25:e.t1=e.sent;case 26:l=e.t1,d=(u=c).name,p=u.mimeType,f=u.size,xn(r,h={__fileName:d,__fileMimeType:p,__fileSize:f,__contextId:l})&&Le(r.id,h,t)(n.props.view.state,n.props.view.dispatch);case 31:case"end":return e.stop()}}),e,null,[[10,18]])})))),s()(this,"getAttrs",(function(){var e=n.props.node.attrs;if(e)return e})),s()(this,"getObjectId",h()(w.a.mark((function e(){var t;return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.props.contextIdentifierProvider;case 2:return t=e.sent,e.abrupt("return",t&&t.objectId);case 4:case"end":return e.stop()}}),e)})))),s()(this,"uploadExternalMedia",function(){var e=h()(w.a.mark((function e(t){var r,i,a,o,s,c,l,u;return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.props.node,e.next=3,n.props.mediaProvider;case 3:if(i=e.sent,!r||!i){e.next=21;break}if((a=i.uploadMediaClientConfig)&&r.attrs.url){e.next=8;break}return e.abrupt("return");case 8:return o=Object(Wt.a)(a),s=i.uploadParams&&i.uploadParams.collection,e.prev=10,e.next=13,o.file.uploadExternal(r.attrs.url,s);case 13:c=e.sent,l=c.uploadableFileUpfrontIds,u=c.dimensions,ze(t()+1,{id:l.id,collection:s,height:u.height,width:u.width,occurrenceKey:l.occurrenceKey})(n.props.view.state,n.props.view.dispatch),e.next=21;break;case 18:e.prev=18,e.t0=e.catch(10),n.props.dispatchAnalyticsEvent&&n.props.dispatchAnalyticsEvent({action:Oe.a.UPLOAD_EXTERNAL_FAIL,actionSubject:Oe.b.EDITOR,eventType:Oe.d.OPERATIONAL});case 21:case"end":return e.stop()}}),e,null,[[10,18]])})));return function(t){return e.apply(this,arguments)}}()),s()(this,"getNodeContextId",(function(){var e=n.getAttrs();if(e&&"file"===e.type)return e.__contextId})),s()(this,"updateDimensions",(function(e){Le(e.id,{height:e.height,width:e.width},!0)(n.props.view.state,n.props.view.dispatch)})),s()(this,"hasDifferentContextId",h()(w.a.mark((function e(){var t,r;return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.getNodeContextId(),e.next=3,n.getObjectId();case 3:if(r=e.sent,!t||!r||t===r){e.next=6;break}return e.abrupt("return",!0);case 6:return e.abrupt("return",!1);case 7:case"end":return e.stop()}}),e)})))),s()(this,"isNodeFromDifferentCollection",h()(w.a.mark((function e(){var t,r,i,a,o;return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.props.mediaProvider;case 2:if((t=e.sent)&&t.uploadParams){e.next=5;break}return e.abrupt("return",!1);case 5:if(r=t.uploadParams.collection,(i=n.getAttrs())&&"file"===i.type){e.next=9;break}return e.abrupt("return",!1);case 9:if(a=i.collection,o=i.__contextId,e.t0=o,e.t0){e.next=15;break}return e.next=14,n.getObjectId();case 14:e.t0=e.sent;case 15:if(!e.t0||r===a){e.next=18;break}return e.abrupt("return",!0);case 18:return e.abrupt("return",!1);case 19:case"end":return e.stop()}}),e)})))),s()(this,"copyNodeFromBlobUrl",function(){var e=h()(w.a.mark((function e(t){var r,i,a,o,s,c,l,u,d,p,f,h,m,v,b,g,y,O,k;return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((r=n.getAttrs())&&"external"===r.type){e.next=3;break}return e.abrupt("return");case 3:if(i=r.url,a=Object(On.b)(i)){e.next=7;break}return e.abrupt("return");case 7:return e.next=9,n.props.mediaProvider;case 9:if((o=e.sent)&&o.uploadParams){e.next=12;break}return e.abrupt("return");case 12:if(s=o.uploadParams.collection,c=a.contextId,l=a.id,u=a.collection,d=a.height,p=a.width,f=a.mimeType,h=a.name,m=a.size,(v=o.uploadMediaClientConfig)&&v.getAuthFromContext){e.next=17;break}return e.abrupt("return");case 17:return b=Object(Wt.a)(v),e.next=20,v.getAuthFromContext(c);case 20:return g=e.sent,y={id:l,collection:u,authProvider:function(){return Promise.resolve(g)}},O={collection:s,authProvider:v.authProvider,occurrenceKey:yn()()},e.next=25,b.file.copyFile(y,O);case 25:k=e.sent,ze(t()+1,{id:k.id,collection:s,height:d,width:p,__fileName:h,__fileMimeType:f,__fileSize:m})(n.props.view.state,n.props.view.dispatch);case 27:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),s()(this,"copyNode",h()(w.a.mark((function e(){var t,r,i,a,o,s,c,l,u,d,p,f,h,m,v,b;return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.props.mediaProvider;case 2:if(t=e.sent,r=n.props,i=r.isMediaSingle,a=r.view,o=n.getAttrs(),t&&t.uploadParams&&o&&"file"===o.type){e.next=7;break}return e.abrupt("return");case 7:if(s=n.getNodeContextId(),!((c=t.uploadMediaClientConfig)&&c.getAuthFromContext&&s)){e.next=25;break}return l=Object(Wt.a)(c),e.next=13,c.getAuthFromContext(s);case 13:return u=e.sent,e.next=16,n.getObjectId();case 16:return d=e.sent,p=o.id,f=o.collection,h={id:p,collection:f,authProvider:function(){return Promise.resolve(u)}},m=t.uploadParams.collection,v={collection:m,authProvider:c.authProvider,occurrenceKey:yn()()},e.next=23,l.file.copyFile(h,v);case 23:b=e.sent,Re(h.id,{id:b.id,collection:m,__contextId:d},i)(a.state,a.dispatch);case 25:case"end":return e.stop()}}),e)})))),this.props=t}var t,n;return g()(e,[{key:"isMediaBlobUrl",value:function(){var e=this.getAttrs();return!(!e||"external"!==e.type||!Object(On.c)(e.url))}},{key:"getRemoteDimensions",value:(n=h()(w.a.mark((function e(){var t,n,r,i,a,o,s,c,l,u;return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.props.mediaProvider;case 2:if(t=e.sent,n=this.props.mediaOptions,r=this.getAttrs(),t&&r){e.next=7;break}return e.abrupt("return",!1);case 7:if(i=r.height,a=r.width,"external"!==r.type&&r.id){e.next=10;break}return e.abrupt("return",!1);case 10:if(o=r.id,s=r.collection,!i||!a){e.next=13;break}return e.abrupt("return",!1);case 13:if(!n||n.allowRemoteDimensionsFetch){e.next=15;break}return e.abrupt("return",{id:o,height:wn.a,width:wn.b});case 15:return c=t.viewMediaClientConfig,l=Object(Wt.a)(c),e.next=19,l.getImageMetadata(o,{collection:s});case 19:if((u=e.sent)&&u.original){e.next=22;break}return e.abrupt("return",!1);case 22:return e.abrupt("return",{id:o,height:u.original.height||wn.a,width:u.original.width||wn.b});case 23:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"handleExternalMedia",value:(t=h()(w.a.mark((function e(t){return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isMediaBlobUrl()){e.next=12;break}return e.prev=1,e.next=4,this.copyNodeFromBlobUrl(t);case 4:e.next=10;break;case 6:return e.prev=6,e.t0=e.catch(1),e.next=10,this.uploadExternalMedia(t);case 10:e.next=14;break;case 12:return e.next=14,this.uploadExternalMedia(t);case 14:case"end":return e.stop()}}),e,this,[[1,6]])}))),function(e){return t.apply(this,arguments)})}]),e}(),xn=function(e,t){return e.__fileName!==t.__fileName||e.__fileMimeType!==t.__fileMimeType||e.__fileSize!==t.__fileSize||e.__contextId!==t.__contextId};function jn(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=G()(e);if(t){var i=G()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return q()(this,n)}}var En=function(e){return Object(we.c)(e.anchorPos,e.headPos,e.getPos(),e.node.nodeSize)},Pn=function(e){V()(n,e);var t=jn(n);function n(e){var r;return v()(this,n),r=t.call(this,e),s()(F()(r),"mediaPluginState",void 0),s()(F()(r),"mediaNodes",void 0),s()(F()(r),"state",{viewMediaClientConfig:void 0}),s()(F()(r),"updateNodeAttrs",(function(e){var t=e.view,n=e.mediaProvider,i=e.contextIdentifierProvider;r.mediaNodes.forEach((function(e){new kn({view:t,mediaProvider:n,contextIdentifierProvider:i,node:e,isMediaSingle:!1}).updateFileAttrs(!1)}))})),s()(F()(r),"setMediaItems",(function(e){var t=e.node;r.mediaNodes=[],t.forEach((function(t,n){r.mediaPluginState.mediaGroupNodes[t.attrs.id]={node:t,getPos:function(){return e.getPos()+n+1}},r.mediaNodes.push(t)}))})),s()(F()(r),"getIdentifier",(function(e){return"external"===e.attrs.type?{mediaItemType:"external-image",dataURI:e.attrs.url}:{id:e.attrs.id,mediaItemType:"file",collectionName:e.attrs.collection}})),s()(F()(r),"isNodeSelected",(function(e){var t=En(r.props);return t===we.a.selectedInRange||t===we.a.selectedInside&&r.props.anchorPos===e})),s()(F()(r),"renderChildNodes",(function(){var e=r.state.viewMediaClientConfig,t=r.props,n=t.getPos,i=t.allowLazyLoading,a=t.disabled,o=t.mediaOptions,s=r.mediaNodes.map((function(e,t){var o=function(){return n()+t+1};return{identifier:r.getIdentifier(e),isLazy:i,selected:r.isNodeSelected(o()),onClick:function(){Object($.f)(r.props.view,o())},actions:[{handler:a?function(){}:r.mediaPluginState.handleMediaNodeRemoval.bind(null,void 0,o),icon:l.a.createElement(fn.a,{label:"delete"})}]}}));return l.a.createElement(hn.a,{items:s,mediaClientConfig:e,featureFlags:o.featureFlags})})),r.mediaNodes=[],r.mediaPluginState=Y.a.getState(e.view.state),r.setMediaItems(e),r.state={viewMediaClientConfig:void 0},r}return g()(n,[{key:"componentDidMount",value:function(){var e=this;this.updateMediaClientConfig(),this.mediaNodes.forEach(function(){var t=h()(w.a.mark((function t(n){var r,i,a,o,s;return w.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if("external"!==n.attrs.type){t.next=2;break}return t.abrupt("return");case 2:if(r=e.props,i=r.view,a=r.mediaProvider,o=r.contextIdentifierProvider,s=new kn({view:i,mediaProvider:a,contextIdentifierProvider:o,node:n,isMediaSingle:!1}),s.getNodeContextId()){t.next=8;break}return t.next=8,s.updateContextId();case 8:return t.next=10,s.hasDifferentContextId();case 10:if(!t.sent){t.next=14;break}return t.next=14,s.copyNode();case 14:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())}},{key:"UNSAFE_componentWillReceiveProps",value:function(e){this.updateMediaClientConfig(),this.setMediaItems(e),!1!==e.isCopyPasteEnabled&&this.updateNodeAttrs(e)}},{key:"shouldComponentUpdate",value:function(e){return t=this.props,n=e,En(t)!==En(n)||En(n)===we.a.selectedInside&&t.anchorPos!==n.anchorPos||this.props.node!==e.node||this.state.viewMediaClientConfig!==this.mediaPluginState.mediaClientConfig;var t,n}},{key:"updateMediaClientConfig",value:function(){var e=this.state.viewMediaClientConfig,t=this.mediaPluginState.mediaClientConfig;!e&&t&&this.setState({viewMediaClientConfig:t})}},{key:"render",value:function(){return this.renderChildNodes()}}]),n}(l.a.Component);s()(Pn,"displayName","MediaGroup");var Cn,Sn=function(e){V()(n,e);var t=jn(n);function n(){return v()(this,n),t.apply(this,arguments)}return g()(n,[{key:"render",value:function(e,t){var n=this,r=e.providerFactory,i=e.mediaOptions,a=this.getPos;return l.a.createElement(dn.a,{providers:["mediaProvider","contextIdentifierProvider"],providerFactory:r,renderNode:function(e){var r=e.mediaProvider,o=e.contextIdentifierProvider;return l.a.createElement(ln.a,{editorView:n.view,plugins:{reactNodeViewState:vn.b,editorDisabledPlugin:bn.b},render:function(e){var s=e.editorDisabledPlugin;return r?l.a.createElement(Pn,{node:n.node,getPos:a,view:n.view,forwardRef:t,disabled:(s||{}).editorDisabled,allowLazyLoading:i.allowLazyLoading,mediaProvider:r,contextIdentifierProvider:o,isCopyPasteEnabled:i.isCopyPasteEnabled,anchorPos:n.view.state.selection.$anchor.pos,headPos:n.view.state.selection.$head.pos,mediaOptions:i}):null}})}})}}]),n}(mn.a),_n=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return function(i,a,o){return new Sn(i,a,o,e,t,{providerFactory:n,mediaOptions:r}).init()}},Mn=n("RNXH"),Dn=n.n(Mn),In=n("LGLP"),Nn=n.n(In),Tn=n("ww0P"),An=n("iHxc"),Ln=n("bHTr"),Rn=n("WISH"),zn=n("RFGA"),Un=N.default.div(Cn||(Cn=I()(["\n  img {\n    width: 100%;\n  }\n\n  & > div {\n    ",";\n    position: relative;\n    clear: both;\n  }\n"])),zn.a);Un.displayName="ResizerWrapper";var Fn=n("9Bpa"),Bn=n("VUve"),Vn=n("LPnw"),Wn=[250,384,576,768];function qn(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=G()(e);if(t){var i=G()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return q()(this,n)}}var Hn=function(e){V()(i,e);var t,n,r=qn(i);function i(){var e;v()(this,i);for(var t=arguments.length,n=new Array(t),a=0;a<t;a++)n[a]=arguments[a];return e=r.call.apply(r,[this].concat(n)),s()(F()(e),"state",{offsetLeft:Gn(e.insideInlineLike,e.insideLayout,e.props.view.dom,void 0),isVideoFile:!0}),s()(F()(e),"calcNewSize",(function(t,n){var r=e.props,i=r.layout,a=r.view.state,o=100*Object(Ln.b)(t,e.props.lineLength);e.setState({resizedPctWidth:o});var s=Object(_.hasParentNodeOfType)(a.schema.nodes.table)(a.selection)?i:e.calcUnwrappedLayout(o,t);return o<=100?(!e.wrappedLayout||n&&100===o||(s=i),{width:o,layout:s}):{width:e.props.pctWidth||null,layout:s}})),s()(F()(e),"calcUnwrappedLayout",(function(e,t){return e<=100?"center":t<=Rn.V?"wide":"full-width"})),s()(F()(e),"calcColumnLeftOffset",(function(){var t=e.state.offsetLeft;return e.insideInlineLike?Object(Ln.a)(t,e.props.lineLength,e.props.gridSize):0})),s()(F()(e),"wrapper",void 0),s()(F()(e),"calcPxWidth",(function(t){var n=e.props,r=n.width,i=n.height,a=n.layout,o=n.pctWidth,s=n.lineLength,c=n.containerWidth,l=n.fullWidthMode,u=n.getPos,d=n.view.state,p=e.state.resizedPctWidth,f="function"==typeof u?u():void 0;return Object(M.a)({origWidth:r,origHeight:i,pctWidth:o,state:d,containerWidth:{width:c,lineLength:s},isFullWidthModeEnabled:l,layout:t||a,pos:f,resizedPctWidth:p})})),s()(F()(e),"highlights",(function(t,n){var r=Object(Bn.c)(t,n),i=e.props.view.state.schema.nodes,a=i.layoutColumn,o=i.table,s=i.expand,c=i.nestedExpand;if(e.$pos&&Object(_.findParentNodeOfTypeClosestToPos)(e.$pos,[a,o,s,c].filter(Boolean)))return[];if(r>Rn.V)return["full-width"];var l=e.props,u=l.layout,d=l.lineLength,p=l.gridSize,f=Object(Ln.a)(r,d,p),h=Math.round(f),m=[];return"wrap-left"===u||"align-start"===u?m.push(0,h):"wrap-right"===u||"align-end"===u?m.push(p,p-h):e.insideInlineLike?m.push(Math.round(f+e.calcColumnLeftOffset())):m.push(Math.floor((p-h)/2),Math.ceil((p+h)/2)),m})),s()(F()(e),"saveWrapper",(function(t){return e.wrapper=t})),e}return g()(i,[{key:"componentDidUpdate",value:function(){var e=Gn(this.insideInlineLike,this.insideLayout,this.props.view.dom,this.wrapper);return e!==this.state.offsetLeft&&e>=0&&this.setState({offsetLeft:e}),!0}},{key:"wrappedLayout",get:function(){return wn.e.indexOf(this.props.layout)>-1}},{key:"componentDidMount",value:(n=h()(w.a.mark((function e(){var t;return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t=this.props.viewMediaClientConfig)){e.next=4;break}return e.next=4,this.checkVideoFile(t);case 4:this.props.pctWidth&&this.setState({resizedPctWidth:this.props.pctWidth});case 5:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"UNSAFE_componentWillReceiveProps",value:function(e){this.props.viewMediaClientConfig!==e.viewMediaClientConfig&&this.checkVideoFile(e.viewMediaClientConfig),this.props.layout!==e.layout&&this.checkLayout(this.props.layout,e.layout)}},{key:"checkVideoFile",value:(t=h()(w.a.mark((function e(t){var n,r,i,a;return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((n=this.$pos)&&t){e.next=3;break}return e.abrupt("return");case 3:if((r=this.props.view.state.doc.nodeAt(n.pos+1))&&r.attrs.id){e.next=6;break}return e.abrupt("return");case 6:return i=Object(Wt.a)(t),e.prev=7,e.next=10,i.file.getCurrentState(r.attrs.id,{collectionName:r.attrs.collection});case 10:(a=e.sent)&&"error"!==a.status&&"image"===a.mediaType&&this.setState({isVideoFile:!1}),e.next=17;break;case 14:e.prev=14,e.t0=e.catch(7),this.setState({isVideoFile:!1});case 17:case"end":return e.stop()}}),e,this,[[7,14]])}))),function(e){return t.apply(this,arguments)})},{key:"checkLayout",value:function(e,t){var n=this.state.resizedPctWidth;if(wn.e.indexOf(e)>-1&&"center"===t&&n){var r=this.calcUnwrappedLayout(n,this.calcPxWidth(t));this.props.updateSize(n,r)}}},{key:"$pos",get:function(){if("function"!=typeof this.props.getPos)return null;var e=this.props.getPos();return Number.isNaN(e)||"number"!=typeof e?null:this.props.view.state.doc.resolve(e)}},{key:"gridWidth",get:function(){var e=this.props.gridSize;return this.wrappedLayout||this.insideInlineLike?e:e/2}},{key:"insideInlineLike",get:function(){var e=this.$pos;if(!e)return!1;var t=this.props.view.state.schema.nodes.listItem;return!!Object(_.findParentNodeOfTypeClosestToPos)(e,[t])}},{key:"insideLayout",get:function(){var e=this.$pos;if(!e)return!1;var t=this.props.view.state.schema.nodes.layoutColumn;return!!Object(_.findParentNodeOfTypeClosestToPos)(e,[t])}},{key:"render",value:function(){var e=this,t=this.props,n=t.width,r=t.height,i=t.layout,a=t.pctWidth,o=t.containerWidth,s=t.fullWidthMode,c=t.selected,u=t.view.state,d=t.children,p=this.calcPxWidth(),f=r/n*p,h=p,m={};Bn.a.forEach((function(t){var n="left"===t?"right":"left";m[t]=["full-width","wide","center"].concat("wrap-".concat(n)).concat("align-".concat(Bn.b[n])).indexOf(i)>-1,"left"===t&&e.insideInlineLike&&(m[t]=!1)}));this.$pos,Rn.V,this.props.allowBreakoutSnapPoints,this.props.containerWidth,this.props.gridSize,this.gridWidth,this.insideInlineLike,this.insideLayout,this.state.isVideoFile,this.props.lineLength,this.state.offsetLeft,this.wrappedLayout;return l.a.createElement(Un,{ratio:(f/h*100).toFixed(3),layout:i,isResized:!!a,containerWidth:o||n,innerRef:this.saveWrapper,fullWidthMode:s},l.a.createElement(Fn.a,Nn()({},this.props,{width:h,height:f,selected:c,enable:m,calcNewSize:this.calcNewSize,snapPoints:Wn,scaleFactor:this.wrappedLayout||this.insideInlineLike?1:2,highlights:this.highlights,handleResizeStart:function(){var e=Object(Vn.c)(u);return!e||!e.dragging},nodeType:"media",dispatchAnalyticsEvent:this.props.dispatchAnalyticsEvent}),d))}}]),i}(l.a.Component);function Gn(e,t,n,r){var i=0;r&&e&&!t&&(i=r.getBoundingClientRect().left-n.getBoundingClientRect().left);return i}var Kn=n("YZT1"),Qn=n("XKts"),Jn=function(){return document.querySelectorAll(".ProseMirror > p").forEach((function(e){return e.setAttribute("contenteditable","false")}))},Xn=function(){return document.querySelectorAll(".ProseMirror > p").forEach((function(e){return e.setAttribute("contenteditable","")}))},$n=function(){return document.querySelector(".ua-firefox")};function Yn(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Zn(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Yn(Object(n),!0).forEach((function(t){s()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Yn(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function er(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=G()(e);if(t){var i=G()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return q()(this,n)}}var tr=function(e){V()(r,e);var t,n=er(r);function r(){var e;v()(this,r);for(var t=arguments.length,i=new Array(t),a=0;a<t;a++)i[a]=arguments[a];return e=n.call.apply(n,[this].concat(i)),s()(F()(e),"state",{width:void 0,height:void 0,viewMediaClientConfig:void 0,isCopying:!1}),s()(F()(e),"createMediaNodeUpdater",(function(t){var n=e.props.node.firstChild;return new kn(Zn(Zn({},t),{},{isMediaSingle:!0,node:n||e.props.node,dispatchAnalyticsEvent:e.props.dispatchAnalyticsEvent}))})),s()(F()(e),"setViewMediaClientConfig",function(){var t=h()(w.a.mark((function t(n){var r,i;return w.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,n.mediaProvider;case 2:(r=t.sent)&&(i=r.viewMediaClientConfig,e.setState({viewMediaClientConfig:i}));case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),s()(F()(e),"updateMediaNodeAttributes",function(){var t=h()(w.a.mark((function t(n){var r,i,a,o,s,c;return w.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=e.createMediaNodeUpdater(n),i=e.props.mediaPluginState.addPendingTask,a=e.props.node.firstChild){t.next=5;break}return t.abrupt("return");case 5:return t.next=7,r.getRemoteDimensions();case 7:if((o=t.sent)&&r.updateDimensions(o),"external"!==a.attrs.type||!a.attrs.__external){t.next=15;break}return s=r.handleExternalMedia(e.props.getPos),i(s),t.next=14,s;case 14:return t.abrupt("return");case 15:if(r.getNodeContextId()){t.next=19;break}return t.next=19,r.updateContextId();case 19:return t.next=21,r.hasDifferentContextId();case 21:if(!t.sent){t.next=34;break}return e.setState({isCopying:!0}),t.prev=24,c=r.copyNode(),i(c),t.next=29,c;case 29:t.next=34;break;case 31:t.prev=31,t.t0=t.catch(24),e.setState({isCopying:!1});case 34:case"end":return t.stop()}}),t,null,[[24,31]])})));return function(e){return t.apply(this,arguments)}}()),s()(F()(e),"selectMediaSingle",(function(t){var n=t.event;n.stopPropagation();var r=e.props.getPos(),i=e.props.view.state;if(n.shiftKey){if(i.selection instanceof X.a)return;Object($.g)(e.props.view,i.selection.from<r?i.selection.from:r,i.selection.to>r?i.selection.to:r+3)}else Object($.f)(e.props.view,r)})),s()(F()(e),"updateSize",(function(t,n){var r=e.props.view,i=r.state,a=r.dispatch,o=e.props.getPos();if(void 0!==o){var s=i.tr.setNodeMarkup(o,void 0,Zn(Zn({},e.props.node.attrs),{},{layout:n,width:t}));return s.setMeta("scrollIntoView",!1),a(s)}})),s()(F()(e),"forwardInnerRef",(function(t){e.props.forwardRef(t)})),s()(F()(e),"getLineLength",(function(e,t){if(Object(Qn.c)(e,t)){var n=e.state.doc.resolve(t),r=e.nodeDOM(n.pos);if(n.nodeAfter&&Qn.b.indexOf(n.nodeAfter.attrs.layout)>-1&&r&&r.parentElement)return r.parentElement.offsetWidth;if(r instanceof HTMLElement)return r.offsetWidth}return null})),e}return g()(r,[{key:"UNSAFE_componentWillReceiveProps",value:function(e){e.mediaProvider!==this.props.mediaProvider&&this.setViewMediaClientConfig(e),!1!==e.isCopyPasteEnabled&&this.createMediaNodeUpdater(e).updateFileAttrs()}},{key:"componentDidMount",value:(t=h()(w.a.mark((function e(){var t;return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.props.contextIdentifierProvider,e.next=3,Promise.all([this.setViewMediaClientConfig(this.props),this.updateMediaNodeAttributes(this.props)]);case 3:return e.t0=this,e.next=6,t;case 6:e.t1=e.sent,e.t2={contextIdentifierProvider:e.t1},e.t0.setState.call(e.t0,e.t2),null!=(n=$n())&&n.addEventListener("dragstart",Jn),null==n||n.addEventListener("dragend",Xn);case 10:case"end":return e.stop()}var n}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"componentWillUnmount",value:function(){var e;null!=(e=$n())&&e.removeEventListener("dragstart",Jn),null==e||e.removeEventListener("dragend",Xn)}},{key:"render",value:function(){var e=this.props,t=e.selected,n=e.getPos,r=e.node,i=e.mediaOptions,a=e.fullWidthMode,o=e.view.state,s=e.view,c=r.attrs,u=c.layout,d=c.width,p=r.firstChild.attrs,f=p.width,h=p.height;f&&h||(f=250,h=187.5);var m={layout:u,width:f,height:h,containerWidth:this.props.width,lineLength:this.props.lineLength||768,pctWidth:d||250/768*100,fullWidthMode:a},v=l.a.createElement(Z,{innerRef:this.forwardInnerRef}),b=!!this.props.mediaOptions.allowResizing;if(!this.props.mediaOptions.allowResizingInTables){var g=n();if(g){var y=o.doc.resolve(g),w=o.schema.nodes.table,O=!!Object(_.findParentNodeOfTypeClosestToPos)(y,[w]);b=b&&!O}}var k=this.getLineLength(s,n())||m.lineLength;return b?l.a.createElement(Hn,Nn()({},m,{lineLength:k,view:this.props.view,getPos:n,updateSize:this.updateSize,displayGrid:Object(Kn.a)(this.props.eventDispatcher),gridSize:12,viewMediaClientConfig:this.state.viewMediaClientConfig,allowBreakoutSnapPoints:i&&i.allowBreakoutSnapPoints,selected:t(),dispatchAnalyticsEvent:this.props.dispatchAnalyticsEvent}),v):l.a.createElement(wn.c,m,v)}}]),r}(c.Component);s()(tr,"defaultProps",{mediaOptions:{}}),s()(tr,"displayName","MediaSingleNode");var nr=function(e){V()(n,e);var t=er(n);function n(){var e;v()(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return e=t.call.apply(t,[this].concat(i)),s()(F()(e),"lastOffsetLeft",0),s()(F()(e),"forceViewUpdate",!1),s()(F()(e),"selectionType",null),s()(F()(e),"checkAndUpdateSelectionType",(function(){var t=e.getPos,n=e.view.state.selection,r=Object(we.c)(n.$anchor.pos,n.$head.pos,t(),e.node.nodeSize);return e.selectionType=r,r})),s()(F()(e),"isNodeSelected",(function(){return e.checkAndUpdateSelectionType(),null!==e.selectionType})),e}return g()(n,[{key:"createDomRef",value:function(){var e=document.createElement("div");return Tn.a.chrome&&this.reactComponentProps.mediaOptions&&this.reactComponentProps.mediaOptions.allowMediaSingleEditable&&(e.contentEditable="true"),e}},{key:"getContentDOM",value:function(){return{dom:document.createElement("div")}}},{key:"viewShouldUpdate",value:function(e){return this.forceViewUpdate?(this.forceViewUpdate=!1,!0):this.node.attrs!==e.attrs||(this.selectionType!==this.checkAndUpdateSelectionType()||Dn()(G()(n.prototype),"viewShouldUpdate",this).call(this,e))}},{key:"getNodeMediaId",value:function(e){if(e.firstChild)return e.firstChild.attrs.id}},{key:"update",value:function(e,t,r){var i=this;return r||(r=function(e,t){return i.getNodeMediaId(e)===i.getNodeMediaId(t)}),Dn()(G()(n.prototype),"update",this).call(this,e,t,r)}},{key:"render",value:function(e,t){var n=this,r=this.reactComponentProps,i=r.eventDispatcher,a=r.fullWidthMode,o=r.providerFactory,s=r.mediaOptions,c=r.dispatchAnalyticsEvent,u=this.getPos;return l.a.createElement(dn.a,{providers:["mediaProvider","contextIdentifierProvider"],providerFactory:o,renderNode:function(e){var r=e.mediaProvider,o=e.contextIdentifierProvider;return l.a.createElement(ln.a,{editorView:n.view,plugins:{width:An.b,mediaPluginState:Y.a},render:function(e){var d=e.width,p=e.mediaPluginState;return l.a.createElement(tr,{width:d.width,lineLength:d.lineLength,node:n.node,getPos:u,mediaProvider:r,contextIdentifierProvider:o,mediaOptions:s,view:n.view,fullWidthMode:a,selected:n.isNodeSelected,eventDispatcher:i,mediaPluginState:p,dispatchAnalyticsEvent:c,forwardRef:t})}})}})}},{key:"ignoreMutation",value:function(){if(this.dom){var e=this.dom.offsetLeft;e!==this.lastOffsetLeft&&(this.lastOffsetLeft=e,this.forceViewUpdate=!0,this.update(this.node,[],(function(){return!0})))}return!0}}]),n}(mn.a),rr=function(e,t,n,r){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};return function(a,o,s){return new nr(a,o,s,e,t,{eventDispatcher:t,fullWidthMode:i.fullWidthEnabled,providerFactory:n,mediaOptions:i,dispatchAnalyticsEvent:r,isCopyPasteEnabled:i.isCopyPasteEnabled}).init()}},ir=n("QGb3"),ar=n.n(ir),or=n("CzxY"),sr=n.n(or),cr=n("368d"),lr=n("tUdN"),ur=n("Havv"),dr=n.n(ur),pr=n("YyNJ"),fr=n("uxt/"),hr=n("qwOa"),mr=Object(hr.e)({annotate:{id:"fabric.editor.annotate",defaultMessage:"Annotate",description:"Annotate an image by drawing arrows, adding text, or scribbles."}});function vr(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=G()(e);if(t){var i=G()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return q()(this,n)}}var br,gr,yr=function(e,t){var n=Y.a.getState(e);if(!n)return!1;var r=e.schema.nodes.mediaSingle,i=n.selectedMediaContainerNode();if(!i||i.type!==r)return!1;var a,o=i.firstChild.attrs,s=o.id,c=o.collection,l=o.occurrenceKey;return Object(ke.d)({action:Oe.a.CLICKED,actionSubject:Oe.b.MEDIA,actionSubjectId:Oe.c.ANNOTATE_BUTTON,eventType:Oe.d.UI})((a=e.selection.from+1,et({type:"open",identifier:{id:s,collectionName:c,mediaItemType:"file",occurrenceKey:l},pos:a})))(e,t)},wr=function(e){V()(i,e);var t,n,r=vr(i);function i(){var e;v()(this,i);for(var t=arguments.length,n=new Array(t),a=0;a<t;a++)n[a]=arguments[a];return e=r.call.apply(r,[this].concat(n)),s()(F()(e),"state",{isImage:!1}),s()(F()(e),"onClickAnnotation",(function(){var t=e.props.view;t&&yr(t.state,t.dispatch)})),e}return g()(i,[{key:"componentDidMount",value:(n=h()(w.a.mark((function e(){return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.checkIsImage();case 2:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"checkIsImage",value:(t=h()(w.a.mark((function e(){var t,n;return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=Object(Wt.a)(this.props.viewMediaClientConfig),this.props.id){e.next=3;break}return e.abrupt("return");case 3:return e.prev=3,e.next=6,t.file.getCurrentState(this.props.id,{collectionName:this.props.collection});case 6:(n=e.sent)&&"error"!==n.status&&"image"===n.mediaType&&this.setState({isImage:!0}),e.next=12;break;case 10:e.prev=10,e.t0=e.catch(3);case 12:case"end":return e.stop()}}),e,this,[[3,10]])}))),function(){return t.apply(this,arguments)})},{key:"componentDidUpdate",value:function(e){var t=this;e.id!==this.props.id&&this.setState({isImage:!1},(function(){t.checkIsImage()}))}},{key:"render",value:function(){if(!this.state.isImage)return null;var e=this.props.intl.formatMessage(mr.annotate);return l.a.createElement(l.a.Fragment,null,l.a.createElement(fr.a,null),l.a.createElement(pr.a,{title:e,icon:l.a.createElement(dr.a,{label:e}),onClick:this.onClickAnnotation}))}}]),i}(l.a.Component),Or=function(e,t){return function(n,r){var i=e.selectedMediaContainerNode();return i&&e.mediaClientConfig?l.a.createElement(wr,{key:r,viewMediaClientConfig:e.mediaClientConfig,id:i.firstChild.attrs.id,collection:i.firstChild.attrs.collection,view:n,intl:t}):null}},kr=n("VqFj"),xr=n.n(kr),jr=n("1mRP"),Er=n.n(jr),Pr=n("VrxG"),Cr=n("BXdW"),Sr=n("pev1"),_r=n("gnaU");function Mr(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=G()(e);if(t){var i=G()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return q()(this,n)}}var Dr=Object(hr.e)({backLink:{id:"fabric.editor.backLink",defaultMessage:"Go back",description:"Go back from media linking toolbar to main toolbar"}}),Ir=N.default.section(br||(br=I()(["\n  display: flex;\n  line-height: 0;\n  padding: 12px 24px 12px 0;\n  margin: 0 4px 0 32px;\n  border-top: 1px solid ",";\n  align-items: start;\n  display: flex;\n  flex-direction: column;\n"])),A.R400),Nr=N.default.span(gr||(gr=I()(["\n  padding: 4px 8px 4px 0px;\n"]))),Tr=function(e){V()(n,e);var t=Mr(n);function n(){var e;v()(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return e=t.call.apply(t,[this].concat(i)),s()(F()(e),"state",{validationErrors:[]}),s()(F()(e),"handleSubmit",(function(t){var n=t.url,r=t.inputMethod;e.props.onSubmit(n,{inputMethod:r})})),s()(F()(e),"handleOnBack",(function(t){var n=t.url,r=t.inputMethod,i=e.props.onBack;i&&i(n,{inputMethod:r})})),s()(F()(e),"handleCancel",(function(){var t=e.props.onCancel;t&&t()})),s()(F()(e),"handleUnlink",(function(){var t=e.props.onUnlink;t&&t()})),s()(F()(e),"handleOnBlur",(function(t){e.props.onBlur(t.url)})),s()(F()(e),"renderContainer",(function(t){var n,r=t.activityProvider,i=t.inputProps,a=i.onChange,o=i.onKeyDown,s=i.onSubmit,c=i.value,u=t.currentInputMethod,d=t.renderRecentList,p=e.props,f=p.intl.formatMessage,h=p.displayUrl,m=f(Dr.backLink),v=f(cr.b.unlink),b=e.state.validationErrors.map((function(e,t){return l.a.createElement(_r.a,{key:t},e)}));return l.a.createElement("div",{className:"recent-list"},l.a.createElement(Cr.a,{provider:!!r},l.a.createElement(Cr.e,null,l.a.createElement(Nr,null,l.a.createElement(pr.a,{title:m,icon:l.a.createElement(xr.a,{label:m}),onClick:function(){return e.handleOnBack({url:c,inputMethod:u})}})),l.a.createElement(Pr.a,{testId:"media-link-input",placeholder:(n=!!r,f(n?cr.b.placeholder:cr.b.linkPlaceholder)),autoFocus:!0,onCancel:e.handleCancel,defaultValue:c,onSubmit:function(t){var n=e.getValidationErrors(t,u);e.setState({validationErrors:n}),n.length||s()},onChange:function(t){e.setState({validationErrors:[]}),a(t)},onKeyDown:o}),Object(Ft.g)(h)&&l.a.createElement(l.a.Fragment,null,l.a.createElement(fr.a,null),l.a.createElement(pr.a,{title:v,icon:l.a.createElement(Er.a,{label:v}),onClick:e.handleUnlink}))),!!b.length&&l.a.createElement(Ir,null,b),d()))})),e}return g()(n,[{key:"getValidationErrors",value:function(e,t){var n=this.props.intl.formatMessage;return t===Oe.e.TYPEAHEAD?[]:e?Object(Ft.g)(e)?[]:[n(cr.b.invalidLink)]:[n(cr.b.emptyLink)]}},{key:"render",value:function(){var e=this.props,t=e.providerFactory,n=e.displayUrl;return l.a.createElement(Sr.a,{defaultUrl:Object(Ft.g)(n),providerFactory:t,onSubmit:this.handleSubmit,onBlur:this.handleOnBlur,render:this.renderContainer})}}]),n}(l.a.PureComponent);function Ar(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Lr(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ar(Object(n),!0).forEach((function(t){s()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ar(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Rr(e){var t=Ut(e);if(!t||null===t.mediaPos)return!1;var n=e.schema,r=n.nodes.media,i=n.marks.link,a=e.doc.nodeAt(t.mediaPos);if(!a||a.type!==r)return!1;var o=e.doc.resolve(t.mediaPos).parent;return o&&o.type.allowsMarkType(i)}var zr,Ur,Fr,Br,Vr,Wr,qr=function(e,t,n,r,i){var a=t.link,o=t.visible,s=t.editable,c=t.mediaPos;if(o&&null!==c&&n.doc.nodeAt(c))return Lr(Lr({},e),{},{height:Cr.c,width:Cr.d,forcePlacement:!0,items:[{type:"custom",render:function(e,t){return e&&i?l.a.createElement(Tr,{key:t,displayUrl:a,providerFactory:i,intl:r,editing:s,onUnlink:function(){return Zt(e.state,e.dispatch,e)},onBack:function(t,n){t.trim()&&n.inputMethod&&tn(t,n.inputMethod)(e.state,e.dispatch,e),Xt(e.state,e.dispatch,e)},onCancel:function(){return Xt(e.state,e.dispatch,e)},onSubmit:function(t,n){tn(t,n.inputMethod)(e.state,e.dispatch,e),Xt(e.state,e.dispatch,e)},onBlur:function(){Xt(e.state,e.dispatch,e)}}):null}}]})},Hr=n("nazu"),Gr=Object(hr.e)({altText:{id:"fabric.editor.addAltText",defaultMessage:"Alt text",description:"Add an alt text for this image"},editAltText:{id:"fabric.editor.editAltText",defaultMessage:"Edit alt text",description:"Edit an alt text for this image"},back:{id:"fabric.editor.closeAltTextEdit",defaultMessage:"Back",description:"Back to toolbar"},clear:{id:"fabric.editor.clearAltTextEdit",defaultMessage:"Clear alt text",description:"Clear alt text"},placeholder:{id:"fabric.editor.placeholderAltText",defaultMessage:"Describe this image with alt text",description:"Describe this image with alt text"},supportText:{id:"fabric.editor.supportAltText",defaultMessage:"Alt text is useful for people using screen readers because of visual limitations.",description:"Alt text is useful for people using screen readers because of visual limitations."},validationMessage:{id:"fabric.editor.alttext.validation",defaultMessage:"Please remove any special characters in alt text.",description:"Please remove any special characters in alt text. "}}),Kr=n("VfAS"),Qr=n.n(Kr),Jr=n("/V8Q"),Xr=n("Mlj8");function $r(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=G()(e);if(t){var i=G()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return q()(this,n)}}var Yr=Cr.d,Zr=N.default.p(zr||(zr=I()(["\n  color: ",";\n  font-size: 12px;\n  padding: 12px 40px;\n  line-height: 20px;\n  border-top: 1px solid ",";\n  margin: 0;\n"])),A.N100,A.N30),ei=N.default.div(Ur||(Ur=I()(["\n  width: ","px;\n  display: flex;\n  flex-direction: column;\n  overflow: auto;\n  line-height: 2;\n"])),Yr),ti=N.default.section(Fr||(Fr=I()(["\n  display: flex;\n  line-height: 0;\n  padding: 5px 0;\n  align-items: center;\n"]))),ni=N.default.section(Br||(Br=I()(["\n  display: flex;\n  line-height: 0;\n  padding: 12px 24px 12px 0;\n  margin: 0 12px 0 40px;\n  border-top: 1px solid ",";\n  align-items: start;\n  display: flex;\n  flex-direction: column;\n"])),A.R400),ri=N.default.div(Vr||(Vr=I()(["\n  display: flex;\n  padding: 4px 8px;\n"]))),ii=N.default.span(Wr||(Wr=I()(["\n  color: ",";\n"])),A.N80),ai=function(e){V()(n,e);var t=$r(n);function n(e){var r;v()(this,n),r=t.call(this,e),s()(F()(r),"fireCustomAnalytics",void 0),s()(F()(r),"state",{showClearTextButton:Boolean(r.props.value),validationErrors:r.props.value?r.getValidationErrors(r.props.value):[],lastValue:r.props.value}),s()(F()(r),"prevValue",void 0),s()(F()(r),"closeMediaAltTextMenu",(function(){var e=r.props.view;jt(e.state,e.dispatch)})),s()(F()(r),"dispatchCancelEvent",(function(e){var t=r.props.view;t.someProp("handleKeyDown",(function(n){return n(t,e)}))})),s()(F()(r),"updateAltText",(function(e){var t=r.props.view;!function(e){return ht((function(e){return!!Object(ge.d)(e)&&{type:"updateAltText"}}),(function(t,n){var r=Object(ge.b)(n),i=t.selection.from+1;return r&&(t.setMeta("scrollIntoView",!1),t.setNodeMarkup(i,void 0,wt(wt({},r.attrs),{},{alt:e}))),t}))}(0===e.length?null:e)(t.state,t.dispatch)})),s()(F()(r),"handleOnChange",(function(e){var t=r.getValidationErrors(e);r.setState({showClearTextButton:Boolean(e),validationErrors:t,lastValue:e},(function(){t&&t.length||r.updateAltText(e)}))})),s()(F()(r),"handleOnBlur",(function(){var e=r.props.value,t=(r.state.lastValue||e||"").trim();r.handleOnChange(t)})),s()(F()(r),"handleClearText",(function(){r.handleOnChange("")}));var i=e.createAnalyticsEvent;return r.fireCustomAnalytics=Object(Xr.a)(i),r}return g()(n,[{key:"componentDidMount",value:function(){this.prevValue=this.props.value}},{key:"componentWillUnmount",value:function(){this.fireAnalytics(Oe.a.CLOSED),!this.prevValue&&this.props.value&&this.fireAnalytics(Oe.a.ADDED),this.prevValue&&!this.props.value&&this.fireAnalytics(Oe.a.CLEARED),this.prevValue&&this.prevValue!==this.props.value&&this.fireAnalytics(Oe.a.EDITED)}},{key:"getValidationErrors",value:function(e){var t=this.props.altTextValidator;return e&&"function"==typeof t&&t(e)||[]}},{key:"render",value:function(){var e=this.props.intl.formatMessage,t=this.state.showClearTextButton,n=e(Gr.back),r=l.a.createElement(gt.ToolTipContent,{description:n,keymap:gt.escape,shortcutOverride:"Esc"}),i=(this.state.validationErrors||[]).map((function(e,t){return l.a.createElement(_r.a,{key:t},e)}));return l.a.createElement(ei,null,l.a.createElement(ti,null,l.a.createElement(ri,null,l.a.createElement(pr.a,{title:e(Gr.back),icon:l.a.createElement(xr.a,{label:e(Gr.back)}),tooltipContent:r,onClick:this.closeMediaAltTextMenu})),l.a.createElement(Pr.a,{testId:"alt-text-input",placeholder:e(Gr.placeholder),defaultValue:this.state.lastValue,onCancel:this.dispatchCancelEvent,onChange:this.handleOnChange,onBlur:this.handleOnBlur,onSubmit:this.closeMediaAltTextMenu,maxLength:510,autoFocus:!0}),t&&l.a.createElement(ri,null,l.a.createElement(pr.a,{testId:"alt-text-clear-button",title:e(Gr.clear),icon:l.a.createElement(ii,null,l.a.createElement(Qr.a,{label:e(Gr.clear)})),tooltipContent:e(Gr.clear),onClick:this.handleClearText}))),!!i.length&&l.a.createElement(ni,null,i),l.a.createElement(Zr,null,e(Gr.supportText)))}},{key:"fireAnalytics",value:function(e){this.props.createAnalyticsEvent&&this.fireCustomAnalytics&&this.fireCustomAnalytics({payload:{action:e,actionSubject:Oe.b.MEDIA,actionSubjectId:Oe.c.ALT_TEXT,eventType:Oe.d.TRACK}})}}]),n}(l.a.Component),oi=Object(Jr.a)()(Object(hr.f)(ai)),si=n("5tuL");function ci(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function li(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ci(Object(n),!0).forEach((function(t){s()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ci(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var ui,di=function(e,t){var n=Object(ge.b)(t),r=n&&n.attrs.alt?Gr.editAltText:Gr.altText,i=e.formatMessage(r);return{title:i,type:"button",onClick:Et,showTitle:!0,testId:"alt-text-edit-button",tooltipContent:l.a.createElement(gt.ToolTipContent,{description:i,keymap:gt.addAltText})}},pi=function(e){return{type:"custom",render:function(t,n){if(!t)return null;var r=Object(ge.b)(t.state);return r?l.a.createElement(oi,{view:t,key:n,value:r.attrs.alt,altTextValidator:e&&e.altTextValidator}):null}}},fi=function(e,t){return li(li({},e),{},{width:Yr,className:si.a.FLOATING_TOOLBAR_COMPONENT,items:[pi(t)]})},hi=n("XkwL"),mi=n.n(hi),vi=n("VKpd"),bi=n.n(vi),gi=n("qZ6Q"),yi=n.n(gi),wi=n("+oBr"),Oi=n("9JXw"),ki=N.default.div(ui||(ui=I()(["\n  display: flex;\n  align-items: center;\n  margin-right: 4px;\n"]))),xi=function(e){var t=e.editorState,n=e.mediaLinkingState,r=e.intl,i=e.showSeparatorLeft,a=e.onAddLink,o=e.onEditLink,s=e.onOpenLink,u=Object(c.useState)(!1),d=mi()(u,2),p=d[0],f=d[1];if(Object(c.useEffect)((function(){var e;f(!1);var n=Vt(t);if(n){var r=null===(e=Y.a.getState(t))||void 0===e?void 0:e.mediaClientConfig;r&&qt(n,r).then((function(e){"external"!==e&&"image"!==e||f(!0)}))}}),[t]),!p)return null;if(n&&n.editable){var h=Object(wi.a)(n.link),m=r.formatMessage(cr.b.editLink),v=r.formatMessage(h?Oi.a.openLink:cr.b.unableToOpenLink);return l.a.createElement(l.a.Fragment,null,i&&l.a.createElement(ki,null,l.a.createElement(fr.a,null)),l.a.createElement(ki,null,l.a.createElement(pr.a,{onClick:o,title:m,tooltipContent:l.a.createElement(gt.ToolTipContent,{description:m,keymap:gt.addLink})},m)),l.a.createElement(ki,null,l.a.createElement(fr.a,null)),l.a.createElement(pr.a,{target:"_blank",href:h?n.link:void 0,disabled:!h,onClick:s,title:v,icon:l.a.createElement(yi.a,{label:v}),className:"hyperlink-open-link"}))}var b=r.formatMessage(cr.b.addLink);return l.a.createElement(l.a.Fragment,null,i&&l.a.createElement(ki,null,l.a.createElement(fr.a,null)),l.a.createElement(pr.a,{testId:"add-link-button",onClick:a,title:b,tooltipContent:l.a.createElement(gt.ToolTipContent,{description:b,keymap:gt.addLink}),icon:l.a.createElement(bi.a,{label:b})}))};function ji(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Ei(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ji(Object(n),!0).forEach((function(t){s()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ji(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Pi=function(e,t){return t&&t(Object(_.removeSelectedNode)(e.tr)),!0},Ci=n("9XXW"),Si=n("0cE9");function _i(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=G()(e);if(t){var i=G()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return q()(this,n)}}var Mi=function(e){V()(n,e);var t=_i(n);function n(){var e;v()(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return e=t.call.apply(t,[this].concat(i)),s()(F()(e),"onUploadStart",(function(t,n){var r=e.props.view,i=r.state,a=r.dispatch;at(t,n)(i,a)})),s()(F()(e),"onClose",(function(){var t=e.props.view,n=t.state,r=t.dispatch;it()(n,r)})),e}return g()(n,[{key:"render",value:function(){var e=this.props.mediaEditorState,t=e.editor,n=e.mediaClientConfig;if(!t||!n)return null;var r=t.identifier;return l.a.createElement(Si.a,{identifier:r,mediaClientConfig:n,onUploadStart:this.onUploadStart,onClose:this.onClose})}}]),n}(l.a.PureComponent);function Di(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=G()(e);if(t){var i=G()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return q()(this,n)}}s()(Mi,"displayName","MediaEditor");var Ii={on:function(){},removeAllListeners:function(){},emit:function(){},destroy:function(){},setUploadParams:function(){}},Ni=function(e){V()(n,e);var t=Di(n);function n(){var e;v()(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return e=t.call.apply(t,[this].concat(i)),s()(F()(e),"state",{}),s()(F()(e),"handleMediaProvider",function(){var t=h()(w.a.mark((function t(n,r){var i,a,o,s,c,l,u,d;return w.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i=e.props,a=i.mediaState,o=i.analyticsName,t.next=3,r;case 3:if((s=t.sent)&&s.uploadParams){t.next=6;break}return t.abrupt("return");case 6:return t.next=8,s.uploadMediaClientConfig;case 8:if(t.t0=t.sent,t.t0){t.next=13;break}return t.next=12,s.viewMediaClientConfig;case 12:t.t0=t.sent;case 13:if(c=t.t0){t.next=16;break}return t.abrupt("return");case 16:return l={mediaClientConfig:c,errorReporter:a.options.errorReporter||new P.a,featureFlags:a.mediaOptions&&a.mediaOptions.featureFlags},t.next=19,new Fe("customMediaPicker",l,Ii,Ue.d,o).init();case 19:(u=t.sent).onNewMedia(a.insertFile),u.setUploadParams(s.uploadParams),d={uploadParams:s.uploadParams},e.setState({pickerFacadeInstance:u,config:d,mediaClientConfig:c});case 24:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}()),e}return g()(n,[{key:"componentDidMount",value:function(){this.props.mediaState.options.providerFactory.subscribe("mediaProvider",this.handleMediaProvider)}},{key:"componentWillUnmount",value:function(){this.props.mediaState.options.providerFactory.unsubscribe("mediaProvider",this.handleMediaProvider)}},{key:"render",value:function(){var e=this.state,t=e.mediaClientConfig,n=e.config,r=e.pickerFacadeInstance;return t&&n&&r?this.props.children({mediaClientConfig:t,config:n,pickerFacadeInstance:r}):null}}]),n}(l.a.Component),Ti=function(e){var t=e.mediaState,n=e.featureFlags;return l.a.createElement(Ni,{mediaState:t,analyticsName:"clipboard"},(function(e){var t=e.mediaClientConfig,r=e.config,i=e.pickerFacadeInstance;return l.a.createElement(Ue.b,{mediaClientConfig:t,config:r,onError:i.handleUploadError,onPreviewUpdate:i.handleUploadPreviewUpdate,onEnd:i.handleReady,featureFlags:n})}))};function Ai(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Li(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ai(Object(n),!0).forEach((function(t){s()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ai(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Ri=function(e){var t=e.mediaState,n=e.isActive,r=e.featureFlags;return l.a.createElement(Ni,{mediaState:t,analyticsName:"dropzone"},(function(e){var i=e.mediaClientConfig,a=e.config,o=e.pickerFacadeInstance,s=t.options.customDropzoneContainer,c=t.handleDrag,u=Li(Li({},a),{},{container:s});return n?l.a.createElement(Ue.c,{mediaClientConfig:i,config:u,onError:o.handleUploadError,onPreviewUpdate:o.handleUploadPreviewUpdate,onEnd:o.handleReady,onDragEnter:function(){return c("enter")},onDragLeave:function(){return c("leave")},featureFlags:r}):null}))},zi=function(e){var t=e.mediaState,n=e.isOpen,r=e.onBrowseFn,i=e.featureFlags;return l.a.createElement(Ni,{mediaState:t,analyticsName:"browser"},(function(e){var t=e.mediaClientConfig,a=e.config,o=e.pickerFacadeInstance;return l.a.createElement(Ue.a,{onBrowseFn:r,isOpen:n,config:a,mediaClientConfig:t,onEnd:o.handleReady,onError:o.handleUploadError,onPreviewUpdate:o.handleUploadPreviewUpdate,featureFlags:i})}))};function Ui(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=G()(e);if(t){var i=G()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return q()(this,n)}}var Fi=function(e){V()(n,e);var t=Ui(n);function n(){var e;v()(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return e=t.call.apply(t,[this].concat(i)),s()(F()(e),"state",{isPopupOpened:!1}),s()(F()(e),"onBrowseFn",(function(t){var n=e.props.mediaState;n&&n.setBrowseFn(t)})),e}return g()(n,[{key:"componentDidMount",value:function(){var e=this;this.props.mediaState.onPopupToggle((function(t){e.setState({isPopupOpened:t})}))}},{key:"render",value:function(){var e=this.props.mediaState,t=this.state.isPopupOpened,n=e.mediaOptions&&e.mediaOptions.featureFlags;return l.a.createElement(l.a.Fragment,null,l.a.createElement(Ti,{mediaState:e,featureFlags:n}),l.a.createElement(Ri,{mediaState:e,isActive:!t,featureFlags:n}),!e.shouldUseMediaPickerPopup()&&l.a.createElement(zi,{onBrowseFn:this.onBrowseFn,mediaState:e,featureFlags:n}))}}]),n}(l.a.Component);s()(Fi,"displayName","MediaPickerComponents");var Bi=n("8unR");function Vi(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=G()(e);if(t){var i=G()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return q()(this,n)}}var Wi=function(e){V()(n,e);var t=Vi(n);function n(){var e;v()(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return e=t.call.apply(t,[this].concat(i)),s()(F()(e),"renderMediaNodeWithState",(function(t,n,r){return function(i){var a=i.width,o=e.getPos,s=e.reactComponentProps.mediaOptions,c=e.view.state.selection,u=e.getAttrs(),d=u.width,p=u.height;d=d||wn.b,p=p||wn.a;var f={width:"".concat(a.width,"px"),height:"".concat(p/d*a.width,"px")},h={width:d,height:p};return l.a.createElement(de,{view:e.view,node:e.node,getPos:o,selected:e.isNodeInsideSelection(c.from,c.to)||c instanceof x.NodeSelection&&c.from===o(),originalDimensions:h,maxDimensions:f,mediaProvider:t,contextIdentifierProvider:n,uploadComplete:e.uploadComplete(),mediaOptions:s,collabEditProvider:r})}})),s()(F()(e),"renderMediaNodeWithProviders",(function(t){var n=t.mediaProvider,r=t.contextIdentifierProvider,i=t.collabEditProvider;return l.a.createElement(ln.a,{editorView:e.view,plugins:{width:An.b},render:e.renderMediaNodeWithState(n,r,i)})})),e}return g()(n,[{key:"createDomRef",value:function(){var e=document.createElement("div");return Tn.a.chrome&&this.reactComponentProps.mediaOptions&&this.reactComponentProps.mediaOptions.allowMediaSingleEditable&&(e.contentEditable="true"),e}},{key:"viewShouldUpdate",value:function(e){return this.node.attrs!==e.attrs||Dn()(G()(n.prototype),"viewShouldUpdate",this).call(this,e)}},{key:"stopEvent",value:function(e){if(-1!==["mousedown","contextmenu"].indexOf(e.type)&&2===e.button)return!0;return!1}},{key:"getAttrs",value:function(){return this.node.attrs}},{key:"uploadComplete",value:function(){return Ae(Y.a.getState(this.view.state),this.node.attrs.id)}},{key:"render",value:function(){var e=this.reactComponentProps.providerFactory;return l.a.createElement(dn.a,{providers:["mediaProvider","contextIdentifierProvider","collabEditProvider"],providerFactory:e,renderNode:this.renderMediaNodeWithProviders})}}]),n}(n("Dol8").a),qi=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return function(i,a,o){return new Wi(i,a,o,e,t,{eventDispatcher:t,providerFactory:n,mediaOptions:r}).init()}},Hi={allowResizing:!0,allowAdvancedToolBarOptions:!0,allowResizingInTables:!1,allowAnnotation:!0,UNSAFE_allowImageCaptions:!0};function Gi(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Ki(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Gi(Object(n),!0).forEach((function(t){s()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Gi(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Qi=function(e){return{name:"media",nodes:function(){var t=e||{},n=t.allowMediaGroup,r=void 0===n||n,i=t.allowMediaSingle,a=void 0!==i&&i,o=t.UNSAFE_allowImageCaptions,s=void 0!==o&&o?u.b:u.a;return[{name:"mediaGroup",node:d.a},{name:"mediaSingle",node:s},{name:"media",node:p.b}].filter((function(e){return"mediaGroup"===e.name?r:"mediaSingle"!==e.name||a}))},pmPlugins:function(){var t=[{name:"media",plugin:function(t){t.schema;var n=t.dispatch,r=t.eventDispatcher,i=t.providerFactory,a=t.errorReporter,o=t.portalProviderAPI,s=t.reactContext,c=t.dispatchAnalyticsEvent;return Ke(0,{providerFactory:i,nodeViews:{mediaGroup:_n(o,r,i,e),mediaSingle:rr(o,r,i,c,e),media:qi(o,r,i,e)},errorReporter:a,uploadErrorHandler:e&&e.uploadErrorHandler,waitForMediaUpload:e&&e.waitForMediaUpload,customDropzoneContainer:e&&e.customDropzoneContainer,customMediaPicker:e&&e.customMediaPicker,allowResizing:!(!e||!e.allowResizing)},s,n,e)}},{name:"mediaKeymap",plugin:function(){return an()}}];return e&&e.allowMediaSingle&&t.push({name:"mediaSingleKeymap",plugin:function(e){return function(e){var t={},n=Mt(e);return gt.bindKeymapWithCommand(gt.backspace.common,n,t),Object(bt.b)(t)}(e.schema)}}),e&&e.allowAnnotation&&t.push({name:"mediaEditor",plugin:st}),e&&e.allowAltTextOnImages&&(t.push({name:"mediaAltText",plugin:vt}),t.push({name:"mediaAltTextKeymap",plugin:function(e){var t;e.schema;return t={},gt.bindKeymapWithCommand(gt.addAltText.common,Et,t),gt.bindKeymapWithCommand(gt.escape.common,jt,t),Object(bt.b)(t)}})),e&&e.allowLinking&&(t.push({name:"mediaLinking",plugin:function(e){return function(e){return new x.Plugin({key:At,state:Rt.createPluginState(e,Lt)})}(e.dispatch)}}),t.push({name:"mediaLinkingKeymap",plugin:function(e){var t;e.schema;return t={},gt.bindKeymapWithCommand(gt.addLink.common,Qt,t),Object(bt.b)(t)}})),t},contentComponent:function(t){var n=t.editorView,r=t.eventDispatcher,i=e&&e.allowAnnotation?l.a.createElement(ln.a,{editorView:n,plugins:{mediaEditorState:$e},eventDispatcher:r,render:function(e){var t=e.mediaEditorState;return l.a.createElement(Mi,{mediaEditorState:t,view:n})}}):null;return l.a.createElement(l.a.Fragment,null,l.a.createElement(ln.a,{editorView:n,plugins:{mediaState:Y.a},render:function(e){var t=e.mediaState;return l.a.createElement(Fi,{mediaState:t})}}),i)},secondaryToolbarComponent:function(e){var t=e.editorView,n=e.eventDispatcher,r=e.disabled;return l.a.createElement(un,{editorView:t,eventDispatcher:n,pluginKey:Y.a,isDisabled:r,isReducedSpacing:!0})},pluginsOptions:{quickInsert:function(e){var t=e.formatMessage;return[{id:"media",title:t(Bi.a.filesAndImages),description:t(Bi.a.filesAndImagesDescription),priority:400,keywords:["attachment","gif","media","picture"],icon:function(){return l.a.createElement(Ci.j,{label:t(Bi.a.filesAndImages)})},action:function(e,t){Y.a.getState(t).showMediaPicker();var n=e("");return Object(ke.a)(t,n,{action:Oe.a.OPENED,actionSubject:Oe.b.PICKER,actionSubjectId:Oe.c.PICKER_CLOUD,attributes:{inputMethod:Oe.e.QUICK_INSERT},eventType:Oe.d.UI})}}]},floatingToolbar:function(t,n,r){return function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=n.providerFactory,i=n.allowResizing,a=n.allowAnnotation,o=n.allowLinking,s=n.allowAdvancedToolBarOptions,c=n.allowResizingInTables,u=n.allowAltTextOnImages,d=n.altTextValidator,p=e.schema.nodes.mediaSingle,f=Y.a.getState(e),h=Ut(e);if(p&&f){var m={title:"Media floating controls",nodeType:p,getDomRef:function(){return f.element}};if(o&&h&&h.visible&&Rr(e)){var v=qr(m,h,e,t,r);if(v)return v}var b=[];if(s){if((b=Object(Hr.a)(e,t,e.schema.nodes.mediaSingle,i,c)).length&&a&&b.push({type:"custom",render:Or(f,t)}),o&&Rr(e)){var g=b.length>0;b.push({type:"custom",render:function(e,n){if(null!=e&&e.state){var r=function(){if(e){var t=e.state,n=e.dispatch;Kt(t,n)}};return l.a.createElement(xi,{key:n,editorState:e.state,intl:t,mediaLinkingState:h,onAddLink:r,onEditLink:r,onOpenLink:function(){if(e){var t=e.state;return(0,e.dispatch)(Object(ke.a)(t,t.tr,{eventType:Oe.d.TRACK,action:Oe.a.VISITED,actionSubject:Oe.b.MEDIA,actionSubjectId:Oe.c.LINK})),!0}},showSeparatorLeft:g})}return null}})}b.length&&b.push({type:"separator"})}if(u){var y=mt(e);if(y.isAltTextEditorOpen)return fi(m,{altTextValidator:d});b.push(di(t,e),{type:"separator"})}var w=[].concat(ar()(b),[{type:"button",appearance:"danger",icon:sr.a,onMouseEnter:Object(lr.b)(p,!0),onMouseLeave:Object(lr.b)(p,!1),title:t.formatMessage(cr.a.remove),onClick:Pi,testId:"media-toolbar-remove-button"}]);return Ei(Ei({},m),{},{items:w})}}(t,n,{providerFactory:r,allowResizing:e&&e.allowResizing,allowResizingInTables:e&&e.allowResizingInTables,allowAnnotation:e&&e.allowAnnotation,allowLinking:e&&e.allowLinking,allowAdvancedToolBarOptions:e&&e.allowAdvancedToolBarOptions,allowAltTextOnImages:e&&e.allowAltTextOnImages,altTextValidator:e&&e.altTextValidator})}}}};t.a=function(e){return Qi(Ki(Ki({},e),Hi))}},ct2w:function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var r=function(e){return!!e&&(e.indexOf("image/")>-1||e.indexOf("video/")>-1)}},eUFy:function(e,t,n){var r={"./atlassian_missing_french":"xyGe","./atlassian_missing_french.json":"xyGe","./en":"2maa","./en.json":"2maa","./fr":"Hsuv","./fr.json":"Hsuv"};function i(e){var t=a(e);return n(t)}function a(e){if(!n.o(r,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return r[e]}i.keys=function(){return Object.keys(r)},i.resolve=a,e.exports=i,i.id="eUFy"},hhV5:function(e,t,n){e.exports={"sharing-button":"sharing-button--nzFli"}},jXUu:function(e,t,n){"use strict";var r=n("GeFe"),i=n.n(r),a=n("Zvb3"),o=n.n(a),s=n("J/YY"),c=n.n(s),l=n("a1Fv"),u=n.n(l),d=n("g3eI"),p=n.n(d),f=n("wDGE"),h=n.n(f),m=n("J58c"),v=n.n(m),b=n("ivGQ"),g=n.n(b),y=n("dKM3"),w=n("zy2m"),O=n("G09D");function k(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=h()(e);if(t){var i=h()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return p()(this,n)}}var x=function(e){u()(n,e);var t=k(n);function n(e){var r;return i()(this,n),r=t.call(this,e),v()(c()(r),"handleRef",(function(e){r.setState({target:e||void 0})})),v()(c()(r),"updatePopupPlacement",(function(e){r.setState({popupPlacement:e})})),r.state={popupPlacement:["bottom","left"]},r}return o()(n,[{key:"renderDropdown",value:function(){var e=this.state.target,t=this.props,n=t.children,r=t.mountTo,i=t.boundariesElement,a=t.scrollableElement,o=t.onOpenChange,s=t.fitHeight,c=t.fitWidth,l=t.zIndex;return g.a.createElement(w.a,{target:e,mountTo:r,boundariesElement:i,scrollableElement:a,onPlacementChanged:this.updatePopupPlacement,fitHeight:s,fitWidth:c,zIndex:l},g.a.createElement("div",{style:{height:0,minWidth:c||0}},g.a.createElement(y.a,{disabled:!0,isOpen:!0,onOpenChange:o,appearance:"tall",position:"top left",shouldFlip:!1,shouldFitContainer:!0},n)))}},{key:"render",value:function(){var e=this.props,t=e.trigger,n=e.isOpen;return g.a.createElement(g.a.Fragment,null,g.a.createElement("div",{ref:this.handleRef},t),n?this.renderDropdown():null)}}]),n}(b.PureComponent),j=Object(O.a)(x);t.a=j},k359:function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var r=new(n("4z1N").PluginKey)("mediaPlugin")},nXPL:function(e,t,n){"use strict";n.r(t),n.d(t,"initApp",(function(){return U}));var r=n("J58c"),i=n.n(r),a=(n("QLHQ"),n("k37E"),n("oULE"),n("AdhS"),n("ivGQ")),o=n.n(a),s=n("Y/FK"),c=n.n(s),l=n("qwOa"),u=n("euuj"),d=n.n(u),p=n("0Lot"),f=n("BqmN"),h=n("bvF7"),m=n("+2kq"),v=n("cyLt"),b=n("f2KQ"),g=n("QJcL"),y=n("mZuE"),w=n("5LIP"),O=n("xEu0"),k=n.n(O),x=n("+s1f"),j=n("Aaol"),E=n("xzHV"),P=n("I6L4"),C=n("HROS"),S=n("q5Wy"),_=n("v2Ur"),M=n("8ZpT"),D=n.n(M),I=n("4vUV");function N(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function T(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?N(Object(n),!0).forEach((function(t){i()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):N(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var A=n("5z4W"),L=n("xyGe"),R={en:{react:n("WNgr"),atlaskit:h.a},fr:{react:n("5mip"),atlaskit:T(T({},m.a),L)}},z=Object(p.a)({disableGlobal:!0}),U=function(){var e=Object(_.b)(),t=Object(_.a)(e.app.slug,A.slug),n=Object(_.a)(e.app.version,A.version);Object(l.d)(R.en.react),Object(l.d)(R.fr.react);var r=Object(_.a)(e.locale,"en"),i=["en","fr"].includes(r)?r:"en",a=window.location?window.location.protocol:"https:",s=Object(_.c)(),u=e.token,d=Boolean(s),p=new k.a({uri:"".concat(a,"//").concat(e.domain),token:u,store:!0,appMetadata:{slug:t,version:n}});return E.Document.cozyClient||E.Document.registerClient(p),p.registerPlugin(x.RealtimePlugin),p.registerPlugin(D.a.plugin),d||(window.React=o.a,window.ReactDOM=c.a,b.a({dsn:"https://16c26a60d9019eea9d9a9775573e3765@errors.cozycloud.cc/73",environment:"production",release:A.version,integrations:[new v.a({levels:["error"]}),g.a({useEffect:o.a.useEffect,useLocation:y.g,useNavigationType:y.i,createRoutesFromChildren:y.d,matchRoutes:y.e})],tracesSampleRate:.1,ignoreErrors:[/^Warning: /],defaultIntegrations:!1})),{appLocale:i,client:p,isPublic:d}},F=d()(U);document.addEventListener("DOMContentLoaded",(function(){var e=F();!function(e,t,r){var i=n("Q6Vf").default;Object(s.render)(o.a.createElement(C.WebviewIntentProvider,null,o.a.createElement(j.default,{lang:e,dictRequire:function(e){return n("eUFy")("./".concat(e))}},o.a.createElement(f.b,{generateClassName:z},o.a.createElement(l.c,{locale:e,messages:R[e].atlaskit},o.a.createElement(O.CozyProvider,{client:t},o.a.createElement(w.default,null,o.a.createElement(S.a.Provider,{value:r},!r&&o.a.createElement(P.a,{doctype:"io.cozy.files",documentType:"Notes",previewPath:I.h},o.a.createElement(i,{isPublic:r})),r&&o.a.createElement(i,{isPublic:r})))))))),document.querySelector("[role=application]"))}(e.appLocale,e.client,e.isPublic)}))},o9PO:function(e,t,n){e.exports={banner:"banner--MWCHK",grid:"grid--1HNmF",chip:"chip--3hU4-"}},q5Wy:function(e,t,n){"use strict";var r=n("ivGQ"),i=n.n(r).a.createContext(!1);t.a=i},uU7o:function(e,t,n){"use strict";n.d(t,"a",(function(){return r})),n.d(t,"b",(function(){return i}));var r=function(e){return null!==e&&"string"!=typeof e&&e},i=function(e){var t;return(null===(t=/(.+)(\/.+)$/.exec(e))||void 0===t?void 0:t[1])||e}},upXl:function(e,t,n){e.exports={"note-article":"note-article--2yQdC","note-article--intents":"note-article--intents--ghgU0",banner:"banner--1nSEd",title:"title--2DQ8I",titleInput:"titleInput--2ERlh"}},"v/Qj":function(e,t,n){"use strict";var r=n("ivGQ"),i=n("q5Wy"),a=n("bOB9"),o=n("xEu0");t.a=function(){var e=Object(o.useClient)(),t=Object(r.useContext)(i.a),n=Object(r.useMemo)((function(){return Object(a.k)()||(t?"?":Object(a.j)(e))}),[e,t]);return{userId:n,userName:n}}},v2Ur:function(e,t,n){"use strict";n.d(t,"b",(function(){return r})),n.d(t,"a",(function(){return i})),n.d(t,"c",(function(){return a}));n("wlqn");var r=function(){var e=document.querySelector("[role=application]");return JSON.parse(e.dataset.cozy)},i=function(e,t){return/^\{\{\.[a-zA-Z]*\}\}$/.test(e)?t:e},a=function(){return new URLSearchParams(window.location.search).get("sharecode")}},xyGe:function(e){e.exports=JSON.parse('{"fabric.editor.editMode.inviteToEditButton.title":"Inviter à éditer","fabric.editor.blockquote2":"Citation","fabric.editor.remove":"Supprimer","fabric.editor.linkPlaceholder":"Coller le lien","fabric.editor.linkAddress":"Adresse du lien","fabric.editor.layoutWide":"Élargir","fabric.editor.layoutFullWidth":"Pleine largeur","fabric.editor.layoutFixedWidth":"Retour au centre","fabric.editor.alignImageLeft":"Aligner l\'image à gauche","fabric.editor.alignImageCenter":"Centrer l\'image","fabric.editor.alignImageRight":"Aligner l\'image à droite","fabric.editor.numberedColumn":"Lignes numérotées","fabric.editor.taskPlaceholder":"Saisissez votre action"}')}});