!function(e){function t(t){for(var r,o,s=t[0],c=t[1],u=t[2],d=0,p=[];d<s.length;d++)o=s[d],Object.prototype.hasOwnProperty.call(i,o)&&i[o]&&p.push(i[o][0]),i[o]=0;for(r in c)Object.prototype.hasOwnProperty.call(c,r)&&(e[r]=c[r]);for(l&&l(t);p.length;)p.shift()();return a.push.apply(a,u||[]),n()}function n(){for(var e,t=0;t<a.length;t++){for(var n=a[t],r=!0,s=1;s<n.length;s++){var c=n[s];0!==i[c]&&(r=!1)}r&&(a.splice(t--,1),e=o(o.s=n[0]))}return e}var r={},i={5:0},a=[];function o(t){if(r[t])return r[t].exports;var n=r[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,o),n.l=!0,n.exports}o.e=function(e){var t=[],n=i[e];if(0!==n)if(n)t.push(n[2]);else{var r=new Promise((function(t,r){n=i[e]=[t,r]}));t.push(n[2]=r);var a,s=document.createElement("script");s.charset="utf-8",s.timeout=120,o.nc&&s.setAttribute("nonce",o.nc),s.src=function(e){return o.p+"vendors/"+({2:"@atlaskit-internal-editor-core-config-panel",3:"@atlaskit-internal_media-card"}[e]||e)+"."+{2:"bcd61036dc4dca7d337a",3:"848ba7058fc0419c657a"}[e]+".js"}(e);var c=new Error;a=function(t){s.onerror=s.onload=null,clearTimeout(u);var n=i[e];if(0!==n){if(n){var r=t&&("load"===t.type?"missing":t.type),a=t&&t.target&&t.target.src;c.message="Loading chunk "+e+" failed.\n("+r+": "+a+")",c.name="ChunkLoadError",c.type=r,c.request=a,n[1](c)}i[e]=void 0}};var u=setTimeout((function(){a({type:"timeout",target:s})}),12e4);s.onerror=s.onload=a,document.head.appendChild(s)}return Promise.all(t)},o.m=e,o.c=r,o.d=function(e,t,n){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)o.d(n,r,function(t){return e[t]}.bind(null,r));return n},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="",o.oe=function(e){throw console.error(e),e};var s=window.webpackJsonp=window.webpackJsonp||[],c=s.push.bind(s);s.push=t,s=s.slice();for(var u=0;u<s.length;u++)t(s[u]);var l=c;a.push([5,0,1]),n()}({0:function(e,t){},1:function(e,t){},2:function(e,t){},"2maa":function(e){e.exports=JSON.parse('{"Notes":{"Add":{"add_note":"Add a note"},"Delete":{"delete_note":"Delete","deleted":"The note has been moved to the trash of your Drive","failed":"The note could not be deleted, please try again"},"EditorView":{"main_placeholder":"Write anything…"},"Editor":{"title_placeholder":"Write your title","exit_confirmation_message":"Automatic saving has not taken into account the latest changes in your doc. Please stay on your current note if you want to keep them.","exit_confirmation_title":"Abandon your changes?","exit_confirmation_leave":"Leave without saving","exit_confirmation_cancel":"Cancel","read_only":"This note is in read-only mode."},"Files":{"share":{"cta":"Share"}},"List":{"latest_notes":"Latest Notes","name":"Name","updated_at":"Updated at","location":"Location","sharings":"Sharings","at":"%{date} at %{time}"},"Empty":{"welcome":"Welcome on Twake Notes","after_created":"Once your Note is created, you can find it in your "},"SavingIndicator":{"saved":{"default":"Up to date","just_now":"Up to date","secs_ago":"Up to date (saved %{time} sec. ago)","min_ago":"Up to date (saved %{time} min. ago)","mins_ago":"Up to date (saved %{time} min. ago)","hour_ago":"Up to date (saved %{time} hour ago)","hours_ago":"Up to date (saved %{time} hours ago)","day_ago":"Up to date (saved %{time} day ago)","days_ago":"Up to date (saved %{time} days ago)","month_ago":"Up to date (saved %{time} month ago)","monthes_ago":"Up to date (saved %{time} monthes ago)","year_ago":"Up to date (saved %{time} year ago)","years_ago":"Up to date (saved %{time} years ago)"},"saving":"Saving...","still_saving":"Saving......","out_of_sync":{"default":"Saved (off-line)","just_now":"Saved (off-line)","secs_ago":"Saved (off-line for %{time} sec)","min_ago":"Saved (off-line for %{time} min)","mins_ago":"Saved (off-line for %{time} min)","hour_ago":"Saved (off-line for %{time} hour)","hours_ago":"Saved (off-line for %{time} hours)","day_ago":"Saved (off-line for %{time} day)","days_ago":"Saved (off-line for %{time} days)","month_ago":"Saved (off-line for %{time} month)","monthes_ago":"Saved (off-line for %{time} monthes)","year_ago":"Saved (off-line for %{time} year)","years_ago":"Saved (off-line for %{time} years)"},"saving_impossible":{"default":"Changes unsaved (off-line)","just_now":"Changes unsaved (off-line)","secs_ago":"Changes unsaved (off-line for %{time} sec)","min_ago":"Changes unsaved (off-line for %{time} min)","mins_ago":"Changes unsaved (off-line for %{time} min)","hour_ago":"Changes unsaved (off-line for %{time} hour)","hours_ago":"Changes unsaved (off-line for %{time} hours)","day_ago":"Changes unsaved (off-line for %{time} day)","days_ago":"Changes unsaved (off-line for %{time} days)","month_ago":"Changes unsaved (off-line for %{time} month)","monthes_ago":"Changes unsaved (off-line for %{time} monthes)","year_ago":"Changes unsaved (off-line for %{time} year)","years_ago":"Changes unsaved (off-line for %{time} years)"}},"OfflineIndicator":{"message":"You\'re not connected to internet anymore. Your changes will be saved once you will be connected again."}},"Error":{"422":"Only images are accepted","unshared_title":"This share is no longer active","unshared_text":"The owner may have revoked this sharing. You can no longer edit a note at this address.","loading_error_title":"The note couldn\'t be loaded","loading_error_text_noReturnUrl":"The note may not exists anymore, or our servers may have a temporary glitch. Please try again later.","back":"back","unknown_error":"An unexpected error occured","only_one_image":"You cannot drag and drop multiple pictures at the same time"},"manifest":{"short_description":"Twake Notes is your personal and collaborative note-taking application.","long_description":"Notes is an online text editor that can already offer you to:\\n\\n* Create your own notes with the essential features (bold, underlined, links, tables...)\\n* Fill and find your notes with you other documents in files of your personal Drive\\n* Edit easily your notes from all your devices\\n* Access your notes offline\\n* For the fans, use shortcuts and input in markdown format ... and even write with contacts together on the same note (coming soon)!","screenshots":["screenshots/en/screenshot01.png","screenshots/en/screenshot02.png"]},"Intents":{"save":"Save"},"TrashedBanner":{"text":"The item has been trashed","redirect":"Open the trash","restore":"Restore","restoreSuccess":"The item has been restored","restoreError":"An error has occurred, please try again.","destroy":"Delete permanently"},"DestroyConfirm":{"title":"Permanently delete?","forbidden":"You won\'t be able to access this file anymore.","restore":"You won\'t be able to restore this file if you didn\'t make a backup.","cancel":"Cancel","delete":"Delete permanently","deleteError":"An error has occurred, please try again."},"MoreButton":{"more":"More"}}')},3:function(e,t){},"3xVv":function(e,t,n){"use strict";n.d(t,"d",(function(){return C})),n.d(t,"b",(function(){return E})),n.d(t,"c",(function(){return j})),n.d(t,"e",(function(){return M})),n.d(t,"a",(function(){return _}));var r=n("J58c"),i=n.n(r),a=n("iO45"),o=n("9Jaj"),s=n("laKe"),c=n("bHTr"),u=n("WISH"),l=n("3mYb"),d=n("PuAp"),p=n("CDNI"),f=n("I/PM"),h=n("AV8T"),m=n("3sCF"),v=n("Eh77"),g=n("OZn/"),y=n("ct2w"),b=n("3Su3");function w(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function O(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?w(Object(n),!0).forEach((function(t){i()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):w(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var k=function(e,t){return{action:h.a.INSERTED,actionSubject:h.b.DOCUMENT,actionSubjectId:h.c.MEDIA,attributes:{inputMethod:e,fileExtension:t,type:h.c.MEDIA_SINGLE},eventType:h.d.TRACK}};function P(e){return Object(b.a)(e)&&!Object(l.d)(e.selection,e.doc,d.g)}function x(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return function(n,r){var i=n.tr,o=n.schema.nodes.paragraph,s=t.inputMethod,c=t.fileExtension,u=0;return P(n)&&(e.push(o.create()),u=1),i.replaceSelection(new a.Slice(a.Fragment.from(e),0,u)),s&&Object(m.a)(n,i,k(s,c)),r&&r(i),!0}}var C=function(e,t){return!!e.nodes.mediaSingle&&Object(y.a)(t)},E=function(e,t,n){var r=e.state,i=e.dispatch,a=r.schema.nodes,o=a.mediaSingle,s=a.media;return!!o&&(!(t.type!==s||!Object(y.a)(t.attrs.__fileMimeType)&&"external"!==t.attrs.type)&&x([o.create({},t)],{inputMethod:n,fileExtension:t.attrs.__fileMimeType})(r,i))},j=function(e,t,n,r,i){if(void 0===r)return!1;var s,c=e.state,u=e.dispatch,l=c.selection.$from.node(-1),d=S(c.schema,r,i)(t),p=l&&l.type.validContent(a.Fragment.from(d));if(t.fileName){var f=t.fileName.lastIndexOf(".");s=f>=0?t.fileName.substring(f+1):void 0}if(p)x([d],{fileExtension:s,inputMethod:n})(c,u);else{var h=null;if(Object(g.b)(e.state).newInsertionBehaviour&&(h=Object(v.b)(d,c.selection.from)(c.tr)),!h){var y=P(e.state)?a.Fragment.fromArray([d,c.schema.nodes.paragraph.create()]):d;h=Object(o.safeInsert)(y,void 0,!0)(c.tr)}n&&(h=Object(m.a)(c,h,k(n,s))),u(h)}return!0},S=function(e,t,n){return function(r){var i=r.id,a=r.dimensions,o=r.contextId,s=r.scaleFactor,c=void 0===s?1:s,u=a||{height:void 0,width:void 0},l=u.width,d=u.height,f=e.nodes,h=f.media,m=f.mediaSingle,v=h.create({id:i,type:"file",collection:t,contextId:o,width:l&&Math.round(l/c),height:d&&Math.round(d/c)}),g=n?{layout:"align-start"}:{};return Object(p.a)(r,v),m.createChecked(g,v)}};function M(e,t){var n=t.nodes,r=n.mediaSingle,i=n.layoutSection,a=n.table,s=n.bulletList,c=n.orderedList,u=n.media,l=n.expand;return function(t){var n=e;return Object(o.hasParentNodeOfType)([i,a,s,c,l])(t)&&(n=Object(f.e)(n,(function(e){return"mediaSingle"===e.type.name?r.createChecked({},e.content,e.marks):e}))),n=Object(f.e)(n,(function(e){return"media"===e.type.name&&"external"===e.attrs.type?u.createChecked(O(O({},e.attrs),{},{__external:!0}),e.content,e.marks):e}))}}var _=function(e){var t=e.origWidth,n=e.origHeight,r=e.layout,i=e.pctWidth,a=e.containerWidth,o=e.resizedPctWidth,c=a.width,l=a.lineLength,d=D(a,i,t,n),p=D(a,o,t,n);if("wide"===r){if(l){var f=Math.ceil(l*u.Z);return f>c?l:f}}else{if("full-width"===r)return c-u.d;if(d)return s.e.indexOf(r)>-1?p?o<50?p:d:Math.max(d,t):p||d;if("center"===r)return p||Math.min(t,l||c);if(r&&-1!==s.e.indexOf(r)){var h=Math.ceil((l||c)/2);return t<=h?t:h}}return t},D=function(e,t,n,r){return t&&n&&r&&Math.ceil(Object(c.d)(t/100,e.lineLength||e.width))}},4:function(e,t){},"4vUV":function(e,t,n){"use strict";var r,i,a,o,s,c,u;n.d(t,"d",(function(){return r})),n.d(t,"c",(function(){return i})),n.d(t,"f",(function(){return a})),n.d(t,"e",(function(){return o})),n.d(t,"g",(function(){return s})),n.d(t,"a",(function(){return c})),n.d(t,"i",(function(){return u})),n.d(t,"h",(function(){return d})),n.d(t,"b",(function(){return l})),function(e){e.NoFileFoundAfterInput="No File was detected during the upload procedure.",e.FileNotProcessable="Could not process the uploaded image.",e.CouldNotFindFileInCurrentNote="Could not find file in current note.",e.MissingCollabEdit="`CollabEditProvider` was `undefined` in `fetchCozyImage`. <Media> was unable to fetch the image source. The component might be unmounted.",e.CouldNotGetNoteImages="MediaNode failed to fetch included files in the current note",e.CouldNotCopyImage="Could not copy image from another note"}(r||(r={})),function(e){e.Input="input"}(i||(i={})),function(e){e.File="file"}(a||(a={})),function(e){e.Click="click",e.Change="change",e.Drop="drop",e.Paste="paste"}(o||(o={})),function(e){e.Created="CREATED",e.Updated="UPDATED"}(s||(s={})),function(e){e.Files="io.cozy.files",e.NoteEvents="io.cozy.notes.events",e.Thumbnails="io.cozy.files.thumbnails"}(c||(c={})),function(e){e.Drive="drive",e.Home="home",e.Notes="notes"}(u||(u={}));var l,d="/preview/";!function(e){e.Files="Files",e.Notes="Notes"}(l||(l={}))},5:function(e,t,n){n("jI5P"),e.exports=n("NHXp")},"5tuL":function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var r={FLOATING_TOOLBAR_COMPONENT:"".concat("pm-alt-text","-alt-text-floating-toolbar")}},"5z4W":function(e,t){e.exports={name:"Notes",name_prefix:"Twake",slug:"notes",icon:"icon.svg",categories:["cozy"],version:"1.43.0",licence:"AGPL-3.0",editor:"Cozy",source:"https://github.com/cozy/cozy-notes.git@build",developer:{name:"Twake Workplace",url:"https://twake.app"},screenshots:["screenshots/fr/screenshot01.png","screenshots/fr/screenshot02.png"],langs:["en","fr"],routes:{"/":{folder:"/",index:"index.html",public:!1},"/public":{folder:"/",index:"index.html",public:!0},"/preview":{folder:"/",index:"index.html",public:!0},"/intents":{folder:"/intents",index:"index.html",public:!1}},intents:[{action:"OPEN",type:["io.cozy.notes.documents"],href:"/intents"}],permissions:{apps:{description:"Required by the cozy-bar to display the icons of the apps",type:"io.cozy.apps",verbs:["GET"]},files:{description:"Notes as files",type:"io.cozy.files"},settings:{description:"Required by the cozy-bar to display Claudy and know which applications are coming soon",type:"io.cozy.settings",verbs:["GET"]},sharings:{description:"Required to have access to the sharings in realtime",type:"io.cozy.sharings",verbs:["GET"]},contacts:{type:"io.cozy.contacts",verbs:["GET","POST"]},groups:{type:"io.cozy.contacts.groups",verbs:["GET"]},intents:{type:"io.cozy.notes.documents",verbs:["GET"]}}}},"6mlU":function(e,t,n){"use strict";n.d(t,"c",(function(){return i})),n.d(t,"a",(function(){return a})),n.d(t,"b",(function(){return u}));var r=n("iO45"),i=4,a=function(){return i},o=[["date",{inline:!0,group:"inline",selectable:!0,attrs:{timestamp:{default:""}},parseDOM:[{tag:'span[data-node-type="date"]'}]}],["status",{inline:!0,group:"inline",selectable:!0,attrs:{text:{default:""},color:{default:""},localId:{default:"dfab1003-a025-425f-869b-4592431ae618"},style:{default:""}},parseDOM:[{tag:'span[data-node-type="status"]'}]}],["doc",{content:"(block)+",marks:"alignment breakout indentation link unsupportedMark unsupportedNodeAttribute"}],["paragraph",{selectable:!1,content:"inline*",group:"block",marks:"strong code em link strike subsup textColor typeAheadQuery underline unsupportedMark unsupportedNodeAttribute",parseDOM:[{tag:"p"}]}],["text",{group:"inline"}],["bulletList",{group:"block",content:"listItem+",selectable:!1,parseDOM:[{tag:"ul"}],marks:"unsupportedMark unsupportedNodeAttribute"}],["orderedList",{group:"block",content:"listItem+",marks:"unsupportedMark unsupportedNodeAttribute",selectable:!1,parseDOM:[{tag:"ol"}]}],["listItem",{content:"(paragraph | mediaSingle | codeBlock) (paragraph | bulletList | orderedList | mediaSingle | codeBlock)*",marks:"link unsupportedMark unsupportedNodeAttribute",defining:!0,selectable:!1,parseDOM:[{tag:"li"}]}],["heading",{attrs:{level:{default:1}},content:"inline*",group:"block",defining:!0,selectable:!1,parseDOM:[{tag:"h1",attrs:{level:1}},{tag:"h2",attrs:{level:2}},{tag:"h3",attrs:{level:3}},{tag:"h4",attrs:{level:4}},{tag:"h5",attrs:{level:5}},{tag:"h6",attrs:{level:6}}]}],["blockquote",{content:"paragraph+",group:"block",defining:!0,selectable:!1,parseDOM:[{tag:"blockquote"}]}],["codeBlock",{attrs:{language:{default:null},uniqueId:{default:null}},content:"text*",marks:"unsupportedMark unsupportedNodeAttribute",group:"block",code:!0,defining:!0,parseDOM:[{tag:"pre",preserveWhitespace:"full"},{tag:"div[style]",preserveWhitespace:"full"},{tag:"table[style]",preserveWhitespace:"full"},{tag:"div.code-block",preserveWhitespace:"full"}]}],["rule",{group:"block",parseDOM:[{tag:"hr"}]}],["panel",{group:"block",content:"(paragraph | heading | bulletList | orderedList )+",marks:"unsupportedMark unsupportedNodeAttribute",attrs:{panelType:{default:"info"}},parseDOM:[{tag:"div[data-panel-type]"}]}],["confluenceUnsupportedBlock",{group:"block",attrs:{cxhtml:{default:null}},parseDOM:[{tag:'div[data-node-type="confluenceUnsupportedBlock"]'}]}],["confluenceUnsupportedInline",{group:"inline",inline:!0,atom:!0,attrs:{cxhtml:{default:null}},parseDOM:[{tag:'div[data-node-type="confluenceUnsupportedInline"]'}]}],["unsupportedBlock",{inline:!1,group:"block",atom:!0,selectable:!0,attrs:{originalValue:{default:{}}},parseDOM:[{tag:'[data-node-type="unsupportedBlock"]'}]}],["unsupportedInline",{inline:!0,group:"inline",selectable:!0,attrs:{originalValue:{default:{}}},parseDOM:[{tag:'[data-node-type="unsupportedInline"]'}]}],["hardBreak",{inline:!0,group:"inline",selectable:!1,parseDOM:[{tag:"br"}]}],["mediaSingle",{inline:!1,group:"block",selectable:!0,atom:!0,content:"media | media ( unsupportedBlock)",attrs:{width:{default:null},layout:{default:"center"}},marks:"unsupportedMark unsupportedNodeAttribute link",parseDOM:[{tag:'div[data-node-type="mediaSingle"]'}]}],["table",{content:"tableRow+",attrs:{isNumberColumnEnabled:{default:!1},layout:{default:"default"},__autoSize:{default:!1}},marks:"unsupportedMark unsupportedNodeAttribute",tableRole:"table",isolating:!0,selectable:!1,group:"block",parseDOM:[{tag:"table"}]}],["media",{selectable:!0,attrs:{id:{default:""},type:{default:"file"},collection:{default:""},occurrenceKey:{default:null},alt:{default:null},width:{default:null},height:{default:null},url:{default:null},__fileName:{default:null},__fileSize:{default:null},__fileMimeType:{default:null},__displayType:{default:null},__contextId:{default:null},__external:{default:!1}},parseDOM:[{tag:'div[data-node-type="media"]'},{tag:'img[src^="data:image"]',ignore:!0},{tag:"img:not(.smart-link-icon)"}]}],["tableHeader",{selectable:!1,content:"(paragraph | panel | blockquote | orderedList | bulletList | rule | heading | codeBlock | mediaSingle | decisionList | taskList )+",attrs:{colspan:{default:1},rowspan:{default:1},colwidth:{default:null},background:{default:null}},tableRole:"header_cell",isolating:!0,marks:"link alignment unsupportedMark unsupportedNodeAttribute",parseDOM:[{tag:"th"}]}],["decisionList",{group:"block",defining:!0,content:"decisionItem+",marks:"unsupportedMark unsupportedNodeAttribute",selectable:!1,attrs:{localId:{default:""}},parseDOM:[{tag:'ol[data-node-type="decisionList"]',priority:100}]}],["tableRow",{selectable:!1,content:"(tableCell | tableHeader)+",marks:"unsupportedMark unsupportedNodeAttribute",tableRole:"row",parseDOM:[{tag:"tr"}]}],["decisionItem",{content:"inline*",defining:!0,marks:"_",attrs:{localId:{default:""},state:{default:"DECIDED"}},parseDOM:[{tag:"li[data-decision-local-id]",priority:100}]}],["tableCell",{selectable:!1,content:"(paragraph | panel | blockquote | orderedList | bulletList | rule | heading | codeBlock | mediaSingle | decisionList | taskList | unsupportedBlock)+",attrs:{colspan:{default:1},rowspan:{default:1},colwidth:{default:null},background:{default:null}},tableRole:"cell",marks:"link alignment unsupportedMark unsupportedNodeAttribute",isolating:!0,parseDOM:[{tag:".ak-renderer-table-number-column",ignore:!0},{tag:"td"}]}],["taskList",{group:"block",defining:!0,selectable:!1,content:"taskItem+ (taskItem|taskList)*",marks:"unsupportedMark unsupportedNodeAttribute",attrs:{localId:{default:""}},parseDOM:[{tag:'div[data-node-type="actionList"]',priority:100}]}],["taskItem",{content:"inline*",defining:!0,selectable:!1,marks:"_",attrs:{localId:{default:""},state:{default:"TODO"}},parseDOM:[{tag:"div[data-task-local-id]",priority:100}]}]],s=[["link",{excludes:"link color",group:"link",attrs:{href:{},__confluenceMetadata:{default:null}},inclusive:!1,parseDOM:[{tag:"[data-block-link]"},{tag:"a[href]",context:"paragraph/|heading/|mediaSingle/|taskItem/|decisionItem/"},{tag:"a[href]"}]}],["em",{inclusive:!0,group:"fontStyle",parseDOM:[{tag:"i"},{tag:"em"},{style:"font-style=italic"}]}],["strong",{inclusive:!0,group:"fontStyle",parseDOM:[{tag:"strong"},{tag:"b"},{tag:"span"}]}],["textColor",{attrs:{color:{}},inclusive:!0,group:"color",parseDOM:[{style:"color"}]}],["strike",{inclusive:!0,group:"fontStyle",parseDOM:[{tag:"strike"},{tag:"s"},{tag:"del"},{style:"text-decoration"}]}],["subsup",{inclusive:!0,group:"fontStyle",attrs:{type:{default:"sub"}},parseDOM:[{tag:"sub",attrs:{type:"sub"}},{tag:"sup",attrs:{type:"sup"}},{tag:"span",style:"vertical-align=super"},{tag:"span",style:"vertical-align=sub"}]}],["underline",{inclusive:!0,group:"fontStyle",parseDOM:[{tag:"u"},{style:"text-decoration"}]}],["code",{excludes:"fontStyle link searchQuery color",inclusive:!0,parseDOM:[{tag:"span.code",preserveWhitespace:!0},{tag:"code",preserveWhitespace:!0},{tag:"tt",preserveWhitespace:!0},{tag:"span",preserveWhitespace:!0}]}],["typeAheadQuery",{inclusive:!0,group:"searchQuery",parseDOM:[{tag:"span[data-type-ahead-query]"}],attrs:{trigger:{default:""}}}],["alignment",{excludes:"alignment indentation",group:"alignment",attrs:{align:{}},parseDOM:[{tag:"div.fabric-editor-block-mark"}]}],["breakout",{spanning:!1,inclusive:!1,parseDOM:[{tag:"div.fabric-editor-breakout-mark"}],attrs:{mode:{default:"wide"}}}],["indentation",{excludes:"indentation alignment",group:"indentation",attrs:{level:{}},parseDOM:[{tag:"div.fabric-editor-indentation-mark"}]}],["unsupportedMark",{attrs:{originalValue:{}}}],["unsupportedNodeAttribute",{attrs:{type:{},unsupported:{}}}]];function c(e){return e.reduce((function(e,t){return e[t[0]]=t[1],e}),{})}var u={nodes:o,marks:s,version:i},l={nodes:c(o),marks:c(s)};new r.Schema(l)},"8BHA":function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var r=new(n("4z1N").PluginKey)("imageUploadPlugin")},"8Zd7":function(e,t,n){"use strict";var r=n("HZZ/"),i=n.n(r),a=n("GeFe"),o=n.n(a),s=n("Zvb3"),c=n.n(s),u=n("J58c"),l=n.n(u),d=n("hJxD"),p=n.n(d),f=[{type:"paragraph"}],h=n("6mlU");function m(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function v(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?m(Object(n),!0).forEach((function(t){l()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):m(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var g=function(){function e(t){var n=this;o()(this,e),l()(this,"postImage",function(){var e=i()(p.a.mark((function e(t,r,i,a){return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",n.stackClient.fetchJSON("POST",n.path(r,"images?Name=".concat(t)),i,{headers:{"Content-Type":a}}));case 1:case"end":return e.stop()}}),e)})));return function(t,n,r,i){return e.apply(this,arguments)}}());var r=t.userId,a=t.cozyClient,s=t.schema,c=t.realtime,u=new Date,d=u.getTime()+"."+u.getMilliseconds()+"."+Math.random();this.sessionId=r+":"+d,this.userId=this.getUserId(r),this.cozyClient=a,this.stackClient=a.getStackClient(),this.schema=s,this.schemaVersion=h.c,this.onRealtimeEvent=this.onRealtimeEvent.bind(this),this.realtime=c||a.plugins.realtime,this.resetCallbacks()}var t,n,r,a,s,u,d,m,g,y,b,w,O;return c()(e,[{key:"resetCallbacks",value:function(){this.callbacks={}}},{key:"setCallback",value:function(e,t,n){this.callbacks[e]=this.callbacks[e]||{},this.callbacks[e][t]=n}},{key:"getUserId",value:function(e){return e?e.match(/[^:]+/)[0]:this.userId}},{key:"getSessionId",value:function(){return this.sessionId}},{key:"close",value:function(){this.realtime.unsubscribeAll(),this.resetCallbacks()}},{key:"defaultTitle",value:function(){return(new Date).toISOString()}},{key:"path",value:function(e,t){return e?t?"/notes/".concat(e,"/").concat(t):"/notes/".concat(e):"/notes"}},{key:"client2server",value:function(e){return v({sessionID:e.sessionId||this.sessionId},e)}},{key:"server2client",value:function(e){return v({sessionId:e.sessionID,userId:this.getUserId(e.sessionID)},e)}},{key:"create",value:(O=i()(p.a.mark((function e(t,n,r){var i,a;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a={data:{type:"io.cozy.notes.documents",attributes:{title:t||this.defaultTitle(),schema:n||this.schema||h.b,content:r?(null===(i=r.content)||void 0===i?void 0:i.length)>0?r:v(v({},r),{},{content:f}):void 0}}},e.abrupt("return",this.stackClient.fetchJSON("POST",this.path(),a));case 2:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return O.apply(this,arguments)})},{key:"updateSchema",value:(w=i()(p.a.mark((function e(t,n){var r,i;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.stackClient.fetchJSON("PUT",this.path(t,"schema"),{data:{type:"io.cozy.notes.documents",attributes:{schema:v(v({},n),{},{version:h.c})}}});case 2:return r=e.sent,i=this.formatDoc(r.data),this.schemaVersion=i.schemaVersion,e.abrupt("return",i);case 6:case"end":return e.stop()}}),e,this)}))),function(e,t){return w.apply(this,arguments)})},{key:"sync",value:(b=i()(p.a.mark((function e(t){return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.stackClient.fetchJSON("POST",this.path(t,"sync"));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return b.apply(this,arguments)})},{key:"setTitle",value:(y=i()(p.a.mark((function e(t,n){var r;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r={data:{type:"io.cozy.notes.documents",id:t,attributes:this.client2server({title:n})}},e.next=3,this.stackClient.fetchJSON("PUT",this.path(t,"title"),r);case 3:case"end":return e.stop()}}),e,this)}))),function(e,t){return y.apply(this,arguments)})},{key:"onRealtimeEvent",value:function(e){var t=e.id||e._id,n=e.doctype||e.type;if("file"===n&&(n="io.cozy.files"),this.callbacks[n]&&this.callbacks[n][t])return this.callbacks[n][t](e);console.warn("Event not managed",n,t,this.callbacks)}},{key:"join",value:(g=i()(p.a.mark((function e(t){return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all([this.realtime.subscribe(null,"io.cozy.notes.events",t,this.onRealtimeEvent)]);case 2:this.realtime.subscribe("UPDATED","io.cozy.files",t,this.onRealtimeEvent);case 3:case"end":return e.stop()}}),e,this)}))),function(e){return g.apply(this,arguments)})},{key:"onStepsCreated",value:(m=i()(p.a.mark((function e(t,n){var r=this;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.setCallback("io.cozy.notes.steps",t,(function(e){return n(r.server2client(e))}));case 1:case"end":return e.stop()}}),e,this)}))),function(e,t){return m.apply(this,arguments)})},{key:"onTelepointerUpdated",value:(d=i()(p.a.mark((function e(t,n){var r=this;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.setCallback("io.cozy.notes.telepointers",t,(function(e){return n(r.server2client(e))}));case 1:case"end":return e.stop()}}),e,this)}))),function(e,t){return d.apply(this,arguments)})},{key:"onSchemaUpdated",value:(u=i()(p.a.mark((function e(t,n){var r=this;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.setCallback("io.cozy.files",t,(function(e){if(e.metadata.schema.version!==r.schemaVersion)return n(e)}));case 1:case"end":return e.stop()}}),e,this)}))),function(e,t){return u.apply(this,arguments)})},{key:"onTitleUpdated",value:(s=i()(p.a.mark((function e(t,n){var r=this;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.setCallback("io.cozy.notes.documents",t,(function(e){return e.sessionID&&e.sessionID==r.sessionId?null:n(e.title)}));case 1:case"end":return e.stop()}}),e,this)}))),function(e,t){return s.apply(this,arguments)})},{key:"getDoc",value:(a=i()(p.a.mark((function e(t){var n,r;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.stackClient.fetchJSON("GET",this.path(t));case 2:return n=e.sent,r=this.formatDoc(n.data),this.schemaVersion=r.schemaVersion,e.abrupt("return",r);case 6:case"end":return e.stop()}}),e,this)}))),function(e){return a.apply(this,arguments)})},{key:"getFormatedDoc",value:function(e){var t=this.formatDoc(e);return this.schemaVersion=t.schemaVersion,t}},{key:"formatDoc",value:function(e){return{doc:e.attributes.metadata.content,version:e.attributes.metadata.version,title:e.attributes.metadata.title,updatedAt:new Date(e.attributes.updated_at),file:e,schemaVersion:e.attributes.metadata.schema.version}}},{key:"pushSteps",value:(r=i()(p.a.mark((function e(t,n,r){var i,a,o=this;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i={headers:{"if-match":n}},a={data:r.map((function(e){return{type:"io.cozy.notes.steps",attributes:o.client2server(e.toJSON())}}))},e.next=4,this.stackClient.fetchJSON("PATCH",this.path(t),a,i);case 4:return e.abrupt("return",null);case 5:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return r.apply(this,arguments)})},{key:"getSteps",value:(n=i()(p.a.mark((function e(t,n){var r,i,a,o,s,c,u,l,d,f,h=this;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.stackClient.fetchJSON("GET","".concat(this.path(t,"steps"),"?Version=").concat(n));case 3:if(0!=(r=e.sent).data.length){e.next=8;break}return e.abrupt("return",{steps:[],version:n});case 8:return i=r.data.map((function(e){return h.server2client(e.attributes)})),a=r.data[r.data.length-1].attributes.version,e.abrupt("return",{version:a,steps:i});case 11:e.next=28;break;case 13:if(e.prev=13,e.t0=e.catch(0),o=e.t0.response,s=e.t0.reason&&e.t0.reason.data,c=s&&s.attributes&&s.attributes.metadata,u=c&&c.content,l=c&&c.version,412!=o.status||!u||!l){e.next=27;break}return f={_id:t,_type:"io.cozy.notes.events",doctype:d="io.cozy.notes.documents",title:c.title},this.callbacks[d]&&this.callbacks[d][t]&&this.callbacks[d][t](f),e.abrupt("return",{doc:u,version:l});case 27:throw e.t0;case 28:case"end":return e.stop()}}),e,this,[[0,13]])}))),function(e,t){return n.apply(this,arguments)})},{key:"pushTelepointer",value:(t=i()(p.a.mark((function e(t,n){var r;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r={data:{type:"io.cozy.notes.telepointers",id:t,attributes:this.client2server(n)}},e.abrupt("return",this.stackClient.fetchJSON("PUT",this.path(t,"telepointer"),r));case 2:case"end":return e.stop()}}),e,this)}))),function(e,n){return t.apply(this,arguments)})}]),e}(),y=n("ivGQ");t.a=function(e){var t=e.userId,n=e.userName,r=e.cozyClient;return Object(y.useMemo)((function(){return new g({userId:t,userName:n,cozyClient:r})}),[r,t,n])}},AdhS:function(e,t,n){},AvBw:function(e,t,n){"use strict";n.d(t,"a",(function(){return s})),n.d(t,"b",(function(){return c}));var r=n("9Jaj"),i=n("JdMa"),a=n("8BHA"),o=function(e){return function(t){return function(e,t){return e.setMeta(a.a,t)}(t,{name:"START_UPLOAD",event:e})}},s=function(e){return function(t,n){if(!a.a.getState(t).enabled||!e.src)return!1;var o=Object(i.b)(e.src,t.schema);return!!o&&(n&&n(Object(r.safeInsert)(o,t.selection.$to.pos)(t.tr).scrollIntoView()),!0)}},c=function(e){return function(t,n){return!!a.a.getState(t).enabled&&(n&&n(o(e)(t.tr)),!0)}}},CDNI:function(e,t,n){"use strict";n.d(t,"f",(function(){return f})),n.d(t,"e",(function(){return h})),n.d(t,"d",(function(){return m})),n.d(t,"h",(function(){return v})),n.d(t,"c",(function(){return k})),n.d(t,"g",(function(){return x})),n.d(t,"i",(function(){return C})),n.d(t,"j",(function(){return E})),n.d(t,"a",(function(){return S})),n.d(t,"k",(function(){return M})),n.d(t,"l",(function(){return I})),n.d(t,"b",(function(){return T}));var r=n("XZ5u"),i=(n("iO45"),n("4z1N")),a=n("9Jaj"),o=n("eXjd"),s=n("3mYb"),c=n("I/PM"),u=n("odni"),l=n("ct2w"),d=n("3Su3"),p=n("a+IN"),f=(n("KgC3"),function(e){return x(e)||w(e)||v(e)||g(e)}),h=function(e){var t=e.selection.node;return t&&t.type!==e.schema.nodes.media&&t.isBlock},m=function(e){var t=e.selection.node;return t&&t.type===e.schema.nodes.mediaSingle},v=function(e){if(Object(d.a)(e))return O(e,e.selection.$from)},g=function(e){if(e.selection instanceof p.a){var t=e.selection.$from,n=e.schema.nodes.mediaGroup;return y(t,n)||b(t,n)}},y=function(e,t){if(e.nodeBefore&&e.nodeBefore.type===t)return e.pos-e.nodeBefore.nodeSize+1},b=function(e,t){if(e.nodeAfter&&e.nodeAfter.type===t)return e.pos+1},w=function(e){if(Object(d.c)(e))return P(e,e.selection.$to)},O=function(e,t){var n,r;if(h(e)?(n=t.pos,r=t.nodeBefore):(n=Object(d.f)(t)-1,r=e.doc.resolve(n).nodeBefore),r&&r.type===e.schema.nodes.mediaGroup)return n-r.nodeSize+1},k=function(e){return e.selection.$from.parent.type===e.schema.nodes.paragraph&&Object(d.a)(e)&&Object(d.c)(e)},P=function(e,t){var n,r,i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(h(e)?(n=t.pos,r=t.nodeAfter):(n=Object(d.e)(t),r=e.doc.nodeAt(n)),r&&r.type===e.schema.nodes.mediaGroup)return i?n+1:n+r.nodeSize-1},x=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=e.selection.$from;if((t=t||r).parent.type===e.schema.nodes.mediaGroup)return n?Object(d.f)(t):Object(d.e)(t)-1};var C=function(e,t,n){var r=t.attrs.id,o=e.state,c=o.tr,u=o.selection,l=o.doc,p=n();c.deleteRange(p,p+t.nodeSize),Object(s.r)(r)&&c.setMeta("addToHistory",!1);var f=l.resolve(p),h=f.nodeBefore,m=f.parent,v=f.index()===m.childCount-1;if(u.from===p&&!v&&!Object(d.b)(o)&&h&&"media"===h.type.name){var g=Object(a.findPositionOfNodeBefore)(c.selection);g&&c.setSelection(i.NodeSelection.create(c.doc,g))}e.dispatch(c)},E=function(e){var t=e.state.selection;return t instanceof i.NodeSelection&&t.node.type===e.state.schema.nodes.media&&(Object(r.e)(e.state,e.dispatch),t.$to.nodeAfter?(Object(r.g)(e.state,e.dispatch),Object(o.e)(!1)(e.state,e.dispatch)):Object(o.c)(e.state,e.dispatch),!0)},j=function(e){return e.length>1&&"_"===e[0]&&"_"===e[1]},S=function(e,t){Object.keys(t.attrs).filter(j).forEach((function(n){var r=n.substring(2),i=e[r];void 0!==i&&(t.attrs[n]=i)}))},M=function(e,t){var n=t.nodes,r=n.mediaGroup,i=n.mediaSingle,a=n.media;return Object(c.e)(e,(function(e,t){return t||e.type!==a?e:i&&(Object(l.a)(e.attrs.__fileMimeType)||"external"===e.attrs.type)?i.createChecked({},e):r.createChecked({},[e])}))},_=function(e){return"0"===e.style.opacity||"none"===e.style.display||"hidden"===e.style.visibility},D=["DIV","TD"];var I=function(e){var t=(new DOMParser).parseFromString(e,"text/html").body,n=t.querySelector('b[id^="docs-internal-guid-"]');n&&Object(u.g)(t,n);var r=t.querySelectorAll("img");return r.length?(r.forEach((function(e){var n=e.parentElement;if(n)if(_(n)||_(e))n.removeChild(e);else if(!(n instanceof HTMLDivElement)){var r=Object(u.h)(n,(function(e){return e.parentElement===t||function(e){return!!e&&-1!==D.indexOf(e.tagName)}(e.parentElement)}));r&&r.parentElement&&(r.parentElement.insertBefore(e,r.nextElementSibling||r),n.innerText=n.innerText.trim(),Object(u.f)(n))}})),t.lastElementChild&&"BR"===t.lastElementChild.tagName&&t.removeChild(t.lastElementChild),t.innerHTML):e},T=function(e){if(!m(e))return null;var t=e.tr,n=t.selection.from+1,r=t.doc.nodeAt(n);return r&&r.type===e.schema.nodes.media?r:null}},G09D:function(e,t,n){"use strict";n.d(t,"a",(function(){return k}));var r=n("GeFe"),i=n.n(r),a=n("Zvb3"),o=n.n(a),s=n("J/YY"),c=n.n(s),u=n("a1Fv"),l=n.n(u),d=n("g3eI"),p=n.n(d),f=n("wDGE"),h=n.n(f),m=n("J58c"),v=n.n(m),g=n("ivGQ"),y=n.n(g),b=n("Y/FK"),w=n.n(b);function O(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=h()(e);if(t){var i=h()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return p()(this,n)}}function k(e){return function(t){l()(r,t);var n=O(r);function r(){var e;i()(this,r);for(var t=arguments.length,a=new Array(t),o=0;o<t;o++)a[o]=arguments[o];return e=n.call.apply(n,[this].concat(a)),v()(c()(e),"handleClick",(function(t){var n=w.a.findDOMNode(c()(e));(!n||t.target instanceof Node&&!n.contains(t.target))&&e.props.handleClickOutside&&e.props.handleClickOutside(t)})),v()(c()(e),"handleKeydown",(function(t){"Escape"===t.code&&e.props.handleEscapeKeydown?e.props.handleEscapeKeydown(t):"Enter"===t.code&&e.props.handleEnterKeydown&&e.props.handleEnterKeydown(t)})),e}return o()(r,[{key:"componentDidMount",value:function(){this.props.handleClickOutside&&document.addEventListener("click",this.handleClick,!1),this.props.handleEscapeKeydown&&document.addEventListener("keydown",this.handleKeydown,!1)}},{key:"componentWillUnmount",value:function(){this.props.handleClickOutside&&document.removeEventListener("click",this.handleClick,!1),this.props.handleEscapeKeydown&&document.removeEventListener("keydown",this.handleKeydown,!1)}},{key:"render",value:function(){return y.a.createElement(e,this.props)}}]),r}(g.PureComponent)}},Gfcl:function(e,t,n){"use strict";var r=n("HZZ/"),i=n.n(r),a=n("J58c"),o=n.n(a),s=n("hJxD"),c=n.n(s),u=n("4z1N"),l=n("fiXu"),d=n("X5HD"),p=n("JdMa"),f=n("AvBw"),h=n("8BHA"),m=n("4vUV");function v(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function g(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?v(Object(n),!0).forEach((function(t){o()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):v(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var y=function(e,t){return function(t,n){return!!e(n)&&(n.preventDefault(),n.stopPropagation(),n.type===m.e.Drop&&Object(p.d)(n,t),Object(f.b)(n)(t.state,t.dispatch),!0)}},b=function(e){var t,n=e.dispatch,r=e.providerFactory;return new u.Plugin({state:{init:function(e,t){return{active:!1,enabled:Object(p.a)(t),hidden:!t.schema.nodes.media||!t.schema.nodes.mediaSingle}},apply:function(e,t,r,i){var a=Object(p.c)(i),o=Object(p.a)(i),s=function(e,t){var n=e.getMeta(h.a);return n&&"START_UPLOAD"===n.name?{event:n.event}:t.activeUpload}(e,t);if(a!==t.active||o!==t.enabled||s!==t.activeUpload){var c=g(g({},t),{},{active:a,enabled:o,activeUpload:s});return n(h.a,c),c}return t}},key:h.a,view:function(){var e=function(){var e=i()(c.a.mark((function e(n,r){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("imageUploadProvider"===n&&r){e.next=2;break}return e.abrupt("return");case 2:return e.prev=2,e.next=5,r;case 5:t=e.sent,e.next=11;break;case 8:e.prev=8,e.t0=e.catch(2),t=void 0;case 11:case"end":return e.stop()}}),e,null,[[2,8]])})));return function(t,n){return e.apply(this,arguments)}}();return r.subscribe("imageUploadProvider",e),{update:function(e,n){var r=e.state,i=h.a.getState(r),a=h.a.getState(n);i.activeUpload!==a.activeUpload&&i.activeUpload&&t&&t(i.activeUpload.event,(function(t){return Object(f.a)(t)(e.state,e.dispatch)}))},destroy:function(){r.unsubscribe("imageUploadProvider",e)}}},props:{handleDOMEvents:{drop:y(d.a),paste:y(l.b)}}})},w=n("cwpE");var O=function(e){if(e.nodes.media&&e.nodes.mediaSingle){var t=Object(w.a)(/!\[(.*)\]\((\S+)\)$/,(function(e,t,n,r){var i=e.schema,a={src:t[2],alt:t[1]},o=Object(p.b)(a.src,i);return o?e.tr.replaceWith(n,r,o):null}));return Object(w.c)("image-upload",{rules:[t]})}};window.document.addEventListener("dragover",(function(e){return e.preventDefault(),!(null==e?void 0:e.target).closest(".ProseMirror")&&null!==e.dataTransfer&&(e.dataTransfer.dropEffect="none")}));t.a=function(){return{name:"imageUpload",pmPlugins:function(){return[{name:"imageUpload",plugin:b},{name:"imageUploadInputRule",plugin:function(e){var t=e.schema;return O(t)}}]}}}},GwML:function(e){e.exports=JSON.parse('{"Notes":{"Add":{"add_note":"Thêm ghi chú"},"Delete":{"delete_note":"Xóa","deleted":"Ghi chú đã được chuyển vào thùng rác trong Drive của bạn","failed":"Không thể xóa ghi chú, vui lòng thử lại"},"EditorView":{"main_placeholder":"Viết bất cứ điều gì…"},"Editor":{"title_placeholder":"Viết tiêu đề của bạn","exit_confirmation_message":"Tính năng lưu tự động chưa lưu những thay đổi mới nhất trong tài liệu của bạn. Vui lòng ở lại ghi chú hiện tại nếu bạn muốn giữ lại chúng.","exit_confirmation_title":"Bỏ qua các thay đổi của bạn?","exit_confirmation_leave":"Rời đi mà không lưu","exit_confirmation_cancel":"Hủy","read_only":"Ghi chú này đang ở chế độ chỉ đọc."},"Files":{"share":{"cta":"Chia sẻ"}},"List":{"latest_notes":"Ghi chú mới nhất","name":"Tên","updated_at":"Cập nhật lúc","location":"Vị trí","sharings":"Chia sẻ","at":"%{date} lúc %{time}"},"Empty":{"welcome":"Chào mừng đến với Twake Notes","after_created":"Sau khi ghi chú được tạo, bạn có thể tìm thấy nó trong "},"SavingIndicator":{"saved":{"default":"Đã cập nhật","just_now":"Đã cập nhật","secs_ago":"Đã cập nhật (đã lưu %{time} giây trước)","min_ago":"Đã cập nhật (đã lưu %{time} phút trước)","mins_ago":"Đã cập nhật (đã lưu %{time} phút trước)","hour_ago":"Đã cập nhật (đã lưu %{time} giờ trước)","hours_ago":"Đã cập nhật (đã lưu %{time} giờ trước)","day_ago":"Đã cập nhật (đã lưu %{time} ngày trước)","days_ago":"Đã cập nhật (đã lưu %{time} ngày trước)","month_ago":"Đã cập nhật (đã lưu %{time} tháng trước)","monthes_ago":"Đã cập nhật (đã lưu %{time} tháng trước)","year_ago":"Đã cập nhật (đã lưu %{time} năm trước)","years_ago":"Đã cập nhật (đã lưu %{time} năm trước)"},"saving":"Đang lưu...","still_saving":"Đang lưu......","out_of_sync":{"default":"Đã lưu (ngoại tuyến)","just_now":"Đã lưu (ngoại tuyến)","secs_ago":"Đã lưu (ngoại tuyến %{time} giây)","min_ago":"Đã lưu (ngoại tuyến %{time} phút)","mins_ago":"Đã lưu (ngoại tuyến %{time} phút)","hour_ago":"Đã lưu (ngoại tuyến %{time} giờ)","hours_ago":"Đã lưu (ngoại tuyến %{time} giờ)","day_ago":"Đã lưu (ngoại tuyến %{time} ngày)","days_ago":"Đã lưu (ngoại tuyến %{time} ngày)","month_ago":"Đã lưu (ngoại tuyến %{time} tháng)","monthes_ago":"Đã lưu (ngoại tuyến %{time} tháng)","year_ago":"Đã lưu (ngoại tuyến %{time} năm)","years_ago":"Đã lưu (ngoại tuyến %{time} năm)"},"saving_impossible":{"default":"Thay đổi chưa được lưu (ngoại tuyến)","just_now":"Thay đổi chưa được lưu (ngoại tuyến)","secs_ago":"Thay đổi chưa được lưu (ngoại tuyến %{time} giây)","min_ago":"Thay đổi chưa được lưu (ngoại tuyến %{time} phút)","mins_ago":"Thay đổi chưa được lưu (ngoại tuyến %{time} phút)","hour_ago":"Thay đổi chưa được lưu (ngoại tuyến %{time} giờ)","hours_ago":"Thay đổi chưa được lưu (ngoại tuyến %{time} giờ)","day_ago":"Thay đổi chưa được lưu (ngoại tuyến %{time} ngày)","days_ago":"Thay đổi chưa được lưu (ngoại tuyến %{time} ngày)","month_ago":"Thay đổi chưa được lưu (ngoại tuyến %{time} tháng)","monthes_ago":"Thay đổi chưa được lưu (ngoại tuyến %{time} tháng)","year_ago":"Thay đổi chưa được lưu (ngoại tuyến %{time} năm)","years_ago":"Thay đổi chưa được lưu (ngoại tuyến %{time} năm)"}},"OfflineIndicator":{"message":"Bạn không còn kết nối internet. Các thay đổi của bạn sẽ được lưu khi bạn kết nối trở lại."}},"Error":{"422":"Chỉ chấp nhận hình ảnh","unshared_title":"Chia sẻ này không còn hoạt động","unshared_text":"Chủ sở hữu có thể đã thu hồi chia sẻ này. Bạn không thể chỉnh sửa ghi chú tại địa chỉ này nữa.","loading_error_title":"Không thể tải ghi chú","loading_error_text_noReturnUrl":"Ghi chú có thể không còn tồn tại, hoặc máy chủ của chúng tôi có thể gặp sự cố tạm thời. Vui lòng thử lại sau.","back":"quay lại","unknown_error":"Đã xảy ra lỗi không mong đợi","only_one_image":"Bạn không thể kéo và thả nhiều hình ảnh cùng một lúc"},"manifest":{"short_description":"Twake Notes là ứng dụng ghi chú cá nhân và cộng tác của bạn.","long_description":"Notes là trình soạn thảo văn bản trực tuyến có thể cung cấp cho bạn:\\n\\n* Tạo ghi chú của riêng bạn với các tính năng thiết yếu (in đậm, gạch chân, liên kết, bảng...)\\n* Điền và tìm ghi chú của bạn với các tài liệu khác trong các tệp của Drive cá nhân\\n* Chỉnh sửa ghi chú dễ dàng từ tất cả các thiết bị của bạn\\n* Truy cập ghi chú khi ngoại tuyến\\n* Dành cho người hâm mộ, sử dụng phím tắt và nhập theo định dạng markdown ... và thậm chí viết cùng với người khác trên cùng một ghi chú (sắp ra mắt)!","screenshots":["screenshots/en/screenshot01.png","screenshots/en/screenshot02.png"]},"Intents":{"save":"Lưu"},"TrashedBanner":{"text":"Mục này đã được chuyển vào thùng rác","redirect":"Mở thùng rác","restore":"Khôi phục","restoreSuccess":"Mục đã được khôi phục","restoreError":"Đã xảy ra lỗi, vui lòng thử lại.","destroy":"Xóa vĩnh viễn"},"DestroyConfirm":{"title":"Xóa vĩnh viễn?","forbidden":"Bạn sẽ không thể truy cập tệp này nữa.","restore":"Bạn sẽ không thể khôi phục tệp này nếu bạn chưa tạo bản sao lưu.","cancel":"Hủy","delete":"Xóa vĩnh viễn","deleteError":"Đã xảy ra lỗi, vui lòng thử lại."},"MoreButton":{"more":"Thêm"}}')},Hsuv:function(e){e.exports=JSON.parse('{"Notes":{"Add":{"add_note":"Ajouter une note"},"Delete":{"delete_note":"Supprimer","deleted":"La note a été placée dans la corbeille de votre Drive","failed":"La note n\'a pas pu être supprimée, merci de re-essayer plus tard"},"EditorView":{"main_placeholder":"Écrivez ce que vous souhaitez…"},"Editor":{"title_placeholder":"Écrivez votre titre","exit_confirmation_message":"La sauvegarde automatique n\'a pas encore pris en compte vos dernières modifications. Merci de retourner sur votre note pour ne pas les perdre.","exit_confirmation_title":"Abandonner les modifications ?","exit_confirmation_leave":"Quitter sans sauvegarder","exit_confirmation_cancel":"Retour","read_only":"Cette note est en mode lecture-seule."},"Files":{"share":{"cta":"Partager"}},"List":{"latest_notes":"Notes récentes","name":"Nom","updated_at":"Mise à jour","location":"Emplacement","sharings":"Partage","at":"%{date} à %{time}"},"Empty":{"welcome":"Bienvenue sur Twake Notes","after_created":"Une fois votre note créée, il vous est possible de la retrouver dans "},"SavingIndicator":{"saved":{"default":"À jour","just_now":"À jour","secs_ago":"À jour (enregistré il y a %{time} sec.)","min_ago":"À jour (enregistré il y a %{time} min.)","mins_ago":"À jour (enregistré il y a %{time} min.)","hour_ago":"À jour (enregistré il y a %{time} heure)","hours_ago":"À jour (enregistré il y a %{time} heures)","day_ago":"À jour (enregistré il y a %{time} jour)","days_ago":"À jour (enregistré il y a %{time} jours)","month_ago":"À jour (enregistré il y a %{time} mois)","monthes_ago":"À jour (enregistré il y a %{time} mois)","year_ago":"À jour (enregistré il y a %{time} an)","years_ago":"À jour (enregistré il y a %{time} ans)"},"saving":"Enregistrement en cours...","still_saving":"Enregistrement en cours......","out_of_sync":{"default":"Enregistré (hors ligne)","just_now":"Enregistré (hors ligne)","secs_ago":"Enregistré (hors ligne depuis %{time} sec)","min_ago":"Enregistré (hors ligne depuis %{time} min)","mins_ago":"Enregistré (hors ligne depuis %{time} min)","hour_ago":"Enregistré (hors ligne depuis %{time} h)","hours_ago":"Enregistré (hors ligne depuis %{time} h)","day_ago":"Enregistré (hors ligne depuis %{time} jour)","days_ago":"Enregistré (hors ligne depuis %{time} jours)","month_ago":"Enregistré (hors ligne depuis %{time} mois)","monthes_ago":"Enregistré (hors ligne depuis %{time} mois)","year_ago":"Enregistré (hors ligne depuis %{time} an)","years_ago":"Enregistré (hors ligne depuis %{time} ans)"},"saving_impossible":{"default":"Non enregistré (hors ligne)","just_now":"Non enregistré (hors ligne)","secs_ago":"Non enregistré (hors ligne depuis %{time} sec)","min_ago":"Non enregistré (hors ligne depuis %{time} min)","mins_ago":"Non enregistré (hors ligne depuis %{time} min)","hour_ago":"Non enregistré (hors ligne depuis %{time} h)","hours_ago":"Non enregistré (hors ligne depuis %{time} h)","day_ago":"Non enregistré (hors ligne depuis %{time} jour)","days_ago":"Non enregistré (hors ligne depuis %{time} jours)","month_ago":"Non enregistré (hors ligne depuis %{time} mois)","monthes_ago":"Non enregistré (hors ligne depuis %{time} mois)","year_ago":"Non enregistré (hors ligne depuis %{time} an)","years_ago":"Non enregistré (hors ligne depuis %{time} ans)"}},"OfflineIndicator":{"message":"Vous n’êtes plus connecté à internet. Vos modifications seront enregistrées quand vous serez connecté à nouveau."}},"Error":{"422":"Seules les images sont acceptées","unshared_title":"Le partage n\'est plus actif","unshared_text":"Le propriétaire a peut-être révoqué ce partage. Vous ne pouvez plus éditer de note à cette adresse.","loading_error_title":"La note n\'a pas pu être chargée","loading_error_text_noReturnUrl":"Cette note n\'existe peut-être plus, ou nos serveurs ont peut-être un moment d\'égarement. Merci de retenter plus tard.","back":"Retour","unknown_error":"Une erreur inattendue s\'est produite","only_one_image":"Vous ne pouvez pas glisser-déposer plusieurs images en même temps"},"manifest":{"short_description":"Twake Notes est votre application de prise de notes personnelles et collaboratives.","long_description":"Notes est un éditeur de texte en ligne destiné à :\\n\\n* Créer vos propres notes avec les fonctionnalités essentielles (gras, souligné, liens, tableaux...)\\n* Classer et retrouver vos notes avec vos autres documents, dans les répertoires de votre Drive personnel\\n* Éditer facilement vos notes depuis tous vos appareils\\n* Accéder à vos notes, même sans internet, stockées sur votre PC\\n* Pour les aficionados, utiliser les raccourcis et la saisie au format markdown\\n*  ... et même écrire à plusieurs simultanément sur la même note (à venir) ! ","screenshots":["screenshots/fr/screenshot01.png","screenshots/fr/screenshot02.png"]},"Intents":{"save":"Enregistrer"},"TrashedBanner":{"text":"Cet élément est dans la corbeille","redirect":"Ouvrir la corbeille","restore":"Restaurer","restoreSuccess":"Cet élément a été restauré avec succès","restoreError":"Une erreur s\'est produite, veuillez réessayer","destroy":"Supprimer définitivement"},"DestroyConfirm":{"title":"Supprimer définitivement ?","forbidden":"Vous ne pourrez plus accéder à ce fichier.","restore":"Vous ne pourrez pas restaurer ce fichier.","cancel":"Annuler","delete":"Supprimer définitivement","deleteError":"Une erreur s\'est produite, veuillez réessayer"},"MoreButton":{"more":"Plus"}}')},JdMa:function(e,t,n){"use strict";n.d(t,"c",(function(){return i})),n.d(t,"a",(function(){return a})),n.d(t,"b",(function(){return o})),n.d(t,"d",(function(){return s}));var r=n("4z1N"),i=function(e){var t=e.schema.nodes.media;return e.selection instanceof r.NodeSelection&&e.selection.node.type===t},a=function(e){var t=e.schema.nodes.mediaSingle,n=e.selection.$to;if(t)for(var r=n.depth;r>=0;r--){var i=n.index(r);if(n.node(r).canReplaceWith(i,i,t))return!0}return!1},o=function(e,t){var n=t.nodes,r=n.media,i=n.mediaSingle;if(!r||!i)return null;var a=r.createChecked({type:"external",url:e});return i.createChecked({},a)},s=function(e,t){var n,i=e.clientX,a=e.clientY;return t.dispatch(t.state.tr.setSelection(r.TextSelection.create(t.state.doc,(null===(n=t.posAtCoords({left:i,top:a}))||void 0===n?void 0:n.pos)||0)))}},MjaT:function(e,t,n){"use strict";n.d(t,"a",(function(){return d}));var r,i=n("yCbO"),a=n.n(i),o=n("Czyx"),s=n("QdRn"),c=n("WISH"),u=n("2KGD"),l=n("K4GK"),d=Object(o.css)(r||(r=a()(["\n  .ProseMirror {\n    "," & [layout='full-width'] .",",\n    & [layout='wide'] ."," {\n      margin-left: 50%;\n      transform: translateX(-50%);\n    }\n\n    & [layout^='wrap-'] + [layout^='wrap-'] {\n      clear: none;\n      & + p,\n      & + div[class^='fabric-editor-align'],\n      & + ul,\n      & + ol,\n      & + h1,\n      & + h2,\n      & + h3,\n      & + h4,\n      & + h5,\n      & + h6 {\n        clear: both !important;\n      }\n      & ."," {\n        margin-left: 0;\n        margin-right: 0;\n      }\n    }\n\n    .mediaSingleView-content-wrap[layout^='wrap-'] {\n      max-width: 100%;\n      // overwrite default Prosemirror setting making it clear: both\n      clear: inherit;\n    }\n\n    .mediaSingleView-content-wrap[layout='wrap-left'] {\n      float: left;\n    }\n\n    .mediaSingleView-content-wrap[layout='wrap-right'] {\n      float: right;\n    }\n\n    .mediaSingleView-content-wrap[layout='wrap-right']\n      + .mediaSingleView-content-wrap[layout='wrap-left'] {\n      clear: both;\n    }\n\n    /* Larger margins for resize handlers when at depth 0 of the document */\n    & > .mediaSingleView-content-wrap {\n      .richMedia-resize-handle-right {\n        margin-right: -","px;\n      }\n      .richMedia-resize-handle-left {\n        margin-left: -","px;\n      }\n    }\n  }\n\n  .richMedia-resize-handle-right,\n  .richMedia-resize-handle-left {\n    display: flex;\n    flex-direction: column;\n\n    /* vertical align */\n    justify-content: center;\n  }\n\n  .richMedia-resize-handle-right {\n    align-items: flex-end;\n    padding-right: 12px;\n    margin-right: -","px;\n  }\n\n  .richMedia-resize-handle-left {\n    align-items: flex-start;\n    padding-left: 12px;\n    margin-left: -","px;\n  }\n\n  .richMedia-resize-handle-right::after,\n  .richMedia-resize-handle-left::after {\n    content: ' ';\n    display: flex;\n    width: 3px;\n    height: 64px;\n\n    border-radius: 6px;\n  }\n\n  .",":hover .richMedia-resize-handle-left::after,\n  .",":hover .richMedia-resize-handle-right::after {\n    background: ",";\n  }\n\n  ."," .richMedia-resize-handle-right::after,\n  ."," .richMedia-resize-handle-left::after,\n  ."," .richMedia-resize-handle-right:hover::after,\n  ."," .richMedia-resize-handle-left:hover::after,\n  .",".is-resizing .richMedia-resize-handle-right::after,\n  .",".is-resizing .richMedia-resize-handle-left::after {\n    background: ",";\n  }\n\n  .__resizable_base__ {\n    left: unset !important;\n    width: auto !important;\n    height: auto !important;\n  }\n\n  /* Danger when top level node for smart cards / inline links */\n  .danger > div > div > .media-card-frame,\n  .danger > span > a {\n    background-color: ",";\n    box-shadow: 0px 0px 0px ","px\n      ",";\n    transition: background-color 0s;\n    transition: box-shadow 0s;\n  }\n\n  /* Danger when nested node or common */\n  .danger {\n    /* Media single */\n    ."," .","::after {\n      border: ","px solid ",";\n    }\n\n    .richMedia-selected .richMedia-resize-handle-right::after,\n    .richMedia-selected .richMedia-resize-handle-left::after {\n      background: ",";\n    }\n\n    /* Smart cards */\n    div div .media-card-frame,\n    .inlineCardView-content-wrap > span > a {\n      background-color: rgb(255, 189, 173, 0.5); /* R75 with 50% opactiy */\n      transition: background-color 0s;\n    }\n\n    div div .media-card-frame::after {\n      box-shadow: none;\n    }\n  }\n"])),s.a,s.b,s.b,s.b,c.v,c.v,c.u,c.u,s.b,s.b,u.N60,c.H,c.H,s.b,s.b,s.b,s.b,u.B200,c.h,c.D,c.j,s.b,l.b,c.D,c.j,c.j)},NHXp:function(e,t,n){"use strict";n.r(t);var r=n("J58c"),i=n.n(r),a=(n("QLHQ"),n("k37E"),n("oULE"),n("cRRo"),n("woVZ"),n("AdhS"),n("bvF7")),o=n("+2kq"),s=n("QNBQ"),c=n("0Cco"),u=n("XkwL"),l=n.n(u),d=n("HZZ/"),p=n.n(d),f=n("hJxD"),h=n.n(f),m=n("ivGQ"),v=n.n(m),g=n("xEu0"),y=n.n(g),b=n("bQqJ"),w=Object(m.createContext)(),O=function(e){var t=e.intentId,n=e.children,r=Object(g.useClient)(),i=Object(m.useState)({service:null,intent:null,data:null}),a=l()(i,2),o=a[0],s=a[1],c=Object(m.useMemo)((function(){return{service:o.service,intent:o.intent,data:o.data}}),[o]);return Object(m.useEffect)((function(){var e=function(){var e=p()(h.a.mark((function e(){var n,i,a;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,r.intents.createService(t,window);case 3:n=e.sent,i=n.getIntent(),a=n.getData(),s({service:n,intent:i,data:a}),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(0),n.throw(e.t0);case 12:case"end":return e.stop()}}),e,null,[[0,9]])})));return function(){return e.apply(this,arguments)}}();o.service||e()}),[r,t,o.service]),o.service?v.a.createElement(w.Provider,{value:c},n):v.a.createElement(b.b,{className:"u-m-0",size:"xxlarge",middle:!0})},k=n("8Zd7"),P=n("v/Qj"),x=n("rUPj"),C=n.n(x),E=n("/s+K"),j=n("Aaol"),S=n("/ENz"),M=Object(S.a)({root:{position:"fixed",bottom:"calc(env(safe-area-inset-bottom) + 1rem)",left:0}}),_=function(e){var t=e.title,n=e.actions,r=Object(j.useI18n)().t,i=M(),a=Object(g.useClient)(),o=function(){var e=Object(m.useContext)(w);if(!e)throw new Error("useIntent must be used within a IntentProvider");return e}().service,s=Object(P.a)(),c=s.userName,u=s.userId,d=Object(k.a)({cozyClient:a,userId:u,userName:c}),f=Object(m.useState)(!1),y=l()(f,2),b=y[0],O=y[1];return v.a.createElement(v.a.Fragment,null,v.a.createElement("style",null,"html .akEditor>div:first-child","{ bottom: calc(env(safe-area-inset-bottom) + 5rem) }"),v.a.createElement(E.default,{classes:i,label:r("Intents.save"),busy:b,fullWidth:!0,onClick:function(e){return function(){var n=p()(h.a.mark((function n(r){var i,a,s;return h.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r.stopPropagation(),n.prev=1,O(!0),n.next=5,e.getValue();case 5:return i=n.sent,n.next=8,d.create(t,void 0,i);case 8:a=n.sent,s=a.data,o.terminate({id:s.id}),O(!1),n.next=18;break;case 14:n.prev=14,n.t0=n.catch(1),C()("error",n.t0),o.cancel();case 18:case"end":return n.stop()}}),n,null,[[1,14]])})));return function(e){return n.apply(this,arguments)}}()}(n)}))},D=n("bfH1"),I=function(){var e=Object(j.useI18n)().t,t=Object(m.useState)(""),n=l()(t,2),r=n[0],i=n[1];return v.a.createElement(D.a,{defaultTitle:e("Notes.Editor.title_placeholder"),isIntents:!0,onTitleChange:function(e){i(e.target.value)}},v.a.createElement(_,{title:r}))},T=n("v2Ur"),N=n("Y/FK"),A=n("qwOa"),L=n("8ZpT"),U=n.n(L),R=n("HROS"),F=n("MvM1"),z=n.n(F),B=n("Rx+m"),V=n("5LIP"),W=n("0Lot"),G=n("BqmN");function K(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function H(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?K(Object(n),!0).forEach((function(t){i()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):K(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var J=n("5z4W"),q=n("xyGe"),$=Object(W.a)({disableGlobal:!0}),Q={en:{react:n("WNgr"),atlaskit:a.a},fr:{react:n("5mip"),atlaskit:H(H({},o.a),q)},ru:{react:n("TqgK"),atlaskit:s.a},vi:{react:n("/Uvb"),atlaskit:c.vi}};document.addEventListener("DOMContentLoaded",(function(){var e=Object(T.b)(),t=e.token,r=Object(T.a)(e.app.slug,J.slug),i=Object(T.a)(e.app.version,J.version);Object(A.d)(Q.en.react),Object(A.d)(Q.fr.react),Object(A.d)(Q.ru.react),Object(A.d)(Q.vi.react);var a=Object(T.a)(e.locale,"en"),o=["en","fr","ru","vi"].includes(a)?a:"en",s=window.location.protocol,c=new y.a({uri:"".concat(s,"//").concat(e.domain),token:t,autoHydrate:!0,appMetadata:{slug:r,version:i}}),u=new z.a({client:c});c.intents=u,c.registerPlugin(U.a.plugin);var l=new URLSearchParams(window.location.search).get("intent");Object(N.render)(v.a.createElement(R.WebviewIntentProvider,null,v.a.createElement(j.default,{lang:e.locale,dictRequire:function(e){return n("eUFy")("./".concat(e))}},v.a.createElement(G.b,{generateClassName:$},v.a.createElement(A.c,{locale:o,messages:Q[o].atlaskit},v.a.createElement(B.BreakpointsProvider,null,v.a.createElement(g.CozyProvider,{client:c},v.a.createElement(O,{intentId:l},v.a.createElement(V.default,null,v.a.createElement(I,null))))))))),document.querySelector("[role=application]"))}))},NZnG:function(e,t,n){"use strict";n.d(t,"a",(function(){return U}));var r,i,a,o=n("GeFe"),s=n.n(o),c=n("Zvb3"),u=n.n(c),l=n("J/YY"),d=n.n(l),p=n("a1Fv"),f=n.n(p),h=n("g3eI"),m=n.n(h),v=n("wDGE"),g=n.n(v),y=n("J58c"),b=n.n(y),w=n("yCbO"),O=n.n(w),k=n("ivGQ"),P=n.n(k),x=n("Czyx"),C=n("dKM3"),E=n("DzbU"),j=n("x3sL"),S=n("kSuG"),M=n("zy2m"),_=n("WISH"),D=n("G09D");function I(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=g()(e);if(t){var i=g()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return m()(this,n)}}var T=x.default.div(r||(r=O()(["\n  /* tooltip in ToolbarButton is display:block */\n  & > div > div {\n    display: flex;\n  }\n"]))),N=Object(D.a)(C.a),A=x.default.div(i||(i=O()(["\n  ",";\n"])),(function(e){return e.isSelected?"&& > span, && > span:hover { background: #6c798f; color: #fff; }":""})),L=x.default.span(a||(a=O()(["\n  ",";\n"])),(function(e){return e.hasElemBefore?"margin-left: 8px;":""})),U=function(e){f()(n,e);var t=I(n);function n(){var e;s()(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return e=t.call.apply(t,[this].concat(i)),b()(d()(e),"state",{popupPlacement:["bottom","left"]}),b()(d()(e),"handleRef",(function(t){e.setState({target:t||void 0})})),b()(d()(e),"updatePopupPlacement",(function(t){e.setState({popupPlacement:t})})),b()(d()(e),"handleClose",(function(){e.props.onOpenChange&&e.props.onOpenChange({isOpen:!1})})),e}return u()(n,[{key:"renderItem",value:function(e){var t=this.props,n=t.onItemActivated,r=t.onMouseEnter,i=t.onMouseLeave;if(!e.onClick&&!e.value&&!e.value.name)return P.a.createElement("span",{key:String(e.content)},e.content);var a=P.a.createElement(A,{key:e.key||e.content,isSelected:e.isActive},P.a.createElement(E.a,{elemBefore:e.elemBefore,elemAfter:e.elemAfter,isDisabled:e.isDisabled,onClick:function(){return n&&n({item:e})},onMouseEnter:function(){return r&&r({item:e})},onMouseLeave:function(){return i&&i({item:e})},className:e.className},P.a.createElement(L,{hasElemBefore:!!e.elemBefore},e.content)));return e.tooltipDescription?P.a.createElement(S.a,{key:e.key||e.content,content:e.tooltipDescription,position:e.tooltipPosition},a):a}},{key:"renderDropdownMenu",value:function(){var e=this,t=this.state,n=t.target,r=t.popupPlacement,i=this.props,a=i.items,o=i.mountTo,s=i.boundariesElement,c=i.scrollableElement,u=i.offset,l=i.fitHeight,d=i.fitWidth,p=i.isOpen,f=i.zIndex;return P.a.createElement(M.a,{target:p?n:void 0,mountTo:o,boundariesElement:s,scrollableElement:c,onPlacementChanged:this.updatePopupPlacement,fitHeight:l,fitWidth:d,zIndex:f||_.n,offset:u},P.a.createElement(N,{isOpen:!0,appearance:"tall",position:r.join(" "),shouldFlip:!0,shouldFitContainer:!0,isTriggerNotTabbable:!0,handleClickOutside:this.handleClose,handleEscapeKeydown:this.handleClose},P.a.createElement("div",{style:{height:0,minWidth:d||0}}),a.map((function(t,n){return P.a.createElement(j.a,{key:n},t.items.map((function(t){return e.renderItem(t)})))}))))}},{key:"render",value:function(){var e=this.props,t=e.children,n=e.isOpen;return P.a.createElement(T,null,P.a.createElement("div",{ref:this.handleRef},t),n?this.renderDropdownMenu():null)}}]),n}(k.PureComponent)},bOB9:function(e,t,n){"use strict";n.d(t,"j",(function(){return k})),n.d(t,"h",(function(){return P})),n.d(t,"c",(function(){return x})),n.d(t,"b",(function(){return _})),n.d(t,"i",(function(){return I})),n.d(t,"f",(function(){return N})),n.d(t,"e",(function(){return A})),n.d(t,"g",(function(){return L})),n.d(t,"d",(function(){return U})),n.d(t,"a",(function(){return R})),n.d(t,"l",(function(){return K})),n.d(t,"k",(function(){return H}));var r=n("J58c"),i=n.n(r),a=n("HZZ/"),o=n.n(a),s=n("XkwL"),c=n.n(s),u=n("hJxD"),l=n.n(u),d=n("6mlU"),p=n("/yh+"),f=n.n(p),h=n("xEu0"),m=n("v2Ur"),v=n("5z4W"),g=n.n(v);function y(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function b(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?y(Object(n),!0).forEach((function(t){i()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):y(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function w(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return O(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return O(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function O(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function k(e){return new URL(e.getStackClient().uri).hostname+Math.floor(100*Math.random())}function P(){var e,t=w(new URLSearchParams(window.location.search));try{for(t.s();!(e=t.n()).done;){var n=c()(e.value,2),r=n[0],i=n[1];if("returnUrl"===r)return i}}catch(a){t.e(a)}finally{t.f()}}function x(e,t,n){return C.apply(this,arguments)}function C(){return(C=o()(l.a.mark((function e(t,n,r){var i,a,o;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=h.models.note.fetchURL(t,n),a=window.location.toString(),e.t0=URL,e.next=5,i;case 5:return e.t1=e.sent,(o=new e.t0(e.t1)).searchParams.set("returnUrl",r||a),e.abrupt("return",o.toString());case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function E(e){return j.apply(this,arguments)}function j(){return(j=o()(l.a.mark((function e(t){var n,r,i;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.collection("io.cozy.permissions").fetchOwnPermissions();case 2:if(n=e.sent,r=f()(n,"data.attributes.permissions")){e.next=6;break}throw"can't get self permissions";case 6:return i=Object.values(r),e.abrupt("return",i.filter((function(e){return h.models.permission.isForType(e,"io.cozy.files")})));case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function S(e,t){return M.apply(this,arguments)}function M(){return(M=o()(l.a.mark((function e(t,n){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",t.query(t.find("io.cozy.files").getById(n)).then((function(e){return e&&e.data})));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function _(e,t){return D.apply(this,arguments)}function D(){return(D=o()(l.a.mark((function e(t,n){var r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,S(t,n);case 2:return r=e.sent,e.abrupt("return",h.models.permission.isDocumentReadOnly({document:r,client:t,writability:["PATCH"]}));case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function I(e){return T.apply(this,arguments)}function T(){return(T=o()(l.a.mark((function e(t){var n,r,i,a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,E(t);case 2:if(!((n=e.sent.filter((function(e){return h.models.permission.isForType(e,"io.cozy.files")&&e.values&&e.values.length>0}))).length<1)){e.next=7;break}throw new Error("No individual io.cozy.files permissions in current context");case 7:(n.length>1||n[0].values.length>1)&&console.warn("There are more than one permission for a file in current context. Let's take the first one, but it may not be the one you expect");case 8:return r=n[0],i=r.values[0],a=h.models.permission.isReadOnly(r,{writability:["PATCH"]}),e.abrupt("return",{id:i,readOnly:a});case 12:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function N(e){return"/folder/".concat(e)}function A(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=new URL(e.getStackClient().uri),r=e.getInstanceOptions(),i=r.subdomain,a="drive",o=null!==t?N(t):"",s=Object(h.generateWebLink)({cozyUrl:n.origin,slug:a,pathname:"/",subDomainType:i,hash:o});return s}function L(e,t){return A(e,h.models.file.getParentFolderId(t))}function U(){var e=Object(m.b)(),t=Object(m.a)(e.app.prefix||g.a.name_prefix,""),n=Object(m.a)(e.app.name,g.a.name);return""!=t?"".concat(t," ").concat(n):n}function R(e){return e.getStackClient().fetchJSON("POST","/notes",{data:{type:"io.cozy.notes.documents",attributes:{title:"",schema:b(b({},d.b),{},{version:d.c})}}})}var F=6e4,z=60*F,B=24*z,V=31*B,W=365*B,G=[[1e4,"just_now",1e3,1],[1*F,"secs_ago",1e3,10],[2*F,"min_ago",F,1],[5*F,"mins_ago",F,1],[20*F,"mins_ago",F,5],[1*z,"mins_ago",F,10],[2*z,"hour_ago",z,1],[1*B,"hours_ago",z,1],[2*B,"day_ago",B,1],[1*V,"days_ago",B,1],[2*V,"month_ago",V,1],[1*W,"monthes_ago",V,1],[2*W,"year_ago",W,1],[1/0,"years_ago",W,1]];function K(e,t){var n=(t||G).find((function(t){return e<t[0]})),r=c()(n,4),i=r[1],a=r[2],o=r[3];return{key:i,unit:a,coef:o,time:Math.floor(e/a/o)*o,interval:a*o}}function H(){var e=new URLSearchParams(window.location.search);return e.has("username")?e.get("username"):null}},bfH1:function(e,t,n){"use strict";var r=n("LGLP"),i=n.n(r),a=n("XkwL"),o=n.n(a),s=n("V3Qr"),c=n("igqv"),u=n("upXl"),l=n.n(u),d={allowBreakout:!0,allowTextColor:!0,allowTextAlignment:!0,allowIndentation:!0,allowTables:{allowColumnSorting:!0,allowColumnResizing:!0,allowMergeCells:!0,allowNumberColumn:!0,allowBackgroundColor:!0,allowHeaderRow:!0,allowHeaderColumn:!0,permittedLayouts:"all",stickToolbarToBottom:!0},allowPanel:!0,allowStatus:!0,allowRule:!0,allowDate:!0,allowTasksAndDecisions:!0},p=n("HZZ/"),f=n.n(p),h=n("hJxD"),m=n.n(h),v=n("4vUV"),g=n("uU7o");var y=n("N8wp"),b=function(e,t){switch(null==e?void 0:e.type){case v.e.Drop:return O(e,t);case v.e.Paste:return k(e,t);default:return w(t)}},w=function(e){var t=document.createElement(v.c.Input);t.setAttribute("accept","image/*"),t.type=v.f.File,t.dispatchEvent(new MouseEvent(v.e.Click)),t.addEventListener(v.e.Change,(function(){var n;return e(null===(n=t.files)||void 0===n?void 0:n[0])}))},O=function(e,t){var n,r,i=e.dataTransfer;return(1===(null==(r=null==i?void 0:i.files)?void 0:r.length)||(y.a.error("Error.only_one_image"),!1))&&t(null==i||null===(n=i.files)||void 0===n?void 0:n[0])},k=function(e,t){var n,r=e.clipboardData;return t(null==r||null===(n=r.files)||void 0===n?void 0:n[0])},P=function(e,t,n){var r=new window.FileReader;if(!n)throw Error(v.d.NoFileFoundAfterInput);r.readAsArrayBuffer(n),r.onloadend=f()(m.a.mark((function i(){var a,o,s;return m.a.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:if(a=Object(g.a)(r.result)){i.next=3;break}throw Error(v.d.FileNotProcessable);case 3:return i.prev=3,e.setUploading(!0),i.next=7,e.collabProvider.serviceClient.postImage(n.name,e.collabProvider.config.noteId,a,n.type);case 7:o=i.sent,s=o.data.id,t({src:s}),i.next=15;break;case 12:i.prev=12,i.t0=i.catch(3),y.a.error(e.t(void 0!==i.t0.status?"Error.".concat(i.t0.status):"Error.unknown_error"),{duration:4e3});case 15:return i.prev=15,e.setUploading(!1),i.finish(15);case 18:case"end":return i.stop()}}),i,null,[[3,12,15,18]])})))},x=n("ivGQ"),C=n.n(x),E=n("bQqJ"),j=n("UuKj"),S=n("9WMr"),M=n("MHrW"),_=n("Aaol");var D=function(){};t.a=function(e){var t=e.defaultValue,n=e.onTitleChange,r=e.onTitleBlur,a=e.defaultTitle,u=e.title,p=e.collabProvider,f=e.onContentChange,h=e.readOnly,m=e.bannerRef,v=e.headerMenu,g=e.isIntent,y=e.children,w=Object(_.useI18n)().t,O=Object(x.useRef)(null),k=Object(x.useCallback)((function(e){n&&n(e)}),[n]);Object(x.useMemo)((function(){return p&&p.setReadOnly(!!h)}),[h,p]);var I=Object(x.useMemo)((function(){return p&&{useNativePlugin:!0,provider:Promise.resolve(p),inviteToEditHandler:function(){},isInviteToEditButtonSelected:!1,userId:p.serviceClient.getSessionId()}}),[p]);Object(x.useEffect)((function(){var e;(e=O.current)&&(e.style.height="".concat(e.scrollHeight,"px"))}),[u]),Object(M.default)(O.current,"blur",r);var T,N=Object(x.useState)(!1),A=o()(N,2),L=A[0],U=A[1];return C.a.createElement("article",{className:"".concat(l.a["note-article"]).concat(g?" "+l.a["note-article--intents"]:"")},L&&C.a.createElement(S.a,null,C.a.createElement(E.b,{size:"xxlarge",middle:!0})),C.a.createElement("style",null,"#coz-bar ","{ display: none }"),v,C.a.createElement("section",{className:"note-editor-container"},C.a.createElement(s.a,i()({},d,{disabled:!p&&h,collabEdit:I,onChange:f||D,defaultValue:t,appearance:"full-page",placeholder:w("Notes.EditorView.main_placeholder"),shouldFocus:!h,legacyImageUploadProvider:(T={collabProvider:p,t:w,setUploading:U},Promise.resolve((function(e,t){return b(e,(function(e){return P(T,t,e)}))}))),contentComponents:C.a.createElement(c.a,{render:function(e){return C.a.createElement(C.a.Fragment,null,C.a.createElement("aside",{ref:m,className:l.a.banner}),C.a.createElement(j.default,{ref:O,className:l.a.title,multiline:!0,minRows:1,value:u,placeholder:a,fullWidth:!0,InputProps:{disableUnderline:!0},inputProps:{className:l.a.titleInput,readOnly:!!h},onChange:h?D:k}),C.a.Children.map(y,(function(t){return C.a.isValidElement(t)?C.a.cloneElement(t,{actions:e}):null})))}})}))))}},bxsC:function(e,t,n){"use strict";var r,i,a,o=n("J58c"),s=n.n(o),c=n("ivGQ"),u=n.n(c),l=n("iu8y"),d=n("zw+H"),p=n("EPWR"),f=n("HZZ/"),h=n.n(f),m=n("GeFe"),v=n.n(m),g=n("Zvb3"),y=n.n(g),b=n("hJxD"),w=n.n(b),O=n("Y/FK"),k=n.n(O),P=n("4z1N"),x=n("ut+C"),C=n("Lu4+"),E=n("uF5U"),j=n("l+VE"),S=n.n(j),M=n("9Jaj"),_=n("3xVv"),D=n("yCbO"),I=n.n(D),T=n("Czyx"),N=n("wjgK"),A=n("2KGD"),L=n("8DMk"),U=n.n(L),R=n("VCdh"),F=n("J/YY"),z=n.n(F),B=n("a1Fv"),V=n.n(B),W=n("g3eI"),G=n.n(W),K=n("wDGE"),H=n.n(K),J=n("K5K7"),q=n("+k3U"),$=n("y3D9"),Q=n("GyuN"),X=n("qheH"),Z=n("k359"),Y=T.default.figure(r||(r=I()(["\n  margin: 0;\n"])));Y.displayName="FigureWrapper";var ee=T.default.div(i||(i=I()(["\n  position: absolute;\n  width: 100%;\n  height: 100%;\n"]))),te=T.default.div(a||(a=I()(["\n  width: 100%;\n  position: relative;\n  padding-bottom: ","%;\n"])),(function(e){return e.dimensions.height/e.dimensions.width*100})),ne=function(e){var t=e.dimensions,n=e.children,r=e.onContextMenu;return u.a.createElement(te,{dimensions:t,onContextMenuCapture:r},u.a.createElement(ee,null,n))},re=n("4vUV"),ie=n("xEu0");function ae(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function oe(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ae(Object(n),!0).forEach((function(t){s()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ae(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function se(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=H()(e);if(t){var i=H()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return G()(this,n)}}var ce,ue,le=function(e){V()(r,e);var t,n=se(r);function r(e){var t;v()(this,r),t=n.call(this,e),s()(z()(t),"mediaPluginState",void 0),s()(z()(t),"state",{imageUrl:"",imageError:"",imageLoading:!0}),s()(z()(t),"realtimeSubscription",void 0),s()(z()(t),"setViewMediaClientConfig",h()(w.a.mark((function e(){var n,r;return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.props.mediaProvider;case 2:(n=e.sent)&&(r=n.viewMediaClientConfig,t.setState({viewMediaClientConfig:r}));case 4:case"end":return e.stop()}}),e)})))),s()(z()(t),"selectMediaSingleFromCard",(function(e){var n=e.event;t.selectMediaSingle(n)})),s()(z()(t),"selectMediaSingle",(function(e){e.stopPropagation();var n=t.props.getPos(),r=t.props.view.state;if(e.shiftKey){if(r.selection instanceof Q.a)return;Object(X.g)(t.props.view,r.selection.from<n?r.selection.from:n-1,r.selection.to>n?r.selection.to:n+2)}else Object(X.f)(t.props.view,n-1)})),s()(z()(t),"fetchCozyImage",h()(w.a.mark((function e(){var n,r,i,a,o,s,c,u,l;return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.setState({imageError:""}),t.state.collabEditProvider){e.next=3;break}throw Error(re.d.MissingCollabEdit);case 3:return n=t.state.collabEditProvider,r=n.serviceClient,i=n.config.noteId,e.prev=4,e.next=7,r.cozyClient.query(Object(ie.Q)(re.a.Files).getById(i));case 7:if(o=e.sent){e.next=10;break}throw Error(re.d.CouldNotGetNoteImages);case 10:if(s=null===(a=o.included)||void 0===a?void 0:a.find((function(e){return e.id===t.props.node.attrs.url}))){e.next=28;break}return e.prev=12,c=t.props.node.attrs.url,u=i,e.next=17,r.cozyClient.getStackClient().fetchJSON("POST","/notes/".concat(c,"/copy?To=").concat(u));case 17:if(l=e.sent){e.next=20;break}throw Error("failed to POST /notes/:id/copy");case 20:return t.mediaPluginState.updateMediaNodeAttrs(t.props.getPos().toString(),oe(oe({},t.props.node.attrs),{},{url:l.data.id}),!0),e.abrupt("return",t.setState({imageUrl:"".concat(r.stackClient.uri).concat(l.data.links.self),imageLoading:!1}));case 24:throw e.prev=24,e.t0=e.catch(12),console.error(re.d.CouldNotCopyImage),e.t0;case 28:!s.attributes.willBeResized&&t.setState({imageUrl:"".concat(r.stackClient.uri).concat(s.links.self),imageLoading:!1}),e.next=35;break;case 31:e.prev=31,e.t1=e.catch(4),t.setState({imageError:e.t1.message,imageLoading:!1}),console.error(e.t1);case 35:case"end":return e.stop()}}),e,null,[[4,31],[12,24]])})))),s()(z()(t),"subscribeToImageUpdate",(function(){var e;return null===(e=t.state.collabEditProvider)||void 0===e?void 0:e.serviceClient.realtime.subscribe(re.g.Updated,re.a.NoteEvents,t.state.collabEditProvider.config.noteId,(function(e){var n=e.image_id;t.props.node.attrs.url.includes(n)&&t.setState({imageLoading:!0},t.fetchCozyImage)}))})),s()(z()(t),"handleNewNode",(function(e){var n=e.node;t.mediaPluginState.handleMediaNodeMount(n,(function(){return t.props.getPos()}))}));var i=t.props.view;return t.mediaPluginState=Z.a.getState(i.state),t}return y()(r,[{key:"shouldComponentUpdate",value:function(e,t){var n=!this.state.viewMediaClientConfig&&t.viewMediaClientConfig;return!(this.state.imageUrl===t.imageUrl&&this.state.imageError===t.imageError&&this.props.selected===e.selected&&this.props.uploadComplete===e.uploadComplete&&this.props.node.attrs.id===e.node.attrs.id&&this.props.node.attrs.collection===e.node.attrs.collection&&this.props.maxDimensions.height===e.maxDimensions.height&&this.props.maxDimensions.width===e.maxDimensions.width&&this.props.contextIdentifierProvider===e.contextIdentifierProvider&&this.props.isLoading===e.isLoading&&this.props.mediaProvider===e.mediaProvider&&!n)}},{key:"componentDidMount",value:(t=h()(w.a.mark((function e(){var t,n,r;return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.handleNewNode(this.props),t=this.props,n=t.contextIdentifierProvider,r=t.collabEditProvider,e.t0=this,e.next=5,n;case 5:return e.t1=e.sent,e.next=8,r;case 8:return e.t2=e.sent,e.t3={contextIdentifierProvider:e.t1,collabEditProvider:e.t2},e.t0.setState.call(e.t0,e.t3),this.realtimeSubscription=this.subscribeToImageUpdate(),e.next=14,this.fetchCozyImage();case 14:return e.next=16,this.setViewMediaClientConfig();case 16:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"componentWillUnmount",value:function(){var e,t=this.props.node;null===(e=this.realtimeSubscription)||void 0===e||e.unsubscribe(),this.mediaPluginState.handleMediaNodeUnmount(t)}},{key:"componentDidUpdate",value:function(e){e.node.attrs.id!==this.props.node.attrs.id&&(this.mediaPluginState.handleMediaNodeUnmount(e.node),this.handleNewNode(this.props)),this.mediaPluginState.updateElement(),this.setViewMediaClientConfig()}},{key:"render",value:function(){var e=this.props,t=e.node,n=e.selected,r=e.uploadComplete,i=e.originalDimensions,a=e.isLoading,o=e.maxDimensions,s=e.mediaOptions,c=this.state,l=c.viewMediaClientConfig,d=c.contextIdentifierProvider,p=t.attrs,f=p.id,h=p.type,m=p.collection,v=p.url,g=p.alt;if(this.state.imageLoading||!this.state.imageUrl||this.state.imageError||a||"external"!==h&&(!l||"boolean"==typeof r&&!r))return u.a.createElement(ne,{dimensions:i},u.a.createElement(q.a,null));var y=d&&d.objectId,b="external"===h?{dataURI:this.state.imageUrl,name:v,mediaItemType:"external-image"}:{id:f,mediaItemType:"file",collectionName:m},w=l||{authProvider:function(){return{}}};return u.a.createElement(ne,{dimensions:i,onContextMenu:this.selectMediaSingle},u.a.createElement($.a,{mediaClientConfig:w,resizeMode:"stretchy-fit",dimensions:o,originalDimensions:i,identifier:b,selectable:!0,selected:n,disableOverlay:!0,onClick:this.selectMediaSingleFromCard,useInlinePlayer:s&&s.allowLazyLoading,isLazy:s&&s.allowLazyLoading,featureFlags:s&&s.featureFlags,contextId:y,alt:g}))}}]),r}(c.Component),de=Object(J.a)(le),pe=T.default.div(ce||(ce=I()(["\n  color: ",";\n  background: ",";\n  border-radius: ","px;\n  margin: 5px 3px 25px;\n  width: ","px;\n  min-height: ","px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n"])),Object(R.J)(A.B400,.4)||A.B400,Object(R.J)(A.B300,.6)||A.B300,Object(N.c)(),156,125),fe=T.default.div(ue||(ue=I()(["\n  background: ",";\n  border-radius: ","px;\n  margin: 2px 0;\n  width: 100%;\n  height: 2px;\n"])),A.B200,Object(N.c)()),he=function(e){var t=e.type;return"single"===(void 0===t?"group":t)?u.a.createElement(fe,null):u.a.createElement(pe,null,u.a.createElement(U.a,{label:"Document",size:"medium"}))},me=n("iO45"),ve=n("3mYb"),ge=n("PuAp"),ye=n("CDNI"),be=n("3Su3"),we=n("44lN"),Oe=n("AV8T"),ke=n("3sCF"),Pe=function(e,t){var n="";return 1===e.length?n=e[0].fileMimeType||"unknown":e.length>1&&(n="multiple"),{action:Oe.a.INSERTED,actionSubject:Oe.b.DOCUMENT,actionSubjectId:Oe.c.MEDIA,attributes:{type:Oe.c.MEDIA_GROUP,inputMethod:t,fileExtension:n},eventType:Oe.d.TRACK}};var xe=function(e,t,n,r){var i=e.state,a=e.dispatch,o=i.tr,s=i.schema,c=s.nodes,u=c.media,l=c.paragraph;if(u&&t.length){var d=Ce(t,n,u),p=je(i),f=o.doc.resolve(p).parent,h=o.doc.nodeAt(p),m=!function(e){var t=e.schema,n=e.selection.$anchor.node();return n&&n.type===t.nodes.mediaGroup}(i)&&Object(we.e)(i,me.Fragment.from(i.schema.nodes.mediaGroup.createChecked({},d))),v=function(e,t){var n=e.schema.nodes.media,r=t&&t.type===n;return(Object(ve.j)(e)||Object(ve.n)(e)||Object(ve.m)(e)||Object(be.d)(e)&&(!Object(ye.h)(e)||Object(ye.e)(e)))&&!r}(i,h),g=f.type===s.nodes.mediaGroup?d:[s.nodes.mediaGroup.createChecked({},d)];if(m){g=v?g.concat(l.create()):g;var y=Se(i);return y?p<=y.start?o.deleteRange(y.start,y.end).insert(p,g):o.insert(p,g).deleteRange(y.start,y.end):o.insert(p,g),Object(ke.a)(i,o,Pe(t,r)),a(o),void _e(e)}v&&f.type!==s.nodes.mediaGroup&&g.push(l.create()),Object(ke.a)(i,o,Pe(t,r)),a(Object(M.safeInsert)(me.Fragment.fromArray(g),p)(o))}},Ce=function(e,t,n){return e.map((function(e){var r=e.id,i=n.create({id:r,type:"file",collection:t});return Object(ye.a)(e,i),i}))},Ee=function(e){var t=e.schema.nodes,n=t.mediaGroup,r=t.listItem;if(Object(M.hasParentNode)((function(e){return e.type===r}))(e.selection)){var i=function(e){var t=e.schema.nodes,n=t.bulletList,r=t.orderedList;return Object(ge.b)((function(e){return e.type===n||e.type===r}))(e.selection.$from)}(e);if(i){var a=i.pos+i.node.nodeSize,o=e.doc.nodeAt(a);return o&&o.type===n?a+1:a}}},je=function(e){var t=e.selection,n=t.$from,r=t.$to,i=Ee(e);if(i)return i;var a=Object(ye.f)(e);return a&&(!Object(ye.e)(e)||n.pos<a&&r.pos<a)?a:Object(ye.e)(e)?r.pos:Object(be.c)(e)?r.pos+1:Object(be.a)(e)?n.pos-1:r.pos},Se=function(e){var t=e.selection,n=t.$from,r=t.$to;if(!Object(ye.g)(e))return!Object(ye.c)(e)||Object(ye.f)(e)?Me(n.pos,r.pos):Me(Object(be.f)(n)-1,Object(be.e)(r))},Me=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e;return{start:e,end:t}},_e=function(e){var t=e.state,n=t.doc,r=Object(ye.f)(t);if(r){var i=n.resolve(r),a=Object(be.e)(i);a+1>=n.nodeSize-1?Object(X.f)(e,r):Object(X.g)(e,a+1)}},De=n("CW9m");function Ie(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}var Te=function(e,t){return e.mediaNodes.reduce((function(e,n){return e||(n.node.attrs.id===t?n:e)}),null)},Ne=function(e,t,n){return n?Te(e,t):e.mediaGroupNodes[t]},Ae=function(e,t){return e.mediaOptions&&e.mediaOptions.allowMarkingUploadsAsIncomplete&&"boolean"==typeof e.mobileUploadComplete[t]?e.mobileUploadComplete[t]:void 0},Le=function(e,t,n){return function(r,i){var a,o=Z.a.getState(r);if(n)a=function(e,t){return e.mediaNodes.filter((function(e){return e.node.attrs.id===t}))}(o,e);else{var s=Ne(o,e,n);a=s?[s]:[]}var c=r.schema.nodes.media;if(0===(a=a.filter((function(e){var t;try{t=r.doc.nodeAt(e.getPos())}catch(n){return!1}return t&&t.type===c}))).length)return!1;if(i){var u=r.tr;a.forEach((function(e){var n=e.getPos;return u.step(new De.a(n(),t))})),u.setMeta("addToHistory",!1),i(u)}return!0}},Ue=function(e,t,n){return function(r,i){var a=Z.a.getState(r),o=Ne(a,e,n);if(!o){var s=a.mediaNodes.find((function(t){return t.getPos().toString()===e}));return!!s&&(null==i||i(r.tr.step(new De.a(s.getPos(),t)).setMeta("addToHistory",!1)),!0)}return i&&i(r.tr.step(new De.a(o.getPos(),t)).setMeta("addToHistory",!1)),!0}},Re=function(e,t){return function(n,r){return!!r&&(r(n.tr.step(new De.a(e,function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ie(Object(n),!0).forEach((function(t){s()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ie(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({type:"file",url:null},t))).setMeta("addToHistory",!1)),!0)}},Fe=n("2AuG"),ze=function(){function e(t,n,r){var i=this,a=(arguments.length>3&&void 0!==arguments[3]||Fe.d,arguments.length>4?arguments[4]:void 0);v()(this,e),s()(this,"picker",void 0),s()(this,"onDragListeners",[]),s()(this,"errorReporter",void 0),s()(this,"pickerType",void 0),s()(this,"onStartListeners",[]),s()(this,"eventListeners",{}),s()(this,"analyticsName",void 0),s()(this,"erroredFiles",void 0),s()(this,"handleUploadPreviewUpdate",(function(e){var t=e.file,n=e.preview,r=i.erroredFiles.has(t.id),a=Object(Fe.e)(n)?n:{dimensions:void 0,scaleFactor:void 0},o=a.dimensions,s=a.scaleFactor,c={id:t.id,fileName:t.name,fileSize:t.size,fileMimeType:t.type,dimensions:o,scaleFactor:s,status:r?"error":void 0};i.eventListeners[t.id]=[],i.onStartListeners.forEach((function(e){return e(c,(function(e){return i.subscribeStateChanged(t,e)}),i.analyticsName||i.pickerType)}))})),s()(this,"subscribeStateChanged",(function(e,t){var n=i.eventListeners[e.id];n&&n.push(t)})),s()(this,"handleUploadError",(function(e){var t=e.error,n=e.fileId,r=i.eventListeners[n];i.erroredFiles.add(n),r&&(r.forEach((function(e){return e({id:n,status:"error",error:t&&{description:t.description,name:t.name}})})),delete i.eventListeners[n])})),s()(this,"handleMobileUploadEnd",(function(e){var t=e.file,n=i.eventListeners[t.id];n&&n.forEach((function(e){return e({id:t.id,status:"mobile-upload-end",fileMimeType:t.type,collection:t.collectionName,publicId:t.publicId})}))})),s()(this,"handleReady",(function(e){var t=e.file,n=i.eventListeners[t.id];n&&(n.forEach((function(e){return e({id:t.id,status:"ready"})})),delete i.eventListeners[t.id])})),this.pickerType=t,this.errorReporter=n.errorReporter,this.analyticsName=a,this.erroredFiles=new Set}var t;return y()(e,[{key:"init",value:(t=h()(w.a.mark((function e(){var t;return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("customMediaPicker"!==this.pickerType){e.next=4;break}t=this.picker=this.pickerConfig,e.next=8;break;case 4:if("popup"!==this.pickerType){e.next=8;break}return e.next=7,this.mediaPickerFactoryClass(this.config.mediaClientConfig,this.pickerConfig);case 7:t=this.picker=e.sent;case 8:if(t){e.next=10;break}return e.abrupt("return",this);case 10:return t.on("upload-preview-update",this.handleUploadPreviewUpdate),t.on("upload-end",this.handleReady),t.on("upload-error",this.handleUploadError),t.on("mobile-upload-end",this.handleMobileUploadEnd),e.abrupt("return",this);case 15:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"type",get:function(){return this.pickerType}},{key:"mediaPicker",get:function(){return this.picker}},{key:"destroy",value:function(){var e=this.picker;if(e){e.removeAllListeners("upload-preview-update"),e.removeAllListeners("upload-end"),e.removeAllListeners("upload-error"),this.onStartListeners=[],this.onDragListeners=[];try{"popup"===this.pickerType&&e.teardown()}catch(t){this.errorReporter.captureException(t)}}}},{key:"setUploadParams",value:function(e){this.picker&&this.picker.setUploadParams(e)}},{key:"onClose",value:function(e){var t=this.picker;if("popup"===this.pickerType){var n=t;return n.on("closed",e),function(){return n.off("closed",e)}}return function(){}}},{key:"show",value:function(){if("popup"===this.pickerType)try{this.picker.show()}catch(e){this.errorReporter.captureException(e)}}},{key:"hide",value:function(){"popup"===this.pickerType&&this.picker.hide()}},{key:"onNewMedia",value:function(e){this.onStartListeners.push(e)}},{key:"onDrag",value:function(e){this.onDragListeners.push(e)}}]),e}(),Be=n("ct2w");function Ve(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function We(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ve(Object(n),!0).forEach((function(t){s()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ve(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Ge=["ready","error","cancelled"],Ke=function(){function e(t,n,r,i,a){var o=this;v()(this,e),s()(this,"allowsUploads",!1),s()(this,"mediaClientConfig",void 0),s()(this,"uploadMediaClientConfig",void 0),s()(this,"ignoreLinks",!1),s()(this,"waitForMediaUpload",!0),s()(this,"allUploadsFinished",!0),s()(this,"showDropzone",!1),s()(this,"element",void 0),s()(this,"layout","center"),s()(this,"mediaNodes",[]),s()(this,"mediaGroupNodes",{}),s()(this,"mobileUploadComplete",{}),s()(this,"options",void 0),s()(this,"mediaProvider",void 0),s()(this,"pendingTask",Promise.resolve(null)),s()(this,"view",void 0),s()(this,"destroyed",!1),s()(this,"contextIdentifierProvider",void 0),s()(this,"errorReporter",void 0),s()(this,"popupPicker",void 0),s()(this,"customPicker",void 0),s()(this,"removeOnCloseListener",(function(){})),s()(this,"openMediaPickerBrowser",void 0),s()(this,"onPopupToogleCallback",(function(){})),s()(this,"reactContext",void 0),s()(this,"pickers",[]),s()(this,"pickerPromises",[]),s()(this,"editingMediaSinglePos",void 0),s()(this,"showEditingDialog",void 0),s()(this,"mediaOptions",void 0),s()(this,"dispatch",void 0),s()(this,"onContextIdentifierProvider",function(){var e=h()(w.a.mark((function e(t,n){return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!n){e.next=4;break}return e.next=3,n;case 3:o.contextIdentifierProvider=e.sent;case 4:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()),s()(this,"setMediaProvider",function(){var e=h()(w.a.mark((function e(t){var n,r,i,a;return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=5;break}return o.destroyPickers(),o.allowsUploads=!1,o.destroyed||o.view.dispatch(o.view.state.tr.setMeta(Z.a,{allowsUploads:o.allowsUploads})),e.abrupt("return");case 5:return e.prev=5,e.next=8,t;case 8:o.mediaProvider=e.sent,o.mediaProvider.viewMediaClientConfig||(n=o.mediaProvider.viewMediaClientConfig)&&(o.mediaProvider.viewMediaClientConfig=n),S()(o.mediaProvider.viewMediaClientConfig,"MediaProvider promise did not resolve to a valid instance of MediaProvider - ".concat(o.mediaProvider)),e.next=21;break;case 13:return e.prev=13,e.t0=e.catch(5),r=new Error("Media functionality disabled due to rejected provider: ".concat(e.t0.message)),o.errorReporter.captureException(r),o.destroyPickers(),o.allowsUploads=!1,o.destroyed||o.view.dispatch(o.view.state.tr.setMeta(Z.a,{allowsUploads:o.allowsUploads})),e.abrupt("return");case 21:if(o.mediaClientConfig=o.mediaProvider.viewMediaClientConfig,o.allowsUploads=!!o.mediaProvider.uploadMediaClientConfig,i=o.view,a=o.allowsUploads,!o.destroyed&&i.dom.parentNode&&i.dispatch(i.state.tr.setMeta(Z.a,{allowsUploads:a})),!o.allowsUploads){e.next=35;break}if(o.uploadMediaClientConfig=o.mediaProvider.uploadMediaClientConfig,!o.mediaProvider.uploadParams||!o.uploadMediaClientConfig){e.next=32;break}return e.next=30,o.initPickers(o.mediaProvider.uploadParams,ze,o.reactContext);case 30:e.next=33;break;case 32:o.destroyPickers();case 33:e.next=36;break;case 35:o.destroyPickers();case 36:case"end":return e.stop()}}),e,null,[[5,13]])})));return function(t){return e.apply(this,arguments)}}()),s()(this,"getMediaOptions",(function(){return o.options})),s()(this,"hasUserAuthProvider",(function(){return!!o.uploadMediaClientConfig&&!!o.uploadMediaClientConfig.userAuthProvider})),s()(this,"insertFile",(function(e,t,n){var r=We(We({},e),{},{contextId:o.contextIdentifierProvider?o.contextIdentifierProvider.objectId:void 0}),i=o.collectionFromProvider();if(void 0!==i){o.mediaOptions&&o.mediaOptions.allowMarkingUploadsAsIncomplete&&(o.mobileUploadComplete[r.id]=!1),"error"!==e.status&&o.updateAndDispatch({allUploadsFinished:!1}),Object(_.d)(o.view.state.schema,r.fileMimeType)?Object(_.c)(o.view,r,o.getInputMethod(n),i,o.mediaOptions&&o.mediaOptions.alignLeftOnInsert):xe(o.view,[r],i,o.getInputMethod(n)),t(o.handleMediaState);var a=function(e){return e.status&&-1!==Ge.indexOf(e.status)};a(r)||(o.addPendingTask(new Promise((function(e){t((function(t){a(t)&&e(t)}))}))),o.pendingTask.then((function(){o.updateAndDispatch({allUploadsFinished:!0})})));var s=o.view;s.hasFocus()||s.focus()}})),s()(this,"addPendingTask",(function(e){var t=o.pendingTask,n=function(){return t};o.pendingTask=e.then(n,n)})),s()(this,"splitMediaGroup",(function(){return Object(ye.j)(o.view)})),s()(this,"onPopupPickerClose",(function(){o.onPopupToogleCallback(!1)})),s()(this,"shouldUseMediaPickerPopup",(function(){return!o.mediaOptions||o.mediaOptions&&void 0===o.mediaOptions.useMediaPickerPopup?o.hasUserAuthProvider():!!o.mediaOptions.useMediaPickerPopup})),s()(this,"showMediaPicker",(function(){if(o.openMediaPickerBrowser&&!o.shouldUseMediaPickerPopup())return o.openMediaPickerBrowser();o.popupPicker&&(o.popupPicker.show(),o.onPopupToogleCallback(!0))})),s()(this,"setBrowseFn",(function(e){o.openMediaPickerBrowser=e})),s()(this,"onPopupToggle",(function(e){o.onPopupToogleCallback=e})),s()(this,"waitForPendingTasks",(function(e,t){if(t&&o.pendingTask===t)return t;var n,r=o.pendingTask.then((function(){return o.waitForPendingTasks(void 0,o.pendingTask)}));if(!e)return r;var i=new Promise((function(t,r){n=window.setTimeout((function(){return r(new Error("Media operations did not finish in ".concat(e," ms")))}),e)}));return Promise.race([i,r.then((function(e){return clearTimeout(n),e}))])})),s()(this,"handleMediaNodeRemoval",(function(e,t){var n=e;n||(n=o.view.state.doc.nodeAt(t())),Object(ye.i)(o.view,n,t)})),s()(this,"handleMediaNodeMount",(function(e,t){o.mediaNodes.unshift({node:e,getPos:t})})),s()(this,"handleMediaNodeUnmount",(function(e){o.mediaNodes=o.mediaNodes.filter((function(t){var n=t.node;return e!==n}))})),s()(this,"findMediaNode",(function(e){return Te(o,e)})),s()(this,"destroyAllPickers",(function(e){e.forEach((function(e){return e.destroy()})),o.pickers.splice(0,o.pickers.length)})),s()(this,"destroyPickers",(function(){var e=o.pickers,t=o.pickerPromises;t.length===e.length?o.destroyAllPickers(o.pickers):Promise.all(t).then((function(e){return o.destroyAllPickers(e)})),o.popupPicker=void 0,o.customPicker=void 0})),s()(this,"getInputMethod",(function(e){switch(e){case"popup":return Oe.e.PICKER_CLOUD;case"clipboard":return Oe.e.CLIPBOARD;case"dropzone":return Oe.e.DRAG_AND_DROP}})),s()(this,"updateMediaNodeAttrs",(function(e,t,n){var r=o.view;if(r)return Ue(e,t,n)(r.state,r.dispatch)})),s()(this,"handleMediaState",(function(e){switch(e.status){case"error":var t=o.options.uploadErrorHandler;t&&t(e);break;case"mobile-upload-end":var n={id:e.publicId||e.id};"string"==typeof e.collection&&(n.collection=e.collection),o.updateMediaNodeAttrs(e.id,n,Object(_.d)(o.view.state.schema,e.fileMimeType)),o.mobileUploadComplete[n.id]=!0,delete o.mediaGroupNodes[e.id]}})),s()(this,"isMobileUploadCompleted",(function(e){return Ae(o,e)})),s()(this,"removeNodeById",(function(e){var t=e.id,n=Ne(o,t,Object(Be.a)(e.fileMimeType));n&&Object(ye.i)(o.view,n.node,n.getPos)})),s()(this,"removeSelectedMediaContainer",(function(){var e=o.view,t=o.selectedMediaContainerNode();if(!t)return!1;var n=e.state.selection.from;return Object(ye.i)(e,t.firstChild,(function(){return n+1})),!0})),s()(this,"selectedMediaContainerNode",(function(){var e=o.view.state,t=e.selection,n=e.schema;if(t instanceof P.NodeSelection&&(t.node.type===n.nodes.mediaSingle||t.node.type===n.nodes.mediaGroup))return t.node})),s()(this,"handleDrag",(function(e){var t="enter"===e;if(o.showDropzone!==t){o.showDropzone=t;var n=o.view;(0,n.dispatch)(n.state.tr)}})),this.reactContext=r,this.options=n,this.mediaOptions=i,this.dispatch=a,this.waitForMediaUpload=void 0===n.waitForMediaUpload||n.waitForMediaUpload;var c=t.schema.nodes;S()(c.media&&(c.mediaGroup||c.mediaSingle),"Editor: unable to init media plugin - media or mediaGroup/mediaSingle node absent in schema"),n.providerFactory.subscribe("mediaProvider",(function(e,t){return o.setMediaProvider(t)})),n.providerFactory.subscribe("contextIdentifierProvider",this.onContextIdentifierProvider),this.errorReporter=n.errorReporter||new E.a}var t;return y()(e,[{key:"updateElement",value:function(){var e,t=this.selectedMediaContainerNode(),n=this.view.state.schema.nodes.mediaSingle;t&&t.type===n&&(e=this.getDomElement(this.view.domAtPos.bind(this.view))),this.element!==e&&(this.element=e)}},{key:"getDomElement",value:function(e){var t=this.view.state,n=t.selection,r=t.schema;if(n instanceof P.NodeSelection&&n.node.type===r.nodes.mediaSingle){var i=Object(M.findDomRefAtPos)(n.from,e);if(i)return i.childNodes.length?i.querySelector(".wrapper")||i:i.parentNode}}},{key:"setView",value:function(e){this.view=e}},{key:"destroy",value:function(){if(!this.destroyed){this.destroyed=!0;var e=this.mediaNodes;e.splice(0,e.length),this.removeOnCloseListener(),this.destroyPickers()}}},{key:"initPickers",value:(t=h()(w.a.mark((function e(t,n,r){var i,a,o,s,c,u,l,d=this;return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.destroyed&&this.uploadMediaClientConfig){e.next=2;break}return e.abrupt("return");case 2:if(i=this.errorReporter,a=this.pickers,o=this.pickerPromises,a.length){e.next=26;break}if(s={mediaClientConfig:this.uploadMediaClientConfig,errorReporter:i},c={uploadParams:t,proxyReactContext:r(),useForgePlugins:this.mediaOptions&&this.mediaOptions.useForgePlugins||!1,featureFlags:this.mediaOptions&&this.mediaOptions.featureFlags},!this.options.customMediaPicker){e.next=16;break}return u=new n("customMediaPicker",s,this.options.customMediaPicker).init(),o.push(u),e.t0=a,e.next=12,u;case 12:e.t1=this.customPicker=e.sent,e.t0.push.call(e.t0,e.t1),e.next=25;break;case 16:if(!this.shouldUseMediaPickerPopup()){e.next=25;break}return l=new n("popup",s,c).init(),o.push(l),e.t2=a,e.next=22,l;case 22:e.t3=this.popupPicker=e.sent,e.t2.push.call(e.t2,e.t3),this.removeOnCloseListener=this.popupPicker.onClose(this.onPopupPickerClose);case 25:a.forEach((function(e){e.onNewMedia(d.insertFile)}));case 26:a.forEach((function(e){return e.setUploadParams(t)}));case 27:case"end":return e.stop()}}),e,this)}))),function(e,n,r){return t.apply(this,arguments)})},{key:"collectionFromProvider",value:function(){return this.mediaProvider&&this.mediaProvider.uploadParams&&this.mediaProvider.uploadParams.collection}},{key:"updateAndDispatch",value:function(e){var t=this;Object.keys(e).forEach((function(n){var r=n,i=e[r];void 0!==i&&(t[r]=i)})),this.dispatch&&this.dispatch(Z.a,We({},this))}}]),e}(),He=function(e){return Z.a.getState(e)},Je=function(e,t,n,r,i){var a=function(e){var t=document.createElement("div");return e?k.a.render(u.a.createElement(he,{type:"single"}),t):k.a.render(u.a.createElement(he),t),t}(i&&i.allowDropzoneDropLine);return new P.Plugin({state:{init:function(e,a){return new Ke(a,t,n,i,r)},apply:function(e,t){"number"==typeof t.editingMediaSinglePos&&(t.editingMediaSinglePos=e.mapping.map(t.editingMediaSinglePos));var n=e.getMeta(Z.a);if(n){var r=n.allowsUploads;t.updateAndDispatch({allowsUploads:void 0===r?t.allowsUploads:r})}return t}},filterTransaction:function(e,t){return!(e.selectionSet&&Object(M.isNodeSelection)(e.selection)&&e.selection.node.type===t.schema.nodes.media&&e.selection.$anchor.parent.type===t.schema.nodes.mediaSingle)},key:Z.a,view:function(e){var t=He(e.state);return t.setView(e),t.updateElement(),{update:function(){t.updateElement()}}},props:{decorations:function(e){if(He(e).showDropzone){var t=e.schema,n=e.selection.$anchor;if(e.selection instanceof P.NodeSelection){if(e.selection.node.type===t.nodes.mediaSingle){var r=C.a.node(e.selection.from,e.selection.to,{class:"richMedia-selected"});return C.b.create(e.doc,[r])}}else{var i=n.pos;if(n.parent.type!==t.nodes.paragraph&&n.parent.type!==t.nodes.codeBlock&&(i=Object(x.h)(e.doc,i,t.nodes.mediaGroup)),null!=i){var o=[C.a.widget(i,a,{key:"drop-placeholder"})];return C.b.create(e.doc,o)}}}},nodeViews:t.nodeViews,handleTextInput:function(e){return He(e.state).splitMediaGroup(),!1}}})},qe=n("7rzR");function $e(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Qe(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?$e(Object(n),!0).forEach((function(t){s()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):$e(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Xe=new P.PluginKey("mediaEditorPlugin"),Ze=Object(qe.a)(Xe,(function(e,t){switch(t.type){case"open":return Qe(Qe({},e),{},{editor:{identifier:t.identifier,pos:t.pos}});case"close":case"upload":return Qe(Qe({},e),{},{editor:void 0});case"setMediaClientConfig":return Qe(Qe({},e),{},{mediaClientConfig:t.mediaClientConfig});default:return e}}),{mapping:function(e,t){return t.editor?Qe(Qe({},t),{},{editor:Qe(Qe({},t.editor),{},{pos:e.mapping.map(t.editor.pos)})}):t}}),Ye=Ze.createPluginState,et=Ze.createCommand,tt=Ze.getPluginState;function nt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function rt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?nt(Object(n),!0).forEach((function(t){s()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):nt(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var it=function(){return et({type:"close"})},at=function(e,t){return et({type:"upload",newIdentifier:e},(function(n,r){var i=tt(r).editor;if(!i)return n;var a=n.mapping.map(i.pos),o=n.doc.nodeAt(a),s=r.schema.nodes.media;if(!o||o.type!==s)return n;var c=rt(rt({},o.attrs),{},{id:e.id,collection:e.collectionName||o.attrs.collection,occurrenceKey:e.occurrenceKey,width:t.width,height:t.height});return n.setNodeMarkup(a,void 0,c)}))},ot=function(e){return function(t){var n=function(){var e=h()(w.a.mark((function e(n,r){var i,a,o,s;return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("mediaProvider"===n){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,r;case 4:if(i=e.sent){e.next=7;break}return e.abrupt("return");case 7:return e.next=9,i.uploadMediaClientConfig;case 9:if(e.t0=e.sent,e.t0){e.next=14;break}return e.next=13,i.viewMediaClientConfig;case 13:e.t0=e.sent;case 14:a=e.t0,o=t.dispatch,s=t.state,et({type:"setMediaClientConfig",mediaClientConfig:a})(s,o,t);case 17:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}();return e.subscribe("mediaProvider",n),{destroy:function(){e.unsubscribe("mediaProvider",n)}}}},st=function(e){var t=e.dispatch,n=e.providerFactory;return new P.Plugin({state:Ye(t,{}),key:Xe,view:ot(n)})};function ct(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function ut(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ct(Object(n),!0).forEach((function(t){s()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ct(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var lt=n("6drl"),dt=new P.PluginKey("mediaAltTextPlugin"),pt=Object(qe.a)(dt,(function(e,t){switch(t.type){case"updateAltText":return ut({},e);case"openMediaAltTextMenu":return ut(ut({},e),{},{isAltTextEditorOpen:!0});case"closeMediaAltTextMenu":return ut(ut({},e),{},{isAltTextEditorOpen:!1});default:return e}}),{onSelectionChanged:function(e,t){return e.getMeta(lt.a)?t:{isAltTextEditorOpen:!1}}}),ft=pt.createPluginState,ht=pt.createCommand,mt=pt.getPluginState,vt=function(e){var t=e.dispatch;e.providerFactory;return new P.Plugin({state:ft(t,{isAltTextEditorOpen:!1}),key:dt,view:function(){return{update:function(e,t){var n=mt(e.state),r=mt(t);n&&r&&r.isAltTextEditorOpen&&!n.isAltTextEditorOpen&&!e.hasFocus()&&e.focus()}}}})},gt=n("pFaK"),yt=n("O+po");function bt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function wt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?bt(Object(n),!0).forEach((function(t){s()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):bt(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Ot,kt,Pt,xt=ht((function(e){return!!Object(ye.d)(e)&&{type:"closeMediaAltTextMenu"}})),Ct=(Ot=Oe.a.OPENED,kt=function(e){return!!Object(ye.d)(e)&&{type:"openMediaAltTextMenu"}},Pt=function(e){return e.setMeta("scrollIntoView",!1)},Object(ke.d)({action:Ot,actionSubject:Oe.b.MEDIA,actionSubjectId:Oe.c.ALT_TEXT,eventType:Oe.d.TRACK})(ht(kt,Pt)));var Et=n("XZ5u");function jt(e,t){var n=e.$from,r=n.index(n.depth-1),i=n.node(n.depth-1);return i?i.maybeChild(r+t):null}function St(e){return function(t,n){var r=t.selection.$from,i=t.schema.nodes.paragraph,a=jt(t.selection,-2);if(!a)return!1;var o=jt(t.selection,-1),s=r.pos-o.nodeSize-a.nodeSize,c=t.tr;if(function(t){var n=!1;try{n=e(t)}catch(r){}return n}(a))c=c.replace(s-1,s+a.nodeSize);else if(Object(ve.q)(t.selection)?c.replace(r.pos,r.pos+r.parent.nodeSize-1):c.replace(r.pos-1,r.pos+r.parent.nodeSize-1),a.type===i){var u=s+a.nodeSize-2;Object(M.safeInsert)(r.parent.content,u)(c)}else{var l=s+a.nodeSize-1;Object(M.safeInsert)(r.parent.copy(r.parent.content),l)(c)}return n&&n(c),!0}}var Mt,_t=function(e){var t=Object(ve.l)(e);return function(e,n){var r=e.selection,i=e.schema,a=r.$from;if(!function(e){return!!e.empty&&e.$from.parentOffset<=0}(e.selection))return!1;if(!function(e,t){return e.$from.parent.type===t}(e.selection,i.nodes.paragraph))return!1;return!!function(e,t,n){var r=jt(e,n);return!!r&&r.type===t}(e.selection,i.nodes.mediaSingle,-1)&&("wrap-right"===jt(e.selection,-1).attrs.layout?St(t)(e,n):(n&&Object(Et.f)(e,(function(r){t(a.parent)&&!Object(be.d)(e)&&r.replace(a.pos-1,a.pos+a.parent.nodeSize-1),n(r)})),!0))}};function Dt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function It(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Dt(Object(n),!0).forEach((function(t){s()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Dt(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}!function(e){e.showToolbar="MEDIA_SHOW_TOOLBAR",e.hideToolbar="MEDIA_HIDE_TOOLBAR",e.setUrl="MEDIA_SET_LINK_TO",e.unlink="MEDIA_LINKING_UNLINK"}(Mt||(Mt={}));function Tt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Nt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Tt(Object(n),!0).forEach((function(t){s()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Tt(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var At=new P.PluginKey("mediaLinking"),Lt={visible:!1,editable:!1,mediaPos:null,link:""};var Ut=Object(qe.a)(At,(function(e,t){switch(t.type){case Mt.showToolbar:return It(It({},e),{},{visible:!0});case Mt.setUrl:return It(It({},e),{},{editable:!0,link:t.payload});case Mt.hideToolbar:return It(It({},e),{},{visible:!1});case Mt.unlink:return It(It({},e),{},{link:"",visible:!1,editable:!1})}return e}),{mapping:function(e,t){return t&&null!==t.mediaPos?Nt(Nt({},t),{},{mediaPos:e.mapping.map(t.mediaPos)}):t},onSelectionChanged:function(e){if(!(e.selection instanceof P.NodeSelection))return Lt;var t=e.selection.$from.pos+1,n=e.doc.nodeAt(t);if(!n||"media"!==n.type.name)return Lt;var r=n.marks.find((function(e){return"link"===e.type.name}));return Nt(Nt({},Lt),{},r?{mediaPos:t,editable:!0,link:r.attrs.href}:{mediaPos:t})}}),Rt=Ut.createCommand,Ft=Ut.getPluginState,zt=n("7i3F"),Bt=n("eXjd"),Vt=function(e){var t=e.doc,n=e.selection,r=e.schema;if(t&&n&&n instanceof P.NodeSelection&&n.node.type===r.nodes.mediaSingle){var i=t.nodeAt(n.$anchor.pos+1);if(i&&i.type===r.nodes.media)return i}},Wt=n("5aEg"),Gt=function(){var e=h()(w.a.mark((function e(t,n){var r;return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("external"!==t.attrs.type){e.next=2;break}return e.abrupt("return","external");case 2:if(t.attrs.id){e.next=4;break}return e.abrupt("return");case 4:return e.prev=4,e.next=7,Object(Wt.a)(n).file.getCurrentState(t.attrs.id,{collectionName:t.attrs.collection});case 7:if(!(r=e.sent)||"error"===r.status){e.next=10;break}return e.abrupt("return",r.mediaType);case 10:e.next=14;break;case 12:e.prev=12,e.t0=e.catch(4);case 14:case"end":return e.stop()}}),e,null,[[4,12]])})));return function(t,n){return e.apply(this,arguments)}}();function Kt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Ht(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Kt(Object(n),!0).forEach((function(t){s()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Kt(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Jt=Rt((function(e){var t=Ft(e);if(t&&null!==t.mediaPos&&e.doc.nodeAt(t.mediaPos))return{type:Mt.showToolbar};return!1})),qt=function(e,t,n){if(t&&n){var r=Vt(e);if(!r)return!1;var i=He(e).mediaClientConfig;if(!i)return!1;Gt(r,i).then((function(e){"external"!==e&&"image"!==e||Vt(n.state)!==r||t(n.state.tr.setMeta(At,{type:Mt.showToolbar}))}))}return!0},$t=Rt({type:Mt.hideToolbar}),Qt=function(e,t,n){$t(e,t,n),n&&n.focus()};function Xt(e,t,n){var r=n.forceRemove,i=void 0!==r&&r,a=n.url,o=Ft(t);if(!o||null===o.mediaPos)return e;var s=t.doc.resolve(o.mediaPos),c=t.doc.nodeAt(s.pos);if(!c)return e;var u=t.schema.marks.link,l=t.schema.nodes.media;return Object(Bt.f)(u,(function(e,t){if(t&&t.type===l){if(i)return!1;var n=Object(zt.g)(a);if(!e||e.href!==n)return""!==n.trim()&&Ht(Ht({},e),{},{href:n})}}),[l])(s.pos,s.pos+c.nodeSize,e,t),e}var Zt=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:void 0;return Object(ke.a)(t,e,{action:n,eventType:Oe.d.TRACK,actionSubject:Oe.b.MEDIA,actionSubjectId:Oe.c.LINK,attributes:r})},Yt=Rt({type:Mt.unlink},(function(e,t){var n=Xt(e,t,{forceRemove:!0});return Zt(n,t,Oe.a.DELETED)})),en=function(e,t){var n=function(e){var t=e.schema.marks.link,n=Ft(e);if(n&&null!==n.mediaPos){var r=e.doc.resolve(n.mediaPos),i=e.doc.nodeAt(r.pos);if(i)if(t.isInSet(i.marks))return i.marks.find((function(e){return e.type===t})).attrs.href}}(t);return n?e!==n?Oe.a.EDITED:void 0:Oe.a.ADDED},tn=function(e,t){return Rt({type:Mt.setUrl,payload:Object(zt.g)(e)},(function(n,r){var i=en(e,r);if(!i)return n;try{var a=Xt(n,r,{url:e});return Zt(n,r,i,i===Oe.a.ADDED?{inputMethod:t}:void 0),a}catch(o){throw Zt(n,r,Oe.a.ERRORED,{action:i}),o}}))};var nn=function(e){return Z.a.getState(e).ignoreLinks=!0,!1},rn=function(e){return Z.a.getState(e).splitMediaGroup()},an=function(){var e={};return yt.bindKeymapWithCommand(yt.undo.common,nn,e),yt.bindKeymapWithCommand(yt.enter.common,rn,e),yt.bindKeymapWithCommand(yt.insertNewLine.common,rn,e),Object(gt.b)(e)},on=n("5+wD"),sn=n.n(on),cn=n("X/1r"),un=n("HGna"),ln=function(e){var t=e.editorView,n=e.eventDispatcher,r=e.pluginKey,i=e.isDisabled,a=e.isReducedSpacing;return u.a.createElement(un.a,{editorView:t,eventDispatcher:n,plugins:{mediaPlugin:r},render:function(e){var t,n=e.mediaPlugin;return n.allowsUploads?u.a.createElement(cn.a,{onClick:(t=n,function(){return t.showMediaPicker(),!0}),disabled:i,title:"Files & images",spacing:a?"none":"default",iconBefore:u.a.createElement(sn.a,{label:"Files & images"})}):null}})},dn=n("XLm4"),pn=n("06eS"),fn=n.n(pn),hn=n("GW/8"),mn=n("Km6/"),vn=n("WJQr"),gn=n("rgs1"),yn=n("x7QK"),bn=n.n(yn),wn=n("laKe"),On=n("KgC3"),kn=function(){function e(t){var n=this;v()(this,e),s()(this,"props",void 0),s()(this,"updateContextId",h()(w.a.mark((function e(){var t,r,i;return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((t=n.getAttrs())&&"file"===t.type){e.next=3;break}return e.abrupt("return");case 3:return r=t.id,e.next=6,n.getObjectId();case 6:i=e.sent,Le(r,{__contextId:i},n.props.isMediaSingle)(n.props.view.state,n.props.view.dispatch);case 8:case"end":return e.stop()}}),e)})))),s()(this,"hasFileAttributesDefined",(function(){var e=n.getAttrs();return e&&"file"===e.type&&e.__fileName&&e.__fileMimeType&&e.__fileSize&&e.__contextId})),s()(this,"updateFileAttrs",h()(w.a.mark((function e(){var t,r,i,a,o,s,c,u,l,d,p,f,h,m=arguments;return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=!(m.length>0&&void 0!==m[0])||m[0],r=n.getAttrs(),e.next=4,n.props.mediaProvider;case 4:if((i=e.sent)&&i.uploadParams&&r&&"file"===r.type&&!n.hasFileAttributesDefined()){e.next=7;break}return e.abrupt("return");case 7:return a=i.viewMediaClientConfig,o=Object(Wt.a)(a),s={collectionName:r.collection},e.prev=10,e.next=13,o.file.getCurrentState(r.id,s);case 13:if("error"!==(c=e.sent).status){e.next=16;break}return e.abrupt("return");case 16:e.next=21;break;case 18:return e.prev=18,e.t0=e.catch(10),e.abrupt("return");case 21:if(e.t1=n.getNodeContextId(),e.t1){e.next=26;break}return e.next=25,n.getObjectId();case 25:e.t1=e.sent;case 26:u=e.t1,d=(l=c).name,p=l.mimeType,f=l.size,Pn(r,h={__fileName:d,__fileMimeType:p,__fileSize:f,__contextId:u})&&Le(r.id,h,t)(n.props.view.state,n.props.view.dispatch);case 31:case"end":return e.stop()}}),e,null,[[10,18]])})))),s()(this,"getAttrs",(function(){var e=n.props.node.attrs;if(e)return e})),s()(this,"getObjectId",h()(w.a.mark((function e(){var t;return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.props.contextIdentifierProvider;case 2:return t=e.sent,e.abrupt("return",t&&t.objectId);case 4:case"end":return e.stop()}}),e)})))),s()(this,"uploadExternalMedia",function(){var e=h()(w.a.mark((function e(t){var r,i,a,o,s,c,u,l;return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.props.node,e.next=3,n.props.mediaProvider;case 3:if(i=e.sent,!r||!i){e.next=21;break}if((a=i.uploadMediaClientConfig)&&r.attrs.url){e.next=8;break}return e.abrupt("return");case 8:return o=Object(Wt.a)(a),s=i.uploadParams&&i.uploadParams.collection,e.prev=10,e.next=13,o.file.uploadExternal(r.attrs.url,s);case 13:c=e.sent,u=c.uploadableFileUpfrontIds,l=c.dimensions,Re(t()+1,{id:u.id,collection:s,height:l.height,width:l.width,occurrenceKey:u.occurrenceKey})(n.props.view.state,n.props.view.dispatch),e.next=21;break;case 18:e.prev=18,e.t0=e.catch(10),n.props.dispatchAnalyticsEvent&&n.props.dispatchAnalyticsEvent({action:Oe.a.UPLOAD_EXTERNAL_FAIL,actionSubject:Oe.b.EDITOR,eventType:Oe.d.OPERATIONAL});case 21:case"end":return e.stop()}}),e,null,[[10,18]])})));return function(t){return e.apply(this,arguments)}}()),s()(this,"getNodeContextId",(function(){var e=n.getAttrs();if(e&&"file"===e.type)return e.__contextId})),s()(this,"updateDimensions",(function(e){Le(e.id,{height:e.height,width:e.width},!0)(n.props.view.state,n.props.view.dispatch)})),s()(this,"hasDifferentContextId",h()(w.a.mark((function e(){var t,r;return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.getNodeContextId(),e.next=3,n.getObjectId();case 3:if(r=e.sent,!t||!r||t===r){e.next=6;break}return e.abrupt("return",!0);case 6:return e.abrupt("return",!1);case 7:case"end":return e.stop()}}),e)})))),s()(this,"isNodeFromDifferentCollection",h()(w.a.mark((function e(){var t,r,i,a,o;return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.props.mediaProvider;case 2:if((t=e.sent)&&t.uploadParams){e.next=5;break}return e.abrupt("return",!1);case 5:if(r=t.uploadParams.collection,(i=n.getAttrs())&&"file"===i.type){e.next=9;break}return e.abrupt("return",!1);case 9:if(a=i.collection,o=i.__contextId,e.t0=o,e.t0){e.next=15;break}return e.next=14,n.getObjectId();case 14:e.t0=e.sent;case 15:if(!e.t0||r===a){e.next=18;break}return e.abrupt("return",!0);case 18:return e.abrupt("return",!1);case 19:case"end":return e.stop()}}),e)})))),s()(this,"copyNodeFromBlobUrl",function(){var e=h()(w.a.mark((function e(t){var r,i,a,o,s,c,u,l,d,p,f,h,m,v,g,y,b,O,k;return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((r=n.getAttrs())&&"external"===r.type){e.next=3;break}return e.abrupt("return");case 3:if(i=r.url,a=Object(On.b)(i)){e.next=7;break}return e.abrupt("return");case 7:return e.next=9,n.props.mediaProvider;case 9:if((o=e.sent)&&o.uploadParams){e.next=12;break}return e.abrupt("return");case 12:if(s=o.uploadParams.collection,c=a.contextId,u=a.id,l=a.collection,d=a.height,p=a.width,f=a.mimeType,h=a.name,m=a.size,(v=o.uploadMediaClientConfig)&&v.getAuthFromContext){e.next=17;break}return e.abrupt("return");case 17:return g=Object(Wt.a)(v),e.next=20,v.getAuthFromContext(c);case 20:return y=e.sent,b={id:u,collection:l,authProvider:function(){return Promise.resolve(y)}},O={collection:s,authProvider:v.authProvider,occurrenceKey:bn()()},e.next=25,g.file.copyFile(b,O);case 25:k=e.sent,Re(t()+1,{id:k.id,collection:s,height:d,width:p,__fileName:h,__fileMimeType:f,__fileSize:m})(n.props.view.state,n.props.view.dispatch);case 27:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),s()(this,"copyNode",h()(w.a.mark((function e(){var t,r,i,a,o,s,c,u,l,d,p,f,h,m,v,g;return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.props.mediaProvider;case 2:if(t=e.sent,r=n.props,i=r.isMediaSingle,a=r.view,o=n.getAttrs(),t&&t.uploadParams&&o&&"file"===o.type){e.next=7;break}return e.abrupt("return");case 7:if(s=n.getNodeContextId(),!((c=t.uploadMediaClientConfig)&&c.getAuthFromContext&&s)){e.next=25;break}return u=Object(Wt.a)(c),e.next=13,c.getAuthFromContext(s);case 13:return l=e.sent,e.next=16,n.getObjectId();case 16:return d=e.sent,p=o.id,f=o.collection,h={id:p,collection:f,authProvider:function(){return Promise.resolve(l)}},m=t.uploadParams.collection,v={collection:m,authProvider:c.authProvider,occurrenceKey:bn()()},e.next=23,u.file.copyFile(h,v);case 23:g=e.sent,Ue(h.id,{id:g.id,collection:m,__contextId:d},i)(a.state,a.dispatch);case 25:case"end":return e.stop()}}),e)})))),this.props=t}var t,n;return y()(e,[{key:"isMediaBlobUrl",value:function(){var e=this.getAttrs();return!(!e||"external"!==e.type||!Object(On.c)(e.url))}},{key:"getRemoteDimensions",value:(n=h()(w.a.mark((function e(){var t,n,r,i,a,o,s,c,u,l;return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.props.mediaProvider;case 2:if(t=e.sent,n=this.props.mediaOptions,r=this.getAttrs(),t&&r){e.next=7;break}return e.abrupt("return",!1);case 7:if(i=r.height,a=r.width,"external"!==r.type&&r.id){e.next=10;break}return e.abrupt("return",!1);case 10:if(o=r.id,s=r.collection,!i||!a){e.next=13;break}return e.abrupt("return",!1);case 13:if(!n||n.allowRemoteDimensionsFetch){e.next=15;break}return e.abrupt("return",{id:o,height:wn.a,width:wn.b});case 15:return c=t.viewMediaClientConfig,u=Object(Wt.a)(c),e.next=19,u.getImageMetadata(o,{collection:s});case 19:if((l=e.sent)&&l.original){e.next=22;break}return e.abrupt("return",!1);case 22:return e.abrupt("return",{id:o,height:l.original.height||wn.a,width:l.original.width||wn.b});case 23:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"handleExternalMedia",value:(t=h()(w.a.mark((function e(t){return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isMediaBlobUrl()){e.next=12;break}return e.prev=1,e.next=4,this.copyNodeFromBlobUrl(t);case 4:e.next=10;break;case 6:return e.prev=6,e.t0=e.catch(1),e.next=10,this.uploadExternalMedia(t);case 10:e.next=14;break;case 12:return e.next=14,this.uploadExternalMedia(t);case 14:case"end":return e.stop()}}),e,this,[[1,6]])}))),function(e){return t.apply(this,arguments)})}]),e}(),Pn=function(e,t){return e.__fileName!==t.__fileName||e.__fileMimeType!==t.__fileMimeType||e.__fileSize!==t.__fileSize||e.__contextId!==t.__contextId};function xn(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=H()(e);if(t){var i=H()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return G()(this,n)}}var Cn=function(e){return Object(we.c)(e.anchorPos,e.headPos,e.getPos(),e.node.nodeSize)},En=function(e){V()(n,e);var t=xn(n);function n(e){var r;return v()(this,n),r=t.call(this,e),s()(z()(r),"mediaPluginState",void 0),s()(z()(r),"mediaNodes",void 0),s()(z()(r),"state",{viewMediaClientConfig:void 0}),s()(z()(r),"updateNodeAttrs",(function(e){var t=e.view,n=e.mediaProvider,i=e.contextIdentifierProvider;r.mediaNodes.forEach((function(e){new kn({view:t,mediaProvider:n,contextIdentifierProvider:i,node:e,isMediaSingle:!1}).updateFileAttrs(!1)}))})),s()(z()(r),"setMediaItems",(function(e){var t=e.node;r.mediaNodes=[],t.forEach((function(t,n){r.mediaPluginState.mediaGroupNodes[t.attrs.id]={node:t,getPos:function(){return e.getPos()+n+1}},r.mediaNodes.push(t)}))})),s()(z()(r),"getIdentifier",(function(e){return"external"===e.attrs.type?{mediaItemType:"external-image",dataURI:e.attrs.url}:{id:e.attrs.id,mediaItemType:"file",collectionName:e.attrs.collection}})),s()(z()(r),"isNodeSelected",(function(e){var t=Cn(r.props);return t===we.a.selectedInRange||t===we.a.selectedInside&&r.props.anchorPos===e})),s()(z()(r),"renderChildNodes",(function(){var e=r.state.viewMediaClientConfig,t=r.props,n=t.getPos,i=t.allowLazyLoading,a=t.disabled,o=t.mediaOptions,s=r.mediaNodes.map((function(e,t){var o=function(){return n()+t+1};return{identifier:r.getIdentifier(e),isLazy:i,selected:r.isNodeSelected(o()),onClick:function(){Object(X.f)(r.props.view,o())},actions:[{handler:a?function(){}:r.mediaPluginState.handleMediaNodeRemoval.bind(null,void 0,o),icon:u.a.createElement(fn.a,{label:"delete"})}]}}));return u.a.createElement(hn.a,{items:s,mediaClientConfig:e,featureFlags:o.featureFlags})})),r.mediaNodes=[],r.mediaPluginState=Z.a.getState(e.view.state),r.setMediaItems(e),r.state={viewMediaClientConfig:void 0},r}return y()(n,[{key:"componentDidMount",value:function(){var e=this;this.updateMediaClientConfig(),this.mediaNodes.forEach(function(){var t=h()(w.a.mark((function t(n){var r,i,a,o,s;return w.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if("external"!==n.attrs.type){t.next=2;break}return t.abrupt("return");case 2:if(r=e.props,i=r.view,a=r.mediaProvider,o=r.contextIdentifierProvider,s=new kn({view:i,mediaProvider:a,contextIdentifierProvider:o,node:n,isMediaSingle:!1}),s.getNodeContextId()){t.next=8;break}return t.next=8,s.updateContextId();case 8:return t.next=10,s.hasDifferentContextId();case 10:if(!t.sent){t.next=14;break}return t.next=14,s.copyNode();case 14:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())}},{key:"UNSAFE_componentWillReceiveProps",value:function(e){this.updateMediaClientConfig(),this.setMediaItems(e),!1!==e.isCopyPasteEnabled&&this.updateNodeAttrs(e)}},{key:"shouldComponentUpdate",value:function(e){return t=this.props,n=e,Cn(t)!==Cn(n)||Cn(n)===we.a.selectedInside&&t.anchorPos!==n.anchorPos||this.props.node!==e.node||this.state.viewMediaClientConfig!==this.mediaPluginState.mediaClientConfig;var t,n}},{key:"updateMediaClientConfig",value:function(){var e=this.state.viewMediaClientConfig,t=this.mediaPluginState.mediaClientConfig;!e&&t&&this.setState({viewMediaClientConfig:t})}},{key:"render",value:function(){return this.renderChildNodes()}}]),n}(u.a.Component);s()(En,"displayName","MediaGroup");var jn,Sn=function(e){V()(n,e);var t=xn(n);function n(){return v()(this,n),t.apply(this,arguments)}return y()(n,[{key:"render",value:function(e,t){var n=this,r=e.providerFactory,i=e.mediaOptions,a=this.getPos;return u.a.createElement(dn.a,{providers:["mediaProvider","contextIdentifierProvider"],providerFactory:r,renderNode:function(e){var r=e.mediaProvider,o=e.contextIdentifierProvider;return u.a.createElement(un.a,{editorView:n.view,plugins:{reactNodeViewState:vn.b,editorDisabledPlugin:gn.b},render:function(e){var s=e.editorDisabledPlugin;return r?u.a.createElement(En,{node:n.node,getPos:a,view:n.view,forwardRef:t,disabled:(s||{}).editorDisabled,allowLazyLoading:i.allowLazyLoading,mediaProvider:r,contextIdentifierProvider:o,isCopyPasteEnabled:i.isCopyPasteEnabled,anchorPos:n.view.state.selection.$anchor.pos,headPos:n.view.state.selection.$head.pos,mediaOptions:i}):null}})}})}}]),n}(mn.a),Mn=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return function(i,a,o){return new Sn(i,a,o,e,t,{providerFactory:n,mediaOptions:r}).init()}},_n=n("RNXH"),Dn=n.n(_n),In=n("LGLP"),Tn=n.n(In),Nn=n("ww0P"),An=n("iHxc"),Ln=n("bHTr"),Un=n("WISH"),Rn=n("RFGA"),Fn=T.default.div(jn||(jn=I()(["\n  img {\n    width: 100%;\n  }\n\n  & > div {\n    ",";\n    position: relative;\n    clear: both;\n  }\n"])),Rn.a);Fn.displayName="ResizerWrapper";var zn=n("9Bpa"),Bn=n("VUve"),Vn=n("LPnw"),Wn=[250,384,576,768];function Gn(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=H()(e);if(t){var i=H()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return G()(this,n)}}var Kn=function(e){V()(i,e);var t,n,r=Gn(i);function i(){var e;v()(this,i);for(var t=arguments.length,n=new Array(t),a=0;a<t;a++)n[a]=arguments[a];return e=r.call.apply(r,[this].concat(n)),s()(z()(e),"state",{offsetLeft:Hn(e.insideInlineLike,e.insideLayout,e.props.view.dom,void 0),isVideoFile:!0}),s()(z()(e),"calcNewSize",(function(t,n){var r=e.props,i=r.layout,a=r.view.state,o=100*Object(Ln.b)(t,e.props.lineLength);e.setState({resizedPctWidth:o});var s=Object(M.hasParentNodeOfType)(a.schema.nodes.table)(a.selection)?i:e.calcUnwrappedLayout(o,t);return o<=100?(!e.wrappedLayout||n&&100===o||(s=i),{width:o,layout:s}):{width:e.props.pctWidth||null,layout:s}})),s()(z()(e),"calcUnwrappedLayout",(function(e,t){return e<=100?"center":t<=Un.V?"wide":"full-width"})),s()(z()(e),"calcColumnLeftOffset",(function(){var t=e.state.offsetLeft;return e.insideInlineLike?Object(Ln.a)(t,e.props.lineLength,e.props.gridSize):0})),s()(z()(e),"wrapper",void 0),s()(z()(e),"calcPxWidth",(function(t){var n=e.props,r=n.width,i=n.height,a=n.layout,o=n.pctWidth,s=n.lineLength,c=n.containerWidth,u=n.fullWidthMode,l=n.getPos,d=n.view.state,p=e.state.resizedPctWidth,f="function"==typeof l?l():void 0;return Object(_.a)({origWidth:r,origHeight:i,pctWidth:o,state:d,containerWidth:{width:c,lineLength:s},isFullWidthModeEnabled:u,layout:t||a,pos:f,resizedPctWidth:p})})),s()(z()(e),"highlights",(function(t,n){var r=Object(Bn.c)(t,n),i=e.props.view.state.schema.nodes,a=i.layoutColumn,o=i.table,s=i.expand,c=i.nestedExpand;if(e.$pos&&Object(M.findParentNodeOfTypeClosestToPos)(e.$pos,[a,o,s,c].filter(Boolean)))return[];if(r>Un.V)return["full-width"];var u=e.props,l=u.layout,d=u.lineLength,p=u.gridSize,f=Object(Ln.a)(r,d,p),h=Math.round(f),m=[];return"wrap-left"===l||"align-start"===l?m.push(0,h):"wrap-right"===l||"align-end"===l?m.push(p,p-h):e.insideInlineLike?m.push(Math.round(f+e.calcColumnLeftOffset())):m.push(Math.floor((p-h)/2),Math.ceil((p+h)/2)),m})),s()(z()(e),"saveWrapper",(function(t){return e.wrapper=t})),e}return y()(i,[{key:"componentDidUpdate",value:function(){var e=Hn(this.insideInlineLike,this.insideLayout,this.props.view.dom,this.wrapper);return e!==this.state.offsetLeft&&e>=0&&this.setState({offsetLeft:e}),!0}},{key:"wrappedLayout",get:function(){return wn.e.indexOf(this.props.layout)>-1}},{key:"componentDidMount",value:(n=h()(w.a.mark((function e(){var t;return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t=this.props.viewMediaClientConfig)){e.next=4;break}return e.next=4,this.checkVideoFile(t);case 4:this.props.pctWidth&&this.setState({resizedPctWidth:this.props.pctWidth});case 5:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"UNSAFE_componentWillReceiveProps",value:function(e){this.props.viewMediaClientConfig!==e.viewMediaClientConfig&&this.checkVideoFile(e.viewMediaClientConfig),this.props.layout!==e.layout&&this.checkLayout(this.props.layout,e.layout)}},{key:"checkVideoFile",value:(t=h()(w.a.mark((function e(t){var n,r,i,a;return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((n=this.$pos)&&t){e.next=3;break}return e.abrupt("return");case 3:if((r=this.props.view.state.doc.nodeAt(n.pos+1))&&r.attrs.id){e.next=6;break}return e.abrupt("return");case 6:return i=Object(Wt.a)(t),e.prev=7,e.next=10,i.file.getCurrentState(r.attrs.id,{collectionName:r.attrs.collection});case 10:(a=e.sent)&&"error"!==a.status&&"image"===a.mediaType&&this.setState({isVideoFile:!1}),e.next=17;break;case 14:e.prev=14,e.t0=e.catch(7),this.setState({isVideoFile:!1});case 17:case"end":return e.stop()}}),e,this,[[7,14]])}))),function(e){return t.apply(this,arguments)})},{key:"checkLayout",value:function(e,t){var n=this.state.resizedPctWidth;if(wn.e.indexOf(e)>-1&&"center"===t&&n){var r=this.calcUnwrappedLayout(n,this.calcPxWidth(t));this.props.updateSize(n,r)}}},{key:"$pos",get:function(){if("function"!=typeof this.props.getPos)return null;var e=this.props.getPos();return Number.isNaN(e)||"number"!=typeof e?null:this.props.view.state.doc.resolve(e)}},{key:"gridWidth",get:function(){var e=this.props.gridSize;return this.wrappedLayout||this.insideInlineLike?e:e/2}},{key:"insideInlineLike",get:function(){var e=this.$pos;if(!e)return!1;var t=this.props.view.state.schema.nodes.listItem;return!!Object(M.findParentNodeOfTypeClosestToPos)(e,[t])}},{key:"insideLayout",get:function(){var e=this.$pos;if(!e)return!1;var t=this.props.view.state.schema.nodes.layoutColumn;return!!Object(M.findParentNodeOfTypeClosestToPos)(e,[t])}},{key:"render",value:function(){var e=this,t=this.props,n=t.width,r=t.height,i=t.layout,a=t.pctWidth,o=t.containerWidth,s=t.fullWidthMode,c=t.selected,l=t.view.state,d=t.children,p=this.calcPxWidth(),f=r/n*p,h=p,m={};Bn.a.forEach((function(t){var n="left"===t?"right":"left";m[t]=["full-width","wide","center"].concat("wrap-".concat(n)).concat("align-".concat(Bn.b[n])).indexOf(i)>-1,"left"===t&&e.insideInlineLike&&(m[t]=!1)}));this.$pos,Un.V,this.props.allowBreakoutSnapPoints,this.props.containerWidth,this.props.gridSize,this.gridWidth,this.insideInlineLike,this.insideLayout,this.state.isVideoFile,this.props.lineLength,this.state.offsetLeft,this.wrappedLayout;return u.a.createElement(Fn,{ratio:(f/h*100).toFixed(3),layout:i,isResized:!!a,containerWidth:o||n,innerRef:this.saveWrapper,fullWidthMode:s},u.a.createElement(zn.a,Tn()({},this.props,{width:h,height:f,selected:c,enable:m,calcNewSize:this.calcNewSize,snapPoints:Wn,scaleFactor:this.wrappedLayout||this.insideInlineLike?1:2,highlights:this.highlights,handleResizeStart:function(){var e=Object(Vn.c)(l);return!e||!e.dragging},nodeType:"media",dispatchAnalyticsEvent:this.props.dispatchAnalyticsEvent}),d))}}]),i}(u.a.Component);function Hn(e,t,n,r){var i=0;r&&e&&!t&&(i=r.getBoundingClientRect().left-n.getBoundingClientRect().left);return i}var Jn=n("YZT1"),qn=n("XKts"),$n=function(){return document.querySelectorAll(".ProseMirror > p").forEach((function(e){return e.setAttribute("contenteditable","false")}))},Qn=function(){return document.querySelectorAll(".ProseMirror > p").forEach((function(e){return e.setAttribute("contenteditable","")}))},Xn=function(){return document.querySelector(".ua-firefox")};function Zn(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Yn(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Zn(Object(n),!0).forEach((function(t){s()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Zn(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function er(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=H()(e);if(t){var i=H()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return G()(this,n)}}var tr=function(e){V()(r,e);var t,n=er(r);function r(){var e;v()(this,r);for(var t=arguments.length,i=new Array(t),a=0;a<t;a++)i[a]=arguments[a];return e=n.call.apply(n,[this].concat(i)),s()(z()(e),"state",{width:void 0,height:void 0,viewMediaClientConfig:void 0,isCopying:!1}),s()(z()(e),"createMediaNodeUpdater",(function(t){var n=e.props.node.firstChild;return new kn(Yn(Yn({},t),{},{isMediaSingle:!0,node:n||e.props.node,dispatchAnalyticsEvent:e.props.dispatchAnalyticsEvent}))})),s()(z()(e),"setViewMediaClientConfig",function(){var t=h()(w.a.mark((function t(n){var r,i;return w.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,n.mediaProvider;case 2:(r=t.sent)&&(i=r.viewMediaClientConfig,e.setState({viewMediaClientConfig:i}));case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),s()(z()(e),"updateMediaNodeAttributes",function(){var t=h()(w.a.mark((function t(n){var r,i,a,o,s,c;return w.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=e.createMediaNodeUpdater(n),i=e.props.mediaPluginState.addPendingTask,a=e.props.node.firstChild){t.next=5;break}return t.abrupt("return");case 5:return t.next=7,r.getRemoteDimensions();case 7:if((o=t.sent)&&r.updateDimensions(o),"external"!==a.attrs.type||!a.attrs.__external){t.next=15;break}return s=r.handleExternalMedia(e.props.getPos),i(s),t.next=14,s;case 14:return t.abrupt("return");case 15:if(r.getNodeContextId()){t.next=19;break}return t.next=19,r.updateContextId();case 19:return t.next=21,r.hasDifferentContextId();case 21:if(!t.sent){t.next=34;break}return e.setState({isCopying:!0}),t.prev=24,c=r.copyNode(),i(c),t.next=29,c;case 29:t.next=34;break;case 31:t.prev=31,t.t0=t.catch(24),e.setState({isCopying:!1});case 34:case"end":return t.stop()}}),t,null,[[24,31]])})));return function(e){return t.apply(this,arguments)}}()),s()(z()(e),"selectMediaSingle",(function(t){var n=t.event;n.stopPropagation();var r=e.props.getPos(),i=e.props.view.state;if(n.shiftKey){if(i.selection instanceof Q.a)return;Object(X.g)(e.props.view,i.selection.from<r?i.selection.from:r,i.selection.to>r?i.selection.to:r+3)}else Object(X.f)(e.props.view,r)})),s()(z()(e),"updateSize",(function(t,n){var r=e.props.view,i=r.state,a=r.dispatch,o=e.props.getPos();if(void 0!==o){var s=i.tr.setNodeMarkup(o,void 0,Yn(Yn({},e.props.node.attrs),{},{layout:n,width:t}));return s.setMeta("scrollIntoView",!1),a(s)}})),s()(z()(e),"forwardInnerRef",(function(t){e.props.forwardRef(t)})),s()(z()(e),"getLineLength",(function(e,t){if(Object(qn.c)(e,t)){var n=e.state.doc.resolve(t),r=e.nodeDOM(n.pos);if(n.nodeAfter&&qn.b.indexOf(n.nodeAfter.attrs.layout)>-1&&r&&r.parentElement)return r.parentElement.offsetWidth;if(r instanceof HTMLElement)return r.offsetWidth}return null})),e}return y()(r,[{key:"UNSAFE_componentWillReceiveProps",value:function(e){e.mediaProvider!==this.props.mediaProvider&&this.setViewMediaClientConfig(e),!1!==e.isCopyPasteEnabled&&this.createMediaNodeUpdater(e).updateFileAttrs()}},{key:"componentDidMount",value:(t=h()(w.a.mark((function e(){var t;return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.props.contextIdentifierProvider,e.next=3,Promise.all([this.setViewMediaClientConfig(this.props),this.updateMediaNodeAttributes(this.props)]);case 3:return e.t0=this,e.next=6,t;case 6:e.t1=e.sent,e.t2={contextIdentifierProvider:e.t1},e.t0.setState.call(e.t0,e.t2),(n=Xn()).addEventListener("dragstart",$n),n.addEventListener("dragend",Qn);case 10:case"end":return e.stop()}var n}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"componentWillUnmount",value:function(){var e;(e=Xn()).removeEventListener("dragstart",$n),e.removeEventListener("dragend",Qn)}},{key:"render",value:function(){var e=this.props,t=e.selected,n=e.getPos,r=e.node,i=e.mediaOptions,a=e.fullWidthMode,o=e.view.state,s=e.view,c=r.attrs,l=c.layout,d=c.width,p=r.firstChild.attrs,f=p.width,h=p.height;f&&h||(f=250,h=187.5);var m={layout:l,width:f,height:h,containerWidth:this.props.width,lineLength:this.props.lineLength||768,pctWidth:d||250/768*100,fullWidthMode:a},v=u.a.createElement(Y,{innerRef:this.forwardInnerRef}),g=!!this.props.mediaOptions.allowResizing;if(!this.props.mediaOptions.allowResizingInTables){var y=n();if(y){var b=o.doc.resolve(y),w=o.schema.nodes.table,O=!!Object(M.findParentNodeOfTypeClosestToPos)(b,[w]);g=g&&!O}}var k=this.getLineLength(s,n())||m.lineLength;return g?u.a.createElement(Kn,Tn()({},m,{lineLength:k,view:this.props.view,getPos:n,updateSize:this.updateSize,displayGrid:Object(Jn.a)(this.props.eventDispatcher),gridSize:12,viewMediaClientConfig:this.state.viewMediaClientConfig,allowBreakoutSnapPoints:i&&i.allowBreakoutSnapPoints,selected:t(),dispatchAnalyticsEvent:this.props.dispatchAnalyticsEvent}),v):u.a.createElement(wn.c,m,v)}}]),r}(c.Component);s()(tr,"defaultProps",{mediaOptions:{}}),s()(tr,"displayName","MediaSingleNode");var nr=function(e){V()(n,e);var t=er(n);function n(){var e;v()(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return e=t.call.apply(t,[this].concat(i)),s()(z()(e),"lastOffsetLeft",0),s()(z()(e),"forceViewUpdate",!1),s()(z()(e),"selectionType",null),s()(z()(e),"checkAndUpdateSelectionType",(function(){var t=e.getPos,n=e.view.state.selection,r=Object(we.c)(n.$anchor.pos,n.$head.pos,t(),e.node.nodeSize);return e.selectionType=r,r})),s()(z()(e),"isNodeSelected",(function(){return e.checkAndUpdateSelectionType(),null!==e.selectionType})),e}return y()(n,[{key:"createDomRef",value:function(){var e=document.createElement("div");return Nn.a.chrome&&this.reactComponentProps.mediaOptions&&this.reactComponentProps.mediaOptions.allowMediaSingleEditable&&(e.contentEditable="true"),e}},{key:"getContentDOM",value:function(){return{dom:document.createElement("div")}}},{key:"viewShouldUpdate",value:function(e){return this.forceViewUpdate?(this.forceViewUpdate=!1,!0):this.node.attrs!==e.attrs||(this.selectionType!==this.checkAndUpdateSelectionType()||Dn()(H()(n.prototype),"viewShouldUpdate",this).call(this,e))}},{key:"getNodeMediaId",value:function(e){if(e.firstChild)return e.firstChild.attrs.id}},{key:"update",value:function(e,t,r){var i=this;return r||(r=function(e,t){return i.getNodeMediaId(e)===i.getNodeMediaId(t)}),Dn()(H()(n.prototype),"update",this).call(this,e,t,r)}},{key:"render",value:function(e,t){var n=this,r=this.reactComponentProps,i=r.eventDispatcher,a=r.fullWidthMode,o=r.providerFactory,s=r.mediaOptions,c=r.dispatchAnalyticsEvent,l=this.getPos;return u.a.createElement(dn.a,{providers:["mediaProvider","contextIdentifierProvider"],providerFactory:o,renderNode:function(e){var r=e.mediaProvider,o=e.contextIdentifierProvider;return u.a.createElement(un.a,{editorView:n.view,plugins:{width:An.b,mediaPluginState:Z.a},render:function(e){var d=e.width,p=e.mediaPluginState;return u.a.createElement(tr,{width:d.width,lineLength:d.lineLength,node:n.node,getPos:l,mediaProvider:r,contextIdentifierProvider:o,mediaOptions:s,view:n.view,fullWidthMode:a,selected:n.isNodeSelected,eventDispatcher:i,mediaPluginState:p,dispatchAnalyticsEvent:c,forwardRef:t})}})}})}},{key:"ignoreMutation",value:function(){if(this.dom){var e=this.dom.offsetLeft;e!==this.lastOffsetLeft&&(this.lastOffsetLeft=e,this.forceViewUpdate=!0,this.update(this.node,[],(function(){return!0})))}return!0}}]),n}(mn.a),rr=function(e,t,n,r){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};return function(a,o,s){return new nr(a,o,s,e,t,{eventDispatcher:t,fullWidthMode:i.fullWidthEnabled,providerFactory:n,mediaOptions:i,dispatchAnalyticsEvent:r,isCopyPasteEnabled:i.isCopyPasteEnabled}).init()}},ir=n("QGb3"),ar=n.n(ir),or=n("CzxY"),sr=n.n(or),cr=n("368d"),ur=n("tUdN"),lr=n("Havv"),dr=n.n(lr),pr=n("YyNJ"),fr=n("uxt/"),hr=n("qwOa"),mr=Object(hr.e)({annotate:{id:"fabric.editor.annotate",defaultMessage:"Annotate",description:"Annotate an image by drawing arrows, adding text, or scribbles."}});function vr(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=H()(e);if(t){var i=H()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return G()(this,n)}}var gr,yr,br=function(e,t){var n=Z.a.getState(e);if(!n)return!1;var r=e.schema.nodes.mediaSingle,i=n.selectedMediaContainerNode();if(!i||i.type!==r)return!1;var a,o=i.firstChild.attrs,s=o.id,c=o.collection,u=o.occurrenceKey;return Object(ke.d)({action:Oe.a.CLICKED,actionSubject:Oe.b.MEDIA,actionSubjectId:Oe.c.ANNOTATE_BUTTON,eventType:Oe.d.UI})((a=e.selection.from+1,et({type:"open",identifier:{id:s,collectionName:c,mediaItemType:"file",occurrenceKey:u},pos:a})))(e,t)},wr=function(e){V()(i,e);var t,n,r=vr(i);function i(){var e;v()(this,i);for(var t=arguments.length,n=new Array(t),a=0;a<t;a++)n[a]=arguments[a];return e=r.call.apply(r,[this].concat(n)),s()(z()(e),"state",{isImage:!1}),s()(z()(e),"onClickAnnotation",(function(){var t=e.props.view;t&&br(t.state,t.dispatch)})),e}return y()(i,[{key:"componentDidMount",value:(n=h()(w.a.mark((function e(){return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.checkIsImage();case 2:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"checkIsImage",value:(t=h()(w.a.mark((function e(){var t,n;return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=Object(Wt.a)(this.props.viewMediaClientConfig),this.props.id){e.next=3;break}return e.abrupt("return");case 3:return e.prev=3,e.next=6,t.file.getCurrentState(this.props.id,{collectionName:this.props.collection});case 6:(n=e.sent)&&"error"!==n.status&&"image"===n.mediaType&&this.setState({isImage:!0}),e.next=12;break;case 10:e.prev=10,e.t0=e.catch(3);case 12:case"end":return e.stop()}}),e,this,[[3,10]])}))),function(){return t.apply(this,arguments)})},{key:"componentDidUpdate",value:function(e){var t=this;e.id!==this.props.id&&this.setState({isImage:!1},(function(){t.checkIsImage()}))}},{key:"render",value:function(){if(!this.state.isImage)return null;var e=this.props.intl.formatMessage(mr.annotate);return u.a.createElement(u.a.Fragment,null,u.a.createElement(fr.a,null),u.a.createElement(pr.a,{title:e,icon:u.a.createElement(dr.a,{label:e}),onClick:this.onClickAnnotation}))}}]),i}(u.a.Component),Or=function(e,t){return function(n,r){var i=e.selectedMediaContainerNode();return i&&e.mediaClientConfig?u.a.createElement(wr,{key:r,viewMediaClientConfig:e.mediaClientConfig,id:i.firstChild.attrs.id,collection:i.firstChild.attrs.collection,view:n,intl:t}):null}},kr=n("VqFj"),Pr=n.n(kr),xr=n("1mRP"),Cr=n.n(xr),Er=n("VrxG"),jr=n("BXdW"),Sr=n("pev1"),Mr=n("gnaU");function _r(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=H()(e);if(t){var i=H()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return G()(this,n)}}var Dr=Object(hr.e)({backLink:{id:"fabric.editor.backLink",defaultMessage:"Go back",description:"Go back from media linking toolbar to main toolbar"}}),Ir=T.default.section(gr||(gr=I()(["\n  display: flex;\n  line-height: 0;\n  padding: 12px 24px 12px 0;\n  margin: 0 4px 0 32px;\n  border-top: 1px solid ",";\n  align-items: start;\n  display: flex;\n  flex-direction: column;\n"])),A.R400),Tr=T.default.span(yr||(yr=I()(["\n  padding: 4px 8px 4px 0px;\n"]))),Nr=function(e){V()(n,e);var t=_r(n);function n(){var e;v()(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return e=t.call.apply(t,[this].concat(i)),s()(z()(e),"state",{validationErrors:[]}),s()(z()(e),"handleSubmit",(function(t){var n=t.url,r=t.inputMethod;e.props.onSubmit(n,{inputMethod:r})})),s()(z()(e),"handleOnBack",(function(t){var n=t.url,r=t.inputMethod,i=e.props.onBack;i&&i(n,{inputMethod:r})})),s()(z()(e),"handleCancel",(function(){var t=e.props.onCancel;t&&t()})),s()(z()(e),"handleUnlink",(function(){var t=e.props.onUnlink;t&&t()})),s()(z()(e),"handleOnBlur",(function(t){e.props.onBlur(t.url)})),s()(z()(e),"renderContainer",(function(t){var n,r=t.activityProvider,i=t.inputProps,a=i.onChange,o=i.onKeyDown,s=i.onSubmit,c=i.value,l=t.currentInputMethod,d=t.renderRecentList,p=e.props,f=p.intl.formatMessage,h=p.displayUrl,m=f(Dr.backLink),v=f(cr.b.unlink),g=e.state.validationErrors.map((function(e,t){return u.a.createElement(Mr.a,{key:t},e)}));return u.a.createElement("div",{className:"recent-list"},u.a.createElement(jr.a,{provider:!!r},u.a.createElement(jr.e,null,u.a.createElement(Tr,null,u.a.createElement(pr.a,{title:m,icon:u.a.createElement(Pr.a,{label:m}),onClick:function(){return e.handleOnBack({url:c,inputMethod:l})}})),u.a.createElement(Er.a,{testId:"media-link-input",placeholder:(n=!!r,f(n?cr.b.placeholder:cr.b.linkPlaceholder)),autoFocus:!0,onCancel:e.handleCancel,defaultValue:c,onSubmit:function(t){var n=e.getValidationErrors(t,l);e.setState({validationErrors:n}),n.length||s()},onChange:function(t){e.setState({validationErrors:[]}),a(t)},onKeyDown:o}),Object(zt.g)(h)&&u.a.createElement(u.a.Fragment,null,u.a.createElement(fr.a,null),u.a.createElement(pr.a,{title:v,icon:u.a.createElement(Cr.a,{label:v}),onClick:e.handleUnlink}))),!!g.length&&u.a.createElement(Ir,null,g),d()))})),e}return y()(n,[{key:"getValidationErrors",value:function(e,t){var n=this.props.intl.formatMessage;return t===Oe.e.TYPEAHEAD?[]:e?Object(zt.g)(e)?[]:[n(cr.b.invalidLink)]:[n(cr.b.emptyLink)]}},{key:"render",value:function(){var e=this.props,t=e.providerFactory,n=e.displayUrl;return u.a.createElement(Sr.a,{defaultUrl:Object(zt.g)(n),providerFactory:t,onSubmit:this.handleSubmit,onBlur:this.handleOnBlur,render:this.renderContainer})}}]),n}(u.a.PureComponent);function Ar(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Lr(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ar(Object(n),!0).forEach((function(t){s()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ar(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Ur(e){var t=Ft(e);if(!t||null===t.mediaPos)return!1;var n=e.schema,r=n.nodes.media,i=n.marks.link,a=e.doc.nodeAt(t.mediaPos);if(!a||a.type!==r)return!1;var o=e.doc.resolve(t.mediaPos).parent;return o&&o.type.allowsMarkType(i)}var Rr,Fr,zr,Br,Vr,Wr,Gr=function(e,t,n,r,i){var a=t.link,o=t.visible,s=t.editable,c=t.mediaPos;if(o&&null!==c&&n.doc.nodeAt(c))return Lr(Lr({},e),{},{height:jr.c,width:jr.d,forcePlacement:!0,items:[{type:"custom",render:function(e,t){return e&&i?u.a.createElement(Nr,{key:t,displayUrl:a,providerFactory:i,intl:r,editing:s,onUnlink:function(){return Yt(e.state,e.dispatch,e)},onBack:function(t,n){t.trim()&&n.inputMethod&&tn(t,n.inputMethod)(e.state,e.dispatch,e),Qt(e.state,e.dispatch,e)},onCancel:function(){return Qt(e.state,e.dispatch,e)},onSubmit:function(t,n){tn(t,n.inputMethod)(e.state,e.dispatch,e),Qt(e.state,e.dispatch,e)},onBlur:function(){Qt(e.state,e.dispatch,e)}}):null}}]})},Kr=n("nazu"),Hr=Object(hr.e)({altText:{id:"fabric.editor.addAltText",defaultMessage:"Alt text",description:"Add an alt text for this image"},editAltText:{id:"fabric.editor.editAltText",defaultMessage:"Edit alt text",description:"Edit an alt text for this image"},back:{id:"fabric.editor.closeAltTextEdit",defaultMessage:"Back",description:"Back to toolbar"},clear:{id:"fabric.editor.clearAltTextEdit",defaultMessage:"Clear alt text",description:"Clear alt text"},placeholder:{id:"fabric.editor.placeholderAltText",defaultMessage:"Describe this image with alt text",description:"Describe this image with alt text"},supportText:{id:"fabric.editor.supportAltText",defaultMessage:"Alt text is useful for people using screen readers because of visual limitations.",description:"Alt text is useful for people using screen readers because of visual limitations."},validationMessage:{id:"fabric.editor.alttext.validation",defaultMessage:"Please remove any special characters in alt text.",description:"Please remove any special characters in alt text. "}}),Jr=n("VfAS"),qr=n.n(Jr),$r=n("/V8Q"),Qr=n("Mlj8");function Xr(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=H()(e);if(t){var i=H()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return G()(this,n)}}var Zr=jr.d,Yr=T.default.p(Rr||(Rr=I()(["\n  color: ",";\n  font-size: 12px;\n  padding: 12px 40px;\n  line-height: 20px;\n  border-top: 1px solid ",";\n  margin: 0;\n"])),A.N100,A.N30),ei=T.default.div(Fr||(Fr=I()(["\n  width: ","px;\n  display: flex;\n  flex-direction: column;\n  overflow: auto;\n  line-height: 2;\n"])),Zr),ti=T.default.section(zr||(zr=I()(["\n  display: flex;\n  line-height: 0;\n  padding: 5px 0;\n  align-items: center;\n"]))),ni=T.default.section(Br||(Br=I()(["\n  display: flex;\n  line-height: 0;\n  padding: 12px 24px 12px 0;\n  margin: 0 12px 0 40px;\n  border-top: 1px solid ",";\n  align-items: start;\n  display: flex;\n  flex-direction: column;\n"])),A.R400),ri=T.default.div(Vr||(Vr=I()(["\n  display: flex;\n  padding: 4px 8px;\n"]))),ii=T.default.span(Wr||(Wr=I()(["\n  color: ",";\n"])),A.N80),ai=function(e){V()(n,e);var t=Xr(n);function n(e){var r;v()(this,n),r=t.call(this,e),s()(z()(r),"fireCustomAnalytics",void 0),s()(z()(r),"state",{showClearTextButton:Boolean(r.props.value),validationErrors:r.props.value?r.getValidationErrors(r.props.value):[],lastValue:r.props.value}),s()(z()(r),"prevValue",void 0),s()(z()(r),"closeMediaAltTextMenu",(function(){var e=r.props.view;xt(e.state,e.dispatch)})),s()(z()(r),"dispatchCancelEvent",(function(e){var t=r.props.view;t.someProp("handleKeyDown",(function(n){return n(t,e)}))})),s()(z()(r),"updateAltText",(function(e){var t=r.props.view;!function(e){return ht((function(e){return!!Object(ye.d)(e)&&{type:"updateAltText"}}),(function(t,n){var r=Object(ye.b)(n),i=t.selection.from+1;return r&&(t.setMeta("scrollIntoView",!1),t.setNodeMarkup(i,void 0,wt(wt({},r.attrs),{},{alt:e}))),t}))}(0===e.length?null:e)(t.state,t.dispatch)})),s()(z()(r),"handleOnChange",(function(e){var t=r.getValidationErrors(e);r.setState({showClearTextButton:Boolean(e),validationErrors:t,lastValue:e},(function(){t&&t.length||r.updateAltText(e)}))})),s()(z()(r),"handleOnBlur",(function(){var e=r.props.value,t=(r.state.lastValue||e||"").trim();r.handleOnChange(t)})),s()(z()(r),"handleClearText",(function(){r.handleOnChange("")}));var i=e.createAnalyticsEvent;return r.fireCustomAnalytics=Object(Qr.a)(i),r}return y()(n,[{key:"componentDidMount",value:function(){this.prevValue=this.props.value}},{key:"componentWillUnmount",value:function(){this.fireAnalytics(Oe.a.CLOSED),!this.prevValue&&this.props.value&&this.fireAnalytics(Oe.a.ADDED),this.prevValue&&!this.props.value&&this.fireAnalytics(Oe.a.CLEARED),this.prevValue&&this.prevValue!==this.props.value&&this.fireAnalytics(Oe.a.EDITED)}},{key:"getValidationErrors",value:function(e){var t=this.props.altTextValidator;return e&&"function"==typeof t&&t(e)||[]}},{key:"render",value:function(){var e=this.props.intl.formatMessage,t=this.state.showClearTextButton,n=e(Hr.back),r=u.a.createElement(yt.ToolTipContent,{description:n,keymap:yt.escape,shortcutOverride:"Esc"}),i=(this.state.validationErrors||[]).map((function(e,t){return u.a.createElement(Mr.a,{key:t},e)}));return u.a.createElement(ei,null,u.a.createElement(ti,null,u.a.createElement(ri,null,u.a.createElement(pr.a,{title:e(Hr.back),icon:u.a.createElement(Pr.a,{label:e(Hr.back)}),tooltipContent:r,onClick:this.closeMediaAltTextMenu})),u.a.createElement(Er.a,{testId:"alt-text-input",placeholder:e(Hr.placeholder),defaultValue:this.state.lastValue,onCancel:this.dispatchCancelEvent,onChange:this.handleOnChange,onBlur:this.handleOnBlur,onSubmit:this.closeMediaAltTextMenu,maxLength:510,autoFocus:!0}),t&&u.a.createElement(ri,null,u.a.createElement(pr.a,{testId:"alt-text-clear-button",title:e(Hr.clear),icon:u.a.createElement(ii,null,u.a.createElement(qr.a,{label:e(Hr.clear)})),tooltipContent:e(Hr.clear),onClick:this.handleClearText}))),!!i.length&&u.a.createElement(ni,null,i),u.a.createElement(Yr,null,e(Hr.supportText)))}},{key:"fireAnalytics",value:function(e){this.props.createAnalyticsEvent&&this.fireCustomAnalytics&&this.fireCustomAnalytics({payload:{action:e,actionSubject:Oe.b.MEDIA,actionSubjectId:Oe.c.ALT_TEXT,eventType:Oe.d.TRACK}})}}]),n}(u.a.Component),oi=Object($r.a)()(Object(hr.f)(ai)),si=n("5tuL");function ci(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function ui(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ci(Object(n),!0).forEach((function(t){s()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ci(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var li,di=function(e,t){var n=Object(ye.b)(t),r=n&&n.attrs.alt?Hr.editAltText:Hr.altText,i=e.formatMessage(r);return{title:i,type:"button",onClick:Ct,showTitle:!0,testId:"alt-text-edit-button",tooltipContent:u.a.createElement(yt.ToolTipContent,{description:i,keymap:yt.addAltText})}},pi=function(e){return{type:"custom",render:function(t,n){if(!t)return null;var r=Object(ye.b)(t.state);return r?u.a.createElement(oi,{view:t,key:n,value:r.attrs.alt,altTextValidator:e&&e.altTextValidator}):null}}},fi=function(e,t){return ui(ui({},e),{},{width:Zr,className:si.a.FLOATING_TOOLBAR_COMPONENT,items:[pi(t)]})},hi=n("XkwL"),mi=n.n(hi),vi=n("VKpd"),gi=n.n(vi),yi=n("qZ6Q"),bi=n.n(yi),wi=n("+oBr"),Oi=n("9JXw"),ki=T.default.div(li||(li=I()(["\n  display: flex;\n  align-items: center;\n  margin-right: 4px;\n"]))),Pi=function(e){var t=e.editorState,n=e.mediaLinkingState,r=e.intl,i=e.showSeparatorLeft,a=e.onAddLink,o=e.onEditLink,s=e.onOpenLink,l=Object(c.useState)(!1),d=mi()(l,2),p=d[0],f=d[1];if(Object(c.useEffect)((function(){var e;f(!1);var n=Vt(t);if(n){var r=null===(e=Z.a.getState(t))||void 0===e?void 0:e.mediaClientConfig;r&&Gt(n,r).then((function(e){"external"!==e&&"image"!==e||f(!0)}))}}),[t]),!p)return null;if(n&&n.editable){var h=Object(wi.a)(n.link),m=r.formatMessage(cr.b.editLink),v=r.formatMessage(h?Oi.a.openLink:cr.b.unableToOpenLink);return u.a.createElement(u.a.Fragment,null,i&&u.a.createElement(ki,null,u.a.createElement(fr.a,null)),u.a.createElement(ki,null,u.a.createElement(pr.a,{onClick:o,title:m,tooltipContent:u.a.createElement(yt.ToolTipContent,{description:m,keymap:yt.addLink})},m)),u.a.createElement(ki,null,u.a.createElement(fr.a,null)),u.a.createElement(pr.a,{target:"_blank",href:h?n.link:void 0,disabled:!h,onClick:s,title:v,icon:u.a.createElement(bi.a,{label:v}),className:"hyperlink-open-link"}))}var g=r.formatMessage(cr.b.addLink);return u.a.createElement(u.a.Fragment,null,i&&u.a.createElement(ki,null,u.a.createElement(fr.a,null)),u.a.createElement(pr.a,{testId:"add-link-button",onClick:a,title:g,tooltipContent:u.a.createElement(yt.ToolTipContent,{description:g,keymap:yt.addLink}),icon:u.a.createElement(gi.a,{label:g})}))};function xi(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Ci(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?xi(Object(n),!0).forEach((function(t){s()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):xi(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Ei=function(e,t){return t&&t(Object(M.removeSelectedNode)(e.tr)),!0},ji=n("9XXW"),Si=n("0cE9");function Mi(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=H()(e);if(t){var i=H()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return G()(this,n)}}var _i=function(e){V()(n,e);var t=Mi(n);function n(){var e;v()(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return e=t.call.apply(t,[this].concat(i)),s()(z()(e),"onUploadStart",(function(t,n){var r=e.props.view,i=r.state,a=r.dispatch;at(t,n)(i,a)})),s()(z()(e),"onClose",(function(){var t=e.props.view,n=t.state,r=t.dispatch;it()(n,r)})),e}return y()(n,[{key:"render",value:function(){var e=this.props.mediaEditorState,t=e.editor,n=e.mediaClientConfig;if(!t||!n)return null;var r=t.identifier;return u.a.createElement(Si.a,{identifier:r,mediaClientConfig:n,onUploadStart:this.onUploadStart,onClose:this.onClose})}}]),n}(u.a.PureComponent);function Di(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=H()(e);if(t){var i=H()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return G()(this,n)}}s()(_i,"displayName","MediaEditor");var Ii={on:function(){},removeAllListeners:function(){},emit:function(){},destroy:function(){},setUploadParams:function(){}},Ti=function(e){V()(n,e);var t=Di(n);function n(){var e;v()(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return e=t.call.apply(t,[this].concat(i)),s()(z()(e),"state",{}),s()(z()(e),"handleMediaProvider",function(){var t=h()(w.a.mark((function t(n,r){var i,a,o,s,c,u,l,d;return w.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i=e.props,a=i.mediaState,o=i.analyticsName,t.next=3,r;case 3:if((s=t.sent)&&s.uploadParams){t.next=6;break}return t.abrupt("return");case 6:return t.next=8,s.uploadMediaClientConfig;case 8:if(t.t0=t.sent,t.t0){t.next=13;break}return t.next=12,s.viewMediaClientConfig;case 12:t.t0=t.sent;case 13:if(c=t.t0){t.next=16;break}return t.abrupt("return");case 16:return u={mediaClientConfig:c,errorReporter:a.options.errorReporter||new E.a,featureFlags:a.mediaOptions&&a.mediaOptions.featureFlags},t.next=19,new ze("customMediaPicker",u,Ii,Fe.d,o).init();case 19:(l=t.sent).onNewMedia(a.insertFile),l.setUploadParams(s.uploadParams),d={uploadParams:s.uploadParams},e.setState({pickerFacadeInstance:l,config:d,mediaClientConfig:c});case 24:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}()),e}return y()(n,[{key:"componentDidMount",value:function(){this.props.mediaState.options.providerFactory.subscribe("mediaProvider",this.handleMediaProvider)}},{key:"componentWillUnmount",value:function(){this.props.mediaState.options.providerFactory.unsubscribe("mediaProvider",this.handleMediaProvider)}},{key:"render",value:function(){var e=this.state,t=e.mediaClientConfig,n=e.config,r=e.pickerFacadeInstance;return t&&n&&r?this.props.children({mediaClientConfig:t,config:n,pickerFacadeInstance:r}):null}}]),n}(u.a.Component),Ni=function(e){var t=e.mediaState,n=e.featureFlags;return u.a.createElement(Ti,{mediaState:t,analyticsName:"clipboard"},(function(e){var t=e.mediaClientConfig,r=e.config,i=e.pickerFacadeInstance;return u.a.createElement(Fe.b,{mediaClientConfig:t,config:r,onError:i.handleUploadError,onPreviewUpdate:i.handleUploadPreviewUpdate,onEnd:i.handleReady,featureFlags:n})}))};function Ai(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Li(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ai(Object(n),!0).forEach((function(t){s()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ai(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Ui=function(e){var t=e.mediaState,n=e.isActive,r=e.featureFlags;return u.a.createElement(Ti,{mediaState:t,analyticsName:"dropzone"},(function(e){var i=e.mediaClientConfig,a=e.config,o=e.pickerFacadeInstance,s=t.options.customDropzoneContainer,c=t.handleDrag,l=Li(Li({},a),{},{container:s});return n?u.a.createElement(Fe.c,{mediaClientConfig:i,config:l,onError:o.handleUploadError,onPreviewUpdate:o.handleUploadPreviewUpdate,onEnd:o.handleReady,onDragEnter:function(){return c("enter")},onDragLeave:function(){return c("leave")},featureFlags:r}):null}))},Ri=function(e){var t=e.mediaState,n=e.isOpen,r=e.onBrowseFn,i=e.featureFlags;return u.a.createElement(Ti,{mediaState:t,analyticsName:"browser"},(function(e){var t=e.mediaClientConfig,a=e.config,o=e.pickerFacadeInstance;return u.a.createElement(Fe.a,{onBrowseFn:r,isOpen:n,config:a,mediaClientConfig:t,onEnd:o.handleReady,onError:o.handleUploadError,onPreviewUpdate:o.handleUploadPreviewUpdate,featureFlags:i})}))};function Fi(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=H()(e);if(t){var i=H()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return G()(this,n)}}var zi=function(e){V()(n,e);var t=Fi(n);function n(){var e;v()(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return e=t.call.apply(t,[this].concat(i)),s()(z()(e),"state",{isPopupOpened:!1}),s()(z()(e),"onBrowseFn",(function(t){var n=e.props.mediaState;n&&n.setBrowseFn(t)})),e}return y()(n,[{key:"componentDidMount",value:function(){var e=this;this.props.mediaState.onPopupToggle((function(t){e.setState({isPopupOpened:t})}))}},{key:"render",value:function(){var e=this.props.mediaState,t=this.state.isPopupOpened,n=e.mediaOptions&&e.mediaOptions.featureFlags;return u.a.createElement(u.a.Fragment,null,u.a.createElement(Ni,{mediaState:e,featureFlags:n}),u.a.createElement(Ui,{mediaState:e,isActive:!t,featureFlags:n}),!e.shouldUseMediaPickerPopup()&&u.a.createElement(Ri,{onBrowseFn:this.onBrowseFn,mediaState:e,featureFlags:n}))}}]),n}(u.a.Component);s()(zi,"displayName","MediaPickerComponents");var Bi=n("8unR");function Vi(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=H()(e);if(t){var i=H()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return G()(this,n)}}var Wi=function(e){V()(n,e);var t=Vi(n);function n(){var e;v()(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return e=t.call.apply(t,[this].concat(i)),s()(z()(e),"renderMediaNodeWithState",(function(t,n,r){return function(i){var a=i.width,o=e.getPos,s=e.reactComponentProps.mediaOptions,c=e.view.state.selection,l=e.getAttrs(),d=l.width,p=l.height;d=d||wn.b,p=p||wn.a;var f={width:"".concat(a.width,"px"),height:"".concat(p/d*a.width,"px")},h={width:d,height:p};return u.a.createElement(de,{view:e.view,node:e.node,getPos:o,selected:e.isNodeInsideSelection(c.from,c.to)||c instanceof P.NodeSelection&&c.from===o(),originalDimensions:h,maxDimensions:f,mediaProvider:t,contextIdentifierProvider:n,uploadComplete:e.uploadComplete(),mediaOptions:s,collabEditProvider:r})}})),s()(z()(e),"renderMediaNodeWithProviders",(function(t){var n=t.mediaProvider,r=t.contextIdentifierProvider,i=t.collabEditProvider;return u.a.createElement(un.a,{editorView:e.view,plugins:{width:An.b},render:e.renderMediaNodeWithState(n,r,i)})})),e}return y()(n,[{key:"createDomRef",value:function(){var e=document.createElement("div");return Nn.a.chrome&&this.reactComponentProps.mediaOptions&&this.reactComponentProps.mediaOptions.allowMediaSingleEditable&&(e.contentEditable="true"),e}},{key:"viewShouldUpdate",value:function(e){return this.node.attrs!==e.attrs||Dn()(H()(n.prototype),"viewShouldUpdate",this).call(this,e)}},{key:"stopEvent",value:function(e){if(-1!==["mousedown","contextmenu"].indexOf(e.type)&&2===e.button)return!0;return!1}},{key:"getAttrs",value:function(){return this.node.attrs}},{key:"uploadComplete",value:function(){return Ae(Z.a.getState(this.view.state),this.node.attrs.id)}},{key:"render",value:function(){var e=this.reactComponentProps.providerFactory;return u.a.createElement(dn.a,{providers:["mediaProvider","contextIdentifierProvider","collabEditProvider"],providerFactory:e,renderNode:this.renderMediaNodeWithProviders})}}]),n}(n("Dol8").a),Gi=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return function(i,a,o){return new Wi(i,a,o,e,t,{eventDispatcher:t,providerFactory:n,mediaOptions:r}).init()}},Ki={allowResizing:!0,allowAdvancedToolBarOptions:!0,allowResizingInTables:!1,allowAnnotation:!0,UNSAFE_allowImageCaptions:!0};function Hi(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Ji(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Hi(Object(n),!0).forEach((function(t){s()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Hi(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var qi=function(e){return{name:"media",nodes:function(){var t=e||{},n=t.allowMediaGroup,r=void 0===n||n,i=t.allowMediaSingle,a=void 0!==i&&i,o=t.UNSAFE_allowImageCaptions,s=void 0!==o&&o?l.b:l.a;return[{name:"mediaGroup",node:d.a},{name:"mediaSingle",node:s},{name:"media",node:p.b}].filter((function(e){return"mediaGroup"===e.name?r:"mediaSingle"!==e.name||a}))},pmPlugins:function(){var t=[{name:"media",plugin:function(t){t.schema;var n=t.dispatch,r=t.eventDispatcher,i=t.providerFactory,a=t.errorReporter,o=t.portalProviderAPI,s=t.reactContext,c=t.dispatchAnalyticsEvent;return Je(0,{providerFactory:i,nodeViews:{mediaGroup:Mn(o,r,i,e),mediaSingle:rr(o,r,i,c,e),media:Gi(o,r,i,e)},errorReporter:a,uploadErrorHandler:e&&e.uploadErrorHandler,waitForMediaUpload:e&&e.waitForMediaUpload,customDropzoneContainer:e&&e.customDropzoneContainer,customMediaPicker:e&&e.customMediaPicker,allowResizing:!(!e||!e.allowResizing)},s,n,e)}},{name:"mediaKeymap",plugin:function(){return an()}}];return e&&e.allowMediaSingle&&t.push({name:"mediaSingleKeymap",plugin:function(e){return function(e){var t={},n=_t(e);return yt.bindKeymapWithCommand(yt.backspace.common,n,t),Object(gt.b)(t)}(e.schema)}}),e&&e.allowAnnotation&&t.push({name:"mediaEditor",plugin:st}),e&&e.allowAltTextOnImages&&(t.push({name:"mediaAltText",plugin:vt}),t.push({name:"mediaAltTextKeymap",plugin:function(e){var t;e.schema;return t={},yt.bindKeymapWithCommand(yt.addAltText.common,Ct,t),yt.bindKeymapWithCommand(yt.escape.common,xt,t),Object(gt.b)(t)}})),e&&e.allowLinking&&(t.push({name:"mediaLinking",plugin:function(e){return function(e){return new P.Plugin({key:At,state:Ut.createPluginState(e,Lt)})}(e.dispatch)}}),t.push({name:"mediaLinkingKeymap",plugin:function(e){var t;e.schema;return t={},yt.bindKeymapWithCommand(yt.addLink.common,qt,t),Object(gt.b)(t)}})),t},contentComponent:function(t){var n=t.editorView,r=t.eventDispatcher,i=e&&e.allowAnnotation?u.a.createElement(un.a,{editorView:n,plugins:{mediaEditorState:Xe},eventDispatcher:r,render:function(e){var t=e.mediaEditorState;return u.a.createElement(_i,{mediaEditorState:t,view:n})}}):null;return u.a.createElement(u.a.Fragment,null,u.a.createElement(un.a,{editorView:n,plugins:{mediaState:Z.a},render:function(e){var t=e.mediaState;return u.a.createElement(zi,{mediaState:t})}}),i)},secondaryToolbarComponent:function(e){var t=e.editorView,n=e.eventDispatcher,r=e.disabled;return u.a.createElement(ln,{editorView:t,eventDispatcher:n,pluginKey:Z.a,isDisabled:r,isReducedSpacing:!0})},pluginsOptions:{quickInsert:function(e){var t=e.formatMessage;return[{id:"media",title:t(Bi.a.filesAndImages),description:t(Bi.a.filesAndImagesDescription),priority:400,keywords:["attachment","gif","media","picture"],icon:function(){return u.a.createElement(ji.j,{label:t(Bi.a.filesAndImages)})},action:function(e,t){Z.a.getState(t).showMediaPicker();var n=e("");return Object(ke.a)(t,n,{action:Oe.a.OPENED,actionSubject:Oe.b.PICKER,actionSubjectId:Oe.c.PICKER_CLOUD,attributes:{inputMethod:Oe.e.QUICK_INSERT},eventType:Oe.d.UI})}}]},floatingToolbar:function(t,n,r){return function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=n.providerFactory,i=n.allowResizing,a=n.allowAnnotation,o=n.allowLinking,s=n.allowAdvancedToolBarOptions,c=n.allowResizingInTables,l=n.allowAltTextOnImages,d=n.altTextValidator,p=e.schema.nodes.mediaSingle,f=Z.a.getState(e),h=Ft(e);if(p&&f){var m={title:"Media floating controls",nodeType:p,getDomRef:function(){return f.element}};if(o&&h&&h.visible&&Ur(e)){var v=Gr(m,h,e,t,r);if(v)return v}var g=[];if(s){if((g=Object(Kr.a)(e,t,e.schema.nodes.mediaSingle,i,c)).length&&a&&g.push({type:"custom",render:Or(f,t)}),o&&Ur(e)){var y=g.length>0;g.push({type:"custom",render:function(e,n){if(null!=e&&e.state){var r=function(){if(e){var t=e.state,n=e.dispatch;Jt(t,n)}};return u.a.createElement(Pi,{key:n,editorState:e.state,intl:t,mediaLinkingState:h,onAddLink:r,onEditLink:r,onOpenLink:function(){if(e){var t=e.state;return(0,e.dispatch)(Object(ke.a)(t,t.tr,{eventType:Oe.d.TRACK,action:Oe.a.VISITED,actionSubject:Oe.b.MEDIA,actionSubjectId:Oe.c.LINK})),!0}},showSeparatorLeft:y})}return null}})}g.length&&g.push({type:"separator"})}if(l){var b=mt(e);if(b.isAltTextEditorOpen)return fi(m,{altTextValidator:d});g.push(di(t,e),{type:"separator"})}var w=[].concat(ar()(g),[{type:"button",appearance:"danger",icon:sr.a,onMouseEnter:Object(ur.b)(p,!0),onMouseLeave:Object(ur.b)(p,!1),title:t.formatMessage(cr.a.remove),onClick:Ei,testId:"media-toolbar-remove-button"}]);return Ci(Ci({},m),{},{items:w})}}(t,n,{providerFactory:r,allowResizing:e&&e.allowResizing,allowResizingInTables:e&&e.allowResizingInTables,allowAnnotation:e&&e.allowAnnotation,allowLinking:e&&e.allowLinking,allowAdvancedToolBarOptions:e&&e.allowAdvancedToolBarOptions,allowAltTextOnImages:e&&e.allowAltTextOnImages,altTextValidator:e&&e.altTextValidator})}}}};t.a=function(e){return qi(Ji(Ji({},e),Ki))}},ct2w:function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var r=function(e){return!!e&&(e.indexOf("image/")>-1||e.indexOf("video/")>-1)}},dmP3:function(e){e.exports=JSON.parse('{"Notes":{"Add":{"add_note":"Добавить заметку"},"Delete":{"delete_note":"Удалить","deleted":"Заметка перемещена в корзину вашего Диска","failed":"Не удалось удалить заметку, попробуйте снова"},"EditorView":{"main_placeholder":"Напишите что-нибудь…"},"Editor":{"title_placeholder":"Напишите заголовок","exit_confirmation_message":"Автоматическое сохранение не учло последние изменения в вашем документе. Пожалуйста, оставайтесь на текущей заметке, если хотите сохранить их.","exit_confirmation_title":"Отменить изменения?","exit_confirmation_leave":"Выйти без сохранения","exit_confirmation_cancel":"Отмена","read_only":"Эта заметка доступна только для чтения."},"Files":{"share":{"cta":"Поделиться"}},"List":{"latest_notes":"Последние заметки","name":"Название","updated_at":"Обновлено","location":"Расположение","sharings":"Доступы","at":"%{date} в %{time}"},"Empty":{"welcome":"Добро пожаловать в Twake Notes","after_created":"После создания заметки вы найдете ее в своем "},"SavingIndicator":{"saved":{"default":"Сохранено","just_now":"Сохранено","secs_ago":"Сохранено (%{time} сек. назад)","min_ago":"Сохранено (%{time} мин. назад)","mins_ago":"Сохранено (%{time} мин. назад)","hour_ago":"Сохранено (%{time} час назад)","hours_ago":"Сохранено (%{time} часа(-ов) назад)","day_ago":"Сохранено (%{time} день назад)","days_ago":"Сохранено (%{time} дня(-ей) назад)","month_ago":"Сохранено (%{time} месяц назад)","monthes_ago":"Сохранено (%{time} месяца(-ев) назад)","year_ago":"Сохранено (%{time} год назад)","years_ago":"Сохранено (%{time} лет назад)"},"saving":"Сохранение...","still_saving":"Сохранение......","out_of_sync":{"default":"Сохранено (не в сети)","just_now":"Сохранено (не в сети)","secs_ago":"Сохранено (не в сети %{time} сек)","min_ago":"Сохранено (не в сети %{time} мин)","mins_ago":"Сохранено (не в сети %{time} мин)","hour_ago":"Сохранено (не в сети %{time} час)","hours_ago":"Сохранено (не в сети %{time} часа(-ов))","day_ago":"Сохранено (не в сети %{time} день)","days_ago":"Сохранено (не в сети %{time} дня(-ей))","month_ago":"Сохранено (не в сети %{time} месяц)","monthes_ago":"Сохранено (не в сети %{time} месяца(-ев))","year_ago":"Сохранено (не в сети %{time} год)","years_ago":"Сохранено (не в сети %{time} лет)"},"saving_impossible":{"default":"Изменения не сохранены (не в сети)","just_now":"Изменения не сохранены (не в сети)","secs_ago":"Изменения не сохранены (не в сети %{time} сек)","min_ago":"Изменения не сохранены (не в сети %{time} мин)","mins_ago":"Изменения не сохранены (не в сети %{time} мин)","hour_ago":"Изменения не сохранены (не в сети %{time} час)","hours_ago":"Изменения не сохранены (не в сети %{time} часа(-ов))","day_ago":"Изменения не сохранены (не в сети %{time} день)","days_ago":"Изменения не сохранены (не в сети %{time} дня(-ей))","month_ago":"Изменения не сохранены (не в сети %{time} месяц)","monthes_ago":"Изменения не сохранены (не в сети %{time} месяца(-ев))","year_ago":"Изменения не сохранены (не в сети %{time} год)","years_ago":"Изменения не сохранены (не в сети %{time} лет)"}},"OfflineIndicator":{"message":"Вы больше не подключены к интернету. Ваши изменения будут сохранены после восстановления соединения."}},"Error":{"422":"Принимаются только изображения","unshared_title":"Доступ больше не активен","unshared_text":"Владелец мог отозвать доступ. Вы больше не можете редактировать заметку по этому адресу.","loading_error_title":"Не удалось загрузить заметку","loading_error_text_noReturnUrl":"Заметка могла быть удалена, или на серверах возникли временные неполадки. Пожалуйста, попробуйте позже.","back":"назад","unknown_error":"Произошла непредвиденная ошибка","only_one_image":"Нельзя перетаскивать несколько изображений одновременно"},"manifest":{"short_description":"Twake Notes — это ваше личное и совместное приложение для заметок.","long_description":"Notes — это онлайн-редактор текста, который уже может предложить вам:\\n\\n* Создавать свои заметки с основными функциями (жирный, подчеркивание, ссылки, таблицы...)\\n* Хранить и находить заметки среди других документов в вашем личном Диске\\n* Легко редактировать заметки с любых устройств\\n* Доступ к заметкам в автономном режиме\\n* Для фанатов: использование горячих клавиш и ввод в формате markdown ... и даже совместное редактирование заметок с другими пользователями (скоро)!","screenshots":["screenshots/en/screenshot01.png","screenshots/en/screenshot02.png"]},"Intents":{"save":"Сохранить"},"TrashedBanner":{"text":"Элемент перемещен в корзину","redirect":"Открыть корзину","restore":"Восстановить","restoreSuccess":"Элемент восстановлен","restoreError":"Произошла ошибка, попробуйте снова.","destroy":"Удалить навсегда"},"DestroyConfirm":{"title":"Удалить навсегда?","forbidden":"Вы больше не сможете получить доступ к этому файлу.","restore":"Вы не сможете восстановить этот файл, если у вас нет резервной копии.","cancel":"Отмена","delete":"Удалить навсегда","deleteError":"Произошла ошибка, попробуйте снова."},"MoreButton":{"more":"Еще"}}')},eUFy:function(e,t,n){var r={"./atlassian_missing_french":"xyGe","./atlassian_missing_french.json":"xyGe","./en":"2maa","./en.json":"2maa","./fr":"Hsuv","./fr.json":"Hsuv","./ru":"dmP3","./ru.json":"dmP3","./vi":"GwML","./vi.json":"GwML"};function i(e){var t=a(e);return n(t)}function a(e){if(!n.o(r,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return r[e]}i.keys=function(){return Object.keys(r)},i.resolve=a,e.exports=i,i.id="eUFy"},jXUu:function(e,t,n){"use strict";var r=n("GeFe"),i=n.n(r),a=n("Zvb3"),o=n.n(a),s=n("J/YY"),c=n.n(s),u=n("a1Fv"),l=n.n(u),d=n("g3eI"),p=n.n(d),f=n("wDGE"),h=n.n(f),m=n("J58c"),v=n.n(m),g=n("ivGQ"),y=n.n(g),b=n("dKM3"),w=n("zy2m"),O=n("G09D");function k(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=h()(e);if(t){var i=h()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return p()(this,n)}}var P=function(e){l()(n,e);var t=k(n);function n(e){var r;return i()(this,n),r=t.call(this,e),v()(c()(r),"handleRef",(function(e){r.setState({target:e||void 0})})),v()(c()(r),"updatePopupPlacement",(function(e){r.setState({popupPlacement:e})})),r.state={popupPlacement:["bottom","left"]},r}return o()(n,[{key:"renderDropdown",value:function(){var e=this.state.target,t=this.props,n=t.children,r=t.mountTo,i=t.boundariesElement,a=t.scrollableElement,o=t.onOpenChange,s=t.fitHeight,c=t.fitWidth,u=t.zIndex;return y.a.createElement(w.a,{target:e,mountTo:r,boundariesElement:i,scrollableElement:a,onPlacementChanged:this.updatePopupPlacement,fitHeight:s,fitWidth:c,zIndex:u},y.a.createElement("div",{style:{height:0,minWidth:c||0}},y.a.createElement(b.a,{disabled:!0,isOpen:!0,onOpenChange:o,appearance:"tall",position:"top left",shouldFlip:!1,shouldFitContainer:!0},n)))}},{key:"render",value:function(){var e=this.props,t=e.trigger,n=e.isOpen;return y.a.createElement(y.a.Fragment,null,y.a.createElement("div",{ref:this.handleRef},t),n?this.renderDropdown():null)}}]),n}(g.PureComponent),x=Object(O.a)(P);t.a=x},k359:function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var r=new(n("4z1N").PluginKey)("mediaPlugin")},q5Wy:function(e,t,n){"use strict";var r=n("ivGQ"),i=n.n(r).a.createContext(!1);t.a=i},uU7o:function(e,t,n){"use strict";n.d(t,"a",(function(){return r})),n.d(t,"b",(function(){return i}));var r=function(e){return null!==e&&"string"!=typeof e&&e},i=function(e){var t;return(null===(t=/(.+)(\/.+)$/.exec(e))||void 0===t?void 0:t[1])||e}},upXl:function(e,t,n){e.exports={"note-article":"note-article--2yQdC","note-article--intents":"note-article--intents--ghgU0",banner:"banner--1nSEd",title:"title--2DQ8I",titleInput:"titleInput--2ERlh"}},"v/Qj":function(e,t,n){"use strict";var r=n("q5Wy"),i=n("bOB9"),a=n("ivGQ"),o=n("xEu0");t.a=function(){var e=Object(o.useClient)(),t=Object(a.useContext)(r.a),n=Object(a.useMemo)((function(){return Object(i.k)()||(t?"?":Object(i.j)(e))}),[e,t]);return{userId:n,userName:n}}},v2Ur:function(e,t,n){"use strict";n.d(t,"b",(function(){return r})),n.d(t,"a",(function(){return i})),n.d(t,"c",(function(){return a}));n("wlqn");var r=function(){var e=document.querySelector("[role=application]");return JSON.parse(e.dataset.cozy)},i=function(e,t){return/^\{\{\.[a-zA-Z]*\}\}$/.test(e)?t:e},a=function(){return new URLSearchParams(window.location.search).get("sharecode")}},xyGe:function(e){e.exports=JSON.parse('{"fabric.editor.editMode.inviteToEditButton.title":"Inviter à éditer","fabric.editor.blockquote2":"Citation","fabric.editor.remove":"Supprimer","fabric.editor.linkPlaceholder":"Coller le lien","fabric.editor.linkAddress":"Adresse du lien","fabric.editor.layoutWide":"Élargir","fabric.editor.layoutFullWidth":"Pleine largeur","fabric.editor.layoutFixedWidth":"Retour au centre","fabric.editor.alignImageLeft":"Aligner l\'image à gauche","fabric.editor.alignImageCenter":"Centrer l\'image","fabric.editor.alignImageRight":"Aligner l\'image à droite","fabric.editor.numberedColumn":"Lignes numérotées","fabric.editor.taskPlaceholder":"Saisissez votre action"}')}});