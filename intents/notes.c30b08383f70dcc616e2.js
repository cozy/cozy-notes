!function(e){function t(t){for(var r,o,s=t[0],c=t[1],l=t[2],d=0,p=[];d<s.length;d++)o=s[d],Object.prototype.hasOwnProperty.call(i,o)&&i[o]&&p.push(i[o][0]),i[o]=0;for(r in c)Object.prototype.hasOwnProperty.call(c,r)&&(e[r]=c[r]);for(u&&u(t);p.length;)p.shift()();return a.push.apply(a,l||[]),n()}function n(){for(var e,t=0;t<a.length;t++){for(var n=a[t],r=!0,s=1;s<n.length;s++){var c=n[s];0!==i[c]&&(r=!1)}r&&(a.splice(t--,1),e=o(o.s=n[0]))}return e}var r={},i={5:0},a=[];function o(t){if(r[t])return r[t].exports;var n=r[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,o),n.l=!0,n.exports}o.e=function(e){var t=[],n=i[e];if(0!==n)if(n)t.push(n[2]);else{var r=new Promise((function(t,r){n=i[e]=[t,r]}));t.push(n[2]=r);var a,s=document.createElement("script");s.charset="utf-8",s.timeout=120,o.nc&&s.setAttribute("nonce",o.nc),s.src=function(e){return o.p+"vendors/"+({2:"@atlaskit-internal-editor-core-config-panel",3:"@atlaskit-internal_media-card"}[e]||e)+"."+{2:"bcd61036dc4dca7d337a",3:"848ba7058fc0419c657a"}[e]+".js"}(e);var c=new Error;a=function(t){s.onerror=s.onload=null,clearTimeout(l);var n=i[e];if(0!==n){if(n){var r=t&&("load"===t.type?"missing":t.type),a=t&&t.target&&t.target.src;c.message="Loading chunk "+e+" failed.\n("+r+": "+a+")",c.name="ChunkLoadError",c.type=r,c.request=a,n[1](c)}i[e]=void 0}};var l=setTimeout((function(){a({type:"timeout",target:s})}),12e4);s.onerror=s.onload=a,document.head.appendChild(s)}return Promise.all(t)},o.m=e,o.c=r,o.d=function(e,t,n){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)o.d(n,r,function(t){return e[t]}.bind(null,r));return n},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="",o.oe=function(e){throw console.error(e),e};var s=window.webpackJsonp=window.webpackJsonp||[],c=s.push.bind(s);s.push=t,s=s.slice();for(var l=0;l<s.length;l++)t(s[l]);var u=c;a.push([4,0,1]),n()}({0:function(e,t){},1:function(e,t){},2:function(e,t){},"2maa":function(e){e.exports=JSON.parse('{"Notes":{"Add":{"add_note":"Add a note"},"Delete":{"delete_note":"Delete","deleted":"The note has been moved to the trash of your Drive","failed":"The note could not be deleted, please try again"},"EditorView":{"main_placeholder":"Write anythingâ€¦"},"Editor":{"title_placeholder":"Write your title","exit_confirmation_message":"Automatic saving has not taken into account the latest changes in your doc. Please stay on your current note if you want to keep them.","exit_confirmation_title":"Abandon your changes?","exit_confirmation_leave":"Leave without saving","exit_confirmation_cancel":"Cancel","read_only":"This note is in read-only mode."},"Files":{"share":{"cta":"Share"}},"List":{"latest_notes":"Latest Notes","name":"Name","updated_at":"Updated at","location":"Location","sharings":"Sharings","at":"%{date} at %{time}"},"Empty":{"welcome":"Welcome on Cozy Notes","after_created":"Once your Note is created, you can find it in your "},"SavingIndicator":{"saved":{"default":"Up to date","just_now":"Up to date","secs_ago":"Up to date (saved %{time} sec. ago)","min_ago":"Up to date (saved %{time} min. ago)","mins_ago":"Up to date (saved %{time} min. ago)","hour_ago":"Up to date (saved %{time} hour ago)","hours_ago":"Up to date (saved %{time} hours ago)","day_ago":"Up to date (saved %{time} day ago)","days_ago":"Up to date (saved %{time} days ago)","month_ago":"Up to date (saved %{time} month ago)","monthes_ago":"Up to date (saved %{time} monthes ago)","year_ago":"Up to date (saved %{time} year ago)","years_ago":"Up to date (saved %{time} years ago)"},"saving":"Saving...","still_saving":"Saving......","out_of_sync":{"default":"Saved (off-line)","just_now":"Saved (off-line)","secs_ago":"Saved (off-line for %{time} sec)","min_ago":"Saved (off-line for %{time} min)","mins_ago":"Saved (off-line for %{time} min)","hour_ago":"Saved (off-line for %{time} hour)","hours_ago":"Saved (off-line for %{time} hours)","day_ago":"Saved (off-line for %{time} day)","days_ago":"Saved (off-line for %{time} days)","month_ago":"Saved (off-line for %{time} month)","monthes_ago":"Saved (off-line for %{time} monthes)","year_ago":"Saved (off-line for %{time} year)","years_ago":"Saved (off-line for %{time} years)"},"saving_impossible":{"default":"Changes unsaved (off-line)","just_now":"Changes unsaved (off-line)","secs_ago":"Changes unsaved (off-line for %{time} sec)","min_ago":"Changes unsaved (off-line for %{time} min)","mins_ago":"Changes unsaved (off-line for %{time} min)","hour_ago":"Changes unsaved (off-line for %{time} hour)","hours_ago":"Changes unsaved (off-line for %{time} hours)","day_ago":"Changes unsaved (off-line for %{time} day)","days_ago":"Changes unsaved (off-line for %{time} days)","month_ago":"Changes unsaved (off-line for %{time} month)","monthes_ago":"Changes unsaved (off-line for %{time} monthes)","year_ago":"Changes unsaved (off-line for %{time} year)","years_ago":"Changes unsaved (off-line for %{time} years)"}},"OfflineIndicator":{"message":"You\'re not connected to internet anymore. Your changes will be saved once you will be connected again."}},"Error":{"422":"Only images are accepted","unshared_title":"This share is no longer active","unshared_text":"The owner may have revoked this sharing. You can no longer edit a note at this address.","loading_error_title":"The note couldn\'t be loaded","loading_error_text_noReturnUrl":"The note may not exists anymore, or our servers may have a temporary glitch. Please try again later.","back":"back","unknown_error":"An unexpected error occured","only_one_image":"You cannot drag and drop multiple pictures at the same time"},"manifest":{"short_description":"Cozy Notes is your personal and collaborative note-taking application.","long_description":"Notes is an online text editor that can already offer you to:\\n\\n* Create your own notes with the essential features (bold, underlined, links, tables...)\\n* Fill and find your notes with you other documents in files of your personal Drive\\n* Edit easily your notes from all your devices\\n* Access your notes offline\\n* For the fans, use shortcuts and input in markdown format ... and even write with contacts together on the same note (coming soon)!","screenshots":["screenshots/en/screenshot01.png","screenshots/en/screenshot02.png"]},"Intents":{"save":"Save"},"TrashedBanner":{"text":"The item has been trashed","redirect":"Open the trash","restore":"Restore","restoreSuccess":"The item has been restored","restoreError":"An error has occurred, please try again.","destroy":"Delete permanently"},"DestroyConfirm":{"title":"Permanently delete?","forbidden":"You won\'t be able to access this file anymore.","restore":"You won\'t be able to restore this file if you didn\'t make a backup.","cancel":"Cancel","delete":"Delete permanently","deleteError":"An error has occurred, please try again."}}')},"2pt2":function(e,t,n){var r={"./_lib/build_formatting_tokens_reg_exp/index.js":"fQxh","./ar/build_distance_in_words_locale/index.js":"7ale","./ar/build_format_locale/index.js":"BUJk","./ar/index.js":"HoPF","./be/build_distance_in_words_locale/index.js":"rXT6","./be/build_format_locale/index.js":"6c7I","./be/index.js":"y+wm","./bg/build_distance_in_words_locale/index.js":"QV4S","./bg/build_format_locale/index.js":"h7EV","./bg/index.js":"6drF","./ca/build_distance_in_words_locale/index.js":"wVGO","./ca/build_format_locale/index.js":"qOJT","./ca/index.js":"J4Lj","./cs/build_distance_in_words_locale/index.js":"qeVT","./cs/build_format_locale/index.js":"9c+d","./cs/index.js":"jOEl","./da/build_distance_in_words_locale/index.js":"P7Gw","./da/build_format_locale/index.js":"ILGm","./da/index.js":"qqlu","./de/build_distance_in_words_locale/index.js":"Y5iN","./de/build_format_locale/index.js":"P5x0","./de/index.js":"1aUX","./el/build_distance_in_words_locale/index.js":"42PH","./el/build_format_locale/index.js":"wtRR","./el/index.js":"Nutn","./en/build_distance_in_words_locale/index.js":"jiHV","./en/build_format_locale/index.js":"Fyqn","./en/index.js":"mnDI","./eo/build_distance_in_words_locale/index.js":"+LkS","./eo/build_format_locale/index.js":"+W4M","./eo/index.js":"CG0c","./es/build_distance_in_words_locale/index.js":"zthh","./es/build_format_locale/index.js":"qi+F","./es/index.js":"jiRl","./fi/build_distance_in_words_locale/index.js":"+5Qr","./fi/build_format_locale/index.js":"y4fA","./fi/index.js":"kPjA","./fil/build_distance_in_words_locale/index.js":"yta+","./fil/build_format_locale/index.js":"A/Ua","./fil/index.js":"HcOy","./fr/build_distance_in_words_locale/index.js":"dS4D","./fr/build_format_locale/index.js":"yxzQ","./fr/index.js":"9cqe","./hr/build_distance_in_words_locale/index.js":"Z4qh","./hr/build_format_locale/index.js":"GXOL","./hr/index.js":"rGV6","./hu/build_distance_in_words_locale/index.js":"A6Uc","./hu/build_format_locale/index.js":"+c4x","./hu/index.js":"fxkC","./id/build_distance_in_words_locale/index.js":"riUr","./id/build_format_locale/index.js":"siJb","./id/index.js":"SJjQ","./is/build_distance_in_words_locale/index.js":"ROjY","./is/build_format_locale/index.js":"qi1n","./is/index.js":"KnO/","./it/build_distance_in_words_locale/index.js":"6Ku4","./it/build_format_locale/index.js":"YYsG","./it/index.js":"nOHs","./ja/build_distance_in_words_locale/index.js":"L5XS","./ja/build_format_locale/index.js":"SxiJ","./ja/index.js":"XIbb","./ko/build_distance_in_words_locale/index.js":"Hbvh","./ko/build_format_locale/index.js":"cEgd","./ko/index.js":"szAg","./mk/build_distance_in_words_locale/index.js":"FaeQ","./mk/build_format_locale/index.js":"sIRx","./mk/index.js":"Caof","./nb/build_distance_in_words_locale/index.js":"NrmK","./nb/build_format_locale/index.js":"S7yZ","./nb/index.js":"Rk98","./nl/build_distance_in_words_locale/index.js":"BZiP","./nl/build_format_locale/index.js":"HdNd","./nl/index.js":"J+GK","./pl/build_distance_in_words_locale/index.js":"Ky9W","./pl/build_format_locale/index.js":"uxkL","./pl/index.js":"0x8W","./pt/build_distance_in_words_locale/index.js":"pN3j","./pt/build_format_locale/index.js":"RFRV","./pt/index.js":"lwnL","./ro/build_distance_in_words_locale/index.js":"JAuI","./ro/build_format_locale/index.js":"j1sQ","./ro/index.js":"gHE0","./ru/build_distance_in_words_locale/index.js":"7ryk","./ru/build_format_locale/index.js":"cTIL","./ru/index.js":"8J30","./sk/build_distance_in_words_locale/index.js":"2oAD","./sk/build_format_locale/index.js":"jVdS","./sk/index.js":"a5Cf","./sl/build_distance_in_words_locale/index.js":"m2c+","./sl/build_format_locale/index.js":"l1+s","./sl/index.js":"qHQe","./sr/build_distance_in_words_locale/index.js":"h7wD","./sr/build_format_locale/index.js":"oLNh","./sr/index.js":"oBDG","./sv/build_distance_in_words_locale/index.js":"RjDH","./sv/build_format_locale/index.js":"LRUT","./sv/index.js":"9KBP","./th/build_distance_in_words_locale/index.js":"SjuW","./th/build_format_locale/index.js":"yHKE","./th/index.js":"rRsv","./tr/build_distance_in_words_locale/index.js":"oPNn","./tr/build_format_locale/index.js":"JNO2","./tr/index.js":"Ra5m","./zh_cn/build_distance_in_words_locale/index.js":"+qzK","./zh_cn/build_format_locale/index.js":"EDbf","./zh_cn/index.js":"SUby","./zh_tw/build_distance_in_words_locale/index.js":"HKTt","./zh_tw/build_format_locale/index.js":"L1Oa","./zh_tw/index.js":"ZoqY"};function i(e){var t=a(e);return n(t)}function a(e){if(!n.o(r,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return r[e]}i.keys=function(){return Object.keys(r)},i.resolve=a,e.exports=i,i.id="2pt2"},3:function(e,t){},"3xVv":function(e,t,n){"use strict";n.d(t,"d",(function(){return j})),n.d(t,"b",(function(){return C})),n.d(t,"c",(function(){return E})),n.d(t,"e",(function(){return S})),n.d(t,"a",(function(){return M}));var r=n("J58c"),i=n.n(r),a=n("iO45"),o=n("9Jaj"),s=n("laKe"),c=n("bHTr"),l=n("WISH"),u=n("3mYb"),d=n("PuAp"),p=n("CDNI"),f=n("I/PM"),h=n("AV8T"),m=n("3sCF"),v=n("Eh77"),g=n("OZn/"),b=n("ct2w"),y=n("3Su3");function w(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function O(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?w(Object(n),!0).forEach((function(t){i()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):w(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var k=function(e,t){return{action:h.a.INSERTED,actionSubject:h.b.DOCUMENT,actionSubjectId:h.c.MEDIA,attributes:{inputMethod:e,fileExtension:t,type:h.c.MEDIA_SINGLE},eventType:h.d.TRACK}};function x(e){return Object(y.a)(e)&&!Object(u.d)(e.selection,e.doc,d.g)}function P(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return function(n,r){var i=n.tr,o=n.schema.nodes.paragraph,s=t.inputMethod,c=t.fileExtension,l=0;return x(n)&&(e.push(o.create()),l=1),i.replaceSelection(new a.Slice(a.Fragment.from(e),0,l)),s&&Object(m.a)(n,i,k(s,c)),r&&r(i),!0}}var j=function(e,t){return!!e.nodes.mediaSingle&&Object(b.a)(t)},C=function(e,t,n){var r=e.state,i=e.dispatch,a=r.schema.nodes,o=a.mediaSingle,s=a.media;return!!o&&(!(t.type!==s||!Object(b.a)(t.attrs.__fileMimeType)&&"external"!==t.attrs.type)&&P([o.create({},t)],{inputMethod:n,fileExtension:t.attrs.__fileMimeType})(r,i))},E=function(e,t,n,r,i){if(void 0===r)return!1;var s,c=e.state,l=e.dispatch,u=c.selection.$from.node(-1),d=_(c.schema,r,i)(t),p=u&&u.type.validContent(a.Fragment.from(d));if(t.fileName){var f=t.fileName.lastIndexOf(".");s=f>=0?t.fileName.substring(f+1):void 0}if(p)P([d],{fileExtension:s,inputMethod:n})(c,l);else{var h=null;if(Object(g.b)(e.state).newInsertionBehaviour&&(h=Object(v.b)(d,c.selection.from)(c.tr)),!h){var b=x(e.state)?a.Fragment.fromArray([d,c.schema.nodes.paragraph.create()]):d;h=Object(o.safeInsert)(b,void 0,!0)(c.tr)}n&&(h=Object(m.a)(c,h,k(n,s))),l(h)}return!0},_=function(e,t,n){return function(r){var i=r.id,a=r.dimensions,o=r.contextId,s=r.scaleFactor,c=void 0===s?1:s,l=a||{height:void 0,width:void 0},u=l.width,d=l.height,f=e.nodes,h=f.media,m=f.mediaSingle,v=h.create({id:i,type:"file",collection:t,contextId:o,width:u&&Math.round(u/c),height:d&&Math.round(d/c)}),g=n?{layout:"align-start"}:{};return Object(p.a)(r,v),m.createChecked(g,v)}};function S(e,t){var n=t.nodes,r=n.mediaSingle,i=n.layoutSection,a=n.table,s=n.bulletList,c=n.orderedList,l=n.media,u=n.expand;return function(t){var n=e;return Object(o.hasParentNodeOfType)([i,a,s,c,u])(t)&&(n=Object(f.e)(n,(function(e){return"mediaSingle"===e.type.name?r.createChecked({},e.content,e.marks):e}))),n=Object(f.e)(n,(function(e){return"media"===e.type.name&&"external"===e.attrs.type?l.createChecked(O(O({},e.attrs),{},{__external:!0}),e.content,e.marks):e}))}}var M=function(e){var t=e.origWidth,n=e.origHeight,r=e.layout,i=e.pctWidth,a=e.containerWidth,o=e.resizedPctWidth,c=a.width,u=a.lineLength,d=D(a,i,t,n),p=D(a,o,t,n);if("wide"===r){if(u){var f=Math.ceil(u*l.Z);return f>c?u:f}}else{if("full-width"===r)return c-l.d;if(d)return s.e.indexOf(r)>-1?p?o<50?p:d:Math.max(d,t):p||d;if("center"===r)return p||Math.min(t,u||c);if(r&&-1!==s.e.indexOf(r)){var h=Math.ceil((u||c)/2);return t<=h?t:h}}return t},D=function(e,t,n,r){return t&&n&&r&&Math.ceil(Object(c.d)(t/100,e.lineLength||e.width))}},4:function(e,t,n){n("jI5P"),n("NHXp"),e.exports=n("MQ8b")},"4vUV":function(e,t,n){"use strict";var r,i,a,o,s,c,l;n.d(t,"d",(function(){return r})),n.d(t,"c",(function(){return i})),n.d(t,"f",(function(){return a})),n.d(t,"e",(function(){return o})),n.d(t,"g",(function(){return s})),n.d(t,"a",(function(){return c})),n.d(t,"i",(function(){return l})),n.d(t,"h",(function(){return d})),n.d(t,"b",(function(){return u})),function(e){e.NoFileFoundAfterInput="No File was detected during the upload procedure.",e.FileNotProcessable="Could not process the uploaded image.",e.CouldNotFindFileInCurrentNote="Could not find file in current note.",e.MissingCollabEdit="`CollabEditProvider` was `undefined` in `fetchCozyImage`. <Media> was unable to fetch the image source. The component might be unmounted.",e.CouldNotGetNoteImages="MediaNode failed to fetch included files in the current note"}(r||(r={})),function(e){e.Input="input"}(i||(i={})),function(e){e.File="file"}(a||(a={})),function(e){e.Click="click",e.Change="change",e.Drop="drop",e.Paste="paste"}(o||(o={})),function(e){e.Created="CREATED",e.Updated="UPDATED"}(s||(s={})),function(e){e.Files="io.cozy.files",e.NoteEvents="io.cozy.notes.events",e.Thumbnails="io.cozy.files.thumbnails"}(c||(c={})),function(e){e.Drive="drive",e.Home="home",e.Notes="notes"}(l||(l={}));var u,d="/preview/";!function(e){e.Files="Files",e.Notes="Notes"}(u||(u={}))},"5tuL":function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var r={FLOATING_TOOLBAR_COMPONENT:"".concat("pm-alt-text","-alt-text-floating-toolbar")}},"5z4W":function(e,t){e.exports={name:"Notes",name_prefix:"Cozy",slug:"notes",icon:"icon.svg",categories:["cozy"],version:"1.34.0",licence:"AGPL-3.0",editor:"Cozy",source:"https://github.com/cozy/cozy-notes.git@build",developer:{name:"Cozy Cloud",url:"https://cozy.io"},screenshots:["screenshots/fr/screenshot01.png","screenshots/fr/screenshot02.png"],langs:["en","fr"],routes:{"/":{folder:"/",index:"index.html",public:!1},"/public":{folder:"/",index:"index.html",public:!0},"/preview":{folder:"/",index:"index.html",public:!0},"/intents":{folder:"/intents",index:"index.html",public:!1}},intents:[{action:"OPEN",type:["io.cozy.notes.documents"],href:"/intents"}],permissions:{apps:{description:"Required by the cozy-bar to display the icons of the apps",type:"io.cozy.apps",verbs:["GET"]},files:{description:"Notes as files",type:"io.cozy.files"},settings:{description:"Required by the cozy-bar to display Claudy and know which applications are coming soon",type:"io.cozy.settings",verbs:["GET"]},sharings:{description:"Required to have access to the sharings in realtime",type:"io.cozy.sharings",verbs:["GET"]},contacts:{type:"io.cozy.contacts",verbs:["GET","POST"]},groups:{type:"io.cozy.contacts.groups",verbs:["GET"]},intents:{type:"io.cozy.notes.documents",verbs:["GET"]}}}},"6mlU":function(e,t,n){"use strict";n.d(t,"c",(function(){return i})),n.d(t,"a",(function(){return a})),n.d(t,"b",(function(){return l}));var r=n("iO45"),i=4,a=function(){return i},o=[["date",{inline:!0,group:"inline",selectable:!0,attrs:{timestamp:{default:""}},parseDOM:[{tag:'span[data-node-type="date"]'}]}],["status",{inline:!0,group:"inline",selectable:!0,attrs:{text:{default:""},color:{default:""},localId:{default:"dfab1003-a025-425f-869b-4592431ae618"},style:{default:""}},parseDOM:[{tag:'span[data-node-type="status"]'}]}],["doc",{content:"(block)+",marks:"alignment breakout indentation link unsupportedMark unsupportedNodeAttribute"}],["paragraph",{selectable:!1,content:"inline*",group:"block",marks:"strong code em link strike subsup textColor typeAheadQuery underline unsupportedMark unsupportedNodeAttribute",parseDOM:[{tag:"p"}]}],["text",{group:"inline"}],["bulletList",{group:"block",content:"listItem+",selectable:!1,parseDOM:[{tag:"ul"}],marks:"unsupportedMark unsupportedNodeAttribute"}],["orderedList",{group:"block",content:"listItem+",marks:"unsupportedMark unsupportedNodeAttribute",selectable:!1,parseDOM:[{tag:"ol"}]}],["listItem",{content:"(paragraph | mediaSingle | codeBlock) (paragraph | bulletList | orderedList | mediaSingle | codeBlock)*",marks:"link unsupportedMark unsupportedNodeAttribute",defining:!0,selectable:!1,parseDOM:[{tag:"li"}]}],["heading",{attrs:{level:{default:1}},content:"inline*",group:"block",defining:!0,selectable:!1,parseDOM:[{tag:"h1",attrs:{level:1}},{tag:"h2",attrs:{level:2}},{tag:"h3",attrs:{level:3}},{tag:"h4",attrs:{level:4}},{tag:"h5",attrs:{level:5}},{tag:"h6",attrs:{level:6}}]}],["blockquote",{content:"paragraph+",group:"block",defining:!0,selectable:!1,parseDOM:[{tag:"blockquote"}]}],["codeBlock",{attrs:{language:{default:null},uniqueId:{default:null}},content:"text*",marks:"unsupportedMark unsupportedNodeAttribute",group:"block",code:!0,defining:!0,parseDOM:[{tag:"pre",preserveWhitespace:"full"},{tag:"div[style]",preserveWhitespace:"full"},{tag:"table[style]",preserveWhitespace:"full"},{tag:"div.code-block",preserveWhitespace:"full"}]}],["rule",{group:"block",parseDOM:[{tag:"hr"}]}],["panel",{group:"block",content:"(paragraph | heading | bulletList | orderedList )+",marks:"unsupportedMark unsupportedNodeAttribute",attrs:{panelType:{default:"info"}},parseDOM:[{tag:"div[data-panel-type]"}]}],["confluenceUnsupportedBlock",{group:"block",attrs:{cxhtml:{default:null}},parseDOM:[{tag:'div[data-node-type="confluenceUnsupportedBlock"]'}]}],["confluenceUnsupportedInline",{group:"inline",inline:!0,atom:!0,attrs:{cxhtml:{default:null}},parseDOM:[{tag:'div[data-node-type="confluenceUnsupportedInline"]'}]}],["unsupportedBlock",{inline:!1,group:"block",atom:!0,selectable:!0,attrs:{originalValue:{default:{}}},parseDOM:[{tag:'[data-node-type="unsupportedBlock"]'}]}],["unsupportedInline",{inline:!0,group:"inline",selectable:!0,attrs:{originalValue:{default:{}}},parseDOM:[{tag:'[data-node-type="unsupportedInline"]'}]}],["hardBreak",{inline:!0,group:"inline",selectable:!1,parseDOM:[{tag:"br"}]}],["mediaSingle",{inline:!1,group:"block",selectable:!0,atom:!0,content:"media | media ( unsupportedBlock)",attrs:{width:{default:null},layout:{default:"center"}},marks:"unsupportedMark unsupportedNodeAttribute link",parseDOM:[{tag:'div[data-node-type="mediaSingle"]'}]}],["table",{content:"tableRow+",attrs:{isNumberColumnEnabled:{default:!1},layout:{default:"default"},__autoSize:{default:!1}},marks:"unsupportedMark unsupportedNodeAttribute",tableRole:"table",isolating:!0,selectable:!1,group:"block",parseDOM:[{tag:"table"}]}],["media",{selectable:!0,attrs:{id:{default:""},type:{default:"file"},collection:{default:""},occurrenceKey:{default:null},alt:{default:null},width:{default:null},height:{default:null},url:{default:null},__fileName:{default:null},__fileSize:{default:null},__fileMimeType:{default:null},__displayType:{default:null},__contextId:{default:null},__external:{default:!1}},parseDOM:[{tag:'div[data-node-type="media"]'},{tag:'img[src^="data:image"]',ignore:!0},{tag:"img:not(.smart-link-icon)"}]}],["tableHeader",{selectable:!1,content:"(paragraph | panel | blockquote | orderedList | bulletList | rule | heading | codeBlock | mediaSingle | decisionList | taskList )+",attrs:{colspan:{default:1},rowspan:{default:1},colwidth:{default:null},background:{default:null}},tableRole:"header_cell",isolating:!0,marks:"link alignment unsupportedMark unsupportedNodeAttribute",parseDOM:[{tag:"th"}]}],["decisionList",{group:"block",defining:!0,content:"decisionItem+",marks:"unsupportedMark unsupportedNodeAttribute",selectable:!1,attrs:{localId:{default:""}},parseDOM:[{tag:'ol[data-node-type="decisionList"]',priority:100}]}],["tableRow",{selectable:!1,content:"(tableCell | tableHeader)+",marks:"unsupportedMark unsupportedNodeAttribute",tableRole:"row",parseDOM:[{tag:"tr"}]}],["decisionItem",{content:"inline*",defining:!0,marks:"_",attrs:{localId:{default:""},state:{default:"DECIDED"}},parseDOM:[{tag:"li[data-decision-local-id]",priority:100}]}],["tableCell",{selectable:!1,content:"(paragraph | panel | blockquote | orderedList | bulletList | rule | heading | codeBlock | mediaSingle | decisionList | taskList | unsupportedBlock)+",attrs:{colspan:{default:1},rowspan:{default:1},colwidth:{default:null},background:{default:null}},tableRole:"cell",marks:"link alignment unsupportedMark unsupportedNodeAttribute",isolating:!0,parseDOM:[{tag:".ak-renderer-table-number-column",ignore:!0},{tag:"td"}]}],["taskList",{group:"block",defining:!0,selectable:!1,content:"taskItem+ (taskItem|taskList)*",marks:"unsupportedMark unsupportedNodeAttribute",attrs:{localId:{default:""}},parseDOM:[{tag:'div[data-node-type="actionList"]',priority:100}]}],["taskItem",{content:"inline*",defining:!0,selectable:!1,marks:"_",attrs:{localId:{default:""},state:{default:"TODO"}},parseDOM:[{tag:"div[data-task-local-id]",priority:100}]}]],s=[["link",{excludes:"link color",group:"link",attrs:{href:{},__confluenceMetadata:{default:null}},inclusive:!1,parseDOM:[{tag:"[data-block-link]"},{tag:"a[href]",context:"paragraph/|heading/|mediaSingle/|taskItem/|decisionItem/"},{tag:"a[href]"}]}],["em",{inclusive:!0,group:"fontStyle",parseDOM:[{tag:"i"},{tag:"em"},{style:"font-style=italic"}]}],["strong",{inclusive:!0,group:"fontStyle",parseDOM:[{tag:"strong"},{tag:"b"},{tag:"span"}]}],["textColor",{attrs:{color:{}},inclusive:!0,group:"color",parseDOM:[{style:"color"}]}],["strike",{inclusive:!0,group:"fontStyle",parseDOM:[{tag:"strike"},{tag:"s"},{tag:"del"},{style:"text-decoration"}]}],["subsup",{inclusive:!0,group:"fontStyle",attrs:{type:{default:"sub"}},parseDOM:[{tag:"sub",attrs:{type:"sub"}},{tag:"sup",attrs:{type:"sup"}},{tag:"span",style:"vertical-align=super"},{tag:"span",style:"vertical-align=sub"}]}],["underline",{inclusive:!0,group:"fontStyle",parseDOM:[{tag:"u"},{style:"text-decoration"}]}],["code",{excludes:"fontStyle link searchQuery color",inclusive:!0,parseDOM:[{tag:"span.code",preserveWhitespace:!0},{tag:"code",preserveWhitespace:!0},{tag:"tt",preserveWhitespace:!0},{tag:"span",preserveWhitespace:!0}]}],["typeAheadQuery",{inclusive:!0,group:"searchQuery",parseDOM:[{tag:"span[data-type-ahead-query]"}],attrs:{trigger:{default:""}}}],["alignment",{excludes:"alignment indentation",group:"alignment",attrs:{align:{}},parseDOM:[{tag:"div.fabric-editor-block-mark"}]}],["breakout",{spanning:!1,inclusive:!1,parseDOM:[{tag:"div.fabric-editor-breakout-mark"}],attrs:{mode:{default:"wide"}}}],["indentation",{excludes:"indentation alignment",group:"indentation",attrs:{level:{}},parseDOM:[{tag:"div.fabric-editor-indentation-mark"}]}],["unsupportedMark",{attrs:{originalValue:{}}}],["unsupportedNodeAttribute",{attrs:{type:{},unsupported:{}}}]];function c(e){return e.reduce((function(e,t){return e[t[0]]=t[1],e}),{})}var l={nodes:o,marks:s,version:i},u={nodes:c(o),marks:c(s)};new r.Schema(u)},"8BHA":function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var r=new(n("4z1N").PluginKey)("imageUploadPlugin")},"8Zd7":function(e,t,n){"use strict";var r=n("ivGQ"),i=n("HZZ/"),a=n.n(i),o=n("GeFe"),s=n.n(o),c=n("Zvb3"),l=n.n(c),u=n("J58c"),d=n.n(u),p=n("hJxD"),f=n.n(p),h=n("6mlU"),m=[{type:"paragraph"}];function v(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function g(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?v(Object(n),!0).forEach((function(t){d()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):v(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var b=function(){function e(t){var n=this;s()(this,e),d()(this,"postImage",function(){var e=a()(f.a.mark((function e(t,r,i,a){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",n.stackClient.fetchJSON("POST",n.path(r,"images?Name=".concat(t)),i,{headers:{"Content-Type":a}}));case 1:case"end":return e.stop()}}),e)})));return function(t,n,r,i){return e.apply(this,arguments)}}());var r=t.userId,i=t.cozyClient,o=t.schema,c=t.realtime,l=new Date,u=l.getTime()+"."+l.getMilliseconds()+"."+Math.random();this.sessionId=r+":"+u,this.userId=this.getUserId(r),this.cozyClient=i,this.stackClient=i.getStackClient(),this.schema=o,this.schemaVersion=h.c,this.onRealtimeEvent=this.onRealtimeEvent.bind(this),this.realtime=c||i.plugins.realtime,this.resetCallbacks()}var t,n,r,i,o,c,u,p,v,b,y,w,O;return l()(e,[{key:"resetCallbacks",value:function(){this.callbacks={}}},{key:"setCallback",value:function(e,t,n){this.callbacks[e]=this.callbacks[e]||{},this.callbacks[e][t]=n}},{key:"getUserId",value:function(e){return e?e.match(/[^:]+/)[0]:this.userId}},{key:"getSessionId",value:function(){return this.sessionId}},{key:"close",value:function(){this.realtime.unsubscribeAll(),this.resetCallbacks()}},{key:"defaultTitle",value:function(){return(new Date).toISOString()}},{key:"path",value:function(e,t){return e?t?"/notes/".concat(e,"/").concat(t):"/notes/".concat(e):"/notes"}},{key:"client2server",value:function(e){return g({sessionID:e.sessionId||this.sessionId},e)}},{key:"server2client",value:function(e){return g({sessionId:e.sessionID,userId:this.getUserId(e.sessionID)},e)}},{key:"create",value:(O=a()(f.a.mark((function e(t,n,r){var i,a;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a={data:{type:"io.cozy.notes.documents",attributes:{title:t||this.defaultTitle(),schema:n||this.schema||h.b,content:r?(null===(i=r.content)||void 0===i?void 0:i.length)>0?r:g(g({},r),{},{content:m}):void 0}}},e.abrupt("return",this.stackClient.fetchJSON("POST",this.path(),a));case 2:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return O.apply(this,arguments)})},{key:"updateSchema",value:(w=a()(f.a.mark((function e(t,n){var r,i;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.stackClient.fetchJSON("PUT",this.path(t,"schema"),{data:{type:"io.cozy.notes.documents",attributes:{schema:g(g({},n),{},{version:h.c})}}});case 2:return r=e.sent,i=this.formatDoc(r.data),this.schemaVersion=i.schemaVersion,e.abrupt("return",i);case 6:case"end":return e.stop()}}),e,this)}))),function(e,t){return w.apply(this,arguments)})},{key:"sync",value:(y=a()(f.a.mark((function e(t){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.stackClient.fetchJSON("POST",this.path(t,"sync"));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return y.apply(this,arguments)})},{key:"setTitle",value:(b=a()(f.a.mark((function e(t,n){var r;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r={data:{type:"io.cozy.notes.documents",id:t,attributes:this.client2server({title:n})}},e.next=3,this.stackClient.fetchJSON("PUT",this.path(t,"title"),r);case 3:case"end":return e.stop()}}),e,this)}))),function(e,t){return b.apply(this,arguments)})},{key:"onRealtimeEvent",value:function(e){var t=e.id||e._id,n=e.doctype||e.type;if("file"===n&&(n="io.cozy.files"),this.callbacks[n]&&this.callbacks[n][t])return this.callbacks[n][t](e);console.warn("Event not managed",n,t,this.callbacks)}},{key:"join",value:(v=a()(f.a.mark((function e(t){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all([this.realtime.subscribe(null,"io.cozy.notes.events",t,this.onRealtimeEvent)]);case 2:this.realtime.subscribe("UPDATED","io.cozy.files",t,this.onRealtimeEvent);case 3:case"end":return e.stop()}}),e,this)}))),function(e){return v.apply(this,arguments)})},{key:"onStepsCreated",value:(p=a()(f.a.mark((function e(t,n){var r=this;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.setCallback("io.cozy.notes.steps",t,(function(e){return n(r.server2client(e))}));case 1:case"end":return e.stop()}}),e,this)}))),function(e,t){return p.apply(this,arguments)})},{key:"onTelepointerUpdated",value:(u=a()(f.a.mark((function e(t,n){var r=this;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.setCallback("io.cozy.notes.telepointers",t,(function(e){return n(r.server2client(e))}));case 1:case"end":return e.stop()}}),e,this)}))),function(e,t){return u.apply(this,arguments)})},{key:"onSchemaUpdated",value:(c=a()(f.a.mark((function e(t,n){var r=this;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.setCallback("io.cozy.files",t,(function(e){if(e.metadata.schema.version!==r.schemaVersion)return n(e)}));case 1:case"end":return e.stop()}}),e,this)}))),function(e,t){return c.apply(this,arguments)})},{key:"onTitleUpdated",value:(o=a()(f.a.mark((function e(t,n){var r=this;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.setCallback("io.cozy.notes.documents",t,(function(e){return e.sessionID&&e.sessionID==r.sessionId?null:n(e.title)}));case 1:case"end":return e.stop()}}),e,this)}))),function(e,t){return o.apply(this,arguments)})},{key:"getDoc",value:(i=a()(f.a.mark((function e(t){var n,r;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.stackClient.fetchJSON("GET",this.path(t));case 2:return n=e.sent,r=this.formatDoc(n.data),this.schemaVersion=r.schemaVersion,e.abrupt("return",r);case 6:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"getFormatedDoc",value:function(e){var t=this.formatDoc(e);return this.schemaVersion=t.schemaVersion,t}},{key:"formatDoc",value:function(e){return{doc:e.attributes.metadata.content,version:e.attributes.metadata.version,title:e.attributes.metadata.title,updatedAt:new Date(e.attributes.updated_at),file:e,schemaVersion:e.attributes.metadata.schema.version}}},{key:"pushSteps",value:(r=a()(f.a.mark((function e(t,n,r){var i,a,o=this;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i={headers:{"if-match":n}},a={data:r.map((function(e){return{type:"io.cozy.notes.steps",attributes:o.client2server(e.toJSON())}}))},e.next=4,this.stackClient.fetchJSON("PATCH",this.path(t),a,i);case 4:return e.abrupt("return",null);case 5:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return r.apply(this,arguments)})},{key:"getSteps",value:(n=a()(f.a.mark((function e(t,n){var r,i,a,o,s,c,l,u,d,p,h=this;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.stackClient.fetchJSON("GET","".concat(this.path(t,"steps"),"?Version=").concat(n));case 3:if(0!=(r=e.sent).data.length){e.next=8;break}return e.abrupt("return",{steps:[],version:n});case 8:return i=r.data.map((function(e){return h.server2client(e.attributes)})),a=r.data[r.data.length-1].attributes.version,e.abrupt("return",{version:a,steps:i});case 11:e.next=28;break;case 13:if(e.prev=13,e.t0=e.catch(0),o=e.t0.response,s=e.t0.reason&&e.t0.reason.data,c=s&&s.attributes&&s.attributes.metadata,l=c&&c.content,u=c&&c.version,412!=o.status||!l||!u){e.next=27;break}return p={_id:t,_type:"io.cozy.notes.events",doctype:d="io.cozy.notes.documents",title:c.title},this.callbacks[d]&&this.callbacks[d][t]&&this.callbacks[d][t](p),e.abrupt("return",{doc:l,version:u});case 27:throw e.t0;case 28:case"end":return e.stop()}}),e,this,[[0,13]])}))),function(e,t){return n.apply(this,arguments)})},{key:"pushTelepointer",value:(t=a()(f.a.mark((function e(t,n){var r;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r={data:{type:"io.cozy.notes.telepointers",id:t,attributes:this.client2server(n)}},e.abrupt("return",this.stackClient.fetchJSON("PUT",this.path(t,"telepointer"),r));case 2:case"end":return e.stop()}}),e,this)}))),function(e,n){return t.apply(this,arguments)})}]),e}();t.a=function(e){var t=e.userId,n=e.userName,i=e.cozyClient;return Object(r.useMemo)((function(){return new b({userId:t,userName:n,cozyClient:i})}),[i,t,n])}},AdhS:function(e,t,n){},AvBw:function(e,t,n){"use strict";n.d(t,"a",(function(){return s})),n.d(t,"b",(function(){return c}));var r=n("9Jaj"),i=n("JdMa"),a=n("8BHA"),o=function(e){return function(t){return function(e,t){return e.setMeta(a.a,t)}(t,{name:"START_UPLOAD",event:e})}},s=function(e){return function(t,n){if(!a.a.getState(t).enabled||!e.src)return!1;var o=Object(i.b)(e.src,t.schema);return!!o&&(n&&n(Object(r.safeInsert)(o,t.selection.$to.pos)(t.tr).scrollIntoView()),!0)}},c=function(e){return function(t,n){return!!a.a.getState(t).enabled&&(n&&n(o(e)(t.tr)),!0)}}},CDNI:function(e,t,n){"use strict";n.d(t,"f",(function(){return f})),n.d(t,"e",(function(){return h})),n.d(t,"d",(function(){return m})),n.d(t,"h",(function(){return v})),n.d(t,"c",(function(){return k})),n.d(t,"g",(function(){return P})),n.d(t,"i",(function(){return j})),n.d(t,"j",(function(){return C})),n.d(t,"a",(function(){return _})),n.d(t,"k",(function(){return S})),n.d(t,"l",(function(){return I})),n.d(t,"b",(function(){return N}));var r=n("XZ5u"),i=(n("iO45"),n("4z1N")),a=n("9Jaj"),o=n("eXjd"),s=n("3mYb"),c=n("I/PM"),l=n("odni"),u=n("ct2w"),d=n("3Su3"),p=n("a+IN"),f=(n("KgC3"),function(e){return P(e)||w(e)||v(e)||g(e)}),h=function(e){var t=e.selection.node;return t&&t.type!==e.schema.nodes.media&&t.isBlock},m=function(e){var t=e.selection.node;return t&&t.type===e.schema.nodes.mediaSingle},v=function(e){if(Object(d.a)(e))return O(e,e.selection.$from)},g=function(e){if(e.selection instanceof p.a){var t=e.selection.$from,n=e.schema.nodes.mediaGroup;return b(t,n)||y(t,n)}},b=function(e,t){if(e.nodeBefore&&e.nodeBefore.type===t)return e.pos-e.nodeBefore.nodeSize+1},y=function(e,t){if(e.nodeAfter&&e.nodeAfter.type===t)return e.pos+1},w=function(e){if(Object(d.c)(e))return x(e,e.selection.$to)},O=function(e,t){var n,r;if(h(e)?(n=t.pos,r=t.nodeBefore):(n=Object(d.f)(t)-1,r=e.doc.resolve(n).nodeBefore),r&&r.type===e.schema.nodes.mediaGroup)return n-r.nodeSize+1},k=function(e){return e.selection.$from.parent.type===e.schema.nodes.paragraph&&Object(d.a)(e)&&Object(d.c)(e)},x=function(e,t){var n,r,i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(h(e)?(n=t.pos,r=t.nodeAfter):(n=Object(d.e)(t),r=e.doc.nodeAt(n)),r&&r.type===e.schema.nodes.mediaGroup)return i?n+1:n+r.nodeSize-1},P=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=e.selection.$from;if((t=t||r).parent.type===e.schema.nodes.mediaGroup)return n?Object(d.f)(t):Object(d.e)(t)-1};var j=function(e,t,n){var r=t.attrs.id,o=e.state,c=o.tr,l=o.selection,u=o.doc,p=n();c.deleteRange(p,p+t.nodeSize),Object(s.r)(r)&&c.setMeta("addToHistory",!1);var f=u.resolve(p),h=f.nodeBefore,m=f.parent,v=f.index()===m.childCount-1;if(l.from===p&&!v&&!Object(d.b)(o)&&h&&"media"===h.type.name){var g=Object(a.findPositionOfNodeBefore)(c.selection);g&&c.setSelection(i.NodeSelection.create(c.doc,g))}e.dispatch(c)},C=function(e){var t=e.state.selection;return t instanceof i.NodeSelection&&t.node.type===e.state.schema.nodes.media&&(Object(r.e)(e.state,e.dispatch),t.$to.nodeAfter?(Object(r.g)(e.state,e.dispatch),Object(o.e)(!1)(e.state,e.dispatch)):Object(o.c)(e.state,e.dispatch),!0)},E=function(e){return e.length>1&&"_"===e[0]&&"_"===e[1]},_=function(e,t){Object.keys(t.attrs).filter(E).forEach((function(n){var r=n.substring(2),i=e[r];void 0!==i&&(t.attrs[n]=i)}))},S=function(e,t){var n=t.nodes,r=n.mediaGroup,i=n.mediaSingle,a=n.media;return Object(c.e)(e,(function(e,t){return t||e.type!==a?e:i&&(Object(u.a)(e.attrs.__fileMimeType)||"external"===e.attrs.type)?i.createChecked({},e):r.createChecked({},[e])}))},M=function(e){return"0"===e.style.opacity||"none"===e.style.display||"hidden"===e.style.visibility},D=["DIV","TD"];var I=function(e){var t=(new DOMParser).parseFromString(e,"text/html").body,n=t.querySelector('b[id^="docs-internal-guid-"]');n&&Object(l.g)(t,n);var r=t.querySelectorAll("img");return r.length?(r.forEach((function(e){var n=e.parentElement;if(n)if(M(n)||M(e))n.removeChild(e);else if(!(n instanceof HTMLDivElement)){var r=Object(l.h)(n,(function(e){return e.parentElement===t||function(e){return!!e&&-1!==D.indexOf(e.tagName)}(e.parentElement)}));r&&r.parentElement&&(r.parentElement.insertBefore(e,r.nextElementSibling||r),n.innerText=n.innerText.trim(),Object(l.f)(n))}})),t.lastElementChild&&"BR"===t.lastElementChild.tagName&&t.removeChild(t.lastElementChild),t.innerHTML):e},N=function(e){if(!m(e))return null;var t=e.tr,n=t.selection.from+1,r=t.doc.nodeAt(n);return r&&r.type===e.schema.nodes.media?r:null}},G09D:function(e,t,n){"use strict";n.d(t,"a",(function(){return k}));var r=n("GeFe"),i=n.n(r),a=n("Zvb3"),o=n.n(a),s=n("J/YY"),c=n.n(s),l=n("a1Fv"),u=n.n(l),d=n("g3eI"),p=n.n(d),f=n("wDGE"),h=n.n(f),m=n("J58c"),v=n.n(m),g=n("ivGQ"),b=n.n(g),y=n("Y/FK"),w=n.n(y);function O(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=h()(e);if(t){var i=h()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return p()(this,n)}}function k(e){return function(t){u()(r,t);var n=O(r);function r(){var e;i()(this,r);for(var t=arguments.length,a=new Array(t),o=0;o<t;o++)a[o]=arguments[o];return e=n.call.apply(n,[this].concat(a)),v()(c()(e),"handleClick",(function(t){var n=w.a.findDOMNode(c()(e));(!n||t.target instanceof Node&&!n.contains(t.target))&&e.props.handleClickOutside&&e.props.handleClickOutside(t)})),v()(c()(e),"handleKeydown",(function(t){"Escape"===t.code&&e.props.handleEscapeKeydown?e.props.handleEscapeKeydown(t):"Enter"===t.code&&e.props.handleEnterKeydown&&e.props.handleEnterKeydown(t)})),e}return o()(r,[{key:"componentDidMount",value:function(){this.props.handleClickOutside&&document.addEventListener("click",this.handleClick,!1),this.props.handleEscapeKeydown&&document.addEventListener("keydown",this.handleKeydown,!1)}},{key:"componentWillUnmount",value:function(){this.props.handleClickOutside&&document.removeEventListener("click",this.handleClick,!1),this.props.handleEscapeKeydown&&document.removeEventListener("keydown",this.handleKeydown,!1)}},{key:"render",value:function(){return b.a.createElement(e,this.props)}}]),r}(g.PureComponent)}},Gfcl:function(e,t,n){"use strict";var r=n("HZZ/"),i=n.n(r),a=n("J58c"),o=n.n(a),s=n("hJxD"),c=n.n(s),l=n("4z1N"),u=n("fiXu"),d=n("X5HD"),p=n("JdMa"),f=n("AvBw"),h=n("8BHA"),m=n("4vUV");function v(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function g(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?v(Object(n),!0).forEach((function(t){o()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):v(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var b=function(e,t){return function(t,n){return!!e(n)&&(n.preventDefault(),n.stopPropagation(),n.type===m.e.Drop&&Object(p.d)(n,t),Object(f.b)(n)(t.state,t.dispatch),!0)}},y=function(e){var t,n=e.dispatch,r=e.providerFactory;return new l.Plugin({state:{init:function(e,t){return{active:!1,enabled:Object(p.a)(t),hidden:!t.schema.nodes.media||!t.schema.nodes.mediaSingle}},apply:function(e,t,r,i){var a=Object(p.c)(i),o=Object(p.a)(i),s=function(e,t){var n=e.getMeta(h.a);return n&&"START_UPLOAD"===n.name?{event:n.event}:t.activeUpload}(e,t);if(a!==t.active||o!==t.enabled||s!==t.activeUpload){var c=g(g({},t),{},{active:a,enabled:o,activeUpload:s});return n(h.a,c),c}return t}},key:h.a,view:function(){var e=function(){var e=i()(c.a.mark((function e(n,r){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("imageUploadProvider"===n&&r){e.next=2;break}return e.abrupt("return");case 2:return e.prev=2,e.next=5,r;case 5:t=e.sent,e.next=11;break;case 8:e.prev=8,e.t0=e.catch(2),t=void 0;case 11:case"end":return e.stop()}}),e,null,[[2,8]])})));return function(t,n){return e.apply(this,arguments)}}();return r.subscribe("imageUploadProvider",e),{update:function(e,n){var r=e.state,i=h.a.getState(r),a=h.a.getState(n);i.activeUpload!==a.activeUpload&&i.activeUpload&&t&&t(i.activeUpload.event,(function(t){return Object(f.a)(t)(e.state,e.dispatch)}))},destroy:function(){r.unsubscribe("imageUploadProvider",e)}}},props:{handleDOMEvents:{drop:b(d.a),paste:b(u.b)}}})},w=n("cwpE");var O=function(e){if(e.nodes.media&&e.nodes.mediaSingle){var t=Object(w.a)(/!\[(.*)\]\((\S+)\)$/,(function(e,t,n,r){var i=e.schema,a={src:t[2],alt:t[1]},o=Object(p.b)(a.src,i);return o?e.tr.replaceWith(n,r,o):null}));return Object(w.c)("image-upload",{rules:[t]})}};window.document.addEventListener("dragover",(function(e){return e.preventDefault(),!(null==e?void 0:e.target).closest(".ProseMirror")&&null!==e.dataTransfer&&(e.dataTransfer.dropEffect="none")}));t.a=function(){return{name:"imageUpload",pmPlugins:function(){return[{name:"imageUpload",plugin:y},{name:"imageUploadInputRule",plugin:function(e){var t=e.schema;return O(t)}}]}}}},Hsuv:function(e){e.exports=JSON.parse('{"Notes":{"Add":{"add_note":"Ajouter une note"},"Delete":{"delete_note":"Supprimer","deleted":"La note a Ã©tÃ© placÃ©e dans la corbeille de votre Drive","failed":"La note n\'a pas pu Ãªtre supprimÃ©e, merci de re-essayer plus tard"},"EditorView":{"main_placeholder":"Ã‰crivez ce que vous souhaitezâ€¦"},"Editor":{"title_placeholder":"Ã‰crivez votre titre","exit_confirmation_message":"La sauvegarde automatique n\'a pas encore pris en compte vos derniÃ¨res modifications. Merci de retourner sur votre note pour ne pas les perdre.","exit_confirmation_title":"Abandonner les modificationsÂ ?","exit_confirmation_leave":"Quitter sans sauvegarder","exit_confirmation_cancel":"Retour","read_only":"Cette note est en mode lecture-seule."},"Files":{"share":{"cta":"Partager"}},"List":{"latest_notes":"Notes rÃ©centes","name":"Nom","updated_at":"Mise Ã  jour","location":"Emplacement","sharings":"Partage","at":"%{date} Ã  %{time}"},"Empty":{"welcome":"Bienvenue sur Cozy Notes","after_created":"Une fois votre note crÃ©Ã©e, il vous est possible de la retrouver dans "},"SavingIndicator":{"saved":{"default":"Ã€ jour","just_now":"Ã€ jour","secs_ago":"Ã€ jour (enregistrÃ© il y a %{time} sec.)","min_ago":"Ã€ jour (enregistrÃ© il y a %{time} min.)","mins_ago":"Ã€ jour (enregistrÃ© il y a %{time} min.)","hour_ago":"Ã€ jour (enregistrÃ© il y a %{time} heure)","hours_ago":"Ã€ jour (enregistrÃ© il y a %{time} heures)","day_ago":"Ã€ jour (enregistrÃ© il y a %{time} jour)","days_ago":"Ã€ jour (enregistrÃ© il y a %{time} jours)","month_ago":"Ã€ jour (enregistrÃ© il y a %{time} mois)","monthes_ago":"Ã€ jour (enregistrÃ© il y a %{time} mois)","year_ago":"Ã€ jour (enregistrÃ© il y a %{time} an)","years_ago":"Ã€ jour (enregistrÃ© il y a %{time} ans)"},"saving":"Enregistrement en cours...","still_saving":"Enregistrement en cours......","out_of_sync":{"default":"EnregistrÃ© (hors ligne)","just_now":"EnregistrÃ© (hors ligne)","secs_ago":"EnregistrÃ© (hors ligne depuis %{time} sec)","min_ago":"EnregistrÃ© (hors ligne depuis %{time} min)","mins_ago":"EnregistrÃ© (hors ligne depuis %{time} min)","hour_ago":"EnregistrÃ© (hors ligne depuis %{time}Â h)","hours_ago":"EnregistrÃ© (hors ligne depuis %{time}Â h)","day_ago":"EnregistrÃ© (hors ligne depuis %{time} jour)","days_ago":"EnregistrÃ© (hors ligne depuis %{time} jours)","month_ago":"EnregistrÃ© (hors ligne depuis %{time} mois)","monthes_ago":"EnregistrÃ© (hors ligne depuis %{time} mois)","year_ago":"EnregistrÃ© (hors ligne depuis %{time} an)","years_ago":"EnregistrÃ© (hors ligne depuis %{time} ans)"},"saving_impossible":{"default":"Non enregistrÃ© (hors ligne)","just_now":"Non enregistrÃ© (hors ligne)","secs_ago":"Non enregistrÃ© (hors ligne depuis %{time} sec)","min_ago":"Non enregistrÃ© (hors ligne depuis %{time} min)","mins_ago":"Non enregistrÃ© (hors ligne depuis %{time} min)","hour_ago":"Non enregistrÃ© (hors ligne depuis %{time}Â h)","hours_ago":"Non enregistrÃ© (hors ligne depuis %{time}Â h)","day_ago":"Non enregistrÃ© (hors ligne depuis %{time} jour)","days_ago":"Non enregistrÃ© (hors ligne depuis %{time} jours)","month_ago":"Non enregistrÃ© (hors ligne depuis %{time} mois)","monthes_ago":"Non enregistrÃ© (hors ligne depuis %{time} mois)","year_ago":"Non enregistrÃ© (hors ligne depuis %{time} an)","years_ago":"Non enregistrÃ© (hors ligne depuis %{time} ans)"}},"OfflineIndicator":{"message":"Vous nâ€™Ãªtes plus connectÃ© Ã  internet. Vos modifications seront enregistrÃ©es quand vous serez connectÃ© Ã  nouveau."}},"Error":{"422":"Seules les images sont acceptÃ©es","unshared_title":"Le partage n\'est plus actif","unshared_text":"Le propriÃ©taire a peut-Ãªtre rÃ©voquÃ© ce partage. Vous ne pouvez plus Ã©diter de note Ã  cette adresse.","loading_error_title":"La note n\'a pas pu Ãªtre chargÃ©e","loading_error_text_noReturnUrl":"Cette note n\'existe peut-Ãªtre plus, ou nos serveurs ont peut-Ãªtre un moment d\'Ã©garement. Merci de retenter plus tard.","back":"Retour","unknown_error":"Une erreur inattendue s\'est produite","only_one_image":"Vous ne pouvez pas glisser-dÃ©poser plusieurs images en mÃªme temps"},"manifest":{"short_description":"Cozy Notes est votre application de prise de notes personnelles et collaboratives.","long_description":"Notes est un Ã©diteur de texte en ligne destinÃ© Ã  :\\n\\n* CrÃ©er vos propres notes avec les fonctionnalitÃ©s essentielles (gras, soulignÃ©, liens, tableaux...)\\n* Classer et retrouver vos notes avec vos autres documents, dans les rÃ©pertoires de votre Drive personnel\\n* Ã‰diter facilement vos notes depuis tous vos appareils\\n* AccÃ©der Ã  vos notes, mÃªme sans internet, stockÃ©es sur votre PC\\n* Pour les aficionados, utiliser les raccourcis et la saisie au format markdown\\n*  ... et mÃªme Ã©crire Ã  plusieurs simultanÃ©ment sur la mÃªme note (Ã  venir) ! ","screenshots":["screenshots/fr/screenshot01.png","screenshots/fr/screenshot02.png"]},"Intents":{"save":"Enregistrer"},"TrashedBanner":{"text":"Lâ€™Ã©lÃ©ment a Ã©tÃ© mis Ã  la corbeille","redirect":"Ouvrir la corbeille","restore":"Restaurer","restoreSuccess":"L\'Ã©lÃ©ment a Ã©tÃ© restaurÃ© avec succÃ¨s","restoreError":"Une erreur s\'est produite, veuillez rÃ©essayer","destroy":"Supprimer dÃ©finitivement"},"DestroyConfirm":{"title":"Supprimer dÃ©finitivement ?","forbidden":"Vous ne pourrez plus accÃ©der Ã  ce fichier.","restore":"Vous ne pourrez pas restaurer ce fichier.","cancel":"Annuler","delete":"Supprimer dÃ©finitivement","deleteError":"Une erreur s\'est produite, veuillez rÃ©essayer"}}')},JdMa:function(e,t,n){"use strict";n.d(t,"c",(function(){return i})),n.d(t,"a",(function(){return a})),n.d(t,"b",(function(){return o})),n.d(t,"d",(function(){return s}));var r=n("4z1N"),i=function(e){var t=e.schema.nodes.media;return e.selection instanceof r.NodeSelection&&e.selection.node.type===t},a=function(e){var t=e.schema.nodes.mediaSingle,n=e.selection.$to;if(t)for(var r=n.depth;r>=0;r--){var i=n.index(r);if(n.node(r).canReplaceWith(i,i,t))return!0}return!1},o=function(e,t){var n=t.nodes,r=n.media,i=n.mediaSingle;if(!r||!i)return null;var a=r.createChecked({type:"external",url:e});return i.createChecked({},a)},s=function(e,t){var n,i=e.clientX,a=e.clientY;return t.dispatch(t.state.tr.setSelection(r.TextSelection.create(t.state.doc,(null===(n=t.posAtCoords({left:i,top:a}))||void 0===n?void 0:n.pos)||0)))}},MjaT:function(e,t,n){"use strict";n.d(t,"a",(function(){return d}));var r,i=n("yCbO"),a=n.n(i),o=n("Czyx"),s=n("QdRn"),c=n("WISH"),l=n("2KGD"),u=n("K4GK"),d=Object(o.css)(r||(r=a()(["\n  .ProseMirror {\n    "," & [layout='full-width'] .",",\n    & [layout='wide'] ."," {\n      margin-left: 50%;\n      transform: translateX(-50%);\n    }\n\n    & [layout^='wrap-'] + [layout^='wrap-'] {\n      clear: none;\n      & + p,\n      & + div[class^='fabric-editor-align'],\n      & + ul,\n      & + ol,\n      & + h1,\n      & + h2,\n      & + h3,\n      & + h4,\n      & + h5,\n      & + h6 {\n        clear: both !important;\n      }\n      & ."," {\n        margin-left: 0;\n        margin-right: 0;\n      }\n    }\n\n    .mediaSingleView-content-wrap[layout^='wrap-'] {\n      max-width: 100%;\n      // overwrite default Prosemirror setting making it clear: both\n      clear: inherit;\n    }\n\n    .mediaSingleView-content-wrap[layout='wrap-left'] {\n      float: left;\n    }\n\n    .mediaSingleView-content-wrap[layout='wrap-right'] {\n      float: right;\n    }\n\n    .mediaSingleView-content-wrap[layout='wrap-right']\n      + .mediaSingleView-content-wrap[layout='wrap-left'] {\n      clear: both;\n    }\n\n    /* Larger margins for resize handlers when at depth 0 of the document */\n    & > .mediaSingleView-content-wrap {\n      .richMedia-resize-handle-right {\n        margin-right: -","px;\n      }\n      .richMedia-resize-handle-left {\n        margin-left: -","px;\n      }\n    }\n  }\n\n  .richMedia-resize-handle-right,\n  .richMedia-resize-handle-left {\n    display: flex;\n    flex-direction: column;\n\n    /* vertical align */\n    justify-content: center;\n  }\n\n  .richMedia-resize-handle-right {\n    align-items: flex-end;\n    padding-right: 12px;\n    margin-right: -","px;\n  }\n\n  .richMedia-resize-handle-left {\n    align-items: flex-start;\n    padding-left: 12px;\n    margin-left: -","px;\n  }\n\n  .richMedia-resize-handle-right::after,\n  .richMedia-resize-handle-left::after {\n    content: ' ';\n    display: flex;\n    width: 3px;\n    height: 64px;\n\n    border-radius: 6px;\n  }\n\n  .",":hover .richMedia-resize-handle-left::after,\n  .",":hover .richMedia-resize-handle-right::after {\n    background: ",";\n  }\n\n  ."," .richMedia-resize-handle-right::after,\n  ."," .richMedia-resize-handle-left::after,\n  ."," .richMedia-resize-handle-right:hover::after,\n  ."," .richMedia-resize-handle-left:hover::after,\n  .",".is-resizing .richMedia-resize-handle-right::after,\n  .",".is-resizing .richMedia-resize-handle-left::after {\n    background: ",";\n  }\n\n  .__resizable_base__ {\n    left: unset !important;\n    width: auto !important;\n    height: auto !important;\n  }\n\n  /* Danger when top level node for smart cards / inline links */\n  .danger > div > div > .media-card-frame,\n  .danger > span > a {\n    background-color: ",";\n    box-shadow: 0px 0px 0px ","px\n      ",";\n    transition: background-color 0s;\n    transition: box-shadow 0s;\n  }\n\n  /* Danger when nested node or common */\n  .danger {\n    /* Media single */\n    ."," .","::after {\n      border: ","px solid ",";\n    }\n\n    .richMedia-selected .richMedia-resize-handle-right::after,\n    .richMedia-selected .richMedia-resize-handle-left::after {\n      background: ",";\n    }\n\n    /* Smart cards */\n    div div .media-card-frame,\n    .inlineCardView-content-wrap > span > a {\n      background-color: rgb(255, 189, 173, 0.5); /* R75 with 50% opactiy */\n      transition: background-color 0s;\n    }\n\n    div div .media-card-frame::after {\n      box-shadow: none;\n    }\n  }\n"])),s.a,s.b,s.b,s.b,c.v,c.v,c.u,c.u,s.b,s.b,l.N60,c.H,c.H,s.b,s.b,s.b,s.b,l.B200,c.h,c.D,c.j,s.b,u.b,c.D,c.j,c.j)},NHXp:function(e,t,n){"use strict";n.r(t);var r=n("J58c"),i=n.n(r),a=(n("QLHQ"),n("k37E"),n("AdhS"),n("ivGQ")),o=n.n(a),s=n("Y/FK"),c=n("0Lot"),l=n("BqmN"),u=n("qwOa"),d=n("bvF7"),p=n("+2kq"),f=n("HROS"),h=n("MvM1"),m=n.n(h),v=n("xEu0"),g=n.n(v),b=n("8ZpT"),y=n.n(b),w=n("Aaol"),O=n("4ZQF"),k=n("v2Ur"),x=n("XkwL"),P=n.n(x),j=n("bfH1"),C=n("HZZ/"),E=n.n(C),_=n("hJxD"),S=n.n(_),M=n("rUPj"),D=n.n(M),I=n("/s+K"),N=n("/ENz"),T=n("8Zd7"),A=n("v/Qj"),L=n("bQqJ"),U=Object(a.createContext)(),R=function(e){var t=e.intentId,n=e.children,r=Object(v.useClient)(),i=Object(a.useState)({service:null,intent:null,data:null}),s=P()(i,2),c=s[0],l=s[1],u=Object(a.useMemo)((function(){return{service:c.service,intent:c.intent,data:c.data}}),[c]);return Object(a.useEffect)((function(){var e=function(){var e=E()(S.a.mark((function e(){var n,i,a;return S.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,r.intents.createService(t,window);case 3:n=e.sent,i=n.getIntent(),a=n.getData(),l({service:n,intent:i,data:a}),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(0),n.throw(e.t0);case 12:case"end":return e.stop()}}),e,null,[[0,9]])})));return function(){return e.apply(this,arguments)}}();c.service||e()}),[r,t,c.service]),c.service?o.a.createElement(U.Provider,{value:u},n):o.a.createElement(L.b,{className:"u-m-0",size:"xxlarge",middle:!0})},z=Object(N.a)({root:{position:"fixed",bottom:"calc(env(safe-area-inset-bottom) + 1rem)",left:0}}),F=function(e){var t=e.title,n=e.actions,r=Object(w.e)().t,i=z(),s=Object(v.useClient)(),c=function(){var e=Object(a.useContext)(U);if(!e)throw new Error("useIntent must be used within a IntentProvider");return e}().service,l=Object(A.a)(),u=l.userName,d=l.userId,p=Object(T.a)({cozyClient:s,userId:d,userName:u}),f=Object(a.useState)(!1),h=P()(f,2),m=h[0],g=h[1];return o.a.createElement(o.a.Fragment,null,o.a.createElement("style",null,"html .akEditor>div:first-child","{ bottom: calc(env(safe-area-inset-bottom) + 5rem) }"),o.a.createElement(I.a,{classes:i,label:r("Intents.save"),busy:m,fullWidth:!0,onClick:function(e){return function(){var n=E()(S.a.mark((function n(r){var i,a,o;return S.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r.stopPropagation(),n.prev=1,g(!0),n.next=5,e.getValue();case 5:return i=n.sent,n.next=8,p.create(t,void 0,i);case 8:a=n.sent,o=a.data,c.terminate({id:o.id}),g(!1),n.next=18;break;case 14:n.prev=14,n.t0=n.catch(1),D()("error",n.t0),c.cancel();case 18:case"end":return n.stop()}}),n,null,[[1,14]])})));return function(e){return n.apply(this,arguments)}}()}(n)}))},B=function(){var e=Object(w.e)().t,t=Object(a.useState)(""),n=P()(t,2),r=n[0],i=n[1];return o.a.createElement(j.a,{defaultTitle:e("Notes.Editor.title_placeholder"),isIntents:!0,onTitleChange:function(e){i(e.target.value)}},o.a.createElement(F,{title:r}))};function V(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function W(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?V(Object(n),!0).forEach((function(t){i()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):V(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var G=n("5z4W"),K=n("xyGe"),H=Object(c.a)({disableGlobal:!0}),J={en:{react:n("WNgr"),atlaskit:d.a},fr:{react:n("5mip"),atlaskit:W(W({},p.a),K)}};document.addEventListener("DOMContentLoaded",(function(){var e=Object(k.b)(),t=e.token,r=Object(k.a)(e.app.slug,G.slug),i=Object(k.a)(e.app.version,G.version);Object(u.d)(J.en.react),Object(u.d)(J.fr.react);var a=Object(k.a)(e.locale,"en"),c=["en","fr"].includes(a)?a:"en",d=window.location.protocol,p=new g.a({uri:"".concat(d,"//").concat(e.domain),token:t,appMetadata:{slug:r,version:i}}),h=new m.a({client:p});p.intents=h,p.registerPlugin(y.a.plugin);var b=new URLSearchParams(window.location.search).get("intent");Object(s.render)(o.a.createElement(f.WebviewIntentProvider,null,o.a.createElement(w.d,{lang:e.locale,dictRequire:function(e){return n("eUFy")("./".concat(e))}},o.a.createElement(l.b,{generateClassName:H},o.a.createElement(u.c,{locale:c,messages:J[c].atlaskit},o.a.createElement(v.CozyProvider,{client:p},o.a.createElement(R,{intentId:b},o.a.createElement(O.a,null,o.a.createElement(B,null)))))))),document.querySelector("[role=application]"))}))},NZnG:function(e,t,n){"use strict";n.d(t,"a",(function(){return U}));var r,i,a,o=n("GeFe"),s=n.n(o),c=n("Zvb3"),l=n.n(c),u=n("J/YY"),d=n.n(u),p=n("a1Fv"),f=n.n(p),h=n("g3eI"),m=n.n(h),v=n("wDGE"),g=n.n(v),b=n("J58c"),y=n.n(b),w=n("yCbO"),O=n.n(w),k=n("ivGQ"),x=n.n(k),P=n("Czyx"),j=n("dKM3"),C=n("DzbU"),E=n("x3sL"),_=n("kSuG"),S=n("zy2m"),M=n("WISH"),D=n("G09D");function I(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=g()(e);if(t){var i=g()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return m()(this,n)}}var N=P.default.div(r||(r=O()(["\n  /* tooltip in ToolbarButton is display:block */\n  & > div > div {\n    display: flex;\n  }\n"]))),T=Object(D.a)(j.a),A=P.default.div(i||(i=O()(["\n  ",";\n"])),(function(e){return e.isSelected?"&& > span, && > span:hover { background: #6c798f; color: #fff; }":""})),L=P.default.span(a||(a=O()(["\n  ",";\n"])),(function(e){return e.hasElemBefore?"margin-left: 8px;":""})),U=function(e){f()(n,e);var t=I(n);function n(){var e;s()(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return e=t.call.apply(t,[this].concat(i)),y()(d()(e),"state",{popupPlacement:["bottom","left"]}),y()(d()(e),"handleRef",(function(t){e.setState({target:t||void 0})})),y()(d()(e),"updatePopupPlacement",(function(t){e.setState({popupPlacement:t})})),y()(d()(e),"handleClose",(function(){e.props.onOpenChange&&e.props.onOpenChange({isOpen:!1})})),e}return l()(n,[{key:"renderItem",value:function(e){var t=this.props,n=t.onItemActivated,r=t.onMouseEnter,i=t.onMouseLeave;if(!e.onClick&&!e.value&&!e.value.name)return x.a.createElement("span",{key:String(e.content)},e.content);var a=x.a.createElement(A,{key:e.key||e.content,isSelected:e.isActive},x.a.createElement(C.a,{elemBefore:e.elemBefore,elemAfter:e.elemAfter,isDisabled:e.isDisabled,onClick:function(){return n&&n({item:e})},onMouseEnter:function(){return r&&r({item:e})},onMouseLeave:function(){return i&&i({item:e})},className:e.className},x.a.createElement(L,{hasElemBefore:!!e.elemBefore},e.content)));return e.tooltipDescription?x.a.createElement(_.a,{key:e.key||e.content,content:e.tooltipDescription,position:e.tooltipPosition},a):a}},{key:"renderDropdownMenu",value:function(){var e=this,t=this.state,n=t.target,r=t.popupPlacement,i=this.props,a=i.items,o=i.mountTo,s=i.boundariesElement,c=i.scrollableElement,l=i.offset,u=i.fitHeight,d=i.fitWidth,p=i.isOpen,f=i.zIndex;return x.a.createElement(S.a,{target:p?n:void 0,mountTo:o,boundariesElement:s,scrollableElement:c,onPlacementChanged:this.updatePopupPlacement,fitHeight:u,fitWidth:d,zIndex:f||M.n,offset:l},x.a.createElement(T,{isOpen:!0,appearance:"tall",position:r.join(" "),shouldFlip:!1,shouldFitContainer:!0,isTriggerNotTabbable:!0,handleClickOutside:this.handleClose,handleEscapeKeydown:this.handleClose},x.a.createElement("div",{style:{height:0,minWidth:d||0}}),a.map((function(t,n){return x.a.createElement(E.a,{key:n},t.items.map((function(t){return e.renderItem(t)})))}))))}},{key:"render",value:function(){var e=this.props,t=e.children,n=e.isOpen;return x.a.createElement(N,null,x.a.createElement("div",{ref:this.handleRef},t),n?this.renderDropdownMenu():null)}}]),n}(k.PureComponent)},bOB9:function(e,t,n){"use strict";n.d(t,"j",(function(){return k})),n.d(t,"h",(function(){return x})),n.d(t,"c",(function(){return P})),n.d(t,"b",(function(){return M})),n.d(t,"i",(function(){return I})),n.d(t,"f",(function(){return T})),n.d(t,"e",(function(){return A})),n.d(t,"g",(function(){return L})),n.d(t,"d",(function(){return U})),n.d(t,"a",(function(){return R})),n.d(t,"l",(function(){return K})),n.d(t,"k",(function(){return H}));var r=n("J58c"),i=n.n(r),a=n("HZZ/"),o=n.n(a),s=n("XkwL"),c=n.n(s),l=n("hJxD"),u=n.n(l),d=n("/yh+"),p=n.n(d),f=n("xEu0"),h=n("v2Ur"),m=n("6mlU"),v=n("5z4W"),g=n.n(v);function b(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function y(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?b(Object(n),!0).forEach((function(t){i()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):b(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function w(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return O(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return O(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function O(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function k(e){return new URL(e.getStackClient().uri).hostname+Math.floor(100*Math.random())}function x(){var e,t=w(new URLSearchParams(window.location.search));try{for(t.s();!(e=t.n()).done;){var n=c()(e.value,2),r=n[0],i=n[1];if("returnUrl"===r)return i}}catch(a){t.e(a)}finally{t.f()}}function P(e,t,n){return j.apply(this,arguments)}function j(){return(j=o()(u.a.mark((function e(t,n,r){var i,a,o;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=f.models.note.fetchURL(t,n),a=window.location.toString(),e.t0=URL,e.next=5,i;case 5:return e.t1=e.sent,(o=new e.t0(e.t1)).searchParams.set("returnUrl",r||a),e.abrupt("return",o.toString());case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function C(e){return E.apply(this,arguments)}function E(){return(E=o()(u.a.mark((function e(t){var n,r,i;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.collection("io.cozy.permissions").fetchOwnPermissions();case 2:if(n=e.sent,r=p()(n,"data.attributes.permissions")){e.next=6;break}throw"can't get self permissions";case 6:return i=Object.values(r),e.abrupt("return",i.filter((function(e){return f.models.permission.isForType(e,"io.cozy.files")})));case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function _(e,t){return S.apply(this,arguments)}function S(){return(S=o()(u.a.mark((function e(t,n){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",t.query(t.find("io.cozy.files").getById(n)).then((function(e){return e&&e.data})));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function M(e,t){return D.apply(this,arguments)}function D(){return(D=o()(u.a.mark((function e(t,n){var r;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,_(t,n);case 2:return r=e.sent,e.abrupt("return",f.models.permission.isDocumentReadOnly({document:r,client:t,writability:["PATCH"]}));case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function I(e){return N.apply(this,arguments)}function N(){return(N=o()(u.a.mark((function e(t){var n,r,i,a;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,C(t);case 2:if(!((n=e.sent.filter((function(e){return f.models.permission.isForType(e,"io.cozy.files")&&e.values&&e.values.length>0}))).length<1)){e.next=7;break}throw new Error("No individual io.cozy.files permissions in current context");case 7:(n.length>1||n[0].values.length>1)&&console.warn("There are more than one permission for a file in current context. Let's take the first one, but it may not be the one you expect");case 8:return r=n[0],i=r.values[0],a=f.models.permission.isReadOnly(r,{writability:["PATCH"]}),e.abrupt("return",{id:i,readOnly:a});case 12:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function T(e){return"/folder/".concat(e)}function A(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=new URL(e.getStackClient().uri),r=e.getInstanceOptions(),i=r.subdomain,a="drive",o=null!==t?T(t):"",s=Object(f.generateWebLink)({cozyUrl:n.origin,slug:a,pathname:"/",subDomainType:i,hash:o});return s}function L(e,t){return A(e,f.models.file.getParentFolderId(t))}function U(){var e=Object(h.b)(),t=Object(h.a)(e.app.prefix||g.a.name_prefix,""),n=Object(h.a)(e.app.name,g.a.name);return""!=t?"".concat(t," ").concat(n):n}function R(e){return e.getStackClient().fetchJSON("POST","/notes",{data:{type:"io.cozy.notes.documents",attributes:{title:"",schema:y(y({},m.b),{},{version:m.c})}}})}var z=6e4,F=60*z,B=24*F,V=31*B,W=365*B,G=[[1e4,"just_now",1e3,1],[1*z,"secs_ago",1e3,10],[2*z,"min_ago",z,1],[5*z,"mins_ago",z,1],[20*z,"mins_ago",z,5],[1*F,"mins_ago",z,10],[2*F,"hour_ago",F,1],[1*B,"hours_ago",F,1],[2*B,"day_ago",B,1],[1*V,"days_ago",B,1],[2*V,"month_ago",V,1],[1*W,"monthes_ago",V,1],[2*W,"year_ago",W,1],[1/0,"years_ago",W,1]];function K(e,t){var n=(t||G).find((function(t){return e<t[0]})),r=c()(n,4),i=r[1],a=r[2],o=r[3];return{key:i,unit:a,coef:o,time:Math.floor(e/a/o)*o,interval:a*o}}function H(){var e=new URLSearchParams(window.location.search);return e.has("username")?e.get("username"):null}},bfH1:function(e,t,n){"use strict";var r=n("LGLP"),i=n.n(r),a=n("XkwL"),o=n.n(a),s=n("ivGQ"),c=n.n(s),l=n("V3Qr"),u=n("igqv"),d=n("Aaol"),p=n("MHrW"),f=n("9WMr"),h=n("bQqJ"),m=n("UuKj"),v=n("HZZ/"),g=n.n(v),b=n("hJxD"),y=n.n(b),w=n("4vUV"),O=n("uU7o"),k=n("N8wp");var x=function(e,t){switch(null==e?void 0:e.type){case w.e.Drop:return j(e,t);case w.e.Paste:return C(e,t);default:return P(t)}},P=function(e){var t=document.createElement(w.c.Input);t.setAttribute("accept","image/*"),t.type=w.f.File,t.dispatchEvent(new MouseEvent(w.e.Click)),t.addEventListener(w.e.Change,(function(){var n;return e(null===(n=t.files)||void 0===n?void 0:n[0])}))},j=function(e,t){var n,r,i=e.dataTransfer;return(1===(null==(r=null==i?void 0:i.files)?void 0:r.length)||(k.a.error("Error.only_one_image"),!1))&&t(null==i||null===(n=i.files)||void 0===n?void 0:n[0])},C=function(e,t){var n,r=e.clipboardData;return t(null==r||null===(n=r.files)||void 0===n?void 0:n[0])},E=function(e,t,n){var r=new window.FileReader;if(!n)throw Error(w.d.NoFileFoundAfterInput);r.readAsArrayBuffer(n),r.onloadend=g()(y.a.mark((function i(){var a,o,s;return y.a.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:if(a=Object(O.a)(r.result)){i.next=3;break}throw Error(w.d.FileNotProcessable);case 3:return i.prev=3,e.setUploading(!0),i.next=7,e.collabProvider.serviceClient.postImage(n.name,e.collabProvider.config.noteId,a,n.type);case 7:o=i.sent,s=o.data.id,t({src:s}),i.next=15;break;case 12:i.prev=12,i.t0=i.catch(3),k.a.error(e.t(void 0!==i.t0.status?"Error.".concat(i.t0.status):"Error.unknown_error"),{duration:4e3});case 15:return i.prev=15,e.setUploading(!1),i.finish(15);case 18:case"end":return i.stop()}}),i,null,[[3,12,15,18]])})))},_={allowBreakout:!0,allowTextColor:!0,allowTextAlignment:!0,allowIndentation:!0,allowTables:{allowColumnSorting:!0,allowColumnResizing:!0,allowMergeCells:!0,allowNumberColumn:!0,allowBackgroundColor:!0,allowHeaderRow:!0,allowHeaderColumn:!0,permittedLayouts:"all",stickToolbarToBottom:!0},allowPanel:!0,allowStatus:!0,allowRule:!0,allowDate:!0,allowTasksAndDecisions:!0},S=n("upXl"),M=n.n(S);var D=function(){};t.a=function(e){var t=e.defaultValue,n=e.onTitleChange,r=e.onTitleBlur,a=e.defaultTitle,v=e.title,g=e.collabProvider,b=e.onContentChange,y=e.readOnly,w=e.bannerRef,O=e.headerMenu,k=e.isIntent,P=e.children,j=Object(d.e)().t,C=Object(s.useRef)(null),S=Object(s.useCallback)((function(e){n&&n(e)}),[n]);Object(s.useMemo)((function(){return g&&g.setReadOnly(!!y)}),[y,g]);var I=Object(s.useMemo)((function(){return g&&{useNativePlugin:!0,provider:Promise.resolve(g),inviteToEditHandler:function(){},isInviteToEditButtonSelected:!1,userId:g.serviceClient.getSessionId()}}),[g]);Object(s.useEffect)((function(){var e;(e=C.current)&&(e.style.height="".concat(e.scrollHeight,"px"))}),[v]),Object(p.a)(C.current,"blur",r);var N,T=Object(s.useState)(!1),A=o()(T,2),L=A[0],U=A[1];return c.a.createElement("article",{className:"".concat(M.a["note-article"]).concat(k?" "+M.a["note-article--intents"]:"")},L&&c.a.createElement(f.a,null,c.a.createElement(h.b,{size:"xxlarge",middle:!0})),c.a.createElement("style",null,"#coz-bar ","{ display: none }"),O,c.a.createElement("section",{className:"note-editor-container"},c.a.createElement(l.a,i()({},_,{disabled:!g&&y,collabEdit:I,onChange:b||D,defaultValue:t,appearance:"full-page",placeholder:j("Notes.EditorView.main_placeholder"),shouldFocus:!y,legacyImageUploadProvider:(N={collabProvider:g,t:j,setUploading:U},Promise.resolve((function(e,t){return x(e,(function(e){return E(N,t,e)}))}))),contentComponents:c.a.createElement(u.a,{render:function(e){return c.a.createElement(c.a.Fragment,null,c.a.createElement("aside",{ref:w,className:M.a.banner}),c.a.createElement(m.a,{ref:C,className:M.a.title,multiline:!0,minRows:1,value:v,placeholder:a,fullWidth:!0,InputProps:{disableUnderline:!0},inputProps:{className:M.a.titleInput,readOnly:!!y},onChange:y?D:S}),c.a.Children.map(P,(function(t){return c.a.isValidElement(t)?c.a.cloneElement(t,{actions:e}):null})))}})}))))}},bxsC:function(e,t,n){"use strict";var r,i,a,o=n("J58c"),s=n.n(o),c=n("ivGQ"),l=n.n(c),u=n("iu8y"),d=n("zw+H"),p=n("EPWR"),f=n("HZZ/"),h=n.n(f),m=n("GeFe"),v=n.n(m),g=n("Zvb3"),b=n.n(g),y=n("hJxD"),w=n.n(y),O=n("Y/FK"),k=n.n(O),x=n("4z1N"),P=n("ut+C"),j=n("Lu4+"),C=n("uF5U"),E=n("l+VE"),_=n.n(E),S=n("9Jaj"),M=n("3xVv"),D=n("yCbO"),I=n.n(D),N=n("Czyx"),T=n("wjgK"),A=n("2KGD"),L=n("8DMk"),U=n.n(L),R=n("VCdh"),z=n("J/YY"),F=n.n(z),B=n("a1Fv"),V=n.n(B),W=n("g3eI"),G=n.n(W),K=n("wDGE"),H=n.n(K),J=n("K5K7"),q=n("+k3U"),Q=n("y3D9"),$=n("GyuN"),X=n("qheH"),Z=n("k359"),Y=N.default.figure(r||(r=I()(["\n  margin: 0;\n"])));Y.displayName="FigureWrapper";var ee=N.default.div(i||(i=I()(["\n  position: absolute;\n  width: 100%;\n  height: 100%;\n"]))),te=N.default.div(a||(a=I()(["\n  width: 100%;\n  position: relative;\n  padding-bottom: ","%;\n"])),(function(e){return e.dimensions.height/e.dimensions.width*100})),ne=function(e){var t=e.dimensions,n=e.children,r=e.onContextMenu;return l.a.createElement(te,{dimensions:t,onContextMenuCapture:r},l.a.createElement(ee,null,n))},re=n("4vUV"),ie=n("xEu0");function ae(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=H()(e);if(t){var i=H()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return G()(this,n)}}var oe,se,ce=function(e){V()(r,e);var t,n=ae(r);function r(e){var t;v()(this,r),t=n.call(this,e),s()(F()(t),"mediaPluginState",void 0),s()(F()(t),"state",{imageUrl:"",imageError:"",imageLoading:!0}),s()(F()(t),"realtimeSubscription",void 0),s()(F()(t),"setViewMediaClientConfig",h()(w.a.mark((function e(){var n,r;return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.props.mediaProvider;case 2:(n=e.sent)&&(r=n.viewMediaClientConfig,t.setState({viewMediaClientConfig:r}));case 4:case"end":return e.stop()}}),e)})))),s()(F()(t),"selectMediaSingleFromCard",(function(e){var n=e.event;t.selectMediaSingle(n)})),s()(F()(t),"selectMediaSingle",(function(e){e.stopPropagation();var n=t.props.getPos(),r=t.props.view.state;if(e.shiftKey){if(r.selection instanceof $.a)return;Object(X.g)(t.props.view,r.selection.from<n?r.selection.from:n-1,r.selection.to>n?r.selection.to:n+2)}else Object(X.f)(t.props.view,n-1)})),s()(F()(t),"fetchCozyImage",h()(w.a.mark((function e(){var n,r,i,a,o;return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.setState({imageError:""}),t.state.collabEditProvider){e.next=3;break}throw Error(re.d.MissingCollabEdit);case 3:return n=t.state.collabEditProvider,r=n.serviceClient,i=n.config.noteId,e.prev=4,e.next=7,r.cozyClient.query(Object(ie.Q)(re.a.Files).getById(i));case 7:if(a=e.sent){e.next=10;break}throw Error(re.d.CouldNotGetNoteImages);case 10:if(o=a.included.find((function(e){return e.id===t.props.node.attrs.url}))){e.next=13;break}throw Error(re.d.CouldNotFindFileInCurrentNote);case 13:!o.attributes.willBeResized&&t.setState({imageUrl:"".concat(r.stackClient.uri).concat(o.links.self),imageLoading:!1}),e.next=19;break;case 16:e.prev=16,e.t0=e.catch(4),t.setState({imageError:e.t0.message});case 19:case"end":return e.stop()}}),e,null,[[4,16]])})))),s()(F()(t),"subscribeToImageUpdate",(function(){var e;return null===(e=t.state.collabEditProvider)||void 0===e?void 0:e.serviceClient.realtime.subscribe(re.g.Updated,re.a.NoteEvents,t.state.collabEditProvider.config.noteId,(function(e){var n=e.image_id;t.props.node.attrs.url.includes(n)&&t.setState({imageLoading:!0},t.fetchCozyImage)}))})),s()(F()(t),"handleNewNode",(function(e){var n=e.node;t.mediaPluginState.handleMediaNodeMount(n,(function(){return t.props.getPos()}))}));var i=t.props.view;return t.mediaPluginState=Z.a.getState(i.state),t}return b()(r,[{key:"shouldComponentUpdate",value:function(e,t){var n=!this.state.viewMediaClientConfig&&t.viewMediaClientConfig;return!(this.state.imageUrl===t.imageUrl&&this.state.imageError===t.imageError&&this.props.selected===e.selected&&this.props.uploadComplete===e.uploadComplete&&this.props.node.attrs.id===e.node.attrs.id&&this.props.node.attrs.collection===e.node.attrs.collection&&this.props.maxDimensions.height===e.maxDimensions.height&&this.props.maxDimensions.width===e.maxDimensions.width&&this.props.contextIdentifierProvider===e.contextIdentifierProvider&&this.props.isLoading===e.isLoading&&this.props.mediaProvider===e.mediaProvider&&!n)}},{key:"componentDidMount",value:(t=h()(w.a.mark((function e(){var t,n,r;return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.handleNewNode(this.props),t=this.props,n=t.contextIdentifierProvider,r=t.collabEditProvider,e.t0=this,e.next=5,n;case 5:return e.t1=e.sent,e.next=8,r;case 8:return e.t2=e.sent,e.t3={contextIdentifierProvider:e.t1,collabEditProvider:e.t2},e.t0.setState.call(e.t0,e.t3),this.realtimeSubscription=this.subscribeToImageUpdate(),e.next=14,this.fetchCozyImage();case 14:return e.next=16,this.setViewMediaClientConfig();case 16:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"componentWillUnmount",value:function(){var e,t=this.props.node;null===(e=this.realtimeSubscription)||void 0===e||e.unsubscribe(),this.mediaPluginState.handleMediaNodeUnmount(t)}},{key:"componentDidUpdate",value:function(e){e.node.attrs.id!==this.props.node.attrs.id&&(this.mediaPluginState.handleMediaNodeUnmount(e.node),this.handleNewNode(this.props)),this.mediaPluginState.updateElement(),this.setViewMediaClientConfig()}},{key:"render",value:function(){var e=this.props,t=e.node,n=e.selected,r=e.uploadComplete,i=e.originalDimensions,a=e.isLoading,o=e.maxDimensions,s=e.mediaOptions,c=this.state,u=c.viewMediaClientConfig,d=c.contextIdentifierProvider,p=t.attrs,f=p.id,h=p.type,m=p.collection,v=p.url,g=p.alt;if(this.state.imageLoading||!this.state.imageUrl||this.state.imageError||a||"external"!==h&&(!u||"boolean"==typeof r&&!r))return l.a.createElement(ne,{dimensions:i},l.a.createElement(q.a,null));var b=d&&d.objectId,y="external"===h?{dataURI:this.state.imageUrl,name:v,mediaItemType:"external-image"}:{id:f,mediaItemType:"file",collectionName:m},w=u||{authProvider:function(){return{}}};return l.a.createElement(ne,{dimensions:i,onContextMenu:this.selectMediaSingle},l.a.createElement(Q.a,{mediaClientConfig:w,resizeMode:"stretchy-fit",dimensions:o,originalDimensions:i,identifier:y,selectable:!0,selected:n,disableOverlay:!0,onClick:this.selectMediaSingleFromCard,useInlinePlayer:s&&s.allowLazyLoading,isLazy:s&&s.allowLazyLoading,featureFlags:s&&s.featureFlags,contextId:b,alt:g}))}}]),r}(c.Component),le=Object(J.a)(ce),ue=N.default.div(oe||(oe=I()(["\n  color: ",";\n  background: ",";\n  border-radius: ","px;\n  margin: 5px 3px 25px;\n  width: ","px;\n  min-height: ","px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n"])),Object(R.J)(A.B400,.4)||A.B400,Object(R.J)(A.B300,.6)||A.B300,Object(T.c)(),156,125),de=N.default.div(se||(se=I()(["\n  background: ",";\n  border-radius: ","px;\n  margin: 2px 0;\n  width: 100%;\n  height: 2px;\n"])),A.B200,Object(T.c)()),pe=function(e){var t=e.type;return"single"===(void 0===t?"group":t)?l.a.createElement(de,null):l.a.createElement(ue,null,l.a.createElement(U.a,{label:"Document",size:"medium"}))},fe=n("iO45"),he=n("3mYb"),me=n("PuAp"),ve=n("CDNI"),ge=n("3Su3"),be=n("44lN"),ye=n("AV8T"),we=n("3sCF"),Oe=function(e,t){var n="";return 1===e.length?n=e[0].fileMimeType||"unknown":e.length>1&&(n="multiple"),{action:ye.a.INSERTED,actionSubject:ye.b.DOCUMENT,actionSubjectId:ye.c.MEDIA,attributes:{type:ye.c.MEDIA_GROUP,inputMethod:t,fileExtension:n},eventType:ye.d.TRACK}};var ke=function(e,t,n,r){var i=e.state,a=e.dispatch,o=i.tr,s=i.schema,c=s.nodes,l=c.media,u=c.paragraph;if(l&&t.length){var d=xe(t,n,l),p=je(i),f=o.doc.resolve(p).parent,h=o.doc.nodeAt(p),m=!function(e){var t=e.schema,n=e.selection.$anchor.node();return n&&n.type===t.nodes.mediaGroup}(i)&&Object(be.e)(i,fe.Fragment.from(i.schema.nodes.mediaGroup.createChecked({},d))),v=function(e,t){var n=e.schema.nodes.media,r=t&&t.type===n;return(Object(he.j)(e)||Object(he.n)(e)||Object(he.m)(e)||Object(ge.d)(e)&&(!Object(ve.h)(e)||Object(ve.e)(e)))&&!r}(i,h),g=f.type===s.nodes.mediaGroup?d:[s.nodes.mediaGroup.createChecked({},d)];if(m){g=v?g.concat(u.create()):g;var b=Ce(i);return b?p<=b.start?o.deleteRange(b.start,b.end).insert(p,g):o.insert(p,g).deleteRange(b.start,b.end):o.insert(p,g),Object(we.a)(i,o,Oe(t,r)),a(o),void _e(e)}v&&f.type!==s.nodes.mediaGroup&&g.push(u.create()),Object(we.a)(i,o,Oe(t,r)),a(Object(S.safeInsert)(fe.Fragment.fromArray(g),p)(o))}},xe=function(e,t,n){return e.map((function(e){var r=e.id,i=n.create({id:r,type:"file",collection:t});return Object(ve.a)(e,i),i}))},Pe=function(e){var t=e.schema.nodes,n=t.mediaGroup,r=t.listItem;if(Object(S.hasParentNode)((function(e){return e.type===r}))(e.selection)){var i=function(e){var t=e.schema.nodes,n=t.bulletList,r=t.orderedList;return Object(me.b)((function(e){return e.type===n||e.type===r}))(e.selection.$from)}(e);if(i){var a=i.pos+i.node.nodeSize,o=e.doc.nodeAt(a);return o&&o.type===n?a+1:a}}},je=function(e){var t=e.selection,n=t.$from,r=t.$to,i=Pe(e);if(i)return i;var a=Object(ve.f)(e);return a&&(!Object(ve.e)(e)||n.pos<a&&r.pos<a)?a:Object(ve.e)(e)?r.pos:Object(ge.c)(e)?r.pos+1:Object(ge.a)(e)?n.pos-1:r.pos},Ce=function(e){var t=e.selection,n=t.$from,r=t.$to;if(!Object(ve.g)(e))return!Object(ve.c)(e)||Object(ve.f)(e)?Ee(n.pos,r.pos):Ee(Object(ge.f)(n)-1,Object(ge.e)(r))},Ee=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e;return{start:e,end:t}},_e=function(e){var t=e.state,n=t.doc,r=Object(ve.f)(t);if(r){var i=n.resolve(r),a=Object(ge.e)(i);a+1>=n.nodeSize-1?Object(X.f)(e,r):Object(X.g)(e,a+1)}},Se=n("CW9m");function Me(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}var De=function(e,t){return e.mediaNodes.reduce((function(e,n){return e||(n.node.attrs.id===t?n:e)}),null)},Ie=function(e,t,n){return n?De(e,t):e.mediaGroupNodes[t]},Ne=function(e,t){return e.mediaOptions&&e.mediaOptions.allowMarkingUploadsAsIncomplete&&"boolean"==typeof e.mobileUploadComplete[t]?e.mobileUploadComplete[t]:void 0},Te=function(e,t,n){return function(r,i){var a,o=Z.a.getState(r);if(n)a=function(e,t){return e.mediaNodes.filter((function(e){return e.node.attrs.id===t}))}(o,e);else{var s=Ie(o,e,n);a=s?[s]:[]}var c=r.schema.nodes.media;if(0===(a=a.filter((function(e){var t;try{t=r.doc.nodeAt(e.getPos())}catch(n){return!1}return t&&t.type===c}))).length)return!1;if(i){var l=r.tr;a.forEach((function(e){var n=e.getPos;return l.step(new Se.a(n(),t))})),l.setMeta("addToHistory",!1),i(l)}return!0}},Ae=function(e,t,n){return function(r,i){var a=Z.a.getState(r),o=Ie(a,e,n);return!!o&&(i&&i(r.tr.step(new Se.a(o.getPos(),t)).setMeta("addToHistory",!1)),!0)}},Le=function(e,t){return function(n,r){return!!r&&(r(n.tr.step(new Se.a(e,function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Me(Object(n),!0).forEach((function(t){s()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Me(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({type:"file",url:null},t))).setMeta("addToHistory",!1)),!0)}},Ue=n("2AuG"),Re=function(){function e(t,n,r){var i=this,a=(arguments.length>3&&void 0!==arguments[3]||Ue.d,arguments.length>4?arguments[4]:void 0);v()(this,e),s()(this,"picker",void 0),s()(this,"onDragListeners",[]),s()(this,"errorReporter",void 0),s()(this,"pickerType",void 0),s()(this,"onStartListeners",[]),s()(this,"eventListeners",{}),s()(this,"analyticsName",void 0),s()(this,"erroredFiles",void 0),s()(this,"handleUploadPreviewUpdate",(function(e){var t=e.file,n=e.preview,r=i.erroredFiles.has(t.id),a=Object(Ue.e)(n)?n:{dimensions:void 0,scaleFactor:void 0},o=a.dimensions,s=a.scaleFactor,c={id:t.id,fileName:t.name,fileSize:t.size,fileMimeType:t.type,dimensions:o,scaleFactor:s,status:r?"error":void 0};i.eventListeners[t.id]=[],i.onStartListeners.forEach((function(e){return e(c,(function(e){return i.subscribeStateChanged(t,e)}),i.analyticsName||i.pickerType)}))})),s()(this,"subscribeStateChanged",(function(e,t){var n=i.eventListeners[e.id];n&&n.push(t)})),s()(this,"handleUploadError",(function(e){var t=e.error,n=e.fileId,r=i.eventListeners[n];i.erroredFiles.add(n),r&&(r.forEach((function(e){return e({id:n,status:"error",error:t&&{description:t.description,name:t.name}})})),delete i.eventListeners[n])})),s()(this,"handleMobileUploadEnd",(function(e){var t=e.file,n=i.eventListeners[t.id];n&&n.forEach((function(e){return e({id:t.id,status:"mobile-upload-end",fileMimeType:t.type,collection:t.collectionName,publicId:t.publicId})}))})),s()(this,"handleReady",(function(e){var t=e.file,n=i.eventListeners[t.id];n&&(n.forEach((function(e){return e({id:t.id,status:"ready"})})),delete i.eventListeners[t.id])})),this.pickerType=t,this.errorReporter=n.errorReporter,this.analyticsName=a,this.erroredFiles=new Set}var t;return b()(e,[{key:"init",value:(t=h()(w.a.mark((function e(){var t;return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("customMediaPicker"!==this.pickerType){e.next=4;break}t=this.picker=this.pickerConfig,e.next=8;break;case 4:if("popup"!==this.pickerType){e.next=8;break}return e.next=7,this.mediaPickerFactoryClass(this.config.mediaClientConfig,this.pickerConfig);case 7:t=this.picker=e.sent;case 8:if(t){e.next=10;break}return e.abrupt("return",this);case 10:return t.on("upload-preview-update",this.handleUploadPreviewUpdate),t.on("upload-end",this.handleReady),t.on("upload-error",this.handleUploadError),t.on("mobile-upload-end",this.handleMobileUploadEnd),e.abrupt("return",this);case 15:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"type",get:function(){return this.pickerType}},{key:"mediaPicker",get:function(){return this.picker}},{key:"destroy",value:function(){var e=this.picker;if(e){e.removeAllListeners("upload-preview-update"),e.removeAllListeners("upload-end"),e.removeAllListeners("upload-error"),this.onStartListeners=[],this.onDragListeners=[];try{"popup"===this.pickerType&&e.teardown()}catch(t){this.errorReporter.captureException(t)}}}},{key:"setUploadParams",value:function(e){this.picker&&this.picker.setUploadParams(e)}},{key:"onClose",value:function(e){var t=this.picker;if("popup"===this.pickerType){var n=t;return n.on("closed",e),function(){return n.off("closed",e)}}return function(){}}},{key:"show",value:function(){if("popup"===this.pickerType)try{this.picker.show()}catch(e){this.errorReporter.captureException(e)}}},{key:"hide",value:function(){"popup"===this.pickerType&&this.picker.hide()}},{key:"onNewMedia",value:function(e){this.onStartListeners.push(e)}},{key:"onDrag",value:function(e){this.onDragListeners.push(e)}}]),e}(),ze=n("ct2w");function Fe(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Be(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Fe(Object(n),!0).forEach((function(t){s()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Fe(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Ve=["ready","error","cancelled"],We=function(){function e(t,n,r,i,a){var o=this;v()(this,e),s()(this,"allowsUploads",!1),s()(this,"mediaClientConfig",void 0),s()(this,"uploadMediaClientConfig",void 0),s()(this,"ignoreLinks",!1),s()(this,"waitForMediaUpload",!0),s()(this,"allUploadsFinished",!0),s()(this,"showDropzone",!1),s()(this,"element",void 0),s()(this,"layout","center"),s()(this,"mediaNodes",[]),s()(this,"mediaGroupNodes",{}),s()(this,"mobileUploadComplete",{}),s()(this,"options",void 0),s()(this,"mediaProvider",void 0),s()(this,"pendingTask",Promise.resolve(null)),s()(this,"view",void 0),s()(this,"destroyed",!1),s()(this,"contextIdentifierProvider",void 0),s()(this,"errorReporter",void 0),s()(this,"popupPicker",void 0),s()(this,"customPicker",void 0),s()(this,"removeOnCloseListener",(function(){})),s()(this,"openMediaPickerBrowser",void 0),s()(this,"onPopupToogleCallback",(function(){})),s()(this,"reactContext",void 0),s()(this,"pickers",[]),s()(this,"pickerPromises",[]),s()(this,"editingMediaSinglePos",void 0),s()(this,"showEditingDialog",void 0),s()(this,"mediaOptions",void 0),s()(this,"dispatch",void 0),s()(this,"onContextIdentifierProvider",function(){var e=h()(w.a.mark((function e(t,n){return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!n){e.next=4;break}return e.next=3,n;case 3:o.contextIdentifierProvider=e.sent;case 4:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()),s()(this,"setMediaProvider",function(){var e=h()(w.a.mark((function e(t){var n,r,i,a;return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=5;break}return o.destroyPickers(),o.allowsUploads=!1,o.destroyed||o.view.dispatch(o.view.state.tr.setMeta(Z.a,{allowsUploads:o.allowsUploads})),e.abrupt("return");case 5:return e.prev=5,e.next=8,t;case 8:o.mediaProvider=e.sent,o.mediaProvider.viewMediaClientConfig||(n=o.mediaProvider.viewMediaClientConfig)&&(o.mediaProvider.viewMediaClientConfig=n),_()(o.mediaProvider.viewMediaClientConfig,"MediaProvider promise did not resolve to a valid instance of MediaProvider - ".concat(o.mediaProvider)),e.next=21;break;case 13:return e.prev=13,e.t0=e.catch(5),r=new Error("Media functionality disabled due to rejected provider: ".concat(e.t0.message)),o.errorReporter.captureException(r),o.destroyPickers(),o.allowsUploads=!1,o.destroyed||o.view.dispatch(o.view.state.tr.setMeta(Z.a,{allowsUploads:o.allowsUploads})),e.abrupt("return");case 21:if(o.mediaClientConfig=o.mediaProvider.viewMediaClientConfig,o.allowsUploads=!!o.mediaProvider.uploadMediaClientConfig,i=o.view,a=o.allowsUploads,!o.destroyed&&i.dom.parentNode&&i.dispatch(i.state.tr.setMeta(Z.a,{allowsUploads:a})),!o.allowsUploads){e.next=35;break}if(o.uploadMediaClientConfig=o.mediaProvider.uploadMediaClientConfig,!o.mediaProvider.uploadParams||!o.uploadMediaClientConfig){e.next=32;break}return e.next=30,o.initPickers(o.mediaProvider.uploadParams,Re,o.reactContext);case 30:e.next=33;break;case 32:o.destroyPickers();case 33:e.next=36;break;case 35:o.destroyPickers();case 36:case"end":return e.stop()}}),e,null,[[5,13]])})));return function(t){return e.apply(this,arguments)}}()),s()(this,"getMediaOptions",(function(){return o.options})),s()(this,"hasUserAuthProvider",(function(){return!!o.uploadMediaClientConfig&&!!o.uploadMediaClientConfig.userAuthProvider})),s()(this,"insertFile",(function(e,t,n){var r=Be(Be({},e),{},{contextId:o.contextIdentifierProvider?o.contextIdentifierProvider.objectId:void 0}),i=o.collectionFromProvider();if(void 0!==i){o.mediaOptions&&o.mediaOptions.allowMarkingUploadsAsIncomplete&&(o.mobileUploadComplete[r.id]=!1),"error"!==e.status&&o.updateAndDispatch({allUploadsFinished:!1}),Object(M.d)(o.view.state.schema,r.fileMimeType)?Object(M.c)(o.view,r,o.getInputMethod(n),i,o.mediaOptions&&o.mediaOptions.alignLeftOnInsert):ke(o.view,[r],i,o.getInputMethod(n)),t(o.handleMediaState);var a=function(e){return e.status&&-1!==Ve.indexOf(e.status)};a(r)||(o.addPendingTask(new Promise((function(e){t((function(t){a(t)&&e(t)}))}))),o.pendingTask.then((function(){o.updateAndDispatch({allUploadsFinished:!0})})));var s=o.view;s.hasFocus()||s.focus()}})),s()(this,"addPendingTask",(function(e){var t=o.pendingTask,n=function(){return t};o.pendingTask=e.then(n,n)})),s()(this,"splitMediaGroup",(function(){return Object(ve.j)(o.view)})),s()(this,"onPopupPickerClose",(function(){o.onPopupToogleCallback(!1)})),s()(this,"shouldUseMediaPickerPopup",(function(){return!o.mediaOptions||o.mediaOptions&&void 0===o.mediaOptions.useMediaPickerPopup?o.hasUserAuthProvider():!!o.mediaOptions.useMediaPickerPopup})),s()(this,"showMediaPicker",(function(){if(o.openMediaPickerBrowser&&!o.shouldUseMediaPickerPopup())return o.openMediaPickerBrowser();o.popupPicker&&(o.popupPicker.show(),o.onPopupToogleCallback(!0))})),s()(this,"setBrowseFn",(function(e){o.openMediaPickerBrowser=e})),s()(this,"onPopupToggle",(function(e){o.onPopupToogleCallback=e})),s()(this,"waitForPendingTasks",(function(e,t){if(t&&o.pendingTask===t)return t;var n,r=o.pendingTask.then((function(){return o.waitForPendingTasks(void 0,o.pendingTask)}));if(!e)return r;var i=new Promise((function(t,r){n=window.setTimeout((function(){return r(new Error("Media operations did not finish in ".concat(e," ms")))}),e)}));return Promise.race([i,r.then((function(e){return clearTimeout(n),e}))])})),s()(this,"handleMediaNodeRemoval",(function(e,t){var n=e;n||(n=o.view.state.doc.nodeAt(t())),Object(ve.i)(o.view,n,t)})),s()(this,"handleMediaNodeMount",(function(e,t){o.mediaNodes.unshift({node:e,getPos:t})})),s()(this,"handleMediaNodeUnmount",(function(e){o.mediaNodes=o.mediaNodes.filter((function(t){var n=t.node;return e!==n}))})),s()(this,"findMediaNode",(function(e){return De(o,e)})),s()(this,"destroyAllPickers",(function(e){e.forEach((function(e){return e.destroy()})),o.pickers.splice(0,o.pickers.length)})),s()(this,"destroyPickers",(function(){var e=o.pickers,t=o.pickerPromises;t.length===e.length?o.destroyAllPickers(o.pickers):Promise.all(t).then((function(e){return o.destroyAllPickers(e)})),o.popupPicker=void 0,o.customPicker=void 0})),s()(this,"getInputMethod",(function(e){switch(e){case"popup":return ye.e.PICKER_CLOUD;case"clipboard":return ye.e.CLIPBOARD;case"dropzone":return ye.e.DRAG_AND_DROP}})),s()(this,"updateMediaNodeAttrs",(function(e,t,n){var r=o.view;if(r)return Ae(e,t,n)(r.state,r.dispatch)})),s()(this,"handleMediaState",(function(e){switch(e.status){case"error":var t=o.options.uploadErrorHandler;t&&t(e);break;case"mobile-upload-end":var n={id:e.publicId||e.id};"string"==typeof e.collection&&(n.collection=e.collection),o.updateMediaNodeAttrs(e.id,n,Object(M.d)(o.view.state.schema,e.fileMimeType)),o.mobileUploadComplete[n.id]=!0,delete o.mediaGroupNodes[e.id]}})),s()(this,"isMobileUploadCompleted",(function(e){return Ne(o,e)})),s()(this,"removeNodeById",(function(e){var t=e.id,n=Ie(o,t,Object(ze.a)(e.fileMimeType));n&&Object(ve.i)(o.view,n.node,n.getPos)})),s()(this,"removeSelectedMediaContainer",(function(){var e=o.view,t=o.selectedMediaContainerNode();if(!t)return!1;var n=e.state.selection.from;return Object(ve.i)(e,t.firstChild,(function(){return n+1})),!0})),s()(this,"selectedMediaContainerNode",(function(){var e=o.view.state,t=e.selection,n=e.schema;if(t instanceof x.NodeSelection&&(t.node.type===n.nodes.mediaSingle||t.node.type===n.nodes.mediaGroup))return t.node})),s()(this,"handleDrag",(function(e){var t="enter"===e;if(o.showDropzone!==t){o.showDropzone=t;var n=o.view;(0,n.dispatch)(n.state.tr)}})),this.reactContext=r,this.options=n,this.mediaOptions=i,this.dispatch=a,this.waitForMediaUpload=void 0===n.waitForMediaUpload||n.waitForMediaUpload;var c=t.schema.nodes;_()(c.media&&(c.mediaGroup||c.mediaSingle),"Editor: unable to init media plugin - media or mediaGroup/mediaSingle node absent in schema"),n.providerFactory.subscribe("mediaProvider",(function(e,t){return o.setMediaProvider(t)})),n.providerFactory.subscribe("contextIdentifierProvider",this.onContextIdentifierProvider),this.errorReporter=n.errorReporter||new C.a}var t;return b()(e,[{key:"updateElement",value:function(){var e,t=this.selectedMediaContainerNode(),n=this.view.state.schema.nodes.mediaSingle;t&&t.type===n&&(e=this.getDomElement(this.view.domAtPos.bind(this.view))),this.element!==e&&(this.element=e)}},{key:"getDomElement",value:function(e){var t=this.view.state,n=t.selection,r=t.schema;if(n instanceof x.NodeSelection&&n.node.type===r.nodes.mediaSingle){var i=Object(S.findDomRefAtPos)(n.from,e);if(i)return i.childNodes.length?i.querySelector(".wrapper")||i:i.parentNode}}},{key:"setView",value:function(e){this.view=e}},{key:"destroy",value:function(){if(!this.destroyed){this.destroyed=!0;var e=this.mediaNodes;e.splice(0,e.length),this.removeOnCloseListener(),this.destroyPickers()}}},{key:"initPickers",value:(t=h()(w.a.mark((function e(t,n,r){var i,a,o,s,c,l,u,d=this;return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.destroyed&&this.uploadMediaClientConfig){e.next=2;break}return e.abrupt("return");case 2:if(i=this.errorReporter,a=this.pickers,o=this.pickerPromises,a.length){e.next=26;break}if(s={mediaClientConfig:this.uploadMediaClientConfig,errorReporter:i},c={uploadParams:t,proxyReactContext:r(),useForgePlugins:this.mediaOptions&&this.mediaOptions.useForgePlugins||!1,featureFlags:this.mediaOptions&&this.mediaOptions.featureFlags},!this.options.customMediaPicker){e.next=16;break}return l=new n("customMediaPicker",s,this.options.customMediaPicker).init(),o.push(l),e.t0=a,e.next=12,l;case 12:e.t1=this.customPicker=e.sent,e.t0.push.call(e.t0,e.t1),e.next=25;break;case 16:if(!this.shouldUseMediaPickerPopup()){e.next=25;break}return u=new n("popup",s,c).init(),o.push(u),e.t2=a,e.next=22,u;case 22:e.t3=this.popupPicker=e.sent,e.t2.push.call(e.t2,e.t3),this.removeOnCloseListener=this.popupPicker.onClose(this.onPopupPickerClose);case 25:a.forEach((function(e){e.onNewMedia(d.insertFile)}));case 26:a.forEach((function(e){return e.setUploadParams(t)}));case 27:case"end":return e.stop()}}),e,this)}))),function(e,n,r){return t.apply(this,arguments)})},{key:"collectionFromProvider",value:function(){return this.mediaProvider&&this.mediaProvider.uploadParams&&this.mediaProvider.uploadParams.collection}},{key:"updateAndDispatch",value:function(e){var t=this;Object.keys(e).forEach((function(n){var r=n,i=e[r];void 0!==i&&(t[r]=i)})),this.dispatch&&this.dispatch(Z.a,Be({},this))}}]),e}(),Ge=function(e){return Z.a.getState(e)},Ke=function(e,t,n,r,i){var a=function(e){var t=document.createElement("div");return e?k.a.render(l.a.createElement(pe,{type:"single"}),t):k.a.render(l.a.createElement(pe),t),t}(i&&i.allowDropzoneDropLine);return new x.Plugin({state:{init:function(e,a){return new We(a,t,n,i,r)},apply:function(e,t){"number"==typeof t.editingMediaSinglePos&&(t.editingMediaSinglePos=e.mapping.map(t.editingMediaSinglePos));var n=e.getMeta(Z.a);if(n){var r=n.allowsUploads;t.updateAndDispatch({allowsUploads:void 0===r?t.allowsUploads:r})}return t}},filterTransaction:function(e,t){return!(e.selectionSet&&Object(S.isNodeSelection)(e.selection)&&e.selection.node.type===t.schema.nodes.media&&e.selection.$anchor.parent.type===t.schema.nodes.mediaSingle)},key:Z.a,view:function(e){var t=Ge(e.state);return t.setView(e),t.updateElement(),{update:function(){t.updateElement()}}},props:{decorations:function(e){if(Ge(e).showDropzone){var t=e.schema,n=e.selection.$anchor;if(e.selection instanceof x.NodeSelection){if(e.selection.node.type===t.nodes.mediaSingle){var r=j.a.node(e.selection.from,e.selection.to,{class:"richMedia-selected"});return j.b.create(e.doc,[r])}}else{var i=n.pos;if(n.parent.type!==t.nodes.paragraph&&n.parent.type!==t.nodes.codeBlock&&(i=Object(P.h)(e.doc,i,t.nodes.mediaGroup)),null!=i){var o=[j.a.widget(i,a,{key:"drop-placeholder"})];return j.b.create(e.doc,o)}}}},nodeViews:t.nodeViews,handleTextInput:function(e){return Ge(e.state).splitMediaGroup(),!1}}})},He=n("7rzR");function Je(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function qe(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Je(Object(n),!0).forEach((function(t){s()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Je(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Qe=new x.PluginKey("mediaEditorPlugin"),$e=Object(He.a)(Qe,(function(e,t){switch(t.type){case"open":return qe(qe({},e),{},{editor:{identifier:t.identifier,pos:t.pos}});case"close":case"upload":return qe(qe({},e),{},{editor:void 0});case"setMediaClientConfig":return qe(qe({},e),{},{mediaClientConfig:t.mediaClientConfig});default:return e}}),{mapping:function(e,t){return t.editor?qe(qe({},t),{},{editor:qe(qe({},t.editor),{},{pos:e.mapping.map(t.editor.pos)})}):t}}),Xe=$e.createPluginState,Ze=$e.createCommand,Ye=$e.getPluginState;function et(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function tt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?et(Object(n),!0).forEach((function(t){s()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):et(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var nt=function(){return Ze({type:"close"})},rt=function(e,t){return Ze({type:"upload",newIdentifier:e},(function(n,r){var i=Ye(r).editor;if(!i)return n;var a=n.mapping.map(i.pos),o=n.doc.nodeAt(a),s=r.schema.nodes.media;if(!o||o.type!==s)return n;var c=tt(tt({},o.attrs),{},{id:e.id,collection:e.collectionName||o.attrs.collection,occurrenceKey:e.occurrenceKey,width:t.width,height:t.height});return n.setNodeMarkup(a,void 0,c)}))},it=function(e){return function(t){var n=function(){var e=h()(w.a.mark((function e(n,r){var i,a,o,s;return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("mediaProvider"===n){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,r;case 4:if(i=e.sent){e.next=7;break}return e.abrupt("return");case 7:return e.next=9,i.uploadMediaClientConfig;case 9:if(e.t0=e.sent,e.t0){e.next=14;break}return e.next=13,i.viewMediaClientConfig;case 13:e.t0=e.sent;case 14:a=e.t0,o=t.dispatch,s=t.state,Ze({type:"setMediaClientConfig",mediaClientConfig:a})(s,o,t);case 17:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}();return e.subscribe("mediaProvider",n),{destroy:function(){e.unsubscribe("mediaProvider",n)}}}},at=function(e){var t=e.dispatch,n=e.providerFactory;return new x.Plugin({state:Xe(t,{}),key:Qe,view:it(n)})};function ot(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function st(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ot(Object(n),!0).forEach((function(t){s()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ot(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var ct=n("6drl"),lt=new x.PluginKey("mediaAltTextPlugin"),ut=Object(He.a)(lt,(function(e,t){switch(t.type){case"updateAltText":return st({},e);case"openMediaAltTextMenu":return st(st({},e),{},{isAltTextEditorOpen:!0});case"closeMediaAltTextMenu":return st(st({},e),{},{isAltTextEditorOpen:!1});default:return e}}),{onSelectionChanged:function(e,t){return e.getMeta(ct.a)?t:{isAltTextEditorOpen:!1}}}),dt=ut.createPluginState,pt=ut.createCommand,ft=ut.getPluginState,ht=function(e){var t=e.dispatch;e.providerFactory;return new x.Plugin({state:dt(t,{isAltTextEditorOpen:!1}),key:lt,view:function(){return{update:function(e,t){var n=ft(e.state),r=ft(t);n&&r&&r.isAltTextEditorOpen&&!n.isAltTextEditorOpen&&!e.hasFocus()&&e.focus()}}}})},mt=n("pFaK"),vt=n("O+po");function gt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function bt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?gt(Object(n),!0).forEach((function(t){s()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):gt(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var yt,wt,Ot,kt=pt((function(e){return!!Object(ve.d)(e)&&{type:"closeMediaAltTextMenu"}})),xt=(yt=ye.a.OPENED,wt=function(e){return!!Object(ve.d)(e)&&{type:"openMediaAltTextMenu"}},Ot=function(e){return e.setMeta("scrollIntoView",!1)},Object(we.d)({action:yt,actionSubject:ye.b.MEDIA,actionSubjectId:ye.c.ALT_TEXT,eventType:ye.d.TRACK})(pt(wt,Ot)));var Pt=n("XZ5u");function jt(e,t){var n=e.$from,r=n.index(n.depth-1),i=n.node(n.depth-1);return i?i.maybeChild(r+t):null}function Ct(e){return function(t,n){var r=t.selection.$from,i=t.schema.nodes.paragraph,a=jt(t.selection,-2);if(!a)return!1;var o=jt(t.selection,-1),s=r.pos-o.nodeSize-a.nodeSize,c=t.tr;if(function(t){var n=!1;try{n=e(t)}catch(r){}return n}(a))c=c.replace(s-1,s+a.nodeSize);else if(Object(he.q)(t.selection)?c.replace(r.pos,r.pos+r.parent.nodeSize-1):c.replace(r.pos-1,r.pos+r.parent.nodeSize-1),a.type===i){var l=s+a.nodeSize-2;Object(S.safeInsert)(r.parent.content,l)(c)}else{var u=s+a.nodeSize-1;Object(S.safeInsert)(r.parent.copy(r.parent.content),u)(c)}return n&&n(c),!0}}var Et,_t=function(e){var t=Object(he.l)(e);return function(e,n){var r=e.selection,i=e.schema,a=r.$from;if(!function(e){return!!e.empty&&e.$from.parentOffset<=0}(e.selection))return!1;if(!function(e,t){return e.$from.parent.type===t}(e.selection,i.nodes.paragraph))return!1;return!!function(e,t,n){var r=jt(e,n);return!!r&&r.type===t}(e.selection,i.nodes.mediaSingle,-1)&&("wrap-right"===jt(e.selection,-1).attrs.layout?Ct(t)(e,n):(n&&Object(Pt.f)(e,(function(r){t(a.parent)&&!Object(ge.d)(e)&&r.replace(a.pos-1,a.pos+a.parent.nodeSize-1),n(r)})),!0))}};function St(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Mt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?St(Object(n),!0).forEach((function(t){s()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):St(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}!function(e){e.showToolbar="MEDIA_SHOW_TOOLBAR",e.hideToolbar="MEDIA_HIDE_TOOLBAR",e.setUrl="MEDIA_SET_LINK_TO",e.unlink="MEDIA_LINKING_UNLINK"}(Et||(Et={}));function Dt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function It(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Dt(Object(n),!0).forEach((function(t){s()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Dt(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Nt=new x.PluginKey("mediaLinking"),Tt={visible:!1,editable:!1,mediaPos:null,link:""};var At=Object(He.a)(Nt,(function(e,t){switch(t.type){case Et.showToolbar:return Mt(Mt({},e),{},{visible:!0});case Et.setUrl:return Mt(Mt({},e),{},{editable:!0,link:t.payload});case Et.hideToolbar:return Mt(Mt({},e),{},{visible:!1});case Et.unlink:return Mt(Mt({},e),{},{link:"",visible:!1,editable:!1})}return e}),{mapping:function(e,t){return t&&null!==t.mediaPos?It(It({},t),{},{mediaPos:e.mapping.map(t.mediaPos)}):t},onSelectionChanged:function(e){if(!(e.selection instanceof x.NodeSelection))return Tt;var t=e.selection.$from.pos+1,n=e.doc.nodeAt(t);if(!n||"media"!==n.type.name)return Tt;var r=n.marks.find((function(e){return"link"===e.type.name}));return It(It({},Tt),{},r?{mediaPos:t,editable:!0,link:r.attrs.href}:{mediaPos:t})}}),Lt=At.createCommand,Ut=At.getPluginState,Rt=n("7i3F"),zt=n("eXjd"),Ft=function(e){var t=e.doc,n=e.selection,r=e.schema;if(t&&n&&n instanceof x.NodeSelection&&n.node.type===r.nodes.mediaSingle){var i=t.nodeAt(n.$anchor.pos+1);if(i&&i.type===r.nodes.media)return i}},Bt=n("5aEg"),Vt=function(){var e=h()(w.a.mark((function e(t,n){var r;return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("external"!==t.attrs.type){e.next=2;break}return e.abrupt("return","external");case 2:if(t.attrs.id){e.next=4;break}return e.abrupt("return");case 4:return e.prev=4,e.next=7,Object(Bt.a)(n).file.getCurrentState(t.attrs.id,{collectionName:t.attrs.collection});case 7:if(!(r=e.sent)||"error"===r.status){e.next=10;break}return e.abrupt("return",r.mediaType);case 10:e.next=14;break;case 12:e.prev=12,e.t0=e.catch(4);case 14:case"end":return e.stop()}}),e,null,[[4,12]])})));return function(t,n){return e.apply(this,arguments)}}();function Wt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Gt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Wt(Object(n),!0).forEach((function(t){s()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Wt(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Kt=Lt((function(e){var t=Ut(e);if(t&&null!==t.mediaPos&&e.doc.nodeAt(t.mediaPos))return{type:Et.showToolbar};return!1})),Ht=function(e,t,n){if(t&&n){var r=Ft(e);if(!r)return!1;var i=Ge(e).mediaClientConfig;if(!i)return!1;Vt(r,i).then((function(e){"external"!==e&&"image"!==e||Ft(n.state)!==r||t(n.state.tr.setMeta(Nt,{type:Et.showToolbar}))}))}return!0},Jt=Lt({type:Et.hideToolbar}),qt=function(e,t,n){Jt(e,t,n),n&&n.focus()};function Qt(e,t,n){var r=n.forceRemove,i=void 0!==r&&r,a=n.url,o=Ut(t);if(!o||null===o.mediaPos)return e;var s=t.doc.resolve(o.mediaPos),c=t.doc.nodeAt(s.pos);if(!c)return e;var l=t.schema.marks.link,u=t.schema.nodes.media;return Object(zt.f)(l,(function(e,t){if(t&&t.type===u){if(i)return!1;var n=Object(Rt.g)(a);if(!e||e.href!==n)return""!==n.trim()&&Gt(Gt({},e),{},{href:n})}}),[u])(s.pos,s.pos+c.nodeSize,e,t),e}var $t=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:void 0;return Object(we.a)(t,e,{action:n,eventType:ye.d.TRACK,actionSubject:ye.b.MEDIA,actionSubjectId:ye.c.LINK,attributes:r})},Xt=Lt({type:Et.unlink},(function(e,t){var n=Qt(e,t,{forceRemove:!0});return $t(n,t,ye.a.DELETED)})),Zt=function(e,t){var n=function(e){var t=e.schema.marks.link,n=Ut(e);if(n&&null!==n.mediaPos){var r=e.doc.resolve(n.mediaPos),i=e.doc.nodeAt(r.pos);if(i)if(t.isInSet(i.marks))return i.marks.find((function(e){return e.type===t})).attrs.href}}(t);return n?e!==n?ye.a.EDITED:void 0:ye.a.ADDED},Yt=function(e,t){return Lt({type:Et.setUrl,payload:Object(Rt.g)(e)},(function(n,r){var i=Zt(e,r);if(!i)return n;try{var a=Qt(n,r,{url:e});return $t(n,r,i,i===ye.a.ADDED?{inputMethod:t}:void 0),a}catch(o){throw $t(n,r,ye.a.ERRORED,{action:i}),o}}))};var en=function(e){return Z.a.getState(e).ignoreLinks=!0,!1},tn=function(e){return Z.a.getState(e).splitMediaGroup()},nn=function(){var e={};return vt.bindKeymapWithCommand(vt.undo.common,en,e),vt.bindKeymapWithCommand(vt.enter.common,tn,e),vt.bindKeymapWithCommand(vt.insertNewLine.common,tn,e),Object(mt.b)(e)},rn=n("5+wD"),an=n.n(rn),on=n("X/1r"),sn=n("HGna"),cn=function(e){var t=e.editorView,n=e.eventDispatcher,r=e.pluginKey,i=e.isDisabled,a=e.isReducedSpacing;return l.a.createElement(sn.a,{editorView:t,eventDispatcher:n,plugins:{mediaPlugin:r},render:function(e){var t,n=e.mediaPlugin;return n.allowsUploads?l.a.createElement(on.a,{onClick:(t=n,function(){return t.showMediaPicker(),!0}),disabled:i,title:"Files & images",spacing:a?"none":"default",iconBefore:l.a.createElement(an.a,{label:"Files & images"})}):null}})},ln=n("XLm4"),un=n("06eS"),dn=n.n(un),pn=n("GW/8"),fn=n("Km6/"),hn=n("WJQr"),mn=n("rgs1"),vn=n("x7QK"),gn=n.n(vn),bn=n("laKe"),yn=n("KgC3"),wn=function(){function e(t){var n=this;v()(this,e),s()(this,"props",void 0),s()(this,"updateContextId",h()(w.a.mark((function e(){var t,r,i;return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((t=n.getAttrs())&&"file"===t.type){e.next=3;break}return e.abrupt("return");case 3:return r=t.id,e.next=6,n.getObjectId();case 6:i=e.sent,Te(r,{__contextId:i},n.props.isMediaSingle)(n.props.view.state,n.props.view.dispatch);case 8:case"end":return e.stop()}}),e)})))),s()(this,"hasFileAttributesDefined",(function(){var e=n.getAttrs();return e&&"file"===e.type&&e.__fileName&&e.__fileMimeType&&e.__fileSize&&e.__contextId})),s()(this,"updateFileAttrs",h()(w.a.mark((function e(){var t,r,i,a,o,s,c,l,u,d,p,f,h,m=arguments;return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=!(m.length>0&&void 0!==m[0])||m[0],r=n.getAttrs(),e.next=4,n.props.mediaProvider;case 4:if((i=e.sent)&&i.uploadParams&&r&&"file"===r.type&&!n.hasFileAttributesDefined()){e.next=7;break}return e.abrupt("return");case 7:return a=i.viewMediaClientConfig,o=Object(Bt.a)(a),s={collectionName:r.collection},e.prev=10,e.next=13,o.file.getCurrentState(r.id,s);case 13:if("error"!==(c=e.sent).status){e.next=16;break}return e.abrupt("return");case 16:e.next=21;break;case 18:return e.prev=18,e.t0=e.catch(10),e.abrupt("return");case 21:if(e.t1=n.getNodeContextId(),e.t1){e.next=26;break}return e.next=25,n.getObjectId();case 25:e.t1=e.sent;case 26:l=e.t1,d=(u=c).name,p=u.mimeType,f=u.size,On(r,h={__fileName:d,__fileMimeType:p,__fileSize:f,__contextId:l})&&Te(r.id,h,t)(n.props.view.state,n.props.view.dispatch);case 31:case"end":return e.stop()}}),e,null,[[10,18]])})))),s()(this,"getAttrs",(function(){var e=n.props.node.attrs;if(e)return e})),s()(this,"getObjectId",h()(w.a.mark((function e(){var t;return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.props.contextIdentifierProvider;case 2:return t=e.sent,e.abrupt("return",t&&t.objectId);case 4:case"end":return e.stop()}}),e)})))),s()(this,"uploadExternalMedia",function(){var e=h()(w.a.mark((function e(t){var r,i,a,o,s,c,l,u;return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.props.node,e.next=3,n.props.mediaProvider;case 3:if(i=e.sent,!r||!i){e.next=21;break}if((a=i.uploadMediaClientConfig)&&r.attrs.url){e.next=8;break}return e.abrupt("return");case 8:return o=Object(Bt.a)(a),s=i.uploadParams&&i.uploadParams.collection,e.prev=10,e.next=13,o.file.uploadExternal(r.attrs.url,s);case 13:c=e.sent,l=c.uploadableFileUpfrontIds,u=c.dimensions,Le(t()+1,{id:l.id,collection:s,height:u.height,width:u.width,occurrenceKey:l.occurrenceKey})(n.props.view.state,n.props.view.dispatch),e.next=21;break;case 18:e.prev=18,e.t0=e.catch(10),n.props.dispatchAnalyticsEvent&&n.props.dispatchAnalyticsEvent({action:ye.a.UPLOAD_EXTERNAL_FAIL,actionSubject:ye.b.EDITOR,eventType:ye.d.OPERATIONAL});case 21:case"end":return e.stop()}}),e,null,[[10,18]])})));return function(t){return e.apply(this,arguments)}}()),s()(this,"getNodeContextId",(function(){var e=n.getAttrs();if(e&&"file"===e.type)return e.__contextId})),s()(this,"updateDimensions",(function(e){Te(e.id,{height:e.height,width:e.width},!0)(n.props.view.state,n.props.view.dispatch)})),s()(this,"hasDifferentContextId",h()(w.a.mark((function e(){var t,r;return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.getNodeContextId(),e.next=3,n.getObjectId();case 3:if(r=e.sent,!t||!r||t===r){e.next=6;break}return e.abrupt("return",!0);case 6:return e.abrupt("return",!1);case 7:case"end":return e.stop()}}),e)})))),s()(this,"isNodeFromDifferentCollection",h()(w.a.mark((function e(){var t,r,i,a,o;return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.props.mediaProvider;case 2:if((t=e.sent)&&t.uploadParams){e.next=5;break}return e.abrupt("return",!1);case 5:if(r=t.uploadParams.collection,(i=n.getAttrs())&&"file"===i.type){e.next=9;break}return e.abrupt("return",!1);case 9:if(a=i.collection,o=i.__contextId,e.t0=o,e.t0){e.next=15;break}return e.next=14,n.getObjectId();case 14:e.t0=e.sent;case 15:if(!e.t0||r===a){e.next=18;break}return e.abrupt("return",!0);case 18:return e.abrupt("return",!1);case 19:case"end":return e.stop()}}),e)})))),s()(this,"copyNodeFromBlobUrl",function(){var e=h()(w.a.mark((function e(t){var r,i,a,o,s,c,l,u,d,p,f,h,m,v,g,b,y,O,k;return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((r=n.getAttrs())&&"external"===r.type){e.next=3;break}return e.abrupt("return");case 3:if(i=r.url,a=Object(yn.b)(i)){e.next=7;break}return e.abrupt("return");case 7:return e.next=9,n.props.mediaProvider;case 9:if((o=e.sent)&&o.uploadParams){e.next=12;break}return e.abrupt("return");case 12:if(s=o.uploadParams.collection,c=a.contextId,l=a.id,u=a.collection,d=a.height,p=a.width,f=a.mimeType,h=a.name,m=a.size,(v=o.uploadMediaClientConfig)&&v.getAuthFromContext){e.next=17;break}return e.abrupt("return");case 17:return g=Object(Bt.a)(v),e.next=20,v.getAuthFromContext(c);case 20:return b=e.sent,y={id:l,collection:u,authProvider:function(){return Promise.resolve(b)}},O={collection:s,authProvider:v.authProvider,occurrenceKey:gn()()},e.next=25,g.file.copyFile(y,O);case 25:k=e.sent,Le(t()+1,{id:k.id,collection:s,height:d,width:p,__fileName:h,__fileMimeType:f,__fileSize:m})(n.props.view.state,n.props.view.dispatch);case 27:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),s()(this,"copyNode",h()(w.a.mark((function e(){var t,r,i,a,o,s,c,l,u,d,p,f,h,m,v,g;return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.props.mediaProvider;case 2:if(t=e.sent,r=n.props,i=r.isMediaSingle,a=r.view,o=n.getAttrs(),t&&t.uploadParams&&o&&"file"===o.type){e.next=7;break}return e.abrupt("return");case 7:if(s=n.getNodeContextId(),!((c=t.uploadMediaClientConfig)&&c.getAuthFromContext&&s)){e.next=25;break}return l=Object(Bt.a)(c),e.next=13,c.getAuthFromContext(s);case 13:return u=e.sent,e.next=16,n.getObjectId();case 16:return d=e.sent,p=o.id,f=o.collection,h={id:p,collection:f,authProvider:function(){return Promise.resolve(u)}},m=t.uploadParams.collection,v={collection:m,authProvider:c.authProvider,occurrenceKey:gn()()},e.next=23,l.file.copyFile(h,v);case 23:g=e.sent,Ae(h.id,{id:g.id,collection:m,__contextId:d},i)(a.state,a.dispatch);case 25:case"end":return e.stop()}}),e)})))),this.props=t}var t,n;return b()(e,[{key:"isMediaBlobUrl",value:function(){var e=this.getAttrs();return!(!e||"external"!==e.type||!Object(yn.c)(e.url))}},{key:"getRemoteDimensions",value:(n=h()(w.a.mark((function e(){var t,n,r,i,a,o,s,c,l,u;return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.props.mediaProvider;case 2:if(t=e.sent,n=this.props.mediaOptions,r=this.getAttrs(),t&&r){e.next=7;break}return e.abrupt("return",!1);case 7:if(i=r.height,a=r.width,"external"!==r.type&&r.id){e.next=10;break}return e.abrupt("return",!1);case 10:if(o=r.id,s=r.collection,!i||!a){e.next=13;break}return e.abrupt("return",!1);case 13:if(!n||n.allowRemoteDimensionsFetch){e.next=15;break}return e.abrupt("return",{id:o,height:bn.a,width:bn.b});case 15:return c=t.viewMediaClientConfig,l=Object(Bt.a)(c),e.next=19,l.getImageMetadata(o,{collection:s});case 19:if((u=e.sent)&&u.original){e.next=22;break}return e.abrupt("return",!1);case 22:return e.abrupt("return",{id:o,height:u.original.height||bn.a,width:u.original.width||bn.b});case 23:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"handleExternalMedia",value:(t=h()(w.a.mark((function e(t){return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isMediaBlobUrl()){e.next=12;break}return e.prev=1,e.next=4,this.copyNodeFromBlobUrl(t);case 4:e.next=10;break;case 6:return e.prev=6,e.t0=e.catch(1),e.next=10,this.uploadExternalMedia(t);case 10:e.next=14;break;case 12:return e.next=14,this.uploadExternalMedia(t);case 14:case"end":return e.stop()}}),e,this,[[1,6]])}))),function(e){return t.apply(this,arguments)})}]),e}(),On=function(e,t){return e.__fileName!==t.__fileName||e.__fileMimeType!==t.__fileMimeType||e.__fileSize!==t.__fileSize||e.__contextId!==t.__contextId};function kn(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=H()(e);if(t){var i=H()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return G()(this,n)}}var xn=function(e){return Object(be.c)(e.anchorPos,e.headPos,e.getPos(),e.node.nodeSize)},Pn=function(e){V()(n,e);var t=kn(n);function n(e){var r;return v()(this,n),r=t.call(this,e),s()(F()(r),"mediaPluginState",void 0),s()(F()(r),"mediaNodes",void 0),s()(F()(r),"state",{viewMediaClientConfig:void 0}),s()(F()(r),"updateNodeAttrs",(function(e){var t=e.view,n=e.mediaProvider,i=e.contextIdentifierProvider;r.mediaNodes.forEach((function(e){new wn({view:t,mediaProvider:n,contextIdentifierProvider:i,node:e,isMediaSingle:!1}).updateFileAttrs(!1)}))})),s()(F()(r),"setMediaItems",(function(e){var t=e.node;r.mediaNodes=[],t.forEach((function(t,n){r.mediaPluginState.mediaGroupNodes[t.attrs.id]={node:t,getPos:function(){return e.getPos()+n+1}},r.mediaNodes.push(t)}))})),s()(F()(r),"getIdentifier",(function(e){return"external"===e.attrs.type?{mediaItemType:"external-image",dataURI:e.attrs.url}:{id:e.attrs.id,mediaItemType:"file",collectionName:e.attrs.collection}})),s()(F()(r),"isNodeSelected",(function(e){var t=xn(r.props);return t===be.a.selectedInRange||t===be.a.selectedInside&&r.props.anchorPos===e})),s()(F()(r),"renderChildNodes",(function(){var e=r.state.viewMediaClientConfig,t=r.props,n=t.getPos,i=t.allowLazyLoading,a=t.disabled,o=t.mediaOptions,s=r.mediaNodes.map((function(e,t){var o=function(){return n()+t+1};return{identifier:r.getIdentifier(e),isLazy:i,selected:r.isNodeSelected(o()),onClick:function(){Object(X.f)(r.props.view,o())},actions:[{handler:a?function(){}:r.mediaPluginState.handleMediaNodeRemoval.bind(null,void 0,o),icon:l.a.createElement(dn.a,{label:"delete"})}]}}));return l.a.createElement(pn.a,{items:s,mediaClientConfig:e,featureFlags:o.featureFlags})})),r.mediaNodes=[],r.mediaPluginState=Z.a.getState(e.view.state),r.setMediaItems(e),r.state={viewMediaClientConfig:void 0},r}return b()(n,[{key:"componentDidMount",value:function(){var e=this;this.updateMediaClientConfig(),this.mediaNodes.forEach(function(){var t=h()(w.a.mark((function t(n){var r,i,a,o,s;return w.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if("external"!==n.attrs.type){t.next=2;break}return t.abrupt("return");case 2:if(r=e.props,i=r.view,a=r.mediaProvider,o=r.contextIdentifierProvider,s=new wn({view:i,mediaProvider:a,contextIdentifierProvider:o,node:n,isMediaSingle:!1}),s.getNodeContextId()){t.next=8;break}return t.next=8,s.updateContextId();case 8:return t.next=10,s.hasDifferentContextId();case 10:if(!t.sent){t.next=14;break}return t.next=14,s.copyNode();case 14:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())}},{key:"UNSAFE_componentWillReceiveProps",value:function(e){this.updateMediaClientConfig(),this.setMediaItems(e),!1!==e.isCopyPasteEnabled&&this.updateNodeAttrs(e)}},{key:"shouldComponentUpdate",value:function(e){return t=this.props,n=e,xn(t)!==xn(n)||xn(n)===be.a.selectedInside&&t.anchorPos!==n.anchorPos||this.props.node!==e.node||this.state.viewMediaClientConfig!==this.mediaPluginState.mediaClientConfig;var t,n}},{key:"updateMediaClientConfig",value:function(){var e=this.state.viewMediaClientConfig,t=this.mediaPluginState.mediaClientConfig;!e&&t&&this.setState({viewMediaClientConfig:t})}},{key:"render",value:function(){return this.renderChildNodes()}}]),n}(l.a.Component);s()(Pn,"displayName","MediaGroup");var jn,Cn=function(e){V()(n,e);var t=kn(n);function n(){return v()(this,n),t.apply(this,arguments)}return b()(n,[{key:"render",value:function(e,t){var n=this,r=e.providerFactory,i=e.mediaOptions,a=this.getPos;return l.a.createElement(ln.a,{providers:["mediaProvider","contextIdentifierProvider"],providerFactory:r,renderNode:function(e){var r=e.mediaProvider,o=e.contextIdentifierProvider;return l.a.createElement(sn.a,{editorView:n.view,plugins:{reactNodeViewState:hn.b,editorDisabledPlugin:mn.b},render:function(e){var s=e.editorDisabledPlugin;return r?l.a.createElement(Pn,{node:n.node,getPos:a,view:n.view,forwardRef:t,disabled:(s||{}).editorDisabled,allowLazyLoading:i.allowLazyLoading,mediaProvider:r,contextIdentifierProvider:o,isCopyPasteEnabled:i.isCopyPasteEnabled,anchorPos:n.view.state.selection.$anchor.pos,headPos:n.view.state.selection.$head.pos,mediaOptions:i}):null}})}})}}]),n}(fn.a),En=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return function(i,a,o){return new Cn(i,a,o,e,t,{providerFactory:n,mediaOptions:r}).init()}},_n=n("RNXH"),Sn=n.n(_n),Mn=n("LGLP"),Dn=n.n(Mn),In=n("ww0P"),Nn=n("iHxc"),Tn=n("bHTr"),An=n("WISH"),Ln=n("RFGA"),Un=N.default.div(jn||(jn=I()(["\n  img {\n    width: 100%;\n  }\n\n  & > div {\n    ",";\n    position: relative;\n    clear: both;\n  }\n"])),Ln.a);Un.displayName="ResizerWrapper";var Rn=n("9Bpa"),zn=n("VUve"),Fn=n("LPnw"),Bn=[250,384,576,768];function Vn(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=H()(e);if(t){var i=H()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return G()(this,n)}}var Wn=function(e){V()(i,e);var t,n,r=Vn(i);function i(){var e;v()(this,i);for(var t=arguments.length,n=new Array(t),a=0;a<t;a++)n[a]=arguments[a];return e=r.call.apply(r,[this].concat(n)),s()(F()(e),"state",{offsetLeft:Gn(e.insideInlineLike,e.insideLayout,e.props.view.dom,void 0),isVideoFile:!0}),s()(F()(e),"calcNewSize",(function(t,n){var r=e.props,i=r.layout,a=r.view.state,o=100*Object(Tn.b)(t,e.props.lineLength);e.setState({resizedPctWidth:o});var s=Object(S.hasParentNodeOfType)(a.schema.nodes.table)(a.selection)?i:e.calcUnwrappedLayout(o,t);return o<=100?(!e.wrappedLayout||n&&100===o||(s=i),{width:o,layout:s}):{width:e.props.pctWidth||null,layout:s}})),s()(F()(e),"calcUnwrappedLayout",(function(e,t){return e<=100?"center":t<=An.V?"wide":"full-width"})),s()(F()(e),"calcColumnLeftOffset",(function(){var t=e.state.offsetLeft;return e.insideInlineLike?Object(Tn.a)(t,e.props.lineLength,e.props.gridSize):0})),s()(F()(e),"wrapper",void 0),s()(F()(e),"calcPxWidth",(function(t){var n=e.props,r=n.width,i=n.height,a=n.layout,o=n.pctWidth,s=n.lineLength,c=n.containerWidth,l=n.fullWidthMode,u=n.getPos,d=n.view.state,p=e.state.resizedPctWidth,f="function"==typeof u?u():void 0;return Object(M.a)({origWidth:r,origHeight:i,pctWidth:o,state:d,containerWidth:{width:c,lineLength:s},isFullWidthModeEnabled:l,layout:t||a,pos:f,resizedPctWidth:p})})),s()(F()(e),"highlights",(function(t,n){var r=Object(zn.c)(t,n),i=e.props.view.state.schema.nodes,a=i.layoutColumn,o=i.table,s=i.expand,c=i.nestedExpand;if(e.$pos&&Object(S.findParentNodeOfTypeClosestToPos)(e.$pos,[a,o,s,c].filter(Boolean)))return[];if(r>An.V)return["full-width"];var l=e.props,u=l.layout,d=l.lineLength,p=l.gridSize,f=Object(Tn.a)(r,d,p),h=Math.round(f),m=[];return"wrap-left"===u||"align-start"===u?m.push(0,h):"wrap-right"===u||"align-end"===u?m.push(p,p-h):e.insideInlineLike?m.push(Math.round(f+e.calcColumnLeftOffset())):m.push(Math.floor((p-h)/2),Math.ceil((p+h)/2)),m})),s()(F()(e),"saveWrapper",(function(t){return e.wrapper=t})),e}return b()(i,[{key:"componentDidUpdate",value:function(){var e=Gn(this.insideInlineLike,this.insideLayout,this.props.view.dom,this.wrapper);return e!==this.state.offsetLeft&&e>=0&&this.setState({offsetLeft:e}),!0}},{key:"wrappedLayout",get:function(){return bn.e.indexOf(this.props.layout)>-1}},{key:"componentDidMount",value:(n=h()(w.a.mark((function e(){var t;return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t=this.props.viewMediaClientConfig)){e.next=4;break}return e.next=4,this.checkVideoFile(t);case 4:this.props.pctWidth&&this.setState({resizedPctWidth:this.props.pctWidth});case 5:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"UNSAFE_componentWillReceiveProps",value:function(e){this.props.viewMediaClientConfig!==e.viewMediaClientConfig&&this.checkVideoFile(e.viewMediaClientConfig),this.props.layout!==e.layout&&this.checkLayout(this.props.layout,e.layout)}},{key:"checkVideoFile",value:(t=h()(w.a.mark((function e(t){var n,r,i,a;return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((n=this.$pos)&&t){e.next=3;break}return e.abrupt("return");case 3:if((r=this.props.view.state.doc.nodeAt(n.pos+1))&&r.attrs.id){e.next=6;break}return e.abrupt("return");case 6:return i=Object(Bt.a)(t),e.prev=7,e.next=10,i.file.getCurrentState(r.attrs.id,{collectionName:r.attrs.collection});case 10:(a=e.sent)&&"error"!==a.status&&"image"===a.mediaType&&this.setState({isVideoFile:!1}),e.next=17;break;case 14:e.prev=14,e.t0=e.catch(7),this.setState({isVideoFile:!1});case 17:case"end":return e.stop()}}),e,this,[[7,14]])}))),function(e){return t.apply(this,arguments)})},{key:"checkLayout",value:function(e,t){var n=this.state.resizedPctWidth;if(bn.e.indexOf(e)>-1&&"center"===t&&n){var r=this.calcUnwrappedLayout(n,this.calcPxWidth(t));this.props.updateSize(n,r)}}},{key:"$pos",get:function(){if("function"!=typeof this.props.getPos)return null;var e=this.props.getPos();return Number.isNaN(e)||"number"!=typeof e?null:this.props.view.state.doc.resolve(e)}},{key:"gridWidth",get:function(){var e=this.props.gridSize;return this.wrappedLayout||this.insideInlineLike?e:e/2}},{key:"insideInlineLike",get:function(){var e=this.$pos;if(!e)return!1;var t=this.props.view.state.schema.nodes.listItem;return!!Object(S.findParentNodeOfTypeClosestToPos)(e,[t])}},{key:"insideLayout",get:function(){var e=this.$pos;if(!e)return!1;var t=this.props.view.state.schema.nodes.layoutColumn;return!!Object(S.findParentNodeOfTypeClosestToPos)(e,[t])}},{key:"render",value:function(){var e=this,t=this.props,n=t.width,r=t.height,i=t.layout,a=t.pctWidth,o=t.containerWidth,s=t.fullWidthMode,c=t.selected,u=t.view.state,d=t.children,p=this.calcPxWidth(),f=r/n*p,h=p,m={};zn.a.forEach((function(t){var n="left"===t?"right":"left";m[t]=["full-width","wide","center"].concat("wrap-".concat(n)).concat("align-".concat(zn.b[n])).indexOf(i)>-1,"left"===t&&e.insideInlineLike&&(m[t]=!1)}));this.$pos,An.V,this.props.allowBreakoutSnapPoints,this.props.containerWidth,this.props.gridSize,this.gridWidth,this.insideInlineLike,this.insideLayout,this.state.isVideoFile,this.props.lineLength,this.state.offsetLeft,this.wrappedLayout;return l.a.createElement(Un,{ratio:(f/h*100).toFixed(3),layout:i,isResized:!!a,containerWidth:o||n,innerRef:this.saveWrapper,fullWidthMode:s},l.a.createElement(Rn.a,Dn()({},this.props,{width:h,height:f,selected:c,enable:m,calcNewSize:this.calcNewSize,snapPoints:Bn,scaleFactor:this.wrappedLayout||this.insideInlineLike?1:2,highlights:this.highlights,handleResizeStart:function(){var e=Object(Fn.c)(u);return!e||!e.dragging},nodeType:"media",dispatchAnalyticsEvent:this.props.dispatchAnalyticsEvent}),d))}}]),i}(l.a.Component);function Gn(e,t,n,r){var i=0;r&&e&&!t&&(i=r.getBoundingClientRect().left-n.getBoundingClientRect().left);return i}var Kn=n("YZT1"),Hn=n("XKts"),Jn=function(){return document.querySelectorAll(".ProseMirror > p").forEach((function(e){return e.setAttribute("contenteditable","false")}))},qn=function(){return document.querySelectorAll(".ProseMirror > p").forEach((function(e){return e.setAttribute("contenteditable","")}))},Qn=function(){return document.querySelector(".ua-firefox")};function $n(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Xn(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?$n(Object(n),!0).forEach((function(t){s()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):$n(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Zn(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=H()(e);if(t){var i=H()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return G()(this,n)}}var Yn=function(e){V()(r,e);var t,n=Zn(r);function r(){var e;v()(this,r);for(var t=arguments.length,i=new Array(t),a=0;a<t;a++)i[a]=arguments[a];return e=n.call.apply(n,[this].concat(i)),s()(F()(e),"state",{width:void 0,height:void 0,viewMediaClientConfig:void 0,isCopying:!1}),s()(F()(e),"createMediaNodeUpdater",(function(t){var n=e.props.node.firstChild;return new wn(Xn(Xn({},t),{},{isMediaSingle:!0,node:n||e.props.node,dispatchAnalyticsEvent:e.props.dispatchAnalyticsEvent}))})),s()(F()(e),"setViewMediaClientConfig",function(){var t=h()(w.a.mark((function t(n){var r,i;return w.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,n.mediaProvider;case 2:(r=t.sent)&&(i=r.viewMediaClientConfig,e.setState({viewMediaClientConfig:i}));case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),s()(F()(e),"updateMediaNodeAttributes",function(){var t=h()(w.a.mark((function t(n){var r,i,a,o,s,c;return w.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=e.createMediaNodeUpdater(n),i=e.props.mediaPluginState.addPendingTask,a=e.props.node.firstChild){t.next=5;break}return t.abrupt("return");case 5:return t.next=7,r.getRemoteDimensions();case 7:if((o=t.sent)&&r.updateDimensions(o),"external"!==a.attrs.type||!a.attrs.__external){t.next=15;break}return s=r.handleExternalMedia(e.props.getPos),i(s),t.next=14,s;case 14:return t.abrupt("return");case 15:if(r.getNodeContextId()){t.next=19;break}return t.next=19,r.updateContextId();case 19:return t.next=21,r.hasDifferentContextId();case 21:if(!t.sent){t.next=34;break}return e.setState({isCopying:!0}),t.prev=24,c=r.copyNode(),i(c),t.next=29,c;case 29:t.next=34;break;case 31:t.prev=31,t.t0=t.catch(24),e.setState({isCopying:!1});case 34:case"end":return t.stop()}}),t,null,[[24,31]])})));return function(e){return t.apply(this,arguments)}}()),s()(F()(e),"selectMediaSingle",(function(t){var n=t.event;n.stopPropagation();var r=e.props.getPos(),i=e.props.view.state;if(n.shiftKey){if(i.selection instanceof $.a)return;Object(X.g)(e.props.view,i.selection.from<r?i.selection.from:r,i.selection.to>r?i.selection.to:r+3)}else Object(X.f)(e.props.view,r)})),s()(F()(e),"updateSize",(function(t,n){var r=e.props.view,i=r.state,a=r.dispatch,o=e.props.getPos();if(void 0!==o){var s=i.tr.setNodeMarkup(o,void 0,Xn(Xn({},e.props.node.attrs),{},{layout:n,width:t}));return s.setMeta("scrollIntoView",!1),a(s)}})),s()(F()(e),"forwardInnerRef",(function(t){e.props.forwardRef(t)})),s()(F()(e),"getLineLength",(function(e,t){if(Object(Hn.c)(e,t)){var n=e.state.doc.resolve(t),r=e.nodeDOM(n.pos);if(n.nodeAfter&&Hn.b.indexOf(n.nodeAfter.attrs.layout)>-1&&r&&r.parentElement)return r.parentElement.offsetWidth;if(r instanceof HTMLElement)return r.offsetWidth}return null})),e}return b()(r,[{key:"UNSAFE_componentWillReceiveProps",value:function(e){e.mediaProvider!==this.props.mediaProvider&&this.setViewMediaClientConfig(e),!1!==e.isCopyPasteEnabled&&this.createMediaNodeUpdater(e).updateFileAttrs()}},{key:"componentDidMount",value:(t=h()(w.a.mark((function e(){var t;return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.props.contextIdentifierProvider,e.next=3,Promise.all([this.setViewMediaClientConfig(this.props),this.updateMediaNodeAttributes(this.props)]);case 3:return e.t0=this,e.next=6,t;case 6:e.t1=e.sent,e.t2={contextIdentifierProvider:e.t1},e.t0.setState.call(e.t0,e.t2),null!=(n=Qn())&&n.addEventListener("dragstart",Jn),null==n||n.addEventListener("dragend",qn);case 10:case"end":return e.stop()}var n}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"componentWillUnmount",value:function(){var e;null!=(e=Qn())&&e.removeEventListener("dragstart",Jn),null==e||e.removeEventListener("dragend",qn)}},{key:"render",value:function(){var e=this.props,t=e.selected,n=e.getPos,r=e.node,i=e.mediaOptions,a=e.fullWidthMode,o=e.view.state,s=e.view,c=r.attrs,u=c.layout,d=c.width,p=r.firstChild.attrs,f=p.width,h=p.height;f&&h||(f=250,h=187.5);var m={layout:u,width:f,height:h,containerWidth:this.props.width,lineLength:this.props.lineLength||768,pctWidth:d||250/768*100,fullWidthMode:a},v=l.a.createElement(Y,{innerRef:this.forwardInnerRef}),g=!!this.props.mediaOptions.allowResizing;if(!this.props.mediaOptions.allowResizingInTables){var b=n();if(b){var y=o.doc.resolve(b),w=o.schema.nodes.table,O=!!Object(S.findParentNodeOfTypeClosestToPos)(y,[w]);g=g&&!O}}var k=this.getLineLength(s,n())||m.lineLength;return g?l.a.createElement(Wn,Dn()({},m,{lineLength:k,view:this.props.view,getPos:n,updateSize:this.updateSize,displayGrid:Object(Kn.a)(this.props.eventDispatcher),gridSize:12,viewMediaClientConfig:this.state.viewMediaClientConfig,allowBreakoutSnapPoints:i&&i.allowBreakoutSnapPoints,selected:t(),dispatchAnalyticsEvent:this.props.dispatchAnalyticsEvent}),v):l.a.createElement(bn.c,m,v)}}]),r}(c.Component);s()(Yn,"defaultProps",{mediaOptions:{}}),s()(Yn,"displayName","MediaSingleNode");var er=function(e){V()(n,e);var t=Zn(n);function n(){var e;v()(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return e=t.call.apply(t,[this].concat(i)),s()(F()(e),"lastOffsetLeft",0),s()(F()(e),"forceViewUpdate",!1),s()(F()(e),"selectionType",null),s()(F()(e),"checkAndUpdateSelectionType",(function(){var t=e.getPos,n=e.view.state.selection,r=Object(be.c)(n.$anchor.pos,n.$head.pos,t(),e.node.nodeSize);return e.selectionType=r,r})),s()(F()(e),"isNodeSelected",(function(){return e.checkAndUpdateSelectionType(),null!==e.selectionType})),e}return b()(n,[{key:"createDomRef",value:function(){var e=document.createElement("div");return In.a.chrome&&this.reactComponentProps.mediaOptions&&this.reactComponentProps.mediaOptions.allowMediaSingleEditable&&(e.contentEditable="true"),e}},{key:"getContentDOM",value:function(){return{dom:document.createElement("div")}}},{key:"viewShouldUpdate",value:function(e){return this.forceViewUpdate?(this.forceViewUpdate=!1,!0):this.node.attrs!==e.attrs||(this.selectionType!==this.checkAndUpdateSelectionType()||Sn()(H()(n.prototype),"viewShouldUpdate",this).call(this,e))}},{key:"getNodeMediaId",value:function(e){if(e.firstChild)return e.firstChild.attrs.id}},{key:"update",value:function(e,t,r){var i=this;return r||(r=function(e,t){return i.getNodeMediaId(e)===i.getNodeMediaId(t)}),Sn()(H()(n.prototype),"update",this).call(this,e,t,r)}},{key:"render",value:function(e,t){var n=this,r=this.reactComponentProps,i=r.eventDispatcher,a=r.fullWidthMode,o=r.providerFactory,s=r.mediaOptions,c=r.dispatchAnalyticsEvent,u=this.getPos;return l.a.createElement(ln.a,{providers:["mediaProvider","contextIdentifierProvider"],providerFactory:o,renderNode:function(e){var r=e.mediaProvider,o=e.contextIdentifierProvider;return l.a.createElement(sn.a,{editorView:n.view,plugins:{width:Nn.b,mediaPluginState:Z.a},render:function(e){var d=e.width,p=e.mediaPluginState;return l.a.createElement(Yn,{width:d.width,lineLength:d.lineLength,node:n.node,getPos:u,mediaProvider:r,contextIdentifierProvider:o,mediaOptions:s,view:n.view,fullWidthMode:a,selected:n.isNodeSelected,eventDispatcher:i,mediaPluginState:p,dispatchAnalyticsEvent:c,forwardRef:t})}})}})}},{key:"ignoreMutation",value:function(){if(this.dom){var e=this.dom.offsetLeft;e!==this.lastOffsetLeft&&(this.lastOffsetLeft=e,this.forceViewUpdate=!0,this.update(this.node,[],(function(){return!0})))}return!0}}]),n}(fn.a),tr=function(e,t,n,r){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};return function(a,o,s){return new er(a,o,s,e,t,{eventDispatcher:t,fullWidthMode:i.fullWidthEnabled,providerFactory:n,mediaOptions:i,dispatchAnalyticsEvent:r,isCopyPasteEnabled:i.isCopyPasteEnabled}).init()}},nr=n("QGb3"),rr=n.n(nr),ir=n("CzxY"),ar=n.n(ir),or=n("368d"),sr=n("tUdN"),cr=n("Havv"),lr=n.n(cr),ur=n("YyNJ"),dr=n("uxt/"),pr=n("qwOa"),fr=Object(pr.e)({annotate:{id:"fabric.editor.annotate",defaultMessage:"Annotate",description:"Annotate an image by drawing arrows, adding text, or scribbles."}});function hr(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=H()(e);if(t){var i=H()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return G()(this,n)}}var mr,vr,gr=function(e,t){var n=Z.a.getState(e);if(!n)return!1;var r=e.schema.nodes.mediaSingle,i=n.selectedMediaContainerNode();if(!i||i.type!==r)return!1;var a,o=i.firstChild.attrs,s=o.id,c=o.collection,l=o.occurrenceKey;return Object(we.d)({action:ye.a.CLICKED,actionSubject:ye.b.MEDIA,actionSubjectId:ye.c.ANNOTATE_BUTTON,eventType:ye.d.UI})((a=e.selection.from+1,Ze({type:"open",identifier:{id:s,collectionName:c,mediaItemType:"file",occurrenceKey:l},pos:a})))(e,t)},br=function(e){V()(i,e);var t,n,r=hr(i);function i(){var e;v()(this,i);for(var t=arguments.length,n=new Array(t),a=0;a<t;a++)n[a]=arguments[a];return e=r.call.apply(r,[this].concat(n)),s()(F()(e),"state",{isImage:!1}),s()(F()(e),"onClickAnnotation",(function(){var t=e.props.view;t&&gr(t.state,t.dispatch)})),e}return b()(i,[{key:"componentDidMount",value:(n=h()(w.a.mark((function e(){return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.checkIsImage();case 2:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"checkIsImage",value:(t=h()(w.a.mark((function e(){var t,n;return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=Object(Bt.a)(this.props.viewMediaClientConfig),this.props.id){e.next=3;break}return e.abrupt("return");case 3:return e.prev=3,e.next=6,t.file.getCurrentState(this.props.id,{collectionName:this.props.collection});case 6:(n=e.sent)&&"error"!==n.status&&"image"===n.mediaType&&this.setState({isImage:!0}),e.next=12;break;case 10:e.prev=10,e.t0=e.catch(3);case 12:case"end":return e.stop()}}),e,this,[[3,10]])}))),function(){return t.apply(this,arguments)})},{key:"componentDidUpdate",value:function(e){var t=this;e.id!==this.props.id&&this.setState({isImage:!1},(function(){t.checkIsImage()}))}},{key:"render",value:function(){if(!this.state.isImage)return null;var e=this.props.intl.formatMessage(fr.annotate);return l.a.createElement(l.a.Fragment,null,l.a.createElement(dr.a,null),l.a.createElement(ur.a,{title:e,icon:l.a.createElement(lr.a,{label:e}),onClick:this.onClickAnnotation}))}}]),i}(l.a.Component),yr=function(e,t){return function(n,r){var i=e.selectedMediaContainerNode();return i&&e.mediaClientConfig?l.a.createElement(br,{key:r,viewMediaClientConfig:e.mediaClientConfig,id:i.firstChild.attrs.id,collection:i.firstChild.attrs.collection,view:n,intl:t}):null}},wr=n("VqFj"),Or=n.n(wr),kr=n("1mRP"),xr=n.n(kr),Pr=n("VrxG"),jr=n("BXdW"),Cr=n("pev1"),Er=n("gnaU");function _r(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=H()(e);if(t){var i=H()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return G()(this,n)}}var Sr=Object(pr.e)({backLink:{id:"fabric.editor.backLink",defaultMessage:"Go back",description:"Go back from media linking toolbar to main toolbar"}}),Mr=N.default.section(mr||(mr=I()(["\n  display: flex;\n  line-height: 0;\n  padding: 12px 24px 12px 0;\n  margin: 0 4px 0 32px;\n  border-top: 1px solid ",";\n  align-items: start;\n  display: flex;\n  flex-direction: column;\n"])),A.R400),Dr=N.default.span(vr||(vr=I()(["\n  padding: 4px 8px 4px 0px;\n"]))),Ir=function(e){V()(n,e);var t=_r(n);function n(){var e;v()(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return e=t.call.apply(t,[this].concat(i)),s()(F()(e),"state",{validationErrors:[]}),s()(F()(e),"handleSubmit",(function(t){var n=t.url,r=t.inputMethod;e.props.onSubmit(n,{inputMethod:r})})),s()(F()(e),"handleOnBack",(function(t){var n=t.url,r=t.inputMethod,i=e.props.onBack;i&&i(n,{inputMethod:r})})),s()(F()(e),"handleCancel",(function(){var t=e.props.onCancel;t&&t()})),s()(F()(e),"handleUnlink",(function(){var t=e.props.onUnlink;t&&t()})),s()(F()(e),"handleOnBlur",(function(t){e.props.onBlur(t.url)})),s()(F()(e),"renderContainer",(function(t){var n,r=t.activityProvider,i=t.inputProps,a=i.onChange,o=i.onKeyDown,s=i.onSubmit,c=i.value,u=t.currentInputMethod,d=t.renderRecentList,p=e.props,f=p.intl.formatMessage,h=p.displayUrl,m=f(Sr.backLink),v=f(or.b.unlink),g=e.state.validationErrors.map((function(e,t){return l.a.createElement(Er.a,{key:t},e)}));return l.a.createElement("div",{className:"recent-list"},l.a.createElement(jr.a,{provider:!!r},l.a.createElement(jr.e,null,l.a.createElement(Dr,null,l.a.createElement(ur.a,{title:m,icon:l.a.createElement(Or.a,{label:m}),onClick:function(){return e.handleOnBack({url:c,inputMethod:u})}})),l.a.createElement(Pr.a,{testId:"media-link-input",placeholder:(n=!!r,f(n?or.b.placeholder:or.b.linkPlaceholder)),autoFocus:!0,onCancel:e.handleCancel,defaultValue:c,onSubmit:function(t){var n=e.getValidationErrors(t,u);e.setState({validationErrors:n}),n.length||s()},onChange:function(t){e.setState({validationErrors:[]}),a(t)},onKeyDown:o}),Object(Rt.g)(h)&&l.a.createElement(l.a.Fragment,null,l.a.createElement(dr.a,null),l.a.createElement(ur.a,{title:v,icon:l.a.createElement(xr.a,{label:v}),onClick:e.handleUnlink}))),!!g.length&&l.a.createElement(Mr,null,g),d()))})),e}return b()(n,[{key:"getValidationErrors",value:function(e,t){var n=this.props.intl.formatMessage;return t===ye.e.TYPEAHEAD?[]:e?Object(Rt.g)(e)?[]:[n(or.b.invalidLink)]:[n(or.b.emptyLink)]}},{key:"render",value:function(){var e=this.props,t=e.providerFactory,n=e.displayUrl;return l.a.createElement(Cr.a,{defaultUrl:Object(Rt.g)(n),providerFactory:t,onSubmit:this.handleSubmit,onBlur:this.handleOnBlur,render:this.renderContainer})}}]),n}(l.a.PureComponent);function Nr(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Tr(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Nr(Object(n),!0).forEach((function(t){s()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Nr(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Ar(e){var t=Ut(e);if(!t||null===t.mediaPos)return!1;var n=e.schema,r=n.nodes.media,i=n.marks.link,a=e.doc.nodeAt(t.mediaPos);if(!a||a.type!==r)return!1;var o=e.doc.resolve(t.mediaPos).parent;return o&&o.type.allowsMarkType(i)}var Lr,Ur,Rr,zr,Fr,Br,Vr=function(e,t,n,r,i){var a=t.link,o=t.visible,s=t.editable,c=t.mediaPos;if(o&&null!==c&&n.doc.nodeAt(c))return Tr(Tr({},e),{},{height:jr.c,width:jr.d,forcePlacement:!0,items:[{type:"custom",render:function(e,t){return e&&i?l.a.createElement(Ir,{key:t,displayUrl:a,providerFactory:i,intl:r,editing:s,onUnlink:function(){return Xt(e.state,e.dispatch,e)},onBack:function(t,n){t.trim()&&n.inputMethod&&Yt(t,n.inputMethod)(e.state,e.dispatch,e),qt(e.state,e.dispatch,e)},onCancel:function(){return qt(e.state,e.dispatch,e)},onSubmit:function(t,n){Yt(t,n.inputMethod)(e.state,e.dispatch,e),qt(e.state,e.dispatch,e)},onBlur:function(){qt(e.state,e.dispatch,e)}}):null}}]})},Wr=n("nazu"),Gr=Object(pr.e)({altText:{id:"fabric.editor.addAltText",defaultMessage:"Alt text",description:"Add an alt text for this image"},editAltText:{id:"fabric.editor.editAltText",defaultMessage:"Edit alt text",description:"Edit an alt text for this image"},back:{id:"fabric.editor.closeAltTextEdit",defaultMessage:"Back",description:"Back to toolbar"},clear:{id:"fabric.editor.clearAltTextEdit",defaultMessage:"Clear alt text",description:"Clear alt text"},placeholder:{id:"fabric.editor.placeholderAltText",defaultMessage:"Describe this image with alt text",description:"Describe this image with alt text"},supportText:{id:"fabric.editor.supportAltText",defaultMessage:"Alt text is useful for people using screen readers because of visual limitations.",description:"Alt text is useful for people using screen readers because of visual limitations."},validationMessage:{id:"fabric.editor.alttext.validation",defaultMessage:"Please remove any special characters in alt text.",description:"Please remove any special characters in alt text. "}}),Kr=n("VfAS"),Hr=n.n(Kr),Jr=n("/V8Q"),qr=n("Mlj8");function Qr(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=H()(e);if(t){var i=H()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return G()(this,n)}}var $r=jr.d,Xr=N.default.p(Lr||(Lr=I()(["\n  color: ",";\n  font-size: 12px;\n  padding: 12px 40px;\n  line-height: 20px;\n  border-top: 1px solid ",";\n  margin: 0;\n"])),A.N100,A.N30),Zr=N.default.div(Ur||(Ur=I()(["\n  width: ","px;\n  display: flex;\n  flex-direction: column;\n  overflow: auto;\n  line-height: 2;\n"])),$r),Yr=N.default.section(Rr||(Rr=I()(["\n  display: flex;\n  line-height: 0;\n  padding: 5px 0;\n  align-items: center;\n"]))),ei=N.default.section(zr||(zr=I()(["\n  display: flex;\n  line-height: 0;\n  padding: 12px 24px 12px 0;\n  margin: 0 12px 0 40px;\n  border-top: 1px solid ",";\n  align-items: start;\n  display: flex;\n  flex-direction: column;\n"])),A.R400),ti=N.default.div(Fr||(Fr=I()(["\n  display: flex;\n  padding: 4px 8px;\n"]))),ni=N.default.span(Br||(Br=I()(["\n  color: ",";\n"])),A.N80),ri=function(e){V()(n,e);var t=Qr(n);function n(e){var r;v()(this,n),r=t.call(this,e),s()(F()(r),"fireCustomAnalytics",void 0),s()(F()(r),"state",{showClearTextButton:Boolean(r.props.value),validationErrors:r.props.value?r.getValidationErrors(r.props.value):[],lastValue:r.props.value}),s()(F()(r),"prevValue",void 0),s()(F()(r),"closeMediaAltTextMenu",(function(){var e=r.props.view;kt(e.state,e.dispatch)})),s()(F()(r),"dispatchCancelEvent",(function(e){var t=r.props.view;t.someProp("handleKeyDown",(function(n){return n(t,e)}))})),s()(F()(r),"updateAltText",(function(e){var t=r.props.view;!function(e){return pt((function(e){return!!Object(ve.d)(e)&&{type:"updateAltText"}}),(function(t,n){var r=Object(ve.b)(n),i=t.selection.from+1;return r&&(t.setMeta("scrollIntoView",!1),t.setNodeMarkup(i,void 0,bt(bt({},r.attrs),{},{alt:e}))),t}))}(0===e.length?null:e)(t.state,t.dispatch)})),s()(F()(r),"handleOnChange",(function(e){var t=r.getValidationErrors(e);r.setState({showClearTextButton:Boolean(e),validationErrors:t,lastValue:e},(function(){t&&t.length||r.updateAltText(e)}))})),s()(F()(r),"handleOnBlur",(function(){var e=r.props.value,t=(r.state.lastValue||e||"").trim();r.handleOnChange(t)})),s()(F()(r),"handleClearText",(function(){r.handleOnChange("")}));var i=e.createAnalyticsEvent;return r.fireCustomAnalytics=Object(qr.a)(i),r}return b()(n,[{key:"componentDidMount",value:function(){this.prevValue=this.props.value}},{key:"componentWillUnmount",value:function(){this.fireAnalytics(ye.a.CLOSED),!this.prevValue&&this.props.value&&this.fireAnalytics(ye.a.ADDED),this.prevValue&&!this.props.value&&this.fireAnalytics(ye.a.CLEARED),this.prevValue&&this.prevValue!==this.props.value&&this.fireAnalytics(ye.a.EDITED)}},{key:"getValidationErrors",value:function(e){var t=this.props.altTextValidator;return e&&"function"==typeof t&&t(e)||[]}},{key:"render",value:function(){var e=this.props.intl.formatMessage,t=this.state.showClearTextButton,n=e(Gr.back),r=l.a.createElement(vt.ToolTipContent,{description:n,keymap:vt.escape,shortcutOverride:"Esc"}),i=(this.state.validationErrors||[]).map((function(e,t){return l.a.createElement(Er.a,{key:t},e)}));return l.a.createElement(Zr,null,l.a.createElement(Yr,null,l.a.createElement(ti,null,l.a.createElement(ur.a,{title:e(Gr.back),icon:l.a.createElement(Or.a,{label:e(Gr.back)}),tooltipContent:r,onClick:this.closeMediaAltTextMenu})),l.a.createElement(Pr.a,{testId:"alt-text-input",placeholder:e(Gr.placeholder),defaultValue:this.state.lastValue,onCancel:this.dispatchCancelEvent,onChange:this.handleOnChange,onBlur:this.handleOnBlur,onSubmit:this.closeMediaAltTextMenu,maxLength:510,autoFocus:!0}),t&&l.a.createElement(ti,null,l.a.createElement(ur.a,{testId:"alt-text-clear-button",title:e(Gr.clear),icon:l.a.createElement(ni,null,l.a.createElement(Hr.a,{label:e(Gr.clear)})),tooltipContent:e(Gr.clear),onClick:this.handleClearText}))),!!i.length&&l.a.createElement(ei,null,i),l.a.createElement(Xr,null,e(Gr.supportText)))}},{key:"fireAnalytics",value:function(e){this.props.createAnalyticsEvent&&this.fireCustomAnalytics&&this.fireCustomAnalytics({payload:{action:e,actionSubject:ye.b.MEDIA,actionSubjectId:ye.c.ALT_TEXT,eventType:ye.d.TRACK}})}}]),n}(l.a.Component),ii=Object(Jr.a)()(Object(pr.f)(ri)),ai=n("5tuL");function oi(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function si(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?oi(Object(n),!0).forEach((function(t){s()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):oi(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var ci,li=function(e,t){var n=Object(ve.b)(t),r=n&&n.attrs.alt?Gr.editAltText:Gr.altText,i=e.formatMessage(r);return{title:i,type:"button",onClick:xt,showTitle:!0,testId:"alt-text-edit-button",tooltipContent:l.a.createElement(vt.ToolTipContent,{description:i,keymap:vt.addAltText})}},ui=function(e){return{type:"custom",render:function(t,n){if(!t)return null;var r=Object(ve.b)(t.state);return r?l.a.createElement(ii,{view:t,key:n,value:r.attrs.alt,altTextValidator:e&&e.altTextValidator}):null}}},di=function(e,t){return si(si({},e),{},{width:$r,className:ai.a.FLOATING_TOOLBAR_COMPONENT,items:[ui(t)]})},pi=n("XkwL"),fi=n.n(pi),hi=n("VKpd"),mi=n.n(hi),vi=n("qZ6Q"),gi=n.n(vi),bi=n("+oBr"),yi=n("9JXw"),wi=N.default.div(ci||(ci=I()(["\n  display: flex;\n  align-items: center;\n  margin-right: 4px;\n"]))),Oi=function(e){var t=e.editorState,n=e.mediaLinkingState,r=e.intl,i=e.showSeparatorLeft,a=e.onAddLink,o=e.onEditLink,s=e.onOpenLink,u=Object(c.useState)(!1),d=fi()(u,2),p=d[0],f=d[1];if(Object(c.useEffect)((function(){var e;f(!1);var n=Ft(t);if(n){var r=null===(e=Z.a.getState(t))||void 0===e?void 0:e.mediaClientConfig;r&&Vt(n,r).then((function(e){"external"!==e&&"image"!==e||f(!0)}))}}),[t]),!p)return null;if(n&&n.editable){var h=Object(bi.a)(n.link),m=r.formatMessage(or.b.editLink),v=r.formatMessage(h?yi.a.openLink:or.b.unableToOpenLink);return l.a.createElement(l.a.Fragment,null,i&&l.a.createElement(wi,null,l.a.createElement(dr.a,null)),l.a.createElement(wi,null,l.a.createElement(ur.a,{onClick:o,title:m,tooltipContent:l.a.createElement(vt.ToolTipContent,{description:m,keymap:vt.addLink})},m)),l.a.createElement(wi,null,l.a.createElement(dr.a,null)),l.a.createElement(ur.a,{target:"_blank",href:h?n.link:void 0,disabled:!h,onClick:s,title:v,icon:l.a.createElement(gi.a,{label:v}),className:"hyperlink-open-link"}))}var g=r.formatMessage(or.b.addLink);return l.a.createElement(l.a.Fragment,null,i&&l.a.createElement(wi,null,l.a.createElement(dr.a,null)),l.a.createElement(ur.a,{testId:"add-link-button",onClick:a,title:g,tooltipContent:l.a.createElement(vt.ToolTipContent,{description:g,keymap:vt.addLink}),icon:l.a.createElement(mi.a,{label:g})}))};function ki(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function xi(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ki(Object(n),!0).forEach((function(t){s()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ki(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Pi=function(e,t){return t&&t(Object(S.removeSelectedNode)(e.tr)),!0},ji=n("9XXW"),Ci=n("0cE9");function Ei(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=H()(e);if(t){var i=H()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return G()(this,n)}}var _i=function(e){V()(n,e);var t=Ei(n);function n(){var e;v()(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return e=t.call.apply(t,[this].concat(i)),s()(F()(e),"onUploadStart",(function(t,n){var r=e.props.view,i=r.state,a=r.dispatch;rt(t,n)(i,a)})),s()(F()(e),"onClose",(function(){var t=e.props.view,n=t.state,r=t.dispatch;nt()(n,r)})),e}return b()(n,[{key:"render",value:function(){var e=this.props.mediaEditorState,t=e.editor,n=e.mediaClientConfig;if(!t||!n)return null;var r=t.identifier;return l.a.createElement(Ci.a,{identifier:r,mediaClientConfig:n,onUploadStart:this.onUploadStart,onClose:this.onClose})}}]),n}(l.a.PureComponent);function Si(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=H()(e);if(t){var i=H()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return G()(this,n)}}s()(_i,"displayName","MediaEditor");var Mi={on:function(){},removeAllListeners:function(){},emit:function(){},destroy:function(){},setUploadParams:function(){}},Di=function(e){V()(n,e);var t=Si(n);function n(){var e;v()(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return e=t.call.apply(t,[this].concat(i)),s()(F()(e),"state",{}),s()(F()(e),"handleMediaProvider",function(){var t=h()(w.a.mark((function t(n,r){var i,a,o,s,c,l,u,d;return w.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i=e.props,a=i.mediaState,o=i.analyticsName,t.next=3,r;case 3:if((s=t.sent)&&s.uploadParams){t.next=6;break}return t.abrupt("return");case 6:return t.next=8,s.uploadMediaClientConfig;case 8:if(t.t0=t.sent,t.t0){t.next=13;break}return t.next=12,s.viewMediaClientConfig;case 12:t.t0=t.sent;case 13:if(c=t.t0){t.next=16;break}return t.abrupt("return");case 16:return l={mediaClientConfig:c,errorReporter:a.options.errorReporter||new C.a,featureFlags:a.mediaOptions&&a.mediaOptions.featureFlags},t.next=19,new Re("customMediaPicker",l,Mi,Ue.d,o).init();case 19:(u=t.sent).onNewMedia(a.insertFile),u.setUploadParams(s.uploadParams),d={uploadParams:s.uploadParams},e.setState({pickerFacadeInstance:u,config:d,mediaClientConfig:c});case 24:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}()),e}return b()(n,[{key:"componentDidMount",value:function(){this.props.mediaState.options.providerFactory.subscribe("mediaProvider",this.handleMediaProvider)}},{key:"componentWillUnmount",value:function(){this.props.mediaState.options.providerFactory.unsubscribe("mediaProvider",this.handleMediaProvider)}},{key:"render",value:function(){var e=this.state,t=e.mediaClientConfig,n=e.config,r=e.pickerFacadeInstance;return t&&n&&r?this.props.children({mediaClientConfig:t,config:n,pickerFacadeInstance:r}):null}}]),n}(l.a.Component),Ii=function(e){var t=e.mediaState,n=e.featureFlags;return l.a.createElement(Di,{mediaState:t,analyticsName:"clipboard"},(function(e){var t=e.mediaClientConfig,r=e.config,i=e.pickerFacadeInstance;return l.a.createElement(Ue.b,{mediaClientConfig:t,config:r,onError:i.handleUploadError,onPreviewUpdate:i.handleUploadPreviewUpdate,onEnd:i.handleReady,featureFlags:n})}))};function Ni(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Ti(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ni(Object(n),!0).forEach((function(t){s()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ni(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Ai=function(e){var t=e.mediaState,n=e.isActive,r=e.featureFlags;return l.a.createElement(Di,{mediaState:t,analyticsName:"dropzone"},(function(e){var i=e.mediaClientConfig,a=e.config,o=e.pickerFacadeInstance,s=t.options.customDropzoneContainer,c=t.handleDrag,u=Ti(Ti({},a),{},{container:s});return n?l.a.createElement(Ue.c,{mediaClientConfig:i,config:u,onError:o.handleUploadError,onPreviewUpdate:o.handleUploadPreviewUpdate,onEnd:o.handleReady,onDragEnter:function(){return c("enter")},onDragLeave:function(){return c("leave")},featureFlags:r}):null}))},Li=function(e){var t=e.mediaState,n=e.isOpen,r=e.onBrowseFn,i=e.featureFlags;return l.a.createElement(Di,{mediaState:t,analyticsName:"browser"},(function(e){var t=e.mediaClientConfig,a=e.config,o=e.pickerFacadeInstance;return l.a.createElement(Ue.a,{onBrowseFn:r,isOpen:n,config:a,mediaClientConfig:t,onEnd:o.handleReady,onError:o.handleUploadError,onPreviewUpdate:o.handleUploadPreviewUpdate,featureFlags:i})}))};function Ui(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=H()(e);if(t){var i=H()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return G()(this,n)}}var Ri=function(e){V()(n,e);var t=Ui(n);function n(){var e;v()(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return e=t.call.apply(t,[this].concat(i)),s()(F()(e),"state",{isPopupOpened:!1}),s()(F()(e),"onBrowseFn",(function(t){var n=e.props.mediaState;n&&n.setBrowseFn(t)})),e}return b()(n,[{key:"componentDidMount",value:function(){var e=this;this.props.mediaState.onPopupToggle((function(t){e.setState({isPopupOpened:t})}))}},{key:"render",value:function(){var e=this.props.mediaState,t=this.state.isPopupOpened,n=e.mediaOptions&&e.mediaOptions.featureFlags;return l.a.createElement(l.a.Fragment,null,l.a.createElement(Ii,{mediaState:e,featureFlags:n}),l.a.createElement(Ai,{mediaState:e,isActive:!t,featureFlags:n}),!e.shouldUseMediaPickerPopup()&&l.a.createElement(Li,{onBrowseFn:this.onBrowseFn,mediaState:e,featureFlags:n}))}}]),n}(l.a.Component);s()(Ri,"displayName","MediaPickerComponents");var zi=n("8unR");function Fi(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=H()(e);if(t){var i=H()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return G()(this,n)}}var Bi=function(e){V()(n,e);var t=Fi(n);function n(){var e;v()(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return e=t.call.apply(t,[this].concat(i)),s()(F()(e),"renderMediaNodeWithState",(function(t,n,r){return function(i){var a=i.width,o=e.getPos,s=e.reactComponentProps.mediaOptions,c=e.view.state.selection,u=e.getAttrs(),d=u.width,p=u.height;d=d||bn.b,p=p||bn.a;var f={width:"".concat(a.width,"px"),height:"".concat(p/d*a.width,"px")},h={width:d,height:p};return l.a.createElement(le,{view:e.view,node:e.node,getPos:o,selected:e.isNodeInsideSelection(c.from,c.to)||c instanceof x.NodeSelection&&c.from===o(),originalDimensions:h,maxDimensions:f,mediaProvider:t,contextIdentifierProvider:n,uploadComplete:e.uploadComplete(),mediaOptions:s,collabEditProvider:r})}})),s()(F()(e),"renderMediaNodeWithProviders",(function(t){var n=t.mediaProvider,r=t.contextIdentifierProvider,i=t.collabEditProvider;return l.a.createElement(sn.a,{editorView:e.view,plugins:{width:Nn.b},render:e.renderMediaNodeWithState(n,r,i)})})),e}return b()(n,[{key:"createDomRef",value:function(){var e=document.createElement("div");return In.a.chrome&&this.reactComponentProps.mediaOptions&&this.reactComponentProps.mediaOptions.allowMediaSingleEditable&&(e.contentEditable="true"),e}},{key:"viewShouldUpdate",value:function(e){return this.node.attrs!==e.attrs||Sn()(H()(n.prototype),"viewShouldUpdate",this).call(this,e)}},{key:"stopEvent",value:function(e){if(-1!==["mousedown","contextmenu"].indexOf(e.type)&&2===e.button)return!0;return!1}},{key:"getAttrs",value:function(){return this.node.attrs}},{key:"uploadComplete",value:function(){return Ne(Z.a.getState(this.view.state),this.node.attrs.id)}},{key:"render",value:function(){var e=this.reactComponentProps.providerFactory;return l.a.createElement(ln.a,{providers:["mediaProvider","contextIdentifierProvider","collabEditProvider"],providerFactory:e,renderNode:this.renderMediaNodeWithProviders})}}]),n}(n("Dol8").a),Vi=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return function(i,a,o){return new Bi(i,a,o,e,t,{eventDispatcher:t,providerFactory:n,mediaOptions:r}).init()}},Wi={allowResizing:!0,allowAdvancedToolBarOptions:!0,allowResizingInTables:!1,allowAnnotation:!0,UNSAFE_allowImageCaptions:!0};function Gi(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Ki(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Gi(Object(n),!0).forEach((function(t){s()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Gi(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Hi=function(e){return{name:"media",nodes:function(){var t=e||{},n=t.allowMediaGroup,r=void 0===n||n,i=t.allowMediaSingle,a=void 0!==i&&i,o=t.UNSAFE_allowImageCaptions,s=void 0!==o&&o?u.b:u.a;return[{name:"mediaGroup",node:d.a},{name:"mediaSingle",node:s},{name:"media",node:p.b}].filter((function(e){return"mediaGroup"===e.name?r:"mediaSingle"!==e.name||a}))},pmPlugins:function(){var t=[{name:"media",plugin:function(t){t.schema;var n=t.dispatch,r=t.eventDispatcher,i=t.providerFactory,a=t.errorReporter,o=t.portalProviderAPI,s=t.reactContext,c=t.dispatchAnalyticsEvent;return Ke(0,{providerFactory:i,nodeViews:{mediaGroup:En(o,r,i,e),mediaSingle:tr(o,r,i,c,e),media:Vi(o,r,i,e)},errorReporter:a,uploadErrorHandler:e&&e.uploadErrorHandler,waitForMediaUpload:e&&e.waitForMediaUpload,customDropzoneContainer:e&&e.customDropzoneContainer,customMediaPicker:e&&e.customMediaPicker,allowResizing:!(!e||!e.allowResizing)},s,n,e)}},{name:"mediaKeymap",plugin:function(){return nn()}}];return e&&e.allowMediaSingle&&t.push({name:"mediaSingleKeymap",plugin:function(e){return function(e){var t={},n=_t(e);return vt.bindKeymapWithCommand(vt.backspace.common,n,t),Object(mt.b)(t)}(e.schema)}}),e&&e.allowAnnotation&&t.push({name:"mediaEditor",plugin:at}),e&&e.allowAltTextOnImages&&(t.push({name:"mediaAltText",plugin:ht}),t.push({name:"mediaAltTextKeymap",plugin:function(e){var t;e.schema;return t={},vt.bindKeymapWithCommand(vt.addAltText.common,xt,t),vt.bindKeymapWithCommand(vt.escape.common,kt,t),Object(mt.b)(t)}})),e&&e.allowLinking&&(t.push({name:"mediaLinking",plugin:function(e){return function(e){return new x.Plugin({key:Nt,state:At.createPluginState(e,Tt)})}(e.dispatch)}}),t.push({name:"mediaLinkingKeymap",plugin:function(e){var t;e.schema;return t={},vt.bindKeymapWithCommand(vt.addLink.common,Ht,t),Object(mt.b)(t)}})),t},contentComponent:function(t){var n=t.editorView,r=t.eventDispatcher,i=e&&e.allowAnnotation?l.a.createElement(sn.a,{editorView:n,plugins:{mediaEditorState:Qe},eventDispatcher:r,render:function(e){var t=e.mediaEditorState;return l.a.createElement(_i,{mediaEditorState:t,view:n})}}):null;return l.a.createElement(l.a.Fragment,null,l.a.createElement(sn.a,{editorView:n,plugins:{mediaState:Z.a},render:function(e){var t=e.mediaState;return l.a.createElement(Ri,{mediaState:t})}}),i)},secondaryToolbarComponent:function(e){var t=e.editorView,n=e.eventDispatcher,r=e.disabled;return l.a.createElement(cn,{editorView:t,eventDispatcher:n,pluginKey:Z.a,isDisabled:r,isReducedSpacing:!0})},pluginsOptions:{quickInsert:function(e){var t=e.formatMessage;return[{id:"media",title:t(zi.a.filesAndImages),description:t(zi.a.filesAndImagesDescription),priority:400,keywords:["attachment","gif","media","picture"],icon:function(){return l.a.createElement(ji.j,{label:t(zi.a.filesAndImages)})},action:function(e,t){Z.a.getState(t).showMediaPicker();var n=e("");return Object(we.a)(t,n,{action:ye.a.OPENED,actionSubject:ye.b.PICKER,actionSubjectId:ye.c.PICKER_CLOUD,attributes:{inputMethod:ye.e.QUICK_INSERT},eventType:ye.d.UI})}}]},floatingToolbar:function(t,n,r){return function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=n.providerFactory,i=n.allowResizing,a=n.allowAnnotation,o=n.allowLinking,s=n.allowAdvancedToolBarOptions,c=n.allowResizingInTables,u=n.allowAltTextOnImages,d=n.altTextValidator,p=e.schema.nodes.mediaSingle,f=Z.a.getState(e),h=Ut(e);if(p&&f){var m={title:"Media floating controls",nodeType:p,getDomRef:function(){return f.element}};if(o&&h&&h.visible&&Ar(e)){var v=Vr(m,h,e,t,r);if(v)return v}var g=[];if(s){if((g=Object(Wr.a)(e,t,e.schema.nodes.mediaSingle,i,c)).length&&a&&g.push({type:"custom",render:yr(f,t)}),o&&Ar(e)){var b=g.length>0;g.push({type:"custom",render:function(e,n){if(null!=e&&e.state){var r=function(){if(e){var t=e.state,n=e.dispatch;Kt(t,n)}};return l.a.createElement(Oi,{key:n,editorState:e.state,intl:t,mediaLinkingState:h,onAddLink:r,onEditLink:r,onOpenLink:function(){if(e){var t=e.state;return(0,e.dispatch)(Object(we.a)(t,t.tr,{eventType:ye.d.TRACK,action:ye.a.VISITED,actionSubject:ye.b.MEDIA,actionSubjectId:ye.c.LINK})),!0}},showSeparatorLeft:b})}return null}})}g.length&&g.push({type:"separator"})}if(u){var y=ft(e);if(y.isAltTextEditorOpen)return di(m,{altTextValidator:d});g.push(li(t,e),{type:"separator"})}var w=[].concat(rr()(g),[{type:"button",appearance:"danger",icon:ar.a,onMouseEnter:Object(sr.b)(p,!0),onMouseLeave:Object(sr.b)(p,!1),title:t.formatMessage(or.a.remove),onClick:Pi,testId:"media-toolbar-remove-button"}]);return xi(xi({},m),{},{items:w})}}(t,n,{providerFactory:r,allowResizing:e&&e.allowResizing,allowResizingInTables:e&&e.allowResizingInTables,allowAnnotation:e&&e.allowAnnotation,allowLinking:e&&e.allowLinking,allowAdvancedToolBarOptions:e&&e.allowAdvancedToolBarOptions,allowAltTextOnImages:e&&e.allowAltTextOnImages,altTextValidator:e&&e.altTextValidator})}}}};t.a=function(e){return Hi(Ki(Ki({},e),Wi))}},ct2w:function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var r=function(e){return!!e&&(e.indexOf("image/")>-1||e.indexOf("video/")>-1)}},eUFy:function(e,t,n){var r={"./atlassian_missing_french":"xyGe","./atlassian_missing_french.json":"xyGe","./en":"2maa","./en.json":"2maa","./fr":"Hsuv","./fr.json":"Hsuv"};function i(e){var t=a(e);return n(t)}function a(e){if(!n.o(r,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return r[e]}i.keys=function(){return Object.keys(r)},i.resolve=a,e.exports=i,i.id="eUFy"},jXUu:function(e,t,n){"use strict";var r=n("GeFe"),i=n.n(r),a=n("Zvb3"),o=n.n(a),s=n("J/YY"),c=n.n(s),l=n("a1Fv"),u=n.n(l),d=n("g3eI"),p=n.n(d),f=n("wDGE"),h=n.n(f),m=n("J58c"),v=n.n(m),g=n("ivGQ"),b=n.n(g),y=n("dKM3"),w=n("zy2m"),O=n("G09D");function k(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=h()(e);if(t){var i=h()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return p()(this,n)}}var x=function(e){u()(n,e);var t=k(n);function n(e){var r;return i()(this,n),r=t.call(this,e),v()(c()(r),"handleRef",(function(e){r.setState({target:e||void 0})})),v()(c()(r),"updatePopupPlacement",(function(e){r.setState({popupPlacement:e})})),r.state={popupPlacement:["bottom","left"]},r}return o()(n,[{key:"renderDropdown",value:function(){var e=this.state.target,t=this.props,n=t.children,r=t.mountTo,i=t.boundariesElement,a=t.scrollableElement,o=t.onOpenChange,s=t.fitHeight,c=t.fitWidth,l=t.zIndex;return b.a.createElement(w.a,{target:e,mountTo:r,boundariesElement:i,scrollableElement:a,onPlacementChanged:this.updatePopupPlacement,fitHeight:s,fitWidth:c,zIndex:l},b.a.createElement("div",{style:{height:0,minWidth:c||0}},b.a.createElement(y.a,{disabled:!0,isOpen:!0,onOpenChange:o,appearance:"tall",position:"top left",shouldFlip:!1,shouldFitContainer:!0},n)))}},{key:"render",value:function(){var e=this.props,t=e.trigger,n=e.isOpen;return b.a.createElement(b.a.Fragment,null,b.a.createElement("div",{ref:this.handleRef},t),n?this.renderDropdown():null)}}]),n}(g.PureComponent),P=Object(O.a)(x);t.a=P},k359:function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var r=new(n("4z1N").PluginKey)("mediaPlugin")},q5Wy:function(e,t,n){"use strict";var r=n("ivGQ"),i=n.n(r).a.createContext(!1);t.a=i},uU7o:function(e,t,n){"use strict";n.d(t,"a",(function(){return r})),n.d(t,"b",(function(){return i}));var r=function(e){return null!==e&&"string"!=typeof e&&e},i=function(e){var t;return(null===(t=/(.+)(\/.+)$/.exec(e))||void 0===t?void 0:t[1])||e}},upXl:function(e,t,n){e.exports={"note-article":"note-article--2yQdC","note-article--intents":"note-article--intents--ghgU0",banner:"banner--1nSEd",title:"title--2DQ8I",titleInput:"titleInput--2ERlh"}},"v/Qj":function(e,t,n){"use strict";var r=n("ivGQ"),i=n("q5Wy"),a=n("bOB9"),o=n("xEu0");t.a=function(){var e=Object(o.useClient)(),t=Object(r.useContext)(i.a),n=Object(r.useMemo)((function(){return Object(a.k)()||(t?"?":Object(a.j)(e))}),[e,t]);return{userId:n,userName:n}}},v2Ur:function(e,t,n){"use strict";n.d(t,"b",(function(){return r})),n.d(t,"a",(function(){return i})),n.d(t,"c",(function(){return a}));n("wlqn");var r=function(){var e=document.querySelector("[role=application]");return JSON.parse(e.dataset.cozy)},i=function(e,t){return/^\{\{\.[a-zA-Z]*\}\}$/.test(e)?t:e},a=function(){return new URLSearchParams(window.location.search).get("sharecode")}},xyGe:function(e){e.exports=JSON.parse('{"fabric.editor.editMode.inviteToEditButton.title":"Inviter Ã  Ã©diter","fabric.editor.blockquote2":"Citation","fabric.editor.remove":"Supprimer","fabric.editor.linkPlaceholder":"Coller le lien","fabric.editor.linkAddress":"Adresse du lien","fabric.editor.layoutWide":"Ã‰largir","fabric.editor.layoutFullWidth":"Pleine largeur","fabric.editor.layoutFixedWidth":"Retour au centre","fabric.editor.alignImageLeft":"Aligner l\'image Ã  gauche","fabric.editor.alignImageCenter":"Centrer l\'image","fabric.editor.alignImageRight":"Aligner l\'image Ã  droite","fabric.editor.numberedColumn":"Lignes numÃ©rotÃ©es","fabric.editor.taskPlaceholder":"Saisissez votre action"}')}});